/**
 * @license wysihtml v0.5.0
 * https://github.com/Voog/wysihtml
 *
 * Author: Christopher Blum (https://github.com/tiff)
 * Secondary author of extended features: Oliver Pulges (https://github.com/pulges)
 *
 * Copyright (C) 2012 XING AG
 * Licensed under the MIT license (MIT)
 *
 */

/**
 * Rangy, a cross-browser JavaScript range and selection library
 * https://github.com/timdown/rangy
 *
 * Copyright 2015, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3.0
 * Build date: 10 May 2015
 */

/**
 * Text range module for Rangy.
 * Text-based manipulation and searching of ranges and selections.
 *
 * Features
 *
 * - Ability to move range boundaries by character or word offsets
 * - Customizable word tokenizer
 * - Ignores text nodes inside <script> or <style> elements or those hidden by CSS display and visibility properties
 * - Range findText method to search for text or regex within the page or within a range. Flags for whole words and case
 *   sensitivity
 * - Selection and range save/restore as text offsets within a node
 * - Methods to return visible text within a range or selection
 * - innerText method for elements
 *
 * References
 *
 * https://www.w3.org/Bugs/Public/show_bug.cgi?id=13145
 * http://aryeh.name/spec/innertext/innertext.html
 * http://dvcs.w3.org/hg/editing/raw-file/tip/editing.html
 *
 * Part of Rangy, a cross-browser JavaScript range and selection library
 * https://github.com/timdown/rangy
 *
 * Depends on Rangy core.
 *
 * Copyright 2015, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3.0
 * Build date: 10 May 2015
 */

/**
 * Selection save and restore module for Rangy.
 * Saves and restores user selections using marker invisible elements in the DOM.
 *
 * Part of Rangy, a cross-browser JavaScript range and selection library
 * https://github.com/timdown/rangy
 *
 * Depends on Rangy core.
 *
 * Copyright 2015, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3.0
 * Build date: 10 May 2015
 */

/*
	Base.js, version 1.1a
	Copyright 2006-2010, Dean Edwards
	License: http://www.opensource.org/licenses/mit-license.php
*/

// implementation borrowed from https://github.com/tmpvar/jsdom/blob/681a8524b663281a0f58348c6129c8c184efc62c/lib/jsdom/level3/core.js // MIT license

/**
 * Inspired by the rangy CSS Applier module written by Tim Down and licensed under the MIT license.
 * http://code.google.com/p/rangy/
 *
 * changed in order to be able ...
 *    - to use custom tags
 *    - to detect and replace similar css classes via reg exp
 */

/* Copyright 2015, Penstro LLC
 * Author: Thomas Barry
 * 
 * Software provided as is, with no warranty, explicit or implied. Use at your own risk!
 * 
 * This software has no license. You are not permitted to reproduce, distribute, or create derivative works from this software. Some other software may be included or interspersed with this software; licenses are included for these works.
 */

define("config",[],function(){}),define("js/constants/params",[],function(){return{ALERT_ERROR:"aErr",ALERT_WARNING:"aWar",ALERT_INFO:"aInf",ALERT_SUCCESS:"aSuc",EXTERNAL_URL:"extUrl",PAGE:"page",SIZE:"size",SORT:"sort",TIME:"time",TIME_REPLIES:"replies",WARNING:"warning",PREVIEW:"preview",EVENT:"event",EMAIL_TOKEN:"emailToken",DIRECTION:"direction",TAGS:"tags",USER:"user",LANGUAGE:"lang",INTERFACE_LANGUAGE:"iLang",SCROLL_TO:"scrollTo",COMMENT_TYPE:"ctype",TRACKING_ID:"trackingId",PAYKEY:"paykey",PAYMENT_SUCCESS:"paymentSuccess",PAYMENT_CANCEL:"paymentCancel",FEEDBACK_TYPE:"feedbackType",FEEDBACK_STATE:"feedbackState",FEEDBACK_CONTEXT:"feedbackContext",ADMIN_TYPE:"adminType",ADMIN_STATE:"adminState",TARGET:"target",RESTRICTED_TYPE:"rtype",FLAG_REASON:"fR"}}),define("js/constants/regexes",[],function(){return{USERNAME_STRING:"[A-Za-z0-9_]*",TAG_STRING:"[A-Za-z0-9_]*",TITLE:/[^a-z0-9]+/g,EMAIL:/\S+@\S+\.\S+/,TAGS_DELIMITER_STRING:" ",ROLES_DELIMITER_STRING:" ",PENDING_ACTIONS_DELIMITER_STRING:" ",PAYKEY_COOKIE_DELIMITER:":",PAYKEY_COOKIE_DATA_DELIMITER:"+",ALIGN_CENTER_START_STRING:"tacs",ALIGN_LEFT_START_STRING:"tals",ALIGN_RIGHT_START_STRING:"tars",ALIGN_JUSTIFY_START_STRING:"tajs",ALIGN_END_STRING:"tae",FONT_SIZE_XSMALL_START_STRING:"tsxss",FONT_SIZE_SMALL_START_STRING:"tsss",FONT_SIZE_MEDIUM_START_STRING:"tsmds",FONT_SIZE_LARGE_START_STRING:"tslgs",FONT_SIZE_XLARGE_START_STRING:"tsxls",FONT_SIZE_END_STRING:"tse",FONT_COLOR_RED_START_STRING:"fcrs",FONT_COLOR_GREEN_START_STRING:"fcgs",FONT_COLOR_BLUE_START_STRING:"fcbs",FONT_COLOR_CYAN_START_STRING:"fccs",FONT_COLOR_MAGENTA_START_STRING:"fcms",FONT_COLOR_YELLOW_START_STRING:"fcys",FONT_COLOR_END_STRING:"fce"}}),define("js/constants/view-ids",[],function(){return{ALERTS:"alerts",PAGEABLE:"pageable",NAVBAR:"pyNavBar",SIDEBAR:"pySidebar",TOUR_SECTION:"pyTour",CONTENT:"content",REGISTER_RECAPTCHA:"registerRecaptcha"}}),define("js/constants/path-variables",[],function(){return{POSTING:"pid",COMMENT:"cid",USER:"uid",TAG:"tag",PARENT:"parid",TARGET:"tid",SOURCE:"sid",BENEFICIARY:"bid",TITLE:"tit",HELP:"helpid"}}),define("js/constants/view-urls",["js/constants/path-variables"],function(e){var t="/messages",n="/posts",r="/comments",i="/users",s="/tags",o="/followers",u="/following",a="/activity",f="/:",l="/profile",c="/replies",h="/offersOutstanding",p="/partials",d="/info",v="/single",m="/page",g="/compose",y="/reply",b="/response",w=n,E="/email",S="/change",x="/t",T="/edit",N="/help",C="/self";return{DEFAULT:w,AUTHENTICATION:w,LOGGED_OUT:"/securityLogout",NOT_FOUND:"/notFound",NO_CONTENT:"/noContent",RESET_PASSWORD:"/password/reset",INDEX:"/",INDEX_BLANK:"",SETTINGS:"/settings",SETTINGS_ERROR:"/settingsError",DELETED:"/deleted",TERMS:"/terms",EXTERNAL_URL:"/extUrl",PAYMENT:"/payment",PAYMENT_SUCCESS:"/payment/success",PAYMENT_CANCEL:"/payment/cancel",EMAIL_CHANGE:E+S,PAYMENT_CHANGE:"/payment"+S,PASSWORD_CHANGE:"/password"+S,CONFIRMATION:"/confirmation",DELETION:"/deleted"+S,CURRENT:l,CURRENT_REPLIES:l+c,CURRENT_POSTINGS:l+n,CURRENT_COMMENTS:l+r,CURRENT_SELF_POSTINGS:l+C+n,CURRENT_SELF_COMMENTS:l+C+r,NOTIFICATIONS:"/notifications",FEED:"/feed",BACKERS:"/backers",BACKEES:"/backing",FOLLOWERS:o,FOLLOWEES:u,BLOCKED:"/blocked",OFFERS:"/offers",OFFEES:h,OFFEES_EMAIL:h+E,MESSAGES:t,POSTINGS:n,POSTINGS_CREATE:g,POSTINGS_ID:n+f+e.POSTING,POSTINGS_ID_TITLE:n+f+e.POSTING+x+f+e.TITLE,COMMENTS:r,COMMENTS_ID:r+f+e.COMMENT,TAGS:s,TAGS_ID:s+f+e.TAG,TAGS_ID_REPLIES:s+f+e.TAG+c,USERS:i,USERS_ID:i+f+e.USER,USERS_ID_REPLIES:i+f+e.USER+c,USERS_ID_FOLLOWERS:i+f+e.USER+o,USERS_ID_FOLLOWEES:i+f+e.USER+u,USERS_ID_POSTINGS:i+f+e.USER+n,USERS_ID_COMMENTS:i+f+e.USER+r,USERS_ID_MESSAGES:i+f+e.USER+t,WELCOME:"/welcome",ACCOUNT:"/account",CAREERS:"/careers",SUPPORT:"/support",HELP:N,HELP_ID:N+f+e.HELP,slashless:function(e){return typeof e!="undefined"&&e.length>0&&e.charAt(0)==="/"?e.substring(1,e.length):e}}}),define("js/util/utils",["moment","js/constants/params","js/constants/regexes","js/constants/view-ids","js/constants/view-urls","js/constants/path-variables"],function(e,t,n,r,i,s){var o={};o[t.ALERT_ERROR]=!0,o[t.ALERT_WARNING]=!0,o[t.ALERT_INFO]=!0,o[t.ALERT_SUCCESS]=!0;var u=[],a=function(e){var t;if(typeof e!="undefined"){t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n)}return t},f=function(e){return typeof e=="undefined"?undefined:Object.prototype.toString.call(e)===Object.prototype.toString.call([])?e:[e]},l=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&!o.hasOwnProperty(n)&&(t[n]=e[n]);return c(t)},c=function(e){var t=e||{},n="",r="?";for(var i in t)if(t.hasOwnProperty(i)&&typeof t[i]!="undefined"&&t[i]!==null){var s=t[i];if(s instanceof Array){for(var o=0;o<s.length;o++)try{n=n+r+i+"="+encodeURIComponent(s[o]),r="&"}catch(u){}r="&"}else if(typeof s=="string")try{n=n+r+i+"="+encodeURIComponent(s),r="&"}catch(u){}else try{n=n+r+i+"="+encodeURIComponent(s),r="&"}catch(u){}}return n},h=function(e,t){if(typeof t!="undefined"&&t!==null){if(Object.prototype.toString.call(t)===Object.prototype.toString.call([])&&t.length>0){var n=[],r;for(r=0;r<t.length;r++)typeof t[r]!="undefined"&&t[r]!==null&&n.push(t[r]);return e.replace(/{(\d+)}/g,function(e,t){return typeof n[t]!="undefined"?n[t]:e})}if(Object.prototype.toString.call(t)===Object.prototype.toString.call({}))return e.replace(/:[A-Za-z0-9]+/g,function(e,n){var r=e.substring(1,e.length);return typeof t[r]!="undefined"&&t[r]!==null?t[r]:e})}return e},p=function(e,t){var n=e,r;for(r in t)t.hasOwnProperty(r)&&(n=n.replace(":"+r,t[r]));return n},d=function(e,t){var n=e;if(typeof e!="undefined"&&typeof e=="string"&&typeof t!="undefined"&&t!==null){var r="({",i=!1;for(var s in t)t.hasOwnProperty(s)&&(n=n+r+s+": '"+t[s]+"'",r=", ",i=!0);i&&(n+="})")}return n},v=function(e){var t={};if(typeof e!="undefined"){e=e.substr(1);var n=e.split("&");for(var r=0;r<n.length;r++){var i=n[r].split("=");i.length>1&&(t[i[0]]=i[1])}}return t},m=function(e){return typeof e!="undefined"&&e!==null&&e!==""?!0:!1},g=function(e){return function(t){var n=[];if(typeof t!="undefined"){var r=t.split(e);if(typeof r!="undefined"){var i,s;for(i=0;i<r.length;i++)s=r[i],typeof s!="undefined"&&s!==""&&n.push(s)}}return n}},y=function(e){var t,n,r;if(typeof e!="undefined")for(n in e)e.hasOwnProperty(n)&&(typeof t=="undefined"||typeof r=="undefined"||e[n]>r)&&(t=n,r=e[n]);return t},b=function(e){if(typeof e=="undefined"||e.length===0)return 0;var t=0,n,r;for(n=0;n<e.length;n++)r=e.charCodeAt(n),t=(t<<5)-t+r,t|=0;return t};return{isExternalUrl:function(e,t){return typeof e!="undefined"&&typeof t!="undefined"?e!==t:!0},getStringHash:b,isObjectEmpty:function(e){if(e===null)return!0;if(e.length>0)return!1;if(e.length===0)return!0;for(var t in e)if(hasOwnProperty.call(e,t))return!1;return!0},getHighestKeyValue:y,getCurrencySymbol:function(e){return"$"},format:h,formatUrl:p,formatState:d,constructHelpLink:function(e,n){if(typeof e=="undefined")return i.HELP;var r,o={};return o[s.HELP]=e,r=p(i.HELP_ID,o),typeof n!="undefined"&&(r=r+"?"+t.SCROLL_TO+"="+n),r},constructNJTermsLink:function(e){return typeof e=="undefined"?i.TERMS:i.TERMS+"#NJ"+e},constructTermsLink:function(e){return typeof e=="undefined"?i.TERMS:i.TERMS+"?"+t.SCROLL_TO+"="+e},constructTermsScrollToLink:function(e){return"#"+e},constructPath:function(e,t,n){return h(e,t)+c(n)},constructQueryPathString:function(e,t,n){return h(e,t)+n},addQuery:function(e,t,n){var r={},i;for(i in n)n.hasOwnProperty(i)&&!o.hasOwnProperty(i)&&(r[i]=n[i]);try{r[e]=encodeURIComponent(t)}catch(s){}return c(r)},constructQueryString:c,constructFilteredQueryString:l,getQueryList:f,getAnchorHref:function(){return"javascript:void(0);"},getTimeSince:function(t){return e.utc(t).fromNow()},getCalendarDate:function(t){return e.utc(t).calendar()},getTimeISO:function(e){return typeof e!="undefined"?(new Date(e)).toISOString():undefined},invertObject:a,parseTags:g(n.TAGS_DELIMITER_STRING),parseRoles:g(n.ROLES_DELIMITER_STRING),parsePendingActions:g(n.PENDING_ACTIONS_DELIMITER_STRING),getEncodedTitle:function(e){if(typeof e!="undefined"){var t=e.toLowerCase().replace(n.TITLE," ");return t.trim().replace(n.TITLE,"-")}return e},createFullTitle:function(e,t,n){return typeof t=="undefined"||typeof n=="undefined"?e:t+n+e},getTourId:function(e,t,n){var i="f";return n&&(i="t"),r.TOUR_SECTION+"-"+e+"-"+i+"-"+t},isValidAuthenticationToken:m,tagify:function(e){var t="";if(typeof e=="undefined"||!Array.isArray(e))return t;for(var n=0;n<e.length;n++)t=t+" [ "+e[n]+" ] ";return t},getNestedValue:function(e,t){var n=t.split(".");while(n.length&&(e=e[n.shift()]));return e},setNestedValue:function(e,t,n){var r=t.split(".");while(r.length>1&&(e=e[r.shift()]));e[r.shift()]=n},getQueryObject:v,getBaseUrl:function(e){var t=e.protocol()||"http",n=e.host(),r=e.port(),i=t+"://"+n;return typeof r!="undefined"&&(i=i+":"+r),i}}}),define("js/constants/language-settings",[],function(){var e="locales/__lng__/__ns__.json",t={en:"English"},n=[],r=t,i=[];for(var s in t)t.hasOwnProperty(s)&&n.push(s);for(s in r)r.hasOwnProperty(s)&&i.push(s);return{RESOURCE_PATH:e,LANGUAGES:t,LANGUAGE_LIST:n,INTERFACE_LANGUAGES:r,INTERFACE_LANGUAGE_LIST:i,SERVER_NAMESPACES:["translation","shared","titles","help","tour","terms"],SERVER_DEFAULT_NAMESPACE:"translation",CLIENT_NAMESPACES:["alerts","validation","shared","titles"],CLIENT_DEFAULT_NAMESPACE:"alerts",DEFAULT_LANGUAGE:"en",USE_COOKIE:!0,SERVER_LOCAL_STORAGE_EXPIRATION:2592e6,CLIENT_LOCAL_STORAGE_EXPIRATION:2592e6}}),define("js/constants/webapp",["config"],function(e){typeof window!="undefined"&&typeof window.pyGetClientConfig!="undefined"&&(e=window.pyGetClientConfig());var t=e.app.protocol+"://"+e.app.host,n=typeof e.app.protocol!="undefined"&&e.app.protocol.toLowerCase()==="https",r=e.app.httpPort;return n?(r=e.app.httpsPort,r!==443&&(t=t+":"+r)):r!==80&&(t=t+":"+r),{DOMAIN:e.app.host,URL:t}}),define("js/constants/cookies",["js/constants/webapp"],function(e){var t={domain:e.DOMAIN,path:"/",secure:!1,expires:0};return{AUTHENTICATION_TOKEN:"A-T",WARNING:"w",LANGUAGE:"l",INTERFACE_LANGUAGE:"iL",TIME:"t",TIME_REPLIES:"tR",SORT:"s",PAYKEYS:"pk",TOUR:"to",INDEX:"i",TEST_COOKIES_ENABLED:"tcd",BETA_ALERT:"ba",getCookieOptions:function(){return t}}}),define("js/util/i18n",["i18next","config","js/util/utils","js/constants/language-settings","js/constants/params","js/constants/cookies"],function(e,t,n,r,i,s){var o;typeof window!="undefined"&&(typeof window.pyGetI18nData!="undefined"&&(o=window.pyGetI18nData()),typeof window.pyGetClientConfig!="undefined"&&(t=window.pyGetClientConfig()));var u=[],a={resGetPath:"/resources/"+r.RESOURCE_PATH,load:"unspecific",supportedLngs:r.INTERFACE_LANGUAGE_LIST,preload:r.DEFAULT_LANGUAGE,ns:{namespaces:r.CLIENT_NAMESPACES,defaultNs:r.CLIENT_DEFAULT_NAMESPACE},fallbackLng:r.DEFAULT_LANGUAGE,detectLngQS:i.INTERFACE_LANGUAGE,useCookie:r.USE_COOKIE,cookieName:s.INTERFACE_LANGUAGE,cookieDomain:s.getCookieOptions().domain};t.cache&&(a.useLocalStorage=!0,a.localStorageExpriationTime=r.CLIENT_LOCAL_STORAGE_EXPIRATION);var f,l,c;if(a.useLocalStorage){var h=function(){try{window.localStorage.removeItem("res_"+o.lng)}catch(e){}};if(window&&typeof window.localStorage!="undefined")if(typeof o!="undefined"&&typeof o.lng!="undefined"&&typeof o.i18nStamp!="undefined")try{l=window.localStorage.getItem("res_"+o.lng),typeof l!="undefined"&&(c=JSON.parse(l),c.i18nStamp<o.i18nStamp&&h())}catch(p){h()}else try{window.localStorage.clear()}catch(p){}}return e.init(a,function(e){f=e;var t=u.length;for(var n=0;n<t;n++)u[n](f);u=[]}),function(t,n){n=n||{},typeof n.language!="undefined"&&(f=undefined,e.setLng(n.language,function(e){f=e})),typeof t!="undefined"&&(typeof f=="undefined"?u.push(t):t(f))}}),define("js/constants/whitelist-urls",[],function(){var e=["self","https://www.sandbox.paypal.com/**"],t=[],n=[];return{URLS:e,HREFS:t,IMGS:n}}),define("js/controller/module",["angular"],function(e){return e.module("app.controller",["app.service"])}),define("js/util/validation-errors",[],function(){var e=function(e){var t={},n=function(){};return e&&t.toString.call(e)===t.toString.call(n)},t=function(e){var t=e||{},n=t.errors;return typeof n!="undefined"&&Object.prototype.toString.call(n)===Object.prototype.toString.call([])?n:[]};return{isValid:function(e){var t=e||{},n=t.errors;return typeof n!="undefined"&&Object.prototype.toString.call(n)===Object.prototype.toString.call([])?!0:!1},getErrorList:t,getArguments:function(e){var t=e.arguments||[],n={};for(var r=0;r<t.length;r++)n[r]=t[r];return n},getValidCode:function(e){var t=e.code||"default",n=e.defaultCode,r=e.arguments;return(typeof r=="undefined"||r.length<1)&&typeof n!="undefined"?n:t},handleErrorsInOrder:function(n,r,i){if(!e(i))return;var s=r||[],o=t(n),u={},a;for(a=0;a<o.length;a++)u[o[a].field]=o[a];var f;for(a=0;a<s.length;a++)if(typeof f=="undefined"||f)f=i(s[a],u[s[a]])}}}),define("js/constants/response-codes",[],function(){return{SUCCESS:200,CREATED:201,DELETED:204,FAILURE:400,DENIED:401,INVALID:420,NOT_ALLOWED:424,LIMIT:425,LOCKED:403,LOGIN_LOCKED:430,OBJECT_LOCKED:423,EXPIRED:419,THEFT:498,EXISTS:409,EXISTS_USERNAME:481,EXISTS_EMAIL:482,NOT_FOUND:410,NOT_FOUND_BACKER:491,ERROR:500,BALANCE:412,FINANCE:500,PAYMENT:500,PAYMENT_TARGET:402,EXTERNAL_SERVICE:520,FEATURE_DISABLED:521,PAGEABLE:416,PARAMETER:449,RESTRICTED:460,RESTRICTED_USERNAME:461,RESTRICTED_PASSWORD:462,RESTRICTED_EMAIL:463,THROTTLED_ADDRESS:429}}),define("js/constants/events",[],function(){var e="DESTROY";return{BACK:"back",PAYMENT:"payment",PAYMENT_END:"paymentEnd",PAYMENT_MODAL_OPEN:"paymentModalOpen",PURCHASE_MODAL_OPEN:"purchaseModalOpen",CACHE_DELAY_SHOW_TOGGLE:"cacheDelayShowToggle",PAYMENT_PROCESSING_SHOW_TOGGLE:"paymentProcessingShowToggle",APPRECIATION_SUCCESS:"appreciationSuccess",APPRECIATION_SHOW_RESPONSE:"appreciationShowResponse",PAGE_CHANGE:"pageChange",SINGLE_CHANGE:"singleChange",SINGLE_ERROR_NOT_ALLOWED:"singleErrorNotAllowed",SINGLE_ERROR_NOT_FOUND:"singleErrorNotFound",SINGLE_ERROR_DENIED:"singleErrorDenied",BALANCE_CHANGE:"balanceChange",LOGIN_CHANGE:"loginChange",PRE_LOGIN_CHANGE:"preLoginChange",CUSTOM_STATE_CHANGE_START:"customStateChangeStart",CUSTOM_STATE_CHANGE_SUCCESS:"customStateChangeSuccess",CUSTOM_LOCATION_CHANGE_SUCCESS:"customLocationChangeSuccess",LIST_SELECT_ITEM:"listSelectItem",UNSAVED_CHANGES_COMPLETE:"unsavedChangesComplete",PREVIEW_UPDATE_PRE:"previewUpdatePre",PREVIEW_UPDATE:"previewUpdate",TOUR_SECTION_CHANGE:"tourSectionChange",TOUR_SHOW_TOGGLE:"tourShowToggle",REGISTER_OPEN:"registerOpen",LOGIN_OPEN:"loginOpen",RECAPTCHA_LOADED:"recaptchaLoaded",TOGGLE_AUTO_REFRESH:"toggleAutoRefresh",SET_EDITOR:"setEditor",destroy:function(t){return e+t+e}}}),define("js/constants/roles",[],function(){return{roles:{ADMIN:"admin"},overrideRoles:{UNACCEPTED:"unaccepted",DELETED:"deleted"}}}),define("js/constants/values",[],function(){return{VOID_ACTION:"javascript: void(0);",LOADED_FAILED:null,MAX_PAGES:5,PAYMENT_AUTO_MARK_SECONDS:60,PAYMENT_CHECK_RETRIES:10,PAYMENT_CHECK_DEFER:20,PAYMENT_MARK_RETRIES:10,PAYMENT_MARK_DEFER:20,PAYMENT_COOKIE_LIMIT:10,PASSWORD_STRENGTH_THROTTLE_MILLISECONDS:1e3,AUTOLOAD_TIMEOUT_MULTIPLIER:250,CURRENCY_TOTAL_CALCULATION_TIME:1,CONVERSATION_REFRESH:30,USER_OPTIONS_REFRESH:60,AUTHENTICATION_CHECK:5,APPRECIATION_MIN:1,PURCHASE_MIN:100,PROMOTION_MIN:1,OFFER_MIN:1,POSTING_MIN:0,COMMENT_MIN:0,CURRENCY_PRECISION:2,STEP_SUSPENSIONS:undefined,STEP_COINS:undefined,STEP_CURRENCY:"any",IMAGE_MIN:0,IMAGE_STEP:1,SCRIPT_TIMEOUT:30,TEXTAREA_ROWS:12,TEXTAREA_COLS:40,OG_IMAGE_WIDTH:200,OG_IMAGE_HEIGHT:200,SCROLLSPY_OFFSET:80,WINDOW_NAME:"PenstroWebapp",MS_TILE_COLOR:"#1e91a2",RECAPTCHA_ONLOAD:"pyOnloadRecaptcha",RECAPTCHA_CALLBACK:"pyOnCallbackRecaptcha",CLICKY_ID:100915372}}),define("js/constants/states",["js/constants/path-variables"],function(e){var t="messages",n="replies",r="posts",i="comments",s="users",o="tags",u="followers",a="following",f="activity",l="offersOutstanding",c=".",h="-",p="change",d="edit",v="create",m="current",g="partials",y="info",b="single",w="page",E="createComment",S="response",x="back",T="email",N="help",C="base",k="root",L=function(e){return k+c+e},A=function(e){return e};return{ROOT:k,DEFAULT:L(r),AUTHENTICATION:L(r),LOGGED_OUT:L("loggedOut"),NOT_FOUND:L("notFound"),NO_CONTENT:L("noContent"),RESET_PASSWORD:L("resetPassword"),INVALID:L("invalid"),INDEX:L("index"),SETTINGS:L("settings"),SETTINGS_ERROR:L("settingsError"),DELETED:L("deleted"),TERMS:L("terms"),EXTERNAL_URL:L("externalUrl"),WELCOME:L("welcome"),ACCOUNT:L("account"),CAREERS:L("careers"),SUPPORT:L("support"),HELP:L(N),HELP_ID:L(N+h+A(e.HELP)),PAYMENT:L("payment"),PAYMENT_SUCCESS:L("payment"+h+"success"),PAYMENT_CANCEL:L("payment"+h+"cancel"),EMAIL_CHANGE:L(T+h+p),PAYMENT_CHANGE:L("payment"+h+p),PASSWORD_CHANGE:L("password"+h+p),CONFIRMATION:L("confirmation"),DELETION:L("deleted"+h+p),CURRENT:L(m),CURRENT_APPRECIATION_RESPONSE:L(m+h+S),CURRENT_CREATE_COMMENT:L(m+h+E),CURRENT_REPLIES:L(m+h+n),CURRENT_POSTINGS:L(m+h+r),CURRENT_COMMENTS:L(m+h+i),CURRENT_SELF_POSTINGS:L(m+h+"self"+r),CURRENT_SELF_COMMENTS:L(m+h+"self"+i),NOTIFICATIONS:L(m+h+"notifications"),FEED:L(m+h+"feed"),BACKERS:L(m+h+"backers"),BACKEES:L(m+h+"backing"),FOLLOWERS:L(m+h+u),FOLLOWEES:L(m+h+a),BLOCKED:L(m+h+"blocked"),OFFERS:L(m+h+"offers"),OFFEES:L(m+h+l),OFFEES_EMAIL:L(m+h+l+h+T),MESSAGES:L(m+h+t),POSTINGS:L(r),POSTINGS_CREATE:L(r+h+v),POSTINGS_ID:L(r+h+A(e.POSTING)),POSTINGS_ID_TITLE:L(r+h+A(e.POSTING)+h+A(e.TITLE)),POSTINGS_ID_CREATE_COMMENT:L(r+h+A(e.POSTING)+h+E),POSTINGS_ID_EDIT:L(r+h+A(e.POSTING)+h+d),COMMENTS:L(i),COMMENTS_ID:L(i+h+A(e.COMMENT)),COMMENTS_ID_CREATE_COMMENT:L(i+h+A(e.COMMENT)+h+E),TAGS:L(o),TAGS_ID:L(o+h+A(e.TAG)),TAGS_ID_CREATE_COMMENT:L(o+h+A(e.TAG)+h+E),TAGS_ID_REPLIES:L(o+h+A(e.TAG)+h+n),USERS:L(s),USERS_ID:L(s+h+A(e.USER)),USERS_ID_APPRECIATION_RESPONSE:L(s+h+A(e.USER)+h+S),USERS_ID_CREATE_COMMENT:L(s+h+A(e.USER)+h+E),USERS_ID_REPLIES:L(s+h+A(e.USER)+h+n),USERS_ID_FOLLOWERS:L(s+h+A(e.USER)+h+u),USERS_ID_FOLLOWEES:L(s+h+A(e.USER)+h+a),USERS_ID_POSTINGS:L(s+h+A(e.USER)+h+r),USERS_ID_COMMENTS:L(s+h+A(e.USER)+h+i),USERS_ID_MESSAGES:L(s+h+A(e.USER)+h+t),state:L,id:A}}),define("js/controller/main",["./module","jquery","angular","js/util/i18n","js/util/validation-errors","js/util/utils","js/constants/response-codes","js/constants/path-variables","js/constants/view-urls","js/constants/events","js/constants/roles","js/constants/values","js/constants/states"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){e.controller("MainController",["$modal","$rootScope","$scope","$state","Loaded","Title","Alerts","Authentication","AutoRefresh","CurrentUser","Payment","ModalInterface","pyFinance",function(e,t,n,s,u,a,p,d,v,m,g,y,b){n.loaded=u,n.title=a,n.show=!1,n.navbar={navigationCollapsed:!0,actionCollapsed:!0,subnavNavigationCollapsed:!0,subnavActionCollapsed:!0},n.navbar.dismissAll=function(){n.navbar.navigationCollapsed=!0,n.navbar.actionCollapsed=!0,n.navbar.subnavNavigationCollapsed=!0,n.navbar.subnavActionCollapsed=!0},n.navbar.toggleNavigation=function(){var e=!n.navbar.navigationCollapsed;n.navbar.dismissAll(),n.navbar.navigationCollapsed=e},n.navbar.toggleAction=function(){var e=!n.navbar.actionCollapsed;n.navbar.dismissAll(),n.navbar.actionCollapsed=e},n.navbar.dismissNavigation=function(){n.navbar.navigationCollapsed=!0},n.navbar.dismissAction=function(){n.navbar.actionCollapsed=!0},n.navbar.subnavToggleNavigation=function(){var e=!n.navbar.subnavNavigationCollapsed;n.navbar.dismissAll(),n.navbar.subnavNavigationCollapsed=e},n.navbar.subnavToggleAction=function(){var e=!n.navbar.subnavActionCollapsed;n.navbar.dismissAll(),n.navbar.subnavActionCollapsed=e},n.navbar.subnavDismissNavigation=function(){n.navbar.subnavNavigationCollapsed=!0},n.navbar.subnavDismissAction=function(){n.navbar.subnavActionCollapsed=!0},t.$on("$stateChangeStart",function(e){n.navbar.dismissAll()});var w={loading:!1,open:!1,hasAccepted:!1};n.purchaseData=w;var E=function(e){n.currentUser=e,n.notificationCount=undefined,n.messageCount=undefined,n.feedCount=undefined,r(function(t){n.show=!0,e.notificationCount>0&&(n.notificationCount=e.notificationCount),e.messageCount>0&&(n.messageCount=e.messageCount),e.feedCount>0&&(n.feedCount=e.feedCount)})},S=function(){n.show=!1},x=function(e,t,i){n.loadedBalance=!0,r(function(e){n.balance=t.balance})},T=function(){n.authenticated&&(n.loadedBalance=u.FAILED,r(function(e){p.warning(e("alerts:user.balanceError"))}))},N=function(e){b.balance(x,e,e)},C=function(){m.hasOverrideRole(l.overrideRoles.UNACCEPTED,function(e){e?w.hasAccepted=!1:w.hasAccepted=!0})},k=function(e){n.authenticated=e,e?(m.getFresh(E,S),m.refreshRoles(),C(),N(T)):(n.show=!0,w.hasAccepted=!1)};k(d.isAuthenticated()),t.$on(f.LOGIN_CHANGE,function(e,t){k(t)}),t.$on(f.PRE_LOGIN_CHANGE,function(e,t){n.show=!1});var L=function(){d.isAuthenticated()&&(m.getFresh(E,function(){}),N(function(){}))};v.manageRefresh(L,c.USER_OPTIONS_REFRESH,undefined,!0),t.$on(f.BALANCE_CHANGE,function(e){n.authenticated&&N(function(){})});var A=function(e,n){e.purchaseData=w,w.amount=undefined,w.errors={},w.loading=!1,w.alert=undefined,e.sinceAction=0,e.amount="0.00",e.tax="0.00",e.total="0.00",e.result={amount:0,tax:0,total:0},v.manageRefresh(function(){e.sinceAction++},1,f.destroy("PurchaseModalCtrl"),!1,!1),e.$on("$destroy",function(e){t.$broadcast(f.destroy("PurchaseModalCtrl"))}),e.$watch("purchaseData.amount",function(t,n){t!==n&&(e.sinceAction=0-c.CURRENCY_TOTAL_CALCULATION_TIME,b.calculatePurchaseTotals(function(t,n){e.result=n,e.amount="0.00",e.tax="0.00",e.total="0.00",typeof n!="undefined"&&(typeof n.amount!="undefined"&&(e.amount=n.amount.toFixed(c.CURRENCY_PRECISION)),typeof n.tax!="undefined"&&(e.tax=n.tax.toFixed(c.CURRENCY_PRECISION)),typeof n.total!="undefined"&&(e.total=n.total.toFixed(c.CURRENCY_PRECISION)))},function(){},function(){},w.amount))});var s=function(e,t){r(function(n){w.loading=!1,e===o.INVALID&&typeof t!="undefined"?i.handleErrorsInOrder(t,["amount"],function(e,t){if(t){var r="validation:"+i.getValidCode(t);w.errors[e]=n(r,i.getArguments(t))}else w.errors[e]=undefined}):w.alert=n("alerts:purchaseCurrency.error")})},u=function(e,t,r){w.loading=!1,n.close(!0),g.payment(t.result,!1)},a=function(){r(function(e){w.loading=!1,w.alert=e("alerts:apiError")})};e.submit=function(){w.hasAccepted&&(w.errors={},w.alert=undefined,w.loading=!0,b.purchaseCurrency(u,s,a,w.amount))},e.cancel=function(){n.dismiss("cancel")}},O=function(){if(w.hasAccepted){var t=e.open({templateUrl:"purchaseModal",controller:y.controller(A),backdrop:!1});t.result.then(function(){w.open=!1},function(){w.open=!1}),t.opened.then(function(){w.open=!0},function(){w.open=!1})}else{var n;w.hasAccepted||(n=s.href(h.TERMS),m.alertOverrideRole(l.overrideRoles.UNACCEPTED,n)),m.refreshRoles(),C()}};n.openPurchase=function(e){O()},t.$on(f.PURCHASE_MODAL_OPEN,function(e){O()}),u.account=!0}])}),define("js/constants/scope-variables",[],function(){return{PAGEABLE:"_$pageable$_",SINGLE:"_$single$_",INDEX:"$index"}}),define("js/constants/chained-keys",[],function(){return{DATA:"data",SINGLE:"single",FOLLOW:"follow",BLOCK:"block",APPRECIATION_RESPONSE:"appreciationResponse",BALANCE:"balance",CURRENT:"current",ROLES:"roles"}}),define("js/controller/single",["./module","jquery","angular","js/constants/events","js/constants/scope-variables","js/constants/chained-keys"],function(e,t,n,r,i,s){e.controller("SingleController",["$scope","$parse",function(e,t){e.single=t(e.$parent[i.SINGLE])(e.$parent),e[i.SINGLE]="single",e[i.INDEX]=e.$parent[i.INDEX],n.isDefined(e.$parent[i.SINGLE])&&e.$watch("$parent."+e.$parent[i.SINGLE]+"."+s.DATA+"."+s.SINGLE,function(n,r){n!==r&&(e.single=t(e.$parent[i.SINGLE])(e.$parent))})}])}),define("js/controller/help",["./module","jquery","angular","js/constants/states","js/constants/path-variables","js/constants/params"],function(e,t,n,r,i,s){e.controller("HelpLinkController",["$scope","$state",function(e,t){e.init=function(n,o){if(typeof n=="undefined"){e.link=t.href(r.HELP);return}var u={};u[i.HELP]=n,typeof o!="undefined"&&(u[s.SCROLL_TO]=o),e.link=t.href(r.HELP_ID,u)}}]),e.controller("HelpController",["$rootScope","$scope","$location","$timeout","Browser","Loaded",function(e,t,n,r,i,o){t.loaded=o,t.$watch("loaded.content",function(e,o){var u=n.search()[s.SCROLL_TO];e===!0&&typeof u!="undefined"&&u!==""&&t.$evalAsync(function(){r(function(){i.scrollTo(u)},1)})}),o.resetInfo(!0),o.loadedInfo()}])}),define("js/controller/pageable",["./module","jquery","angular","js/util/i18n","js/constants/events","js/constants/view-ids","js/constants/scope-variables"],function(e,t,n,r,i,s,o){e.controller("PageableController",["$scope","$parse","$state","$timeout","Alerts","Browser","Options",function(e,t,u,a,f,l,c){var h=t(e.$parent[o.PAGEABLE])(e.$parent);e.pageable=h,e[o.PAGEABLE]="pageable";var p=!1,d=!1,v=function(t,i){if(n.isDefined(t)){e.pageable=t;var o,a,f,h=t.getAlternatives();e.alternatives=[],e.alternativesOpen=!1,e.alternativesCurrent=undefined,e.altActive=undefined,e.altIcon=undefined,r(function(r){if(typeof h!="undefined"&&h.length>0)for(var i=0;i<h.length;i++)typeof h[i].label!="undefined"&&typeof h[i].state!="undefined"&&(o=h[i].state===u.current.name,f=h[i].icon,typeof f=="undefined"&&(f="fa"),a=r(h[i].label),o&&(e.altActive=a,e.altIcon=f),e.alternatives.push({label:a,icon:f,state:h[i].state,active:o,params:h[i].params}));else e.alternatives=undefined;n.isDefined(t.search)&&(n.isDefined(t.search.searchLabel)&&(e.searchLabel=r(t.search.searchLabel)),n.isDefined(t.search.symbol)&&(e.searchSymbol=r(t.search.symbol)))}),c.setPage(i),p&&!d&&t.scroll&&(d=!0,l.scrollTo(s.PAGEABLE))}};if(n.isDefined(h)){var m=h.getFirst();v(h,m)}p=!0,e.$on(i.PAGE_CHANGE,function(e,t,n){e.defaultPrevented||(e.preventDefault(),v(t,n))}),e.onPrevious=function(){h.getPrevious()},e.onNext=function(){h.getNext()},e.alternativeClick=function(t){var n,r;typeof e.alternatives!="undefined"&&(n=e.alternatives[t],typeof n!="undefined"&&typeof n.state!="undefined"&&(r=u.go(n.state,u.params,{reload:!0})))},e.$watch("$parent."+e.$parent[o.PAGEABLE],function(r,i){r!==i&&(h=t(e.$parent[o.PAGEABLE])(e.$parent),n.isDefined(h)&&(m=h.getFirst(),v(h,m)))})}]),e.controller("SubPageableController",["$scope","$parse","$state",function(e,t,r){var s=t(e.$parent[o.PAGEABLE])(e.$parent);e.pageable=s,e[o.PAGEABLE]="pageable";var u=function(t,r){n.isDefined(t)&&(e.pageable=t)};if(n.isDefined(s)){var a=s.getFirst();u(s,a)}e.$on(i.PAGE_CHANGE,function(e,t,n){e.defaultPrevented||(e.preventDefault(),u(t,n))}),e.onPrevious=function(){s.getPrevious()},e.onNext=function(){s.getNext()},e.$watch("$parent."+e.$parent[o.PAGEABLE],function(r,i){r!==i&&(s=t(e.$parent[o.PAGEABLE])(e.$parent),n.isDefined(s)&&(a=s.getFirst(),u(s,a)))})}]),e.controller("PageableItemController",["$scope",function(e){e[o.SINGLE]="pageItem"}])}),define("js/constants/param-values",[],function(){return{TIME_OPTION_HOUR:"HOUR",TIME_OPTION_DAY:"DAY",TIME_OPTION_MONTH:"MONTH",TIME_OPTION_YEAR:"YEAR",TIME_OPTION_ALLTIME:"ALLTIME",SORT_OPTION_VALUE:"VALUE",SORT_OPTION_PROMOTION:"PROMOTION",SORT_OPTION_COST:"COST",DIRECTION_ASCENDING:"ascending",DIRECTION_DESCENDING:"descending",FLAG_REASON_ILLICIT:"ILLICIT",FLAG_REASON_VIOLATION:"VIOLATION",FLAG_REASON_SPAM:"SPAM",FLAG_REASON_PLAGIARISM:"PLAGIARISM"}}),define("js/controller/options",["./module","jquery","angular","js/util/i18n","js/constants/params","js/constants/param-values","js/constants/events","js/constants/scope-variables"],function(e,t,n,r,i,s,o,u){var a=function(e,t,i,o,a){e.label={},e.optionalOpen=!1,r(function(t){e.label[s.TIME_OPTION_HOUR]=t("shared:lastTimeOption.hour"),e.label[s.TIME_OPTION_DAY]=t("shared:lastTimeOption.day"),e.label[s.TIME_OPTION_MONTH]=t("shared:lastTimeOption.month"),e.label[s.TIME_OPTION_YEAR]=t("shared:lastTimeOption.year"),e.label[s.TIME_OPTION_ALLTIME]=t("shared:lastTimeOption.alltime")});var f=function(t){e.time={},e.time[t]=!0,e.timeLabel=e.label[t]};f(o()),e.onChange=function(r){i.setPage(0),a(r),f(r);var s=t(e.$parent[u.PAGEABLE])(e.$parent);n.isDefined(s)&&s.refresh(0)}};e.controller("TimeSelectController",["$parse","$scope","Options",function(e,t,n){a(t,e,n,n.getTime,n.setTime)}]),e.controller("TimeRepliesSelectController",["$parse","$scope","Options",function(e,t,n){a(t,e,n,n.getTimeReplies,n.setTimeReplies)}]),e.controller("SortSelectController",["$parse","$scope","Options",function(e,t,r){var i=function(e){t.sort={},t.sort[e]=!0};i(r.getSort()),t.onChange=function(s){r.setPage(0),r.setSort(s),i(s);var o=e(t.$parent[u.PAGEABLE])(t.$parent);n.isDefined(o)&&o.refresh(0)}}]),e.controller("WarningController",["$parse","$scope","Options",function(e,t,n){t.accept=function(e){n.setWarning(!0),t.$parent[e]=!t.$parent[e]}}]),e.controller("ContentPreviewController",["$rootScope","$scope","Options",function(e,t,n){t.preview=function(){e.$broadcast(o.PREVIEW_UPDATE_PRE),e.$broadcast(o.PREVIEW_UPDATE)}}])}),define("js/constants/api",["config"],function(e){typeof window!="undefined"&&typeof window.pyGetClientConfig!="undefined"&&(e=window.pyGetClientConfig());var t=e.api.host,n=e.api.port,r=t,i=n;typeof e.internal!="undefined"&&(typeof e.internal.api.host!="undefined"&&(t=e.internal.api.host),typeof e.internal.api.port!="undefined"&&(n=e.internal.api.port));var s=e.api.basePath,o=e.api.protocol,u="://",a=e.api.authenticationHeader,f=e.api.anticacheHeader;typeof e.api.authenticationHeader=="undefined"&&(a="Authentication-Token"),typeof e.api.anticacheHeader=="undefined"&&(f="AC-Timestamp"),typeof e.admin!="undefined"&&(typeof e.admin.api.host!="undefined"&&(t=e.admin.api.host),typeof e.admin.api.port!="undefined"&&(n=e.admin.api.port),typeof e.internal!="undefined"&&(typeof e.internal.api.adminHost!="undefined"&&(t=e.internal.api.adminHost),typeof e.internal.api.adminPort!="undefined"&&(n=e.internal.api.adminPort)),typeof e.admin.api.basePath!="undefined"&&(s=e.admin.api.basePath),typeof e.admin.api.protocol!="undefined"&&(o=e.admin.api.protocol),typeof e.admin.api.protocolSeparator!="undefined"&&(u=e.admin.api.protocolSeparator));var l=function(){return o+u+t+":"+n+s},c=function(){return o+u+r+":"+i+s};return{HOST:t,PORT:n,PUBLIC_HOST:r,PUBLIC_PORT:i,BASE_PATH:s,PROTOCOL:o,PROTOCOL_FULL:o+u,AUTHENTICATION_HEADER:a,ANTICACHE_HEADER:f,getBaseUrl:l,getPublicBaseUrl:c}}),define("js/constants/api-urls",[],function(){var e="/appreciate",t="/promote",n="/accept",r="/deny",i="/withdraw",s="/outstanding",o="/email",u="/author",a="/backer",f="/enable",l="/disable",c="/send",h="/flag",p="/change",d="/reset",v="/remove",m="/delete",g="/roles",y="/pending",b="/finances",w="/payment",E="/purchase",S="/currency",x="/response",T="/subscription",N="/followers",C="/followees",k="/blocked",L="/feed",A="/notifications",O="/{0}",M="/show",_="/login",D="/register",P="/logout",H="/offers",B="/backings",j="/postings",F=j+O,I="/comments",q=I+O,R="/users",U=R+O,z="/tags",W=z+O,X=o+O,V="/current",$="/profile",J="/hide",K="/locations",Q="/confirmation",G="/password",Y="/settings",Z="/messages",et="/resources";return{LOGIN:_,LOGOUT:P,REGISTER:D,CURRENT:V,CURRENT_DELETE_SEND:V+m+c,CURRENT_DELETE:V+m,CURRENT_ACCEPT:V+n,ROLES:g,PROFILE:$,RESPONSE:x,LOCATIONS:K,LOCATIONS_REMOVE:K+v,CONFIRMATION:Q,CONFIRMATION_SEND:Q+c,EMAIL:o,EMAIL_CHANGE:o+p,EMAIL_PENDING_ACTION_CHANGE:o+y,PASSWORD:G,PASSWORD_USERS_ID:G+U,PASSWORD_RESET:G+d,SETTINGS:Y,FINANCES:b,PAYMENT:w,PAYMENT_CHANGE:w+p,PAYMENT_SEND:w+c,PURCHASE:S+E,POSTINGS:j,POSTINGS_CURRENT:V+j,POSTINGS_ID:F,POSTINGS_COMMENTS:F+I,POSTINGS_APPRECIATE:F+e,POSTINGS_PROMOTE:F+t,POSTINGS_ENABLE:F+f,POSTINGS_DISABLE:F+l,POSTINGS_FLAG:F+h,POSTINGS_EDIT:F+p,COMMENTS:I,COMMENTS_CURRENT:V+I,COMMENTS_ID:q,COMMENTS_COMMENTS:q+I,COMMENTS_APPRECIATE:q+e,COMMENTS_PROMOTE:q+t,COMMENTS_ENABLE:q+f,COMMENTS_DISABLE:q+l,COMMENTS_FLAG:q+h,COMMENTS_EDIT:q+p,TAGS:z,TAGS_ID:W,TAGS_COMMENTS:W+I,USERS:R,USERS_ID:U,USERS_APPRECIATION_RESPONSE:U+x,USERS_FLAG:U+h,USERS_RESPONSE:U+x,USERS_COMMENTS:U+I,USERS_FOLLOWEES:U+C,USERS_FOLLOWERS:U+N,USERS_FEED:U+L,FEED:L,NOTIFICATIONS:A,MESSAGES:Z,CONVERSATION:Z+U,CONVERSATION_MESSAGES:Z+U+Z,CONVERSATION_FLAG:Z+U+h,CONVERSATION_SHOW:Z+U+M,SUBSCRIPTION:T,FOLLOWERS:N,FOLLOWERS_ID:N+U,FOLLOWEES:C,FOLLOWEES_ID:C+U,BLOCKED:k,BLOCKED_ID:k+U,OFFERS:H,OFFERS_ID:H+U,OFFERS_ACCEPT:H+U+n,OFFERS_DENY:H+U+r,OFFERS_OUTSTANDING:H+s,OFFERS_OUTSTANDING_ID:H+s+U,OFFERS_OUTSTANDING_WITHDRAW:H+s+U+i,OFFERS_EMAIL_ACCEPT:H+U+o+n,OFFERS_EMAIL_DENY:H+U+o+r,OFFERS_EMAIL:H+o,OFFERS_EMAIL_OUTSTANDING:H+s+o,OFFERS_EMAIL_OUTSTANDING_ID:H+s+X,OFFERS_EMAIL_OUTSTANDING_WITHDRAW:H+s+X+i,BACKERS:B,BACKERS_ID:B+U,BACKERS_OUTSTANDING:B+s,BACKERS_OUTSTANDING_ID:B+s+U,CORS_PROXY_HTML:et+"/corsProxy.html",CORS_PROXY_JS:et+"/corsProxy.min.js"}}),define("js/controller/authentication",["./module","jquery","angular","js/util/i18n","js/util/validation-errors","js/constants/api","js/constants/api-urls","js/constants/cookies","js/constants/response-codes","js/constants/states","js/constants/events","js/constants/values"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=function(e,t){return function(n,i){r(function(n){e.account=!0,typeof t!="undefined"&&(t.loading=!1,t.alert=n("alerts:apiError"))})}};e.controller("RegisterController",["$modal","$rootScope","$scope","$state","$timeout","Loaded","pyAuthentication","Alerts","Tour","ModalInterface","GRecaptcha",function(e,t,n,s,o,u,c,p,d,v,m){var g={open:!1,loading:!1};n.registerData=g;var y=function(e,t){e.registerData=g,g.loading=!1,g.username="",g.password="",g.confirmNewPassword="",g.email="",g.confirmAge=!1,g.rememberMe=!1,g.errors={},g.alert=undefined,e.zxcvbnResult={},e.zxcvbnLoaded=!1;var n=function(e,n,r){u.account=!0,t.close(!0),g.loading=!1,d.start(),s.go(f.TERMS)},o=function(e,t){r(function(n){m.reset(),u.account=!0,g.loading=!1,e===a.INVALID&&typeof t!="undefined"?i.handleErrorsInOrder(t,["username","password","email","confirmNewPassword","recaptchaResponse"],function(e,t){if(t){var r="validation:"+i.getValidCode(t);g.errors[e]=n(r,i.getArguments(t))}else g.errors[e]=undefined;t&&e==="recaptchaResponse"?g.errors.recaptchaResponse=n("validation:recaptcha.required"):(t&&e==="password"&&(i.getValidCode(t)==="py.validation.error.length.short.generic"||i.getValidCode(t)==="py.validation.error.length.short.default")&&(g.errors.password=n("validation:register.password",i.getArguments(t))),t&&e==="confirmNewPassword"&&(i.getValidCode(t)==="py.validation.error.length.short.generic"||i.getValidCode(t)==="py.validation.error.length.short.default")&&(g.errors.confirmNewPassword=n("validation:register.password",i.getArguments(t))))}):e===a.EXISTS?g.errors.username=n("validation:exists.usernameOrEmail"):e===a.EXISTS_USERNAME?g.errors.username=n("validation:exists.username"):e===a.EXISTS_EMAIL?g.errors.email=n("validation:exists.email"):e===a.RESTRICTED_USERNAME?g.errors.username=n("validation:restricted.username"):e===a.RESTRICTED_PASSWORD?g.errors.password=n("validation:restricted.password"):e===a.RESTRICTED_EMAIL?g.errors.email=n("validation:restricted.email"):e===a.EXTERNAL_SERVICE?g.errors.recaptchaResponse=n("validation:recaptcha.externalService"):e===a.NOT_ALLOWED?g.errors.recaptchaResponse=n("validation:recaptcha.invalid"):g.alert=n("alerts:register.error")})},l=function(e,t){h(u,g)(e,t),m.reset()};e.submit=function(){if(g.confirmAge){u.account=!1,g.errors={},g.alert=undefined,g.loading=!0;var e=m.getResponse();c.forceLogout(),c.register(n,o,l,g.username,g.email,g.password,g.confirmNewPassword,g.confirmAge,g.rememberMe,e)}else r(function(e){g.errors.confirmAge=e("validation:register.confirmAge")})},e.cancel=function(){t.dismiss("cancel")};var p=function(){};require(["zxcvbn"],function(t){e.zxcvbnLoaded=!0,p=function(){typeof g.password!="undefined"&&(e.zxcvbnResult=t(g.password.substring(0,100)),typeof e.zxcvbnResult!="undefined"&&(typeof e.zxcvbnResult.feedback!="undefined"&&(e.passwordAdvice=e.zxcvbnResult.feedback.suggestions),e.passwordScore=e.zxcvbnResult.score))}}),e.$watch("registerData.password",function(e,t){e!==t&&p()})};n.openRegister=function(){var t=e.open({templateUrl:"registerModal",controller:v.controller(y),backdrop:!1});t.result.then(function(){g.open=!1},function(){g.open=!1}),t.opened.then(function(){g.open=!0},function(){g.open=!1})},t.$on(l.REGISTER_OPEN,function(e){n.openRegister()})}]),e.controller("LoginController",["$modal","$rootScope","$scope","Loaded","pyAuthentication","Alerts","ModalInterface",function(e,t,n,i,s,o,u){var f={open:!1,loading:!1};n.loginData=f;var c=function(e,t){e.loginData=f,f.loading=!1,f.username="",f.password="",f.rememberMe=!1,f.alert=undefined;var n=function(e,n,r){i.account=!0,t.close(!0),f.loading=!1},o=function(e,t){i.account=!0,r(function(t){f.loading=!1,e===a.LOGIN_LOCKED?f.alert=t("alerts:login.locked"):f.alert=t("alerts:login.invalid")})};e.submit=function(){i.account=!1,f.loading=!0,s.forceLogout(),s.login(n,o,h(i,f),f.username,f.password,f.rememberMe),f.password="",f.alert=undefined},e.cancel=function(){t.dismiss("cancel")}};n.openLogin=function(){var t=e.open({templateUrl:"loginModal",controller:u.controller(c),backdrop:!1});t.result.then(function(){f.open=!1},function(){f.open=!1}),t.opened.then(function(){f.open=!0},function(){f.open=!1})},t.$on(l.LOGIN_OPEN,function(e){n.openLogin()})}]),e.controller("LogoutController",["$scope","Loaded","Options","pyAuthentication","Alerts",function(e,t,n,i,s){var o=function(e,r,i){t.account=!0,n.resetWarning()},u=function(e,n){t.account=!0,r(function(e){s.error(e("alerts:logout.error"))})};e.logout=function(e){t.account=!1,i.logout(o,u,h(t))}}])}),define("js/controller/sidebar",["./module","jquery","angular","js/constants/events"],function(e,t,n,r){var i;e.controller("SidebarController",["$rootScope","$scope","Authentication","Loaded",function(e,t,n,i){t.loaded=i;var s=function(e){t.authenticated=e};s(n.isAuthenticated()),e.$on(r.LOGIN_CHANGE,function(e,t){s(t)}),t.loaded.account=!0}])}),define("js/controller/user-actions",["./module","jquery","angular","js/util/i18n","js/util/validation-errors","js/util/utils","js/constants/path-variables","js/constants/view-urls","js/constants/response-codes","js/constants/chained-keys","js/constants/roles","js/constants/events","js/constants/states"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){e.controller("UserActionsController",["$scope","$parse","$modal","$state","Authentication","Alerts","CurrentUser","Title","Social","ModalInterface","pyFollow","pyUser","pyMessage","pyBlock",function(e,t,i,s,u,f,l,c,p,d,v,m,g,y){var b=e.$parent;e.pscope=b,e.loadedFollowing=!0,e.loadedBlocking=!0,e.optionalOpen=!1;var w=function(t){e.authenticated=t,t?l.get(function(t){e.loadedCurrentUser=!0,e.currentUser=t,e.currentUsername=t.username.username},function(){e.loadedCurrentUser=!1}):(e.loadedCurrentUser=undefined,e.currentUser=undefined,e.currentUsername=undefined)};w(u.isAuthenticated()),u.manageEvent(e,function(e,t){w(t)}),e.openShare=function(){typeof e.user!="undefined"&&r(function(e){var t={};t[o.USER]=b.username,p.open(c.title,e("shared:socialOptions.user.description",{value:b.user.appreciation,postingsCount:b.user.contributedPostings}),s.href(h.USERS_ID,t,{absolute:!0}))})};var E;e.isFollowing=function(){return n.isDefined(E)?E:n.isDefined(b.single)&&b.follows?!0:!1};var S=function(t){return function(){r(function(n){f.warning(n(t)),e.loadedFollowing=!0})}},x=function(t,n,r){E=!0,e.loadedFollowing=!0,l.refreshSubscription()},T=function(t,n,r){E=!1,e.loadedFollowing=!0,l.refreshSubscription()};e.onFollow=function(){e.loadedFollowing=!1,v.follow(x,function(t,n){r(function(n){t===a.LIMIT?f.warning(n("alerts:follow.followLimit")):f.warning(n("alerts:follow.followError")),e.loadedFollowing=!0})},S("alerts:apiError"),b.username)},e.onUnfollow=function(){e.loadedFollowing=!1,v.unfollow(T,S("alerts:follow.unfollowError"),S("alerts:apiError"),b.username)};var N;e.isBlocking=function(){return n.isDefined(N)?N:n.isDefined(b.single)&&b.blocked?!0:!1};var C=function(t,n,r){N=!0,e.loadedBlocking=!0,l.refreshSubscription()},k=function(t,n,r){N=!1,e.loadedBlocking=!0,l.refreshSubscription()},L=function(t){return function(){r(function(n){f.warning(n(t)),e.loadedBlocking=!0})}};e.onBlock=function(t){e.loadedBlocking=!1,y.block(C,function(t,n){r(function(n){t===a.LIMIT?f.warning(n("alerts:block.blockLimit")):f.warning(n("alerts:block.blockError")),e.loadedBlocking=!0})},L("alerts:apiError"),b.username)},e.onUnblock=function(t){e.loadedBlocking=!1,y.unblock(k,L("alerts:block.unblockError"),L("alerts:apiError"),b.username)};var A={loading:!1,open:!1};e.flagData=A;var O=function(e,t){e.flagData=A;var n=function(e,t,n){A.loading=!1,r(function(e){f.info(e("alerts:flagged.userSuccess"))})},i=function(){r(function(e){A.loading=!1,f.warning(e("alerts:flagged.userError"))})};e.submit=function(e){A.loading=!0,m.flag(n,i,i,b.username,e),t.close(!0)},e.cancel=function(){t.dismiss("cancel")}};e.openFlag=function(){var e=i.open({templateUrl:"flagModal",controller:d.controller(O),backdrop:!1});e.result.then(function(){A.open=!1},function(){A.open=!1}),e.opened.then(function(){A.open=!0},function(){A.open=!1})}}])}),define("js/controller/posting-actions",["./module","jquery","angular","js/util/i18n","js/util/validation-errors","js/util/utils","js/constants/view-urls","js/constants/response-codes","js/constants/roles","js/constants/events","js/constants/states","js/constants/values","js/constants/path-variables"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){e.controller("PostingActionsController",["$rootScope","$scope","$state","$modal","Authentication","Alerts","Options","CurrentUser","Title","Payment","Social","ModalInterface","AutoRefresh","pyFinance","pyPosting","pyUser",function(e,t,o,p,d,v,m,g,y,b,w,E,S,x,T,N){var C=t.$parent;t.pscope=C,t.loadedEnable=!0,t.optionalOpen=!1,t.hasAccepted=!1;var k,L=function(){return n.isDefined(C.posting)&&n.isDefined(k)&&n.isDefined(C.posting.author)&&n.isDefined(C.posting.author.username)&&k!==C.posting.author.username&&C.posting.canAppreciate},A=function(){g.hasOverrideRole(a.overrideRoles.UNACCEPTED,function(e){e?t.hasAccepted=!1:t.hasAccepted=!0})},O=function(e){t.authenticated=e,e?(g.get(function(e){t.loadedCurrentUser=!0,t.currentUser=e,t.currentUsername=e.username.username,k=t.currentUsername},function(){t.loadedCurrentUser=undefined}),A()):(t.loadedCurrentUser=!1,t.currentUser=undefined,t.currentUsername=undefined,t.hasAccepted=!1)};O(d.isAuthenticated()),d.manageEvent(t,function(e,t){O(t)}),t.openShare=function(){n.isDefined(C.posting)&&n.isDefined(C.posting.tally)&&n.isDefined(C.posting.author)&&r(function(e){var t={};t[h.POSTING]=C.postingId;var r;n.isDefined(C.posting.title)&&(t[h.TITLE]=s.getEncodedTitle(C.posting.title),r=o.href(l.POSTINGS_ID_TITLE,t,{absolute:!0})),w.open(y.title,e("shared:socialOptions.posting.description",{value:C.posting.tally.appreciation,title:C.posting.title,author:C.posting.author.username,tags:s.tagify(C.posting.tags),created:s.getCalendarDate(C.posting.created)}),o.href(l.POSTINGS_ID,t,{absolute:!0}),r)})};var M={loading:!1,open:!1};t.promotionData=M;var _=function(t,o){t.promotionData=M,M.errors={},M.promotion=undefined,M.warning=C.posting.warning||!1,M.tags=undefined,M.alert=undefined,M.showPurchaseLink=!1,t.optionalCollapsed=!0;var a=function(t){return function(i,s,u){M.loading=!1,e.$broadcast(f.BALANCE_CHANGE),o.close(!0),r(function(e){v.info(e("alerts:promotion.success"))}),n.isDefined(C.posting.tally)&&t>0&&(C.posting.tally.promotion+=t,C.posting.tally.value+=t)}},l=function(e,t){r(function(n){M.loading=!1,e===u.INVALID&&typeof t!="undefined"?i.handleErrorsInOrder(t,["promotion","tags","warning"],function(e,t){if(t){var r="validation:"+i.getValidCode(t);M.errors[e]=n(r,i.getArguments(t))}else M.errors[e]=undefined}):e===u.BALANCE?(M.alert=n("validation:balance"),M.showPurchaseLink=!0):e===u.NOT_ALLOWED?M.alert=n("alerts:comment.promote.notAllowed"):M.alert=n("alerts:promotion.error")})},c=function(){r(function(e){M.loading=!1,M.alert=e("alerts:promotion.error")})};t.openPurchase=function(){e.$broadcast(f.PURCHASE_MODAL_OPEN)},t.submit=function(){M.alert=undefined,M.errors={},M.loading=!0,M.showPurchaseLink=!1;var e=s.parseTags(M.tags);x.promotePosting(a(M.promotion),l,c,C.postingId,M.promotion,e,M.warning)},t.cancel=function(){o.dismiss("cancel")}};t.openPromotion=function(){var e=p.open({templateUrl:"postingPromotionModal",controller:E.controller(_),backdrop:!1});e.result.then(function(){M.open=!1},function(){M.open=!1}),e.opened.then(function(){M.open=!0},function(){M.open=!1})};var D={loading:!1,open:!1};t.appreciationData=D;var P=function(t,n){t.appreciationData=D,D.errors={},D.appreciation=undefined,D.appreciationAlt=undefined,D.warning=C.posting.warning||!1,D.tags=undefined,D.alert=undefined,D.onAlt=undefined,t.optionalCollapsed=!0,t.sinceAction=0,t.amount="0.00",t.fee="0.00",t.tax="0.00",t.author="0.00",t.total="0.00",t.result={amount:0,tax:0,total:0},S.manageRefresh(function(){t.sinceAction++},1,undefined,!1,!1,t),t.$on("$destroy",function(t){e.$broadcast(f.destroy("AppreciationModalCtrl"))});var o=function(e){return function(n,r){t.result=r,t.amount="0.00",t.fee="0.00",t.tax="0.00",t.author="0.00",t.total="0.00",typeof r!="undefined"&&(typeof r.amount!="undefined"&&(t.amount=r.amount.toFixed(c.CURRENCY_PRECISION)),typeof r.fee!="undefined"&&(t.fee=r.fee.toFixed(c.CURRENCY_PRECISION)),typeof r.tax!="undefined"&&(t.tax=r.tax.toFixed(c.CURRENCY_PRECISION)),typeof r.author!="undefined"&&(t.author=r.author.toFixed(c.CURRENCY_PRECISION)),typeof r.total!="undefined"&&(t.total=r.total.toFixed(c.CURRENCY_PRECISION))),D.onAlt=e,e?(D.appreciation===r.amount&&(D.onAlt=undefined),D.appreciation=r.amount):(D.appreciationAlt===r.author&&(D.onAlt=undefined),D.appreciationAlt=r.author)}};t.$watch("appreciationData.appreciation",function(e,n){if(typeof D.onAlt!="undefined"){D.onAlt&&(D.onAlt=undefined);return}e!==n&&(t.sinceAction=0-c.CURRENCY_TOTAL_CALCULATION_TIME,x.calculateAppreciationTotals(o(!1),function(){},function(){},D.appreciation))}),t.$watch("appreciationData.appreciationAlt",function(e,n){if(typeof D.onAlt!="undefined"){D.onAlt||(D.onAlt=undefined);return}e!==n&&(t.sinceAction=0-c.CURRENCY_TOTAL_CALCULATION_TIME,x.calculateAppreciationTotalsFromAppreciation(o(!0),function(){},function(){},D.appreciationAlt))});var a=function(e){return function(t,r,i){D.loading=!1,n.close(!0),b.payment(r.result,!0,C.single,C.posting.author.username,e)}},l=function(e,t){r(function(r){D.loading=!1,e===u.INVALID&&typeof t!="undefined"?i.handleErrorsInOrder(t,["appreciation","tags","warning"],function(e,t){if(t){var n="validation:"+i.getValidCode(t);D.errors[e]=r(n,i.getArguments(t))}else D.errors[e]=undefined}):e===u.NOT_ALLOWED?D.alert=r("alerts:posting.appreciate.notAllowed"):e===u.PAYMENT_TARGET?(v.warning(r("alerts:posting.appreciate.paymentTarget")),n.dismiss("cancel")):D.alert=r("alerts:appreciation.error")})},h=function(){r(function(e){D.loading=!1,D.alert=e("alerts:appreciation.error")})};t.submit=function(){if(L()){D.errors={},D.alert=undefined,D.loading=!0;var e=s.parseTags(D.tags);x.appreciatePosting(a(D.appreciation),l,h,C.postingId,D.appreciation,e,D.warning)}},t.cancel=function(){n.dismiss("cancel")}};t.openAppreciation=function(){if(t.hasAccepted){var e=p.open({templateUrl:"postingAppreciationModal",controller:E.controller(P),backdrop:!1});e.result.then(function(){D.open=!1},function(){D.open=!1}),e.opened.then(function(){D.open=!0},function(){D.open=!1})}else{var n;t.hasAccepted||(n=o.href(l.TERMS),g.alertOverrideRole(a.overrideRoles.UNACCEPTED,n)),g.refreshRoles(),A()}};var H={loading:!1,open:!1};t.flagData=H;var B=function(e,t){e.flagData=H;var n=function(e,t,n){H.loading=!1,r(function(e){v.info(e("alerts:flagged.postingSuccess"))})},i=function(){r(function(e){H.loading=!1,v.warning(e("alerts:flagged.postingError"))})};e.submit=function(e){typeof postingId!="undefined"&&(H.loading=!0,T.flag(n,i,i,C.postingId,e)),t.close(!0)},e.cancel=function(){t.dismiss("cancel")}};t.openFlag=function(){var e=p.open({templateUrl:"postingFlagModal",controller:E.controller(B),backdrop:!1});e.result.then(function(){H.open=!1},function(){H.open=!1}),e.opened.then(function(){H.open=!0},function(){H.open=!1})};var j=function(e,n,r){C.posting.disabled=!1,t.loadedEnable=!0},F=function(e,n,r){C.posting.disabled=!0,t.loadedEnable=!0},I=function(e){return function(){r(function(n){v.warning(n(e)),t.loadedEnable=!0})}};t.onEnable=function(){t.loadedEnable=!1,T.enable(j,I("alerts:posting.enable.error"),I("alerts:apiError"),C.postingId)},t.onDisable=function(){t.loadedEnable=!1,T.disable(F,I("alerts:posting.disable.error"),I("alerts:apiError"),C.postingId)},t.$on(f.APPRECIATION_SUCCESS,function(e,t,r){if(!e.defaultPrevented&&n.isDefined(t)){var i=t.getSingleMain();if(n.isDefined(i)&&i.id===C.postingId&&n.isDefined(C.posting.tally)){e.preventDefault();var s=parseFloat(r);if(s!==s)return;var o=Math.floor(s);C.posting.tally.appreciation+=o}}})}])}),define("js/controller/comment-actions",["./module","jquery","angular","js/util/i18n","js/util/validation-errors","js/util/utils","js/constants/view-urls","js/constants/response-codes","js/constants/roles","js/constants/events","js/constants/states","js/constants/values","js/constants/path-variables"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){e.controller("CommentActionsController",["$rootScope","$scope","$state","$modal","Authentication","Single","Alerts","Options","CurrentUser","Title","Payment","CacheDelay","Social","ModalInterface","AutoRefresh","pyFinance","pyComment","pyUser",function(e,t,o,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k){var L=t.$parent;t.pscope=L,t.loadedEnable=!0,t.optionalOpen=!1,t.hasAccepted=!1;var A,O=function(){return n.isDefined(L.comment)&&n.isDefined(A)&&n.isDefined(L.comment.author)&&n.isDefined(L.comment.author.username)&&A!==L.comment.author.username&&L.comment.canAppreciate},M=function(){y.hasOverrideRole(a.overrideRoles.UNACCEPTED,function(e){e?t.hasAccepted=!1:t.hasAccepted=!0})},_=function(e){t.authenticated=e,e?(y.get(function(e){t.loadedCurrentUser=!0,t.currentUser=e,t.currentUsername=e.username.username,A=t.currentUsername},function(){t.loadedCurrentUser=undefined}),M()):(t.loadedCurrentUser=undefined,t.currentUser=undefined,t.currentUsername=undefined)};_(d.isAuthenticated()),d.manageEvent(t,function(e,t){_(t)}),t.openShare=function(){typeof L.comment!="undefined"&&typeof L.comment.tally!="undefined"&&typeof L.comment.author!="undefined"&&r(function(e){var t={};t[h.COMMENT]=L.commentId,S.open(b.title,e("shared:socialOptions.comment.description",{value:L.comment.tally.appreciation,author:L.comment.author.username,created:s.getCalendarDate(L.comment.created)}),o.href(l.COMMENTS_ID,t,{absolute:!0}))})};var D={loading:!1,open:!1};t.promotionData=D;var P=function(t,s){t.promotionData=D,D.errors={},D.promotion=undefined,D.warning=L.comment.warning||!1,D.alert=undefined,D.showPurchaseLink=!1,t.optionalCollapsed=!0;var o=function(t){return function(i,o,u){D.loading=!1,e.$broadcast(f.BALANCE_CHANGE),s.close(!0),r(function(e){m.info(e("alerts:promotion.success"))}),n.isDefined(L.comment.tally)&&t>0&&(L.comment.tally.promotion+=t,L.comment.tally.value+=t)}},a=function(e,t){r(function(n){D.loading=!1,e===u.INVALID&&typeof t!="undefined"?i.handleErrorsInOrder(t,["promotion","tags","warning"],function(e,t){if(t){var r="validation:"+i.getValidCode(t);D.errors[e]=n(r,i.getArguments(t))}else D.errors[e]=undefined}):e===u.BALANCE?(D.alert=n("validation:balance"),D.showPurchaseLink=!0):e===u.NOT_ALLOWED?D.alert=n("alerts:comment.promote.notAllowed"):D.alert=n("alerts:promotion.error")})},l=function(){r(function(e){D.loading=!1,D.alert=e("alerts:promotion.error")})};t.openPurchase=function(){e.$broadcast(f.PURCHASE_MODAL_OPEN)},t.submit=function(){D.alert=undefined,D.errors={},D.loading=!0,D.showPurchaseLink=!1,N.promoteComment(o(D.promotion),a,l,L.commentId,D.promotion,D.warning)},t.cancel=function(){s.dismiss("cancel")}};t.openPromotion=function(){var e=p.open({templateUrl:"commentPromotionModal",controller:x.controller(P),backdrop:!1});e.result.then(function(){D.open=!1},function(){D.open=!1}),e.opened.then(function(){D.open=!0},function(){D.open=!1})};var H={loading:!1,open:!1};t.appreciationData=H;var B=function(e,t){e.appreciationData=H,H.errors={},H.appreciation=undefined,H.appreciationAlt=undefined,H.warning=L.comment.warning||!1,H.alert=undefined,H.onAlt=undefined,e.optionalCollapsed=!0,e.sinceAction=0,e.amount="0.00",e.fee="0.00",e.tax="0.00",e.author="0.00",e.total="0.00",e.result={amount:0,tax:0,total:0},T.manageRefresh(function(){e.sinceAction++},1,undefined,!1,!1,e);var n=function(t){return function(n,r){e.result=r,e.amount="0.00",e.fee="0.00",e.tax="0.00",e.author="0.00",e.total="0.00",typeof r!="undefined"&&(typeof r.amount!="undefined"&&(e.amount=r.amount.toFixed(c.CURRENCY_PRECISION)),typeof r.fee!="undefined"&&(e.fee=r.fee.toFixed(c.CURRENCY_PRECISION)),typeof r.tax!="undefined"&&(e.tax=r.tax.toFixed(c.CURRENCY_PRECISION)),typeof r.author!="undefined"&&(e.author=r.author.toFixed(c.CURRENCY_PRECISION)),typeof r.total!="undefined"&&(e.total=r.total.toFixed(c.CURRENCY_PRECISION))),H.onAlt=t,t?(H.appreciation===r.amount&&(H.onAlt=undefined),H.appreciation=r.amount):(H.appreciationAlt===r.author&&(H.onAlt=undefined),H.appreciationAlt=r.author)}};e.$watch("appreciationData.appreciation",function(t,r){if(typeof H.onAlt!="undefined"){H.onAlt&&(H.onAlt=undefined);return}t!==r&&(e.sinceAction=0-c.CURRENCY_TOTAL_CALCULATION_TIME,N.calculateAppreciationTotals(n(!0),function(){},function(){},H.appreciation))}),e.$watch("appreciationData.appreciationAlt",function(t,r){if(typeof H.onAlt!="undefined"){H.onAlt||(H.onAlt=undefined);return}t!==r&&(e.sinceAction=0-c.CURRENCY_TOTAL_CALCULATION_TIME,N.calculateAppreciationTotalsFromAppreciation(n(!0),function(){},function(){},H.appreciationAlt))});var s=function(e){return function(n,r,i){H.loading=!1,t.close(!0),w.payment(r.result,!0,L.single,L.comment.author.username,e)}},o=function(e,n){r(function(r){H.loading=!1,e===u.INVALID&&typeof n!="undefined"?i.handleErrorsInOrder(n,["appreciation","tags","warning"],function(e,t){if(t){var n="validation:"+i.getValidCode(t);H.errors[e]=r(n,i.getArguments(t))}else H.errors[e]=undefined}):e===u.NOT_ALLOWED?H.alert=r("alerts:comment.appreciate.notAllowed"):e===u.PAYMENT_TARGET?(m.warning(r("alerts:comment.appreciate.paymentTarget")),t.dismiss("cancel")):H.alert=r("alerts:appreciation.error")})},a=function(){r(function(e){H.loading=!1,H.alert=e("alerts:appreciation.error")})};e.submit=function(){O()&&(H.errors={},H.alert=undefined,H.loading=!0,N.appreciateComment(s(H.appreciation),o,a,L.commentId,H.appreciation,H.warning))},e.cancel=function(){t.dismiss("cancel")}};t.openAppreciation=function(){if(t.hasAccepted){var e=p.open({templateUrl:"commentAppreciationModal",controller:x.controller(B),backdrop:!1});e.result.then(function(){H.open=!1},function(){H.open=!1}),e.opened.then(function(){H.open=!0},function(){H.open=!1})}else{var n;t.hasAccepted||(n=o.href(l.TERMS),y.alertOverrideRole(a.overrideRoles.UNACCEPTED,n)),y.refreshRoles(),M()}};var j={loading:!1,open:!1};t.flagData=j;var F=function(e,t){e.flagData=j;var n=function(e,t,n){j.loading=!1,r(function(e){m.info(e("alerts:flagged.commentSuccess"))})},i=function(){r(function(e){j.loading=!1,m.warning(e("alerts:flagged.commentError"))})};e.submit=function(e){typeof commentId!="undefined"&&(j.loading=!0,C.flag(n,i,i,L.commentId,e)),t.close(!0)},e.cancel=function(){t.dismiss("cancel")}};t.openFlag=function(){var e=p.open({templateUrl:"commentFlagModal",controller:x.controller(F),backdrop:!1});e.result.then(function(){j.open=!1},function(){j.open=!1}),e.opened.then(function(){j.open=!0},function(){j.open=!1})};var I=function(e,n,r){L.comment.disabled=!1,t.loadedEnable=!0},q=function(e,n,r){L.comment.disabled=!0,t.loadedEnable=!0},R=function(e){return function(){r(function(n){m.warning(n(e)),t.loadedEnable=!0})}};t.onEnable=function(){t.loadedEnable=!1,C.enable(I,R("alerts:comment.enable.error"),R("alerts:apiError"),L.commentId)},t.onDisable=function(){t.loadedEnable=!1,C.disable(q,R("alerts:comment.disable.error"),R("alerts:apiError"),L.commentId)},t.$on(f.APPRECIATION_SUCCESS,function(e,t,r){if(!e.defaultPrevented&&n.isDefined(t)){var i=t.getSingleMain();if(n.isDefined(i)&&i.id===L.commentId&&n.isDefined(L.comment.tally)){e.preventDefault();var s=parseFloat(r);if(s!==s)return;var o=Math.floor(s);L.comment.tally.appreciation+=o}}})}])}),define("js/controller/current-actions",["./module","jquery","angular","js/util/i18n","js/util/validation-errors","js/util/utils","js/constants/view-urls","js/constants/response-codes","js/constants/roles","js/constants/events","js/constants/path-variables","js/constants/states"],function(e,t,n,r,i,s,o,u,a,f,l,c){e.controller("CurrentActionsController",["$rootScope","$scope","$state","$modal","Authentication","ModalInterface","Social","Title",function(e,t,n,i,s,o,u,a){t.optionalOpen=!1;var f=t.$parent;t.pscope=f;var h=function(e){t.authenticated=e};h(s.isAuthenticated()),s.manageEvent(t,function(e,t){h(t)}),t.openShare=function(){typeof t.current!="undefined"&&r(function(e){var t={};t[l.USER]=f.username,u.open(a.title,e("shared:socialOptions.user.description",{value:f.current.appreciation,postingsCount:f.current.contributedPostings}),n.href(c.USERS_ID,t,{absolute:!0}))})}}])}),define("js/controller/tag-actions",["./module","jquery","angular","js/util/i18n","js/util/utils","js/constants/events","js/constants/path-variables","js/constants/states"],function(e,t,n,r,i,s,o,u){e.controller("TagActionsController",["$state","$scope","Authentication","Single","CurrentUser","Title","Social",function(e,t,i,s,a,f,l){var c=t.$parent;t.pscope=c,t.openShare=function(){n.isDefined(t.tag)&&r(function(t){var n={};n[o.TAG]=c.tag.name,l.open(f.title,t("shared:socialOptions.tag.description",{value:c.tag.appreciation,tag:c.tag.name}),e.href(u.TAGS_ID,n,{absolute:!0}))})}}])}),define("js/controller/content-column",["./module","jquery","angular","js/constants/events"],function(e,t,n,r){var i;e.controller("ContentColumnController",["$scope","Loaded","CustomEvents","StateHandler","RouteCheck",function(e,t,n,i,s){e.loaded=t;var o=function(){e.loaded.content=!1};e.$on(r.CUSTOM_STATE_CHANGE_START,o)}])}),define("js/controller/alerts",["./module","jquery","angular"],function(e,t,n){e.controller("AlertsController",["$scope","Alerts",function(e,t){e.alerts=t.getAlerts(),e.clear=function(){t.clear(),e.notifications=t.getAlerts()},e.close=function(e){t.remove(e)}}])}),define("js/controller/payment-processing",["./module","jquery","angular","js/constants/events","js/constants/view-ids"],function(e,t,n,r,i){e.controller("PaymentProcessingController",["$rootScope","$scope","Browser","Payment",function(e,t,n,s){t.show=!0,t.processing=s.processing,t.close=function(){t.show=!1},e.$on(r.PAYMENT_PROCESSING_SHOW_TOGGLE,function(e){t.show=!t.show,n.scrollTo(i.ALERTS)})}]),e.controller("PaymentProcessingIconController",["$rootScope","$scope","Payment","Tour",function(e,t,n,i){t.processing=n.processing,t.tour=i.tour,t.toggle=function(){e.$broadcast(r.PAYMENT_PROCESSING_SHOW_TOGGLE)}}])}),define("js/controller/cache-delay-waiting",["./module","jquery","angular","js/constants/events","js/constants/view-ids"],function(e,t,n,r,i){e.controller("CacheDelayController",["$rootScope","$scope","Browser","CacheDelay",function(e,t,n,s){t.show=!1,t.waiting=s.waiting,t.close=function(){t.show=!1},e.$on(r.CACHE_DELAY_SHOW_TOGGLE,function(e){t.show=!t.show,n.scrollTo(i.ALERTS)})}]),e.controller("CacheDelayIconController",["$rootScope","$scope","CacheDelay","Tour",function(e,t,n,i){t.waiting=n.waiting,t.tour=i.tour,t.toggle=function(){e.$broadcast(r.CACHE_DELAY_SHOW_TOGGLE)}}])}),define("js/controller/tour-available",["./module","jquery","angular","js/constants/events","js/constants/view-ids"],function(e,t,n,r,i){e.controller("TourAvailableController",["$rootScope","$scope","Browser","Tour",function(e,t,n,s){t.show=!1,t.tour=s.tour,t.close=function(){t.show=!1},t.finish=function(){t.show=!1,s.finish()},t.begin=function(){t.show=!1,s.show()},e.$on(r.TOUR_SHOW_TOGGLE,function(e){t.show=!t.show,n.scrollTo(i.ALERTS)})}]),e.controller("TourAvailableIconController",["$rootScope","$scope","Tour",function(e,t,n){t.tour=n.tour,t.toggle=function(){e.$broadcast(r.TOUR_SHOW_TOGGLE)}}])}),define("js/constants/tour-states",["js/constants/states"],function(e){var t={GENERAL:{key:"g",states:[e.WELCOME,e.TERMS,e.ABOUT,e.ACCOUNT],unauthed:{BRAND:"brand",ACTION_BAR:"actionBar",TOUR_AVAILABLE:"tourAvailable",SETTINGS:"settings",AUTHENTICATION:"authentication"},authed:{CREATE_POSTING:"createPosting",PAYMENT_PROCESSING:"paymentProcessing",CACHE_DELAY:"cacheDelay"}},CONTENT:{key:"con",states:[e.POSTINGS,e.COMMENTS,e.TAGS,e.USERS],unauthed:{CONTENT_SELECT:"contentSelect",TIME_SELECT:"timeSelect",CONTENT:"content"},authed:{}},POSTING:{key:"p",states:[e.POSTINGS_ID,e.POSTINGS_ID_TITLE],unauthed:{TITLE:"title",AUTHOR:"author",TAGS:"tags",APPRECIATION:"appreciation",HELP:"help"},authed:{APPRECIATE:"appreciate",PROMOTE:"promote",MORE:"more",COMMENT:"comment"}},COMMENT:{key:"c",states:[e.COMMENTS_ID],unauthed:{AUTHOR:"author",CONTEXT:"context",APPRECIATION:"appreciation",HELP:"help"},authed:{APPRECIATE:"appreciate",PROMOTE:"promote",MORE:"more",COMMENT:"comment"}},TAG:{key:"t",states:[e.TAGS_ID],unauthed:{TAG:"tag",PROMOTION:"promotion",HELP:"help"},authed:{COMMENT:"comment"}},USER:{key:"u",states:[e.USERS_ID],unauthed:{USERNAME:"username",APPRECIATION:"appreciation",HELP:"help"},authed:{FOLLOW:"follow",MESSAGE:"message",MORE:"more",COMMENT:"comment"}},CURRENT:{key:"cur",states:[e.CURRENT],unauthed:{},authed:{APPRECIATION:"appreciation",DESCRIPTION:"description",APPRECIATION_RESPONSE:"appreciationResponse",VIEW_USER:"viewUser",COMMENT:"comment"}}};t.GENERAL.order=[t.GENERAL.unauthed.BRAND,t.GENERAL.unauthed.ACTION_BAR,t.GENERAL.unauthed.TOUR_AVAILABLE,t.GENERAL.unauthed.SETTINGS,t.GENERAL.unauthed.AUTHENTICATION],t.GENERAL.authedOrder=[t.GENERAL.authed.CREATE_POSTING,t.GENERAL.authed.PAYMENT_PROCESSING,t.GENERAL.authed.CACHE_DELAY],t.CONTENT.order=[t.CONTENT.unauthed.CONTENT_SELECT,t.CONTENT.unauthed.TIME_SELECT,t.CONTENT.unauthed.CONTENT],t.CONTENT.authedOrder=[],t.POSTING.order=[t.POSTING.unauthed.TITLE,t.POSTING.unauthed.AUTHOR,t.POSTING.unauthed.TAGS,t.POSTING.unauthed.APPRECIATION,t.POSTING.unauthed.HELP],t.POSTING.authedOrder=[t.POSTING.authed.APPRECIATE,t.POSTING.authed.PROMOTE,t.POSTING.authed.MORE,t.POSTING.authed.COMMENT],t.COMMENT.order=[t.COMMENT.unauthed.AUTHOR,t.COMMENT.unauthed.CONTEXT,t.COMMENT.unauthed.APPRECIATION,t.COMMENT.unauthed.HELP],t.COMMENT.authedOrder=[t.COMMENT.authed.APPRECIATE,t.COMMENT.authed.PROMOTE,t.COMMENT.authed.MORE,t.COMMENT.authed.COMMENT],t.TAG.order=[t.TAG.unauthed.TAG,t.TAG.unauthed.PROMOTION,t.TAG.unauthed.HELP],t.TAG.authedOrder=[t.TAG.authed.COMMENT],t.USER.order=[t.USER.unauthed.USERNAME,t.USER.unauthed.APPRECIATION,t.USER.unauthed.HELP],t.USER.authedOrder=[t.USER.authed.FOLLOW,t.USER.authed.MESSAGE,t.USER.authed.MORE,t.USER.authed.COMMENT],t.CURRENT.order=[],t.CURRENT.authedOrder=[t.CURRENT.authed.APPRECIATION,t.CURRENT.authed.DESCRIPTION,t.CURRENT.authed.APPRECIATION_RESPONSE,t.CURRENT.authed.VIEW_USER,t.CURRENT.authed.COMMENT];for(var n in t)t.hasOwnProperty(n)&&(t[n].name=n);return t}),define("js/controller/generics",["./module","jquery","angular","js/util/i18n","js/util/utils","js/constants/path-variables","js/constants/states","js/constants/cookies","js/constants/params","js/constants/response-codes","js/constants/events","js/constants/tour-states"],function(e,t,n,r,i,s,o,u,a,f,l,c){e.controller("AccountController",["$rootScope","$scope","$state","Authentication",function(e,t,n,r){var i=function(e){e&&n.go(o.DEFAULT,undefined,{reload:!0})};i(r.isAuthenticated()),r.manageEvent(t,function(e,t){i(t)}),t.openLogin=function(){e.$broadcast(l.LOGIN_OPEN)},t.openRegister=function(){e.$broadcast(l.REGISTER_OPEN)}}]),e.controller("HeaderController",["$scope","Title",function(e,t){e.title=t}]),e.controller("TourController",["$scope","Loaded","Tour",function(e,t,n){e.startTour=function(){n.start(c.GENERAL.name)}}]),e.controller("SettingsErrorController",["$scope","$state","Alerts","Loaded",function(e,t,n,i){r(function(e){n.error(e("alerts:user.settingsError")),t.go(o.DEFAULT,undefined,{reload:!0})}),i.resetInfo(!0),i.loadedInfo()}]),e.controller("DeletedController",["$scope","$state","Alerts","Authentication","Reloader","Loaded","CurrentUser","pyProfile",function(e,t,n,i,s,u,a,l){var c=function(t){e.authenticated=t};c(i.isAuthenticated()),i.manageEvent(e,function(e,t){c(t)}),e.authenticated||t.go(o.DEFAULT,undefined,{reload:!0});var h=function(e,i,s){r(function(e){a.refreshRoles(function(){n.success(e("alerts:deleted.success")),t.go(o.DEFAULT,undefined,{reload:!0})},function(){n.success(e("alerts:deleted.success")),t.go(o.DEFAULT,undefined,{reload:!0})})})},p=function(e,t){r(function(t){e===f.NOT_ALLOWED?n.warning(t("alerts:deleted.notAllowed")):n.error(t("alerts:deleted.error"))})},d=function(){r(function(e){n.error(e("alerts:deleted.apiError"))})};e.undelete=function(t){e.authenticated&&l.undelete(h,p,d)},u.resetInfo(!0),u.loadedInfo()}]),e.controller("ContentLoaderController",["$rootScope","$scope","Loaded",function(e,t,n){t.loaded=n}]),e.controller("ExternalUrlController",["$rootScope","$scope","$location","Loaded",function(e,t,n,r){var i=n.search()[a.EXTERNAL_URL];typeof i=="undefined"&&(i=""),t.externalUrl=i,t.back=function(){e.$broadcast(l.BACK)},r.resetInfo(!0),r.loadedInfo()}])}),define("js/controller/user-options",["./module","jquery","angular","js/util/i18n","js/util/utils","js/constants/path-variables","js/constants/view-urls","js/constants/events","js/constants/roles","js/constants/values"],function(e,t,n,r,i,s,o,u,a,f){e.controller("UserOptionsController",["$rootScope","$scope","$location","Loaded","Alerts","Authentication","AutoRefresh","CurrentUser","pyFinance",function(e,t,n,l,c,h,p,d,v){t.loaded=l,t.show=!1;var m=function(e){t.show=!0,t.currentUser=e;var n={};n[s.USER]=e.username.username,t.userLink=i.format(o.USERS_ID,n),t.activityLink=i.format(o.USERS_ID_ACTIVITY,n),t.followersLink=i.format(o.USERS_ID_FOLLOWERS,n),t.followeesLink=i.format(o.USERS_ID_FOLLOWEES,n)},g=function(){t.show=l.FAILED},y=function(e,n,i){t.loadedBalance=!0,r(function(e){t.balance=e("shared:balanceCount",{count:n.balance})})},b=function(){t.authenticated&&(t.loadedBalance=l.FAILED,r(function(e){c.warning(e("alerts:user.balanceError"))}))},w=function(e){e&&n.url(o.DELETED)},E=function(e){v.balance(y,e,e)},S=function(e){t.authenticated=e,e&&(d.getFresh(m,g),d.hasOverrideRole(a.overrideRoles.DELETED,w),E(b))};S(h.isAuthenticated()),e.$on(u.LOGIN_CHANGE,function(e,t){S(t)}),e.$on(u.PRE_LOGIN_CHANGE,function(e,n){t.show=!1});var x=function(){h.isAuthenticated()&&(d.getFresh(m,function(){}),E(function(){}))};p.manageRefresh(x,f.USER_OPTIONS_REFRESH,undefined,!0,undefined,t),e.$on(u.BALANCE_CHANGE,function(e){t.authenticated&&E(function(){})})}])}),define("js/controller/payment",["./module","jquery","angular","payment","js/util/i18n","js/util/validation-errors","js/util/utils","js/constants/response-codes","js/constants/view-urls","js/constants/params","js/constants/roles","js/constants/events","js/constants/values","js/constants/states"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){e.controller("PaymentController",["$rootScope","$scope","$window","$modal","Loaded","Authentication","Alerts","Payment","Single","AutoRefresh","ModalInterface","pyFinance",function(e,t,r,i,s,u,a,f,l,h,p,d){var v=function(e){t.authenticated=e};v(u.isAuthenticated()),u.manageEvent(t,function(e,t){v(t)}),t.paymentUrl=undefined,t.paykey=undefined,t.appreciation=!1;var m=[],g=function(){t.paymentUrl=undefined,t.paykey=undefined};e.$on(c.PAYMENT_END,function(e){g()}),e.$on(c.PAYMENT,function(r,s,u,a,l,h,d,v){t.isSingle=a;if(!n.isDefined(s)||s===""||!n.isDefined(u)||u==="")g();else{var y="mini",b={paykey:u};b.expType=y;var w=o.constructPath(s,undefined,b),E={paymentUrl:w},S=function(e,t){e.paymentData=E,e.pay=function(){f.paymentStarted(u,a,l,h,d,v),t.close(!0)},e.cancel=function(){t.dismiss("cancel")}},x=i.open({templateUrl:"paymentModal",controller:p.controller(S),backdrop:!1}),T=function(e,t,n,r,i,s){return m.push({paykey:e,isSingle:t,single:l,username:r,amount:i,altId:s}),function(){typeof dgFlowMini!="undefined"&&typeof dgFlowMini.closeFlow!="undefined"&&dgFlowMini.closeFlow();var o;if(typeof m=="undefined")f.paymentFinished(e,t,n,r,i,s);else for(var u=0;u<m.length;u++)o=m[u],f.paymentFinished(o.paykey,o.isSingle,o.single,o.username,o.amount,o.altId);m=[],g()}},N=e.$on(c.PAYMENT_MODAL_OPEN,function(e,t){dgFlowMini=new PAYPAL.apps.DGFlowMini({trigger:t,expType:y,callbackFunction:T(u,a,l,h,d,v)}),N()})}})}])}),define("js/controller/appreciation-response",["./module","jquery","angular","js/util/i18n","js/constants/events"],function(e,t,n,r,i){e.controller("AppreciationResponseController",["$rootScope","$scope","$modal","Options","Alerts","pyUser","Payment","ModalInterface",function(e,t,n,s,o,u,a,f){var l={open:!1},c=function(e,t){e.dto=l.dto,e.response=e.dto.appreciationResponse,e.appreciationResponseWarning=e.dto.appreciationResponseWarning,e.hideExplicit=e.appreciationResponseWarning&&!s.getWarning(),typeof e.dto.username!="undefined"?e.username=e.dto.username.username:e.username=l.username,r(function(t){e.title=t("shared:appreciationResponseUser",{user:e.username})}),e.close=function(){t.close(!0)}};e.$on(i.APPRECIATION_SHOW_RESPONSE,function(e,i){if(typeof i!="undefined"){t.username=i;var s=function(e,r,s){if(typeof r!="undefined"&&typeof r.appreciationResponse!="undefined"){l.dto=r,t.dto=r,t.response=r.appreciationResponse,t.appreciationResponseWarning=r.appreciationResponseWarning,typeof r.username!="undefined"?t.username=r.username.username:t.username=i,l.username=i;var o=n.open({templateUrl:"appreciationResponseModal",controller:f.controller(c),backdrop:!1});o.result.then(function(){l.open=!1},function(){l.open=!1}),o.opened.then(function(){l.open=!0},function(){l.open=!1})}},a=function(){r(function(e){o.warning(e("alerts:appreciationResponse.getError"))})};u.appreciationResponse(s,a,a,i,!0)}})}])}),define("js/constants/partials",[],function(){return{ROOT:"root@",SINGLE:"single@",PAGEABLE:"pageable@",SUB_SINGLE:"subSingle@",SUB_PAGEABLE:"subPageable@",ACTIVITY:"activity@",BLOCKED:"blocked@",COMMENT:"comment@",CONVERSATION:"conversation@",FOLLOWEE:"followee@",FOLLOWER:"follower@",MESSAGE:"message@",NOTIFICATION:"notification@",POSTING:"posting@",TAG:"tag@",USER:"user@",CURRENT:"current@"}}),define("js/controller/posting",["./module","jquery","angular","js/util/i18n","js/util/utils","js/constants/path-variables","js/constants/events","js/constants/scope-variables","js/constants/partials","js/constants/chained-keys"],function(e,t,n,r,i,s,o,u,a,f){e.controller("PostingController",["$scope","$parse","SharedMethods","ApiData","Options","pyComment",function(e,t,s,l,c,h){e.single=t(e.$parent[u.SINGLE])(e.$parent),e[u.SINGLE]="single",e[u.PAGEABLE]="data.pageable";var p="fa-plus",d="fa-minus",v=function(t){return function(n,r,i){e.showSubPageable=!0,e.showSubPageableIcon=d,e.loadingComments=!1,t(n,r,i)}},m=function(t){return function(n,i){r(function(r){e.loadingComments=!1,e.subPageableAlert=r("alerts:pageableErrors.comments"),t(n,i)})}},g=function(t,n,r,i){e.loadingComments=!0,h.postingComments(v(n),m(r),m(i),t,e.postingId)},y=function(){e.subPageableAlert=undefined,e.data=l.getData(undefined,{scope:e,view:a.COMMENT,method:g,number:0,title:"shared:comments",time:!0,asReplies:!0,scroll:!1})},b=function(t){return n.isDefined(t)||(t=function(){}),function(i,o,u){return n.isDefined(e.posting)&&r(function(t){e.posting.replyCount=e.posting.replyCount+1,e.replyTallyLabel=t("shared:commentsCount",{count:e.posting.replyCount}),e.openStatistics=s.getPromotionStatsModal(e,e.title,e.tally,e.tallyLabel,e.replyTally,e.replyTallyLabel,[e.appreciationCountLabel,e.promotionCountLabel]),y()}),t(i,o,u)}};e.reply=function(t,n,r,i,s,u,a){e.$broadcast(o.SET_EDITOR),h.postingReply(b(t),n,r,e.postingId,i,s,u,a)};var w=function(t){n.isDefined(t)&&n.isDefined(t.getSingleMain())&&(e.single=t,e.posting=t.getSingleMain(),e.postingId=e.posting.id,e.hideExplicit=e.posting.warning&&!c.getWarning(),typeof e.posting.title!="undefined"&&(e.title=e.posting.title),r(function(n){e.tally=e.posting.tally||{},e.replyTally=e.posting.replyTally||{},e.tallyLabel=n("shared:tallyTitle.posting"),e.replyTallyLabel=n("shared:commentsCount",{count:e.posting.replyCount}),e.appreciationCountLabel=n("shared:appreciationsCount",{count:e.posting.appreciationCount}),e.promotionCountLabel=n("shared:promotionsCount",{count:e.posting.promotionCount}),e.timeSince=i.getTimeSince(e.posting.created),e.calendar=i.getCalendarDate(e.posting.created),e.openStatistics=s.getPromotionStatsModal(e,e.title,e.tally,e.tallyLabel,e.replyTally,e.replyTallyLabel,[e.appreciationCountLabel,e.promotionCountLabel]),e.showSubPageable=!1,e.showSubPageableIcon=p,e.subPageableAlert=undefined,t.autoSub&&(e.showSubPageable=!0,e.showSubPageableIcon=d,y())}),e.toggleSubPageable=function(){e.showSubPageable?(e.showSubPageable=!1,e.showSubPageableIcon=p):y()},e.data={})};w(e.single),e.$watch("$parent."+e.$parent[u.SINGLE]+"."+f.DATA+"."+f.SINGLE,function(n,r){n!==r&&w(t(e.$parent[u.SINGLE])(e.$parent))})}]),e.controller("PostingPreviewController",["$scope","$parse",function(e,t){e.init=function(n){e.posting=t(e.$parent[u.SINGLE])(e.$parent),typeof e.posting!="undefined"&&r(function(t){typeof e.posting.title!="undefined"&&(e.title=e.posting.title,e.hrefTitle=i.getEncodedTitle(e.posting.title)),e.tally=e.posting.tally||{},e.replyTally=e.posting.replyTally||{},e.tallyLabel=t("shared:finance.summary"),e.replyTallyLabel=t("shared:commentsCount",{count:e.posting.replyCount}),e.timeSince=i.getTimeSince(e.posting.created),e.calendar=i.getCalendarDate(e.posting.created)})}}])}),define("js/constants/comment-types",[],function(){return{POSTING:"POSTING",USER:"USER",TAG:"TAG"}}),define("js/controller/comment",["./module","jquery","angular","js/util/i18n","js/util/utils","js/constants/path-variables","js/constants/comment-types","js/constants/states","js/constants/events","js/constants/scope-variables","js/constants/partials","js/constants/chained-keys"],function(e,t,n,r,i,s,o,u,a,f,l,c){e.controller("CommentController",["$scope","$state","$parse","ApiData","SharedMethods","Options","pyComment",function(e,t,h,p,d,v,m){e.single=h(e.$parent[f.SINGLE])(e.$parent),e[f.SINGLE]="single",e[f.PAGEABLE]="data.pageable";var g="fa-plus",y="fa-minus",b=function(t){return function(n,r,i){e.showSubPageable=!0,e.showSubPageableIcon=y,e.loadingComments=!1,t(n,r,i)}},w=function(t){return function(n,i){r(function(r){e.loadingComments=!1,e.subPageableAlert=r("alerts:pageableErrors.comments"),t(n,i)})}},E=function(t,n,r,i){m.commentComments(b(n),w(r),w(i),t,e.commentId)},S=function(){e.subPageableAlert=undefined,e.data=p.getData(undefined,{scope:e,view:l.COMMENT,method:E,number:0,title:"shared:comments",time:!0,asReplies:!0,scroll:!1})},x=function(t){return n.isDefined(t)||(t=function(){}),function(i,s,o){return n.isDefined(e.comment)&&r(function(t){e.comment.replyCount=e.comment.replyCount+1,e.replyTallyLabel=t("shared:commentsCount",{count:e.comment.replyCount}),e.openStatistics=d.getPromotionStatsModal(e,e.title,e.tally,e.tallyLabel,e.replyTally,e.replyTallyLabel,[e.appreciationCountLabel,e.promotionCountLabel]),S()}),t(i,s,o)}};e.reply=function(t,n,r,i,s,o,u){e.$broadcast(a.SET_EDITOR),m.commentReply(x(t),n,r,e.commentId,i,s,o,u)},e.contextOpen=!1;var T=function(a){n.isDefined(a)&&n.isDefined(a.getSingleMain())&&(e.single=a,e.comment=a.getSingleMain(),e.commentId=e.comment.id,e.hideExplicit=e.comment.warning&&!v.getWarning(),r(function(n){if(typeof e.comment.base!="undefined"){var r={};e.comment.type===o.POSTING?(r[s.POSTING]=e.comment.base,e.baseLink=t.href(u.POSTINGS_ID,r,{reload:!0}),e.baseTitle=n("shared:base.posting")):e.comment.type===o.TAG?(r[s.TAG]=e.comment.base,e.baseLink=t.href(u.TAGS_ID,r,{reload:!0}),e.baseTitle=n("shared:base.tag")):e.comment.type===o.USER&&(r[s.USER]=e.comment.base,e.baseLink=t.href(u.USERS_ID,r,{reload:!0}),e.baseTitle=n("shared:base.user"))}typeof e.comment.parent!="undefined"&&(e.parentTitle=n("shared:parent")),e.tally=e.comment.tally||{},e.replyTally=e.comment.replyTally||{},e.title=n("shared:commentUser",{user:e.comment.author.username}),e.tallyLabel=n("shared:tallyTitle.comment"),e.replyTallyLabel=n("shared:commentsCount",{count:e.comment.replyCount}),e.appreciationCountLabel=n("shared:appreciationsCount",{count:e.comment.appreciationCount}),e.promotionCountLabel=n("shared:promotionsCount",{count:e.comment.promotionCount}),e.timeSince=i.getTimeSince(e.comment.created),e.calendar=i.getCalendarDate(e.comment.created),e.openStatistics=d.getPromotionStatsModal(e,e.title,e.tally,e.tallyLabel,e.replyTally,e.replyTallyLabel,[e.appreciationCountLabel,e.promotionCountLabel]),e.showSubPageable=!1,e.showSubPageableIcon=g,e.subPageableAlert=undefined,a.autoSub&&(e.showSubPageable=!0,e.showSubPageableIcon=y,S())}),e.toggleSubPageable=function(){e.showSubPageable?(e.showSubPageable=!1,e.showSubPageableIcon=g):S()},e.data={})};T(e.single),e.$watch("$parent."+e.$parent[f.SINGLE]+"."+c.DATA+"."+c.SINGLE,function(t,n){t!==n&&T(h(e.$parent[f.SINGLE])(e.$parent))})}]),e.controller("CommentViewController",["$scope","$state","Options","Pageable",function(e,t,n,a){e.init=function(f){e.contextOpen=!1,e.comment=a.getPageItem(f),typeof e.comment!="undefined"&&(e.hideExplicit=e.comment.warning&&!n.getWarning(),r(function(n){if(typeof e.comment.base!="undefined"){var r={};e.comment.type===o.POSTING?(r[s.POSTING]=e.comment.base,e.baseLink=t.href(u.POSTINGS_ID,r,{reload:!0}),e.baseTitle=n("shared:base.posting")):e.comment.type===o.TAG?(r[s.TAG]=e.comment.base,e.baseLink=t.href(u.TAGS_ID,r,{reload:!0}),e.baseTitle=n("shared:base.tag")):e.comment.type===o.USER&&(r[s.USER]=e.comment.base,e.baseLink=t.href(u.USERS_ID,r,{reload:!0}),e.baseTitle=n("shared:base.user"))}typeof e.comment.parent!="undefined"&&(e.parentTitle=n("shared:parent")),e.tally=e.comment.tally||{},e.replyTally=e.comment.replyTally||{},e.tallyLabel=n("shared:tallyTitle.comment"),e.replyTallyLabel=n("shared:commentsCount",{count:e.comment.replyCount}),e.timeSince=i.getTimeSince(e.comment.created),e.calendar=i.getCalendarDate(e.comment.created),e.commentLabel=n("shared:commentPreviewLink")}))}}]),e.controller("CommentPreviewController",["$scope","$state","Options","Pageable",function(e,t,n,a){e.init=function(f){e.contextOpen=!1,e.comment=a.getPageItem(f),typeof e.comment!="undefined"&&(e.hideExplicit=e.comment.warning&&!n.getWarning(),r(function(n){if(typeof e.comment.base!="undefined"){var r={};e.comment.type===o.POSTING?(r[s.POSTING]=e.comment.base,e.baseLink=t.href(u.POSTINGS_ID,r,{reload:!0}),e.baseTitle=n("shared:base.posting")):e.comment.type===o.TAG?(r[s.TAG]=e.comment.base,e.baseLink=t.href(u.TAGS_ID,r,{reload:!0}),e.baseTitle=n("shared:base.tag")):e.comment.type===o.USER&&(r[s.USER]=e.comment.base,e.baseLink=t.href(u.USERS_ID,r,{reload:!0}),e.baseTitle=n("shared:base.user"))}typeof e.comment.parent!="undefined"&&(e.parentTitle=n("shared:parent")),e.tally=e.comment.tally||{},e.replyTally=e.comment.replyTally||{},e.tallyLabel=n("shared:tallyTitle.comment"),e.replyTallyLabel=n("shared:commentsCount",{count:e.comment.replyCount}),e.timeSince=i.getTimeSince(e.comment.created),e.calendar=i.getCalendarDate(e.comment.created),e.commentLabel=n("shared:commentPreviewLink")}))}}])}),define("js/controller/tag",["./module","jquery","angular","js/util/i18n","js/util/utils","js/constants/path-variables","js/constants/states","js/constants/scope-variables","js/constants/partials","js/constants/chained-keys","js/constants/events"],function(e,t,n,r,i,s,o,u,a,f,l){e.controller("TagController",["$scope","$parse","$state","SharedMethods","ApiData","pyPosting","pyComment",function(e,t,s,c,h,p,d){e.single=t(e.$parent[u.SINGLE])(e.$parent),e[u.SINGLE]="single",e[u.PAGEABLE]="data.pageable";var v="fa-plus",m="fa-minus",g=function(t){return function(n,r,i){e.showSubPageable=!0,e.showSubPageableIcon=m,e.loadingSubPageable=!1,t(n,r,i)}},y=function(t,i){return function(s,o){r(function(r){e.loadingSubPageable=!1,e.subPageableAlert=r("alerts:pageableErrors.sub"),n.isDefined(i)&&(e.subPageableAlert=r(i)),t(s,o)})}},b=function(t,n,r,i){e.loadingSubPageable=!0,p.postingPreviews(g(n),y(r,"alerts:pageableErrors.postings"),y(i,"alerts:pageableErrors.postings"),t,undefined,[e.tag.name])},w=function(t,n,r,i){e.loadingSubPageable=!0,d.tagComments(g(n),y(r,"alerts:pageableErrors.comments"),y(i,"alerts:pageableErrors.comments"),t,e.tag.name)};e.loadSubPageable=function(t){e.subPageableAlert=undefined,e.activeSubPageable=t,e.data=h.getData(undefined,{scope:e,view:t.view,method:t.method,number:0,title:t.label,time:!0,asReplies:!0,autoSub:!1,scroll:!1})},e.subPageableDropdownOpen=!1;var E=function(t){return n.isDefined(t)||(t=function(){}),function(i,s,u){return n.isDefined(e.tag)&&r(function(t){e.tag.replyCount=e.tag.replyCount+1,e.replyTallyLabel=t("shared:commentsCount",{count:e.tag.replyCount}),e.openStatistics=c.getPromotionStatsModal(e,e.tag.name,e.tally,e.tallyLabel,e.replyTally,e.replyTallyLabel);for(var n=0;n<e.subPageableOptions.length;n++)e.subPageableOptions[n].state===o.TAGS_ID_REPLIES&&(e.activeSubPageable=e.subPageableOptions[n],e.activeSubPageable.label=e.replyTallyLabel,e.loadSubPageable(e.activeSubPageable))}),t(i,s,u)}};e.reply=function(t,n,r,i,s,o,u){e.$broadcast(l.SET_EDITOR),d.tagReply(E(t),n,r,e.tag.name,i,s,o,u)};var S=function(t){n.isDefined(t)&&n.isDefined(t.getSingleMain())&&(e.tag=t.getSingleMain(),r(function(r){e.tally={value:e.tag.value,appreciation:e.tag.appreciation},e.replyTally=e.tag.replyTally||{},e.tallyLabel=r("shared:tallyTitle.tag"),e.replyTallyLabel=r("shared:commentsCount",{count:e.tag.replyCount}),e.timeSince=i.getTimeSince(e.tag.lastPromotion),e.calendar=i.getCalendarDate(e.tag.lastPromotion),e.openStatistics=c.getPromotionStatsModal(e,e.tag.name,e.tally,e.tallyLabel,e.replyTally,e.replyTallyLabel),e.showSubPageable=!1,e.showSubPageableIcon=v,e.subPageableAlert=undefined,e.subPageableOptions=[{label:r("shared:taggedPostings"),view:a.POSTING,method:b,state:o.TAGS_ID,icon:"fa-newspaper-o"},{label:e.replyTallyLabel,view:a.COMMENT,method:w,state:o.TAGS_ID_REPLIES,icon:"fa-at"}],e.activeSubPageable=e.subPageableOptions[0];var s=t.getArg("state");if(n.isDefined(s))for(var u=0;u<e.subPageableOptions.length;u++)e.subPageableOptions[u].state===s&&(e.activeSubPageable=e.subPageableOptions[u]);t.autoSub&&(e.showSubPageable=!0,e.showSubPageableIcon=m,e.loadSubPageable(e.activeSubPageable))}),e.toggleSubPageable=function(){e.showSubPageable?(e.showSubPageable=!1,e.showSubPageableIcon=v):e.loadSubPageable(e.activeSubPageable)},e.data={})};S(e.single),e.$watch("$parent."+e.$parent[u.SINGLE]+"."+f.DATA+"."+f.SINGLE,function(n,r){n!==r&&S(t(e.$parent[u.SINGLE])(e.$parent))})}]),e.controller("TagPreviewController",["$scope","Pageable",function(e,t){e.init=function(n){e.tag=t.getPageItem(n),typeof e.tag!="undefined"&&r(function(t){e.tally={value:e.tag.value,appreciation:e.tag.appreciation},e.replyTally=e.tag.replyTally||{},e.tallyLabel=t("shared:tallyTitle.tag"),e.replyTallyLabel=t("shared:commentsCount",{count:e.tag.replyCount}),e.timeSince=i.getTimeSince(e.tag.lastPromotion),e.calendar=i.getCalendarDate(e.tag.lastPromotion)})}}])}),define("js/controller/user",["./module","jquery","angular","js/util/i18n","js/util/utils","js/constants/path-variables","js/constants/scope-variables","js/constants/chained-keys","js/constants/states","js/constants/partials","js/constants/response-codes","js/constants/events"],function(e,t,n,r,i,s,o,u,a,f,l,c){e.controller("UserController",["$scope","$parse","$state","$stateParams","SharedMethods","AutoRefresh","ApiData","Authentication","CurrentUser","Options","pyFollow","pyEvent","pyPosting","pyComment",function(e,t,i,s,l,h,p,d,v,m,g,y,b,w){e.single=t(e.$parent[o.SINGLE])(e.$parent),e[o.SINGLE]="single",e[o.PAGEABLE]="data.pageable";var E="fa-plus",S="fa-minus",x=function(t){return function(n,r,i){e.showSubPageable=!0,e.showSubPageableIcon=S,e.loadingSubPageable=!1,t(n,r,i)}},T=function(t,i){return function(s,o){r(function(r){e.loadingSubPageable=!1,e.subPageableAlert=r("alerts:pageableErrors.sub"),n.isDefined(i)&&(e.subPageableAlert=r(i)),t(s,o)})}};e.loadSubPageable=function(t){e.subPageableAlert=undefined,e.activeSubPageable=t,e.data=p.getData(undefined,{scope:e,view:t.view,method:t.method,number:0,title:t.label,time:t.time,asReplies:t.asReplies,scroll:!1,autoLoad:!0,autoSub:!1})},e.subPageableDropdownOpen=!1;var N=function(t){v.hasFollows(t,function(t){t?e.follows=!0:e.follows=!1},function(){e.follows=undefined})},C=function(t){v.hasBlocked(t,function(t){t?e.blocked=!0:e.blocked=!1},function(){e.blocked=undefined})},k=function(t){e.authenticated=t,t&&n.isDefined(e.username)&&(N(e.username),C(e.username))};k(d.isAuthenticated()),d.manageEvent(e,function(e,t){k(t)});var L=function(t){return n.isDefined(t)||(t=function(){}),function(i,s,o){return n.isDefined(e.user)&&r(function(t){e.user.replyCount=e.user.replyCount+1,e.replyTallyLabel=t("shared:commentsCount",{count:e.user.replyCount}),e.openStatistics=l.getPromotionStatsModal(e,e.username,e.tally,e.tallyLabel,e.replyTally,e.replyTallyLabel,[e.appreciationCountLabel,e.promotionCountLabel,e.postingCountLabel,e.commentCountLabel,e.followerCountLabel,e.followeeCountLabel]);for(var n=0;n<e.subPageableOptions.length;n++)e.subPageableOptions[n].state===a.USERS_ID_REPLIES&&(e.activeSubPageable=e.subPageableOptions[n],e.activeSubPageable.label=e.replyTallyLabel,e.loadSubPageable(e.activeSubPageable))}),t(i,s,o)}};e.reply=function(t,n,r,i,s,o,u){e.$broadcast(c.SET_EDITOR),w.userReply(L(t),n,r,e.username,i,s,o,u)};var A=function(t){n.isDefined(t)&&n.isDefined(t.getSingleMain())&&(e.user=t.getSingleMain(),e.username=e.user.username.username,e.hideExplicit=e.user.warning&&!m.getWarning(),e.follows=!1,e.blocked=!1,N(e.username),C(e.username),r(function(r){e.tally={appreciation:e.user.appreciation,value:e.user.promotion},e.replyTally=e.user.replyTally||{},e.tallyLabel=r("shared:tallyTitle.user"),e.replyTallyLabel=r("shared:commentsCount",{count:e.user.replyCount}),e.appreciationCountLabel=r("shared:appreciationsCount",{count:e.user.appreciationCount}),e.promotionCountLabel=r("shared:promotionsCount",{count:e.user.promotionCount}),e.followerCountLabel=r("shared:followersCount",{count:e.user.followerCount}),e.followeeCountLabel=r("shared:followeesCount",{count:e.user.followeeCount}),e.postingCountLabel=r("shared:postingsCount",{count:e.user.contributedPostings}),e.commentCountLabel=r("shared:commentsCount",{count:e.user.contributedComments}),e.openStatistics=l.getPromotionStatsModal(e,e.username,e.tally,e.tallyLabel,e.replyTally,e.replyTallyLabel,[e.appreciationCountLabel,e.promotionCountLabel,e.postingCountLabel,e.commentCountLabel,e.followerCountLabel,e.followeeCountLabel]),e.showSubPageable=!1,e.showSubPageableIcon=E,e.subPageableAlert=undefined,e.subPageableOptions=[{label:r("shared:activity"),state:a.USERS_ID,icon:"fa-star",view:f.ACTIVITY,time:!1,asReplies:!1,method:function(t,n,r,i){var s;y.userFeed(x(n),T(r,"alerts:pageableErrors.feed"),T(i,"alerts:pageableErrors.feed"),e.username,t,s)}},{label:e.replyTallyLabel,state:a.USERS_ID_REPLIES,icon:"fa-at",view:f.COMMENT,time:!0,asReplies:!0,method:function(t,n,r,i){w.userComments(x(n),T(r,"alerts:pageableErrors.comments"),T(i,"alerts:pageableErrors.comments"),t,e.username)}},{label:r("shared:followees"),state:a.USERS_ID_FOLLOWEES,icon:"fa-binoculars",view:f.FOLLOWER,time:!1,asReplies:!1,method:function(t,n,r,i){g.userFollowees(x(n),T(r,"alerts:pageableErrors.users"),T(i,"alerts:pageableErrors.users"),e.username,t)}},{label:r("shared:followers"),state:a.USERS_ID_FOLLOWERS,icon:"fa-child",view:f.FOLLOWER,time:!1,asReplies:!1,method:function(t,n,r,i){g.userFollowers(x(n),T(r,"alerts:pageableErrors.users"),T(i,"alerts:pageableErrors.users"),e.username,t)}},{label:r("shared:authoredPostings"),state:a.USERS_ID_POSTINGS,icon:"fa-newspaper-o",view:f.POSTING,time:!0,asReplies:!1,method:function(t,n,r,i){var s;b.postingPreviews(x(n),T(r,"alerts:pageableErrors.postings"),T(i,"alerts:pageableErrors.postings"),t,e.username,s)}},{label:r("shared:authoredComments"),state:a.USERS_ID_COMMENTS,icon:"fa-comments",view:f.COMMENT,time:!0,asReplies:!1,method:function(t,n,r,i){var s;w.commentPreviews(x(n),T(r,"alerts:pageableErrors.comments"),T(i,"alerts:pageableErrors.comments"),t,e.username,s)}}],e.activeSubPageable=e.subPageableOptions[0];var i=t.getArg("state");if(n.isDefined(i))for(var s=0;s<e.subPageableOptions.length;s++)e.subPageableOptions[s].state===i&&(e.activeSubPageable=e.subPageableOptions[s]);t.autoSub&&(e.showSubPageable=!0,e.showSubPageableIcon=S,e.loadSubPageable(e.activeSubPageable)),e.appreciationResponseHideExplicit=e.appreciationResponseWarning&&!m.getWarning()}),e.toggleSubPageable=function(){e.showSubPageable?(e.showSubPageable=!1,e.showSubPageableIcon=E):e.loadSubPageable(e.activeSubPageable)},e.data={})};A(e.single),e.$watch("$parent."+e.$parent[o.SINGLE]+"."+u.DATA+"."+u.SINGLE,function(n,r){n!==r&&A(t(e.$parent[o.SINGLE])(e.$parent))})}]),e.controller("UserAppreciationResponseController",["$scope","$parse","$stateParams","Options",function(e,t,i,s){e.single=t(e.$parent[o.SINGLE])(e.$parent),e[o.SINGLE]="single";var a=function(t){if(n.isDefined(t)&&n.isDefined(t.getSingleMain())){e.user=t.getSingleMain();var i=t.getChained(u.APPRECIATION_RESPONSE);if(typeof i=="undefined"||i.code!==l.SUCCESS)return;e.aR=i.dto,e.response=e.aR.appreciationResponse,e.appreciationResponseWarning=e.aR.appreciationResponseWarning,e.hideExplicit=e.appreciationResponseWarning&&!s.getWarning(),r(function(t){e.tally={appreciation:e.user.appreciation,value:e.user.promotion},e.replyTally=e.user.replyTally||{},e.tallyLabel=t("shared:tallyTitle.user"),e.replyTallyLabel=t("shared:commentsCount",{count:e.user.replyCount})})}};a(e.single),e.$watch("$parent."+e.$parent[o.SINGLE]+"."+u.DATA+"."+u.SINGLE,function(n,r){n!==r&&a(t(e.$parent[o.SINGLE])(e.$parent))})}]),e.controller("UserPreviewController",["$scope","Pageable",function(e,t){e.init=function(n){e.user=t.getPageItem(n),typeof e.user!="undefined"&&r(function(t){e.tally={appreciation:e.user.appreciation,value:e.user.promotion},e.replyTally=e.user.replyTally||{},e.tallyLabel=t("shared:tallyTitle.user"),e.replyTallyLabel=t("shared:commentsCount",{count:e.user.replyCount})})}}])}),define("js/controller/search",["./module","jquery","angular","js/util/i18n","js/constants/states","js/constants/path-variables","js/constants/response-codes"],function(e,t,n,r,i,s,o){e.controller("SearchTagsController",["$scope","$state","Loaded","pyTag",function(e,t,n,u){var a,f=function(n,r,o){var u={};u[s.TAG]=e.tag,t.go(i.TAGS_ID,u,{reload:!0})},l=function(t,n){r(function(n){t===o.NOT_FOUND?e.alert=n("shared:tagSearch.notFoundTag",{tag:a}):e.alert=n("alerts:apiError")})},c=function(){r(function(t){e.alert=t("alerts:apiError")})};e.search=function(){a=e.tag,e.alert=undefined;if(typeof e.tag=="undefined"||e.tag.length===0)return;u.tag(f,l,c,a)},n.resetInfo(!0),n.loadedInfo()}]),e.controller("SearchUsersController",["$scope","$state","Loaded","pyUser",function(e,t,n,u){var a,f=function(n,r,o){var u={};u[s.USER]=e.user,t.go(i.USERS_ID,u,{reload:!0})},l=function(t,n){r(function(n){t===o.NOT_FOUND?e.alert=n("shared:userSearch.notFoundUser",{user:a}):e.alert=n("alerts:apiError")})},c=function(){r(function(t){e.alert=t("alerts:apiError")})};e.search=function(){a=e.user,e.alert=undefined;if(typeof e.user=="undefined"||e.user.length===0)return;u.user(f,l,c,a)},n.resetInfo(!0),n.loadedInfo()}]),e.controller("MessageUsersController",["$scope","$state","Loaded","pyUser",function(e,t,n,u){var a,f=function(n,r,o){var u={};u[s.USER]=e.user,t.go(i.USERS_ID_MESSAGES,u,{reload:!0})},l=function(t,n){r(function(n){t===o.NOT_FOUND?e.alert=n("shared:userSearch.notFoundUser",{user:a}):e.alert=n("alerts:apiError")})},c=function(){r(function(t){e.alert=t("alerts:apiError")})};e.search=function(){a=e.user,e.alert=undefined;if(typeof e.user=="undefined"||e.user.length===0)return;u.user(f,l,c,a)},n.resetInfo(!0),n.loadedInfo()}])}),define("js/constants/forms",[],function(){return{EDIT_PROFILE_A:"pyeditProfileA",EDIT_APPRECIATION_RESPONSE_A:"pyeditAppreciationResponseA",EDIT_POSTING:"pyeditPosting",CREATE_POSTING:"pycreatePosting",EDIT_COMMENT:"pyeditComment",CREATE_COMMENT:"pycreateComment",CREATE_OFFER:"pycreateOffer",CREATE_OFFER_EMAIL:"pycreateOfferEmail",CREATE_MESSAGE:"pycreateMessage",EDIT_PROFILE:"pyeditProfile",EDIT_APPRECIATION_RESPONSE:"pyeditAppreciationResponse",PASSWORD_CHANGE:"pypasswordChange",PASSWORD_CHANGE_UNAUTHED:"pypasswordChangeUnauthed",PAYMENT_CHANGE:"pypaymentChange",SETTINGS_EMAIL_CHANGE:"pysettingsEmailChange",EMAIL_CHANGE:"pyemailChange",PASSWORD_RESET:"pypasswordReset",SETTINGS:"pysettings",SETTINGS_SESSION:"pysettingsSession",LOGIN:"pylogin",REGISTER:"pyregister",ADD_RESTRICTED:"pyaddRestricted"}}),define("js/controller/current",["./module","jquery","angular","js/util/i18n","js/util/validation-errors","js/util/utils","js/constants/path-variables","js/constants/view-urls","js/constants/response-codes","js/constants/forms","js/constants/events","js/constants/values","js/constants/chained-keys","js/constants/scope-variables","js/constants/partials","js/constants/states"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){e.controller("CurrentController",["$rootScope","$scope","$parse","SharedMethods","Browser","ApiData","Authentication","AutoRefresh","Options","Alerts","User","Utils","MarkdownConverter","pyProfile","pyPosting","pyComment","pyFollow","pyBlock","pyEvent",function(e,t,s,o,u,c,m,g,y,b,w,E,S,x,T,N,C,k,L){t.single=s(t.$parent[p.SINGLE])(t.$parent),t[p.SINGLE]="single",t[p.PAGEABLE]="data.pageable";var A="fa-plus",O="fa-minus",M=function(e){return function(n,r,i){t.showSubPageable=!0,t.showSubPageableIcon=O,t.loadingSubPageable=!1,e(n,r,i)}},_=function(e,i){return function(s,o){r(function(r){t.loadingSubPageable=!1,t.subPageableAlert=r("alerts:pageableErrors.sub"),n.isDefined(i)&&(t.subPageableAlert=r(i)),e(s,o)})}};t.loadSubPageable=function(e){t.subPageableAlert=undefined,t.activeSubPageable=e,t.data=c.getData(undefined,{scope:t,view:e.view,method:e.method,number:0,title:e.label,time:e.time,asReplies:e.asReplies,scroll:!1,autoLoad:!0,autoSub:!1})},t.subPageableDropdownOpen=!1,t.descriptionWarning=!1,t.appreciationResponseWarning=!1,t.showDescriptionPreview=!1,t.showResponsePreview=!1;var D,P={loading:!1,open:!1,errors:{}};t.descriptionData=P;var H={loading:!1,open:!1,errors:{}};t.appreciationResponseData=H;var B=function(e){return n.isDefined(e)||(e=function(){}),function(i,s,u){return n.isDefined(t.current)&&r(function(e){t.current.replyCount=t.current.replyCount+1,t.replyTallyLabel=e("shared:commentsCount",{count:t.current.replyCount}),t.openStatistics=o.getPromotionStatsModal(t,t.username,t.tally,t.tallyLabel,t.replyTally,t.replyTallyLabel,[t.appreciationCountLabel,t.promotionCountLabel,t.postingCountLabel,t.commentCountLabel,t.followerCountLabel,t.followeeCountLabel]);for(var n=0;n<t.subPageableOptions.length;n++)t.subPageableOptions[n].state===v.CURRENT_REPLIES&&(t.activeSubPageable=t.subPageableOptions[n],t.loadSubPageable(t.activeSubPageable))}),e(i,s,u)}};t.reply=function(e,n,r,i,s,o,u){N.userReply(B(e),n,r,t.username,i,s,o,u)};var j=function(e){n.isDefined(e)&&n.isDefined(e.getSingleMain())&&(t.current=e.getSingleMain(),D=t.current.username.username,t.username=D,t.tally=t.current.tally||{},t.replyTally=t.current.replyTally||{},t.description=t.current.description,t.appreciationResponse=t.current.appreciationResponse,typeof t.descriptionData!="undefined"&&(t.descriptionData.description=t.description),typeof t.appreciationResponse!="undefined"&&(t.appreciationResponseData.appreciationResponse=t.appreciationResponse),t.descriptionWarning=t.current.warning,t.appreciationResponseWarning=t.current.appreciationResponseWarning,r(function(r){t.tally={appreciation:t.current.appreciation,value:t.current.promotion},t.tallyLabel=r("shared:tallyTitle.current"),t.replyTally=t.current.replyTally||{},t.replyTallyLabel=r("shared:commentsCount",{count:t.current.replyCount}),t.appreciationCountLabel=r("shared:appreciationsCount",{count:t.current.appreciationCount}),t.promotionCountLabel=r("shared:promotionsCount",{count:t.current.promotionCount}),t.followerCountLabel=r("shared:followersCount",{count:t.current.followerCount}),t.followeeCountLabel=r("shared:followeesCount",{count:t.current.followeeCount}),t.postingCountLabel=r("shared:postingsCount",{count:t.current.contributedPostings}),t.commentCountLabel=r("shared:commentsCount",{count:t.current.contributedComments}),t.openStatistics=o.getPromotionStatsModal(t,t.username,t.tally,t.tallyLabel,t.replyTally,t.replyTallyLabel,[t.appreciationCountLabel,t.promotionCountLabel,t.postingCountLabel,t.commentCountLabel,t.followerCountLabel,t.followeeCountLabel]),t.showSubPageable=!1,t.showSubPageableIcon=A,t.subPageableAlert=undefined,t.subPageableOptions=[{label:r("shared:activity"),state:v.CURRENT,icon:"fa-star",view:d.ACTIVITY,time:!1,asReplies:!1,method:function(e,n,r,i){var s;L.userFeed(M(n),_(r,"alerts:pageableErrors.feed"),_(i,"alerts:pageableErrors.feed"),t.username,e,s)}},{label:t.replyTallyLabel,state:v.CURRENT_REPLIES,icon:"fa-at",view:d.COMMENT,time:!0,asReplies:!0,method:function(e,n,r,i){N.userComments(M(n),_(r,"alerts:pageableErrors.comments"),_(i,"alerts:pageableErrors.comments"),e,t.username)}},{label:r("shared:followees"),state:v.FOLLOWEES,icon:"fa-binoculars",view:d.FOLLOWEE,time:!1,asReplies:!1,method:function(e,t,n,r){C.followees(M(t),_(n,"alerts:pageableErrors.users"),_(r,"alerts:pageableErrors.users"),e)}},{label:r("shared:followers"),state:v.FOLLOWERS,icon:"fa-child",view:d.FOLLOWER,time:!1,asReplies:!1,method:function(e,t,n,r){C.followers(M(t),_(n,"alerts:pageableErrors.users"),_(r,"alerts:pageableErrors.users"),e)}},{label:r("shared:blocked"),state:v.BLOCKED,icon:"fa-child",view:d.BLOCKED,time:!1,asReplies:!1,method:function(e,t,n,r){k.blocked(M(t),_(n,"alerts:pageableErrors.users"),_(r,"alerts:pageableErrors.users"),e)}},{label:r("shared:authoredPostings"),state:v.CURRENT_POSTINGS,icon:"fa-newspaper-o",view:d.POSTING,time:!0,asReplies:!1,method:function(e,n,r,i){var s;T.postingPreviews(M(n),_(r,"alerts:pageableErrors.postings"),_(i,"alerts:pageableErrors.postings"),e,t.username,s)}},{label:r("shared:authoredComments"),state:v.CURRENT_COMMENTS,icon:"fa-comments",view:d.COMMENT,time:!0,asReplies:!1,method:function(e,n,r,i){var s;N.commentPreviews(M(n),_(r,"alerts:pageableErrors.comments"),_(i,"alerts:pageableErrors.comments"),e,t.username,s)}},{label:r("shared:yourPostings"),state:v.CURRENT_SELF_POSTINGS,icon:"fa-newspaper-o",view:d.POSTING,time:!1,asReplies:!1,method:function(e,t,n,r){var i;T.currentPostingPreviews(M(t),_(n,"alerts:pageableErrors.postings"),_(r,"alerts:pageableErrors.postings"),e,i)}},{label:r("shared:yourComments"),state:v.CURRENT_SELF_COMMENTS,icon:"fa-comments",view:d.COMMENT,time:!1,asReplies:!1,method:function(e,t,n,r){N.currentCommentPreviews(M(t),_(n,"alerts:pageableErrors.comments"),_(r,"alerts:pageableErrors.comments"),e)}}],t.activeSubPageable=t.subPageableOptions[0];var i=e.getArg("state");if(n.isDefined(i))for(var s=0;s<t.subPageableOptions.length;s++)t.subPageableOptions[s].state===i&&(t.activeSubPageable=t.subPageableOptions[s]);e.autoSub&&(t.showSubPageable=!0,t.showSubPageableIcon=O,t.loadSubPageable(t.activeSubPageable))}),t.toggleSubPageable=function(){t.showSubPageable?(t.showSubPageable=!1,t.showSubPageableIcon=A):t.loadSubPageable(t.activeSubPageable)},t.data={})},F=function(n,r,i){P.loading=!1,P.open=!1,t.description=P.description,e.$broadcast(l.UNSAVED_CHANGES_COMPLETE)},I=function(e,t){r(function(n){u.scrollTo("descriptionForm"),P.loading=!1,e===a.INVALID&&typeof t!="undefined"?i.handleErrorsInOrder(t,["description"],function(e,t){if(t){var r="validation:"+i.getValidCode(t);P.errors[e]=n(r,i.getArguments(t))}else P.errors[e]=undefined}):P.alert(n("alerts:description.descriptionError"))})},q=function(){r(function(e){u.scrollTo("descriptionForm"),P.loading=!1,P.alert=e("alerts:apiError")})};t.updateDescription=function(){P.loading=!0,P.errors={},P.alert=undefined,x.updateProfile(F,I,q,P.description,P.warning)},t.cancelDescription=function(){P.open=!1,t.descriptionData.description=t.description,e.$broadcast(l.UNSAVED_CHANGES_COMPLETE)},t.editDescription=function(){P.loading=!1,P.open=!0,P.alert=undefined,P.errors={},P.description=t.description,P.warning=t.descriptionWarning,E.unsavedChanges(t,f.EDIT_PROFILE)};var R=function(n,r,i){H.loading=!1,H.open=!1,t.appreciationResponse=H.appreciationResponse,e.$broadcast(l.UNSAVED_CHANGES_COMPLETE)},U=function(e,t){r(function(n){u.scrollTo("appreciationResponseForm"),H.loading=!1,e===a.INVALID&&typeof t!="undefined"?i.handleErrorsInOrder(t,["appreciationResponse"],function(e,t){if(t){var r="validation:"+i.getValidCode(t);H.errors[e]=n(r,i.getArguments(t))}else H.errors[e]=undefined}):H.alert(n("alerts:appreciationResponse.updateError"))})},z=function(){r(function(e){u.scrollTo("appreciationResponseForm"),H.loading=!1,H.alert=e("alerts:apiError")})};t.updateAppreciationResponse=function(){H.loading=!0,H.errors={},H.alert=undefined,x.updateAppreciationResponse(R,U,z,H.appreciationResponse,H.warning)},t.cancelAppreciationResponse=function(){H.open=!1,H.appreciationResponse=t.appreciationResponse,e.$broadcast(l.UNSAVED_CHANGES_COMPLETE)},t.editAppreciationResponse=function(){H.loading=!1,H.open=!0,H.alert=undefined,H.errors={},H.appreciationResponse=t.appreciationResponse,H.warning=t.appreciationResponseWarning,E.unsavedChanges(t,f.EDIT_APPRECIATION_RESPONSE)},t.updateDescriptionPreview=function(){var e=t.descriptionData.description;typeof e=="undefined"&&(e=""),t.descriptionPreview=e},t.updateResponsePreview=function(){var e=t.appreciationResponseData.appreciationResponse;typeof e=="undefined"&&(e=""),t.responsePreview=e},S.manageEvent(t,function(){t.updateDescriptionPreview(),t.updateResponsePreview()}),j(t.single),t.$watch("$parent."+t.$parent[p.SINGLE]+"."+h.DATA+"."+h.SINGLE,function(e,n){e!==n&&j(s(t.$parent[p.SINGLE])(t.$parent))});var W=function(e){t.authenticated=e};m.manageEvent(t,function(e,t){W(t)}),W(m.isAuthenticated())}])}),define("js/constants/settings-options",[],function(){return{ALLOW_PROFILE_COMMENTS:"ALLOW_PROFILE_COMMENTS",ALLOW_WARNING_CONTENT:"ALLOW_WARNING_CONTENT",HIDE_USER_PROFILE:"HIDE_USER_PROFILE"}}),define("js/constants/pending-actions",[],function(){return{UNCONFIRMED_EMAIL:"UNCONFIRMED_EMAIL",UNLINKED_PAYMENT_ID:"UNLINKED_PAYMENT_ID"}}),define("js/controller/settings",["./module","jquery","angular","js/util/utils","js/util/i18n","js/util/validation-errors","js/constants/events","js/constants/language-settings","js/constants/settings-options","js/constants/response-codes","js/constants/forms","js/constants/roles","js/constants/pending-actions"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p;e.controller("SettingsController",["$rootScope","$scope","Alerts","Authentication","Loaded","Browser","CurrentUser","Reloader","Options","pyProfile",function(e,t,n,o,l,c,p,d,v,m){t.loaded=l;var g=u.LANGUAGES,y=u.INTERFACE_LANGUAGES,b=r.invertObject(g),w=r.invertObject(y),E=function(e){var t=[];if(typeof e!="undefined")for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t};t.languages=E(g),t.interfaceLanguages=E(y),t.email="",t.paymentId="";var S=function(){t.language=g[v.getLanguage()],t.interfaceLanguage=y[v.getInterfaceLanguage()],t.warning=v.getWarning()},x=function(e,n,r){v.setLanguage(n.language),v.setInterfaceLanguage(n.interfaceLanguage),typeof n.options!="undefined"&&(typeof n.options[a.ALLOW_WARNING_CONTENT]!="undefined"&&(v.setWarning(n.options[a.ALLOW_WARNING_CONTENT]),t.warning=n.options[a.ALLOW_WARNING_CONTENT]),typeof n.options[a.ALLOW_PROFILE_COMMENTS]!="undefined"&&(t.allowProfileComments=n.options[a.ALLOW_PROFILE_COMMENTS]),typeof n.options[a.HIDE_USER_PROFILE]!="undefined"&&(t.hideUserProfile=n.options[a.HIDE_USER_PROFILE])),t.email=n.email,t.paymentId=n.paymentId,S(!0)},T=function(){i(function(e){c.scrollTo("content"),n.warning(e("alerts:user.settingsError"))})},N=function(){t.authenticated&&m.getSettings(x,T,T)},C=function(){p.hasPendingAction(h.UNCONFIRMED_EMAIL,function(e){e&&(t.emailInvalid=!0,i(function(e){c.scrollTo("content"),n.error(e("alerts:settingsEmail.required"))}))},function(){i(function(e){c.scrollTo("content"),n.warning(e("alerts:user.settingsError"))})})},k=function(e){t.authenticated=e,S(),e&&(N(),p.getFresh(C,C))};k(o.isAuthenticated()),o.manageEvent(t,function(e,t){k(t)});var L=function(){t.changePassword={oldPassword:"",newPassword:"",confirmNewPassword:""},t.changePasswordErrors={}};L();var A=function(e,t,r){i(function(e){c.scrollTo("content"),n.success(e("alerts:user.passwordChangeSuccess"))})},O=function(e,r){i(function(i){e===f.INVALID&&typeof r!="undefined"?s.handleErrorsInOrder(r,["oldPassword","newPassword","confirmNewPassword"],function(e,n){if(n){var r="validation:"+s.getValidCode(n);t.changePasswordErrors[e]=i(r,s.getArguments(n))}else t.changePasswordErrors[e]=undefined}):e===f.LOGIN_LOCKED?t.changePasswordErrors.oldPassword=i("alerts:password.locked"):e===f.INVALID?t.changePasswordErrors.oldPassword=i("validation:py.validation.error.format.password"):e===f.RESTRICTED_PASSWORD?t.changePasswordErrors.newPassword=i("validation:restricted.password"):e===f.NOT_ALLOWED?t.changePasswordErrors.oldPassword=i("validation:notAllowed.password"):(c.scrollTo("content"),n.error(i("alerts:password.change.error")),t.changePasswordErrors={})})},M=function(){i(function(e){c.scrollTo("content"),n.error(e("alerts:apiError"))})};t.submitPasswordChange=function(){t.changePasswordErrors={},m.passwordChange(A,O,M,t.changePassword.oldPassword,t.changePassword.newPassword,t.changePassword.confirmNewPassword),L()},t.zxcvbnResult={},t.zxcvbnLoaded=!1;var _=function(){};require(["zxcvbn"],function(e){t.zxcvbnLoaded=!0,_=function(){typeof t.changePassword.newPassword!="undefined"&&(t.zxcvbnResult=e(t.changePassword.newPassword.substring(0,100)),typeof t.zxcvbnResult!="undefined"&&(typeof t.zxcvbnResult.feedback!="undefined"&&(t.passwordAdvice=t.zxcvbnResult.feedback.suggestions),t.passwordScore=t.zxcvbnResult.score))}}),t.$watch("changePassword.newPassword",function(e,t){e!==t&&_()});var D=function(e){return function(t,r,s){i(function(t){c.scrollTo("content"),n.success(t(e))})}},P=function(e){return function(){i(function(t){c.scrollTo("content"),n.warning(t(e))})}},H=function(e,t){i(function(e){c.scrollTo("content"),n.warning(e("emailToken.confirmationError"))})};t.sendEmailChangeToken=function(){m.sendEmailChangeToken(D("alerts:emailToken.emailChange"),P("alerts:emailToken.error"),P("alerts:emailToken.error"))},t.sendConfirmationToken=function(){m.sendConfirmationToken(D("alerts:emailToken.confirmation"),H,P("alerts:emailToken.error"))},t.sendPaymentIdChangeToken=function(){m.sendPaymentIdChangeToken(D("alerts:emailToken.paymentIdChange"),P("alerts:emailToken.error"),P("alerts:emailToken.error"))},t.sendDeleteToken=function(){m.sendDeleteToken(D("alerts:emailToken.delete"),P("alerts:emailToken.error"),P("alerts:emailToken.error"))};var B=function(e,t,n){d.fullRefresh()},j=function(e,t,r){i(function(e){n.warning(e("alerts:user.settingsResetError"))})};t.resetSettings=function(){m.resetSettings(B,j,j)},t.changeEmailData={loading:!1,errors:{}},t.changeEmailToggle=!1,t.emailInvalid=!1,t.toggleChangeEmail=function(){t.changeEmailToggle=!t.changeEmailToggle,t.changeEmailData={loading:!1,errors:{}}};var F=function(e,n){i(function(r){t.changeEmailData.loading=!1,e===f.INVALID&&typeof n!="undefined"?s.handleErrorsInOrder(n,["email","password"],function(e,n){if(n){var i="validation:"+s.getValidCode(n);t.changeEmailData.errors[e]=r(i,s.getArguments(n))}else t.changeEmailData.errors[e]=undefined}):e===f.RESTRICTED_EMAIL?t.changeEmailData.errors.email=r("validation:restricted.email"):e===f.LOGIN_LOCKED?t.changeEmailData.errors.password=r("alerts:password.locked"):e===f.NOT_ALLOWED?t.changeEmailData.errors.password=r("validation:notAllowed.password"):e===f.EXISTS?t.changeEmailData.errors.email=r("validation:exists.selfEmail"):e===f.EXISTS_EMAIL?t.changeEmailData.errors.email=r("validation:exists.email"):t.changeEmailData.alert=r("alerts:settingsEmail.error")})},I=function(e,r,s){i(function(e){t.email=t.changeEmailData.email,t.changeEmailData.loading=!1,t.changeEmailToggle=!1,c.scrollTo("content"),n.success(e("alerts:settingsEmail.success"))})},q=function(){i(function(e){t.changeEmailData.loading=!1,t.changeEmailData.alert=e("alerts:apiError")})};t.changeEmail=function(){t.changeEmailData.alert=undefined,t.changeEmailData.loading=!0,t.changeEmailData.errors={},m.emailPendingActionChange(I,F,q,t.changeEmailData.email,t.changeEmailData.password),t.changeEmailData.password=undefined},l.resetInfo(!0),l.loadedInfo(),t.submitSessionSettings=function(){var e=b[t.language],r=w[t.interfaceLanguage],s=t.warning;typeof s!="undefined"&&v.setWarning(s),typeof e!="undefined"&&v.setLanguage(e),typeof r!="undefined"&&v.setInterfaceLanguage(r),i(function(e){c.scrollTo("content"),n.success(e("alerts:user.settingsSuccess"))})},t.submitSettings=function(){var e=b[t.language],r=w[t.interfaceLanguage],s=t.warning,o=function(t,o,u){typeof s!="undefined"&&v.setWarning(s),typeof e!="undefined"&&v.setLanguage(e),typeof r!="undefined"&&v.setInterfaceLanguage(r),i(function(e){c.scrollTo("content"),n.success(e("alerts:user.settingsSuccess"))})},u=function(){i(function(e){c.scrollTo("content"),n.warning(e("alerts:user.settingsChangeError"))})},f={};f[a.ALLOW_WARNING_CONTENT]=s,f[a.ALLOW_PROFILE_COMMENTS]=t.allowProfileComments,f[a.HIDE_USER_PROFILE]=t.hideUserProfile,m.setSettings(o,u,u,e,r,f,undefined,undefined,undefined)}}])}),define("js/controller/event",["./module","jquery","angular","js/util/i18n","js/util/utils","js/constants/states","js/constants/path-variables","js/constants/scope-variables","js/constants/partials","js/constants/chained-keys","js/constants/values"],function(e,t,n,r,i,s,o,u,a,f,l){var c={ANY:s.INDEX,POSTING:s.POSTINGS_ID,COMMENT:s.COMMENTS_ID,COMMENT_SUB:s.COMMENTS_ID,MESSAGE:s.CONVERSATION,APPRECIATION_POSTING:s.POSTINGS_ID,APPRECIATION_COMMENT:s.COMMENTS_ID,APPRECIATION_ATTEMPT:s.SETTINGS,PROMOTION_POSTING:s.POSTINGS_ID,PROMOTION_COMMENT:s.COMMENTS_ID,OFFER:s.OFFERS,OFFER_ACCEPT:s.USERS_ID,OFFER_WITHDRAW:s.USERS_ID,OFFER_DENY:s.USERS_ID,BACKING_CANCEL:s.USERS_ID,BACKING_WITHDRAW:s.USERS_ID,FOLLOW_ADD:s.USERS_ID,FOLLOW_REMOVE:s.USERS_ID,POSTING_INFRINGEMENT:s.POSTINGS_ID,COMMENT_INFRINGEMENT:s.COMMENTS_ID};e.controller("ActivityController",["$scope","$state","$parse","$timeout","ApiData","pyPosting","pyComment","User",function(e,t,c,h,p,d,v,m){e.single=c(e.$parent[u.SINGLE])(e.$parent),e[u.SINGLE]="subData.single";var g=function(t){return function(n,r,i){return e.loadingSubSingle=!1,t(n,r,i)}},y=function(t,i){return function(s,o){r(function(t){e.loadingSubSingle=!1,e.subSingleAlert=t("alerts:pageableErrors.sub"),n.isDefined(i)&&(e.subSingleAlert=t(i))}),e.subData={},t(s,o)}},b=function(t){return n.isDefined(t)&&n.isDefined(t.view)&&(n.isDefined(t.method)||n.isDefined(t.getData))?function(){e.subSingleAlert=undefined,n.isDefined(e.subData)&&n.isDefined(e.subData.single)?e.subData={}:(e.loadingSubSingle=!0,n.isDefined(t.getData)?e.subData=t.getData(e.targetIds,e.targets):e.subData=p.getData({scope:e,view:t.view,method:t.method(e.targetIds,e.targets)}))}:function(){}},w={ANY:{state:s.INDEX},POSTING:{state:s.POSTINGS_ID,method:function(e,t){return function(t,n,r){d.posting(g(t),y(n),y(r),e[o.POSTING])}},view:a.POSTING},COMMENT:{state:s.COMMENTS_ID,method:function(e,t){return function(t,n,r){v.comment(g(t),y(n),y(r),e[o.COMMENT])}},view:a.COMMENT},COMMENT_SUB:{state:s.COMMENTS_ID,method:function(e,t){return function(t,n,r){v.comment(g(t),y(n),y(r),e[o.COMMENT])}},view:a.COMMENT},MESSAGE:{state:s.CONVERSATION},APPRECIATION_POSTING:{state:s.POSTINGS_ID,method:function(e,t){return function(t,n,r){d.posting(g(t),y(n),y(r),e[o.POSTING])}},view:a.POSTING},APPRECIATION_COMMENT:{state:s.COMMENTS_ID,method:function(e,t){return function(t,n,r){v.comment(g(t),y(n),y(r),e[o.COMMENT])}},view:a.COMMENT},APPRECIATION_ATTEMPT:{state:s.SETTINGS},PROMOTION_POSTING:{state:s.POSTINGS_ID,method:function(e,t){return function(t,n,r){d.posting(g(t),y(n),y(r),e[o.POSTING])}},view:a.POSTING},PROMOTION_COMMENT:{state:s.COMMENTS_ID,method:function(e,t){return function(t,n,r){v.comment(g(t),y(n),y(r),e[o.COMMENT])}},view:a.COMMENT},OFFER:{state:s.OFFERS},OFFER_ACCEPT:{state:s.USERS_ID},OFFER_WITHDRAW:{state:s.USERS_ID},OFFER_DENY:{state:s.USERS_ID},BACKING_CANCEL:{state:s.USERS_ID},BACKING_WITHDRAW:{state:s.USERS_ID},FOLLOW_ADD:{state:s.USERS_ID,getData:function(t,n){return m.user(e,t[o.TARGET],g,y,y)},view:a.USER},FOLLOW_REMOVE:{state:s.USERS_ID,getData:function(t,n){return m.user(e,t[o.TARGET],g,y,y)},view:a.USER},POSTING_INFRINGEMENT:{state:s.POSTINGS_ID},COMMENT_INFRINGEMENT:{state:s.COMMENTS_ID}},E=function(a){if(n.isDefined(a)&&n.isDefined(a.getSingleMain())){e.single=a,e.event=a.getSingleMain(),e.subData={};if(!n.isDefined(e.event.type))return;r(function(r){e.targets=e.event.targets,e.targets.type==="POSTING"?e.targets.typeRenamed=r("shared:typeRenamed.posting"):e.targets.type==="USER"?e.targets.typeRenamed=r("shared:typeRenamed.user"):e.targets.type==="TAG"&&(e.targets.typeRenamed=r("shared:typeRenamed.tag")),e.targetIds=e.event.targetIds,typeof e.targetIds[o.USER]=="undefined"&&(e.targetIds[o.USER]=e.targetIds[o.TARGET]),e.title=r("shared:activityTypes."+e.event.type,e.targets),e.timeSince=i.getTimeSince(e.event.occurred),e.calendar=i.getCalendarDate(e.event.occurred);var a=w[e.event.type];e.click=undefined;if(n.isDefined(a)){e.link=t.href(a.state,e.targetIds);if((n.isDefined(a.method)||n.isDefined(a.getData))&&n.isDefined(a.view)){e.click=b(a);if(e.single.autoLoad){var f=0,c=e.$parent[u.INDEX];n.isDefined(c)&&c>0&&(f=c*l.AUTOLOAD_TIMEOUT_MULTIPLIER),h(function(){e.click()},f)}}}else e.link=t.href(s.INDEX,e.targetIds)})}};E(e.single),e.$watch("$parent."+e.$parent[u.SINGLE]+"."+f.DATA+"."+f.SINGLE,function(t,n){t!==n&&E(c(e.$parent[u.SINGLE])(e.$parent))})}]),e.controller("NotificationController",["$scope","$state","$parse","$timeout","ApiData","pyPosting","pyComment","User",function(e,t,c,h,p,d,v,m){e.single=c(e.$parent[u.SINGLE])(e.$parent),e[u.SINGLE]="subData.single";var g=function(t){return function(n,r,i){return e.loadingSubSingle=!1,t(n,r,i)}},y=function(t,i){return function(s,o){r(function(t){e.loadingSubSingle=!1,e.subSingleAlert=t("alerts:pageableErrors.sub"),n.isDefined(i)&&(e.subSingleAlert=t(i))}),e.subData={},t(s,o)}},b=function(t){return n.isDefined(t)&&n.isDefined(t.view)&&(n.isDefined(t.method)||n.isDefined(t.getData))?function(){e.subSingleAlert=undefined,n.isDefined(e.subData)&&n.isDefined(e.subData.single)?e.subData={}:(e.loadingSubSingle=!0,n.isDefined(t.getData)?e.subData=t.getData(e.targetIds,e.targets):e.subData=p.getData({scope:e,view:t.view,method:t.method(e.targetIds,e.targets)}))}:function(){}},w={ANY:{state:s.INDEX},POSTING:{state:s.POSTINGS_ID,method:function(e,t){return function(t,n,r){d.posting(g(t),y(n),y(r),e[o.POSTING])}},view:a.POSTING},COMMENT:{state:s.COMMENTS_ID,method:function(e,t){return function(t,n,r){v.comment(g(t),y(n),y(r),e[o.COMMENT])}},view:a.COMMENT},COMMENT_SUB:{state:s.COMMENTS_ID,method:function(e,t){return function(t,n,r){v.comment(g(t),y(n),y(r),e[o.COMMENT])}},view:a.COMMENT},MESSAGE:{state:s.CONVERSATION},APPRECIATION_POSTING:{state:s.POSTINGS_ID,getData:function(t,n){return m.user(e,t[o.USER],g,y,y)},view:a.USER},APPRECIATION_COMMENT:{state:s.COMMENTS_ID,getData:function(t,n){return m.user(e,t[o.USER],g,y,y)},view:a.USER},APPRECIATION_ATTEMPT:{state:s.SETTINGS},PROMOTION_POSTING:{state:s.POSTINGS_ID,getData:function(t,n){return m.user(e,t[o.USER],g,y,y)},view:a.USER},PROMOTION_COMMENT:{state:s.COMMENTS_ID,getData:function(t,n){return m.user(e,t[o.USER],g,y,y)},view:a.USER},OFFER:{state:s.OFFERS},OFFER_ACCEPT:{state:s.USERS_ID},OFFER_WITHDRAW:{state:s.USERS_ID},OFFER_DENY:{state:s.USERS_ID},BACKING_CANCEL:{state:s.USERS_ID},BACKING_WITHDRAW:{state:s.USERS_ID},FOLLOW_ADD:{state:s.USERS_ID,getData:function(t,n){return m.user(e,t[o.USER],g,y,y)},view:a.USER},FOLLOW_REMOVE:{state:s.USERS_ID,getData:function(t,n){return m.user(e,t[o.USER],g,y,y)},view:a.USER},POSTING_INFRINGEMENT:{state:s.POSTINGS_ID},COMMENT_INFRINGEMENT:{state:s.COMMENTS_ID}},E=function(a){if(n.isDefined(a)&&n.isDefined(a.getSingleMain())){e.single=a,e.event=a.getSingleMain(),e.subData={};if(!n.isDefined(e.event.type))return;r(function(r){e.targets=e.event.targets,e.targets.type==="POSTING"?e.targets.typeRenamed=r("shared:typeRenamed.posting"):e.targets.type==="USER"?e.targets.typeRenamed=r("shared:typeRenamed.user"):e.targets.type==="TAG"&&(e.targets.typeRenamed=r("shared:typeRenamed.tag")),e.targetIds=e.event.targetIds,typeof e.targetIds[o.USER]=="undefined"&&(e.targetIds[o.USER]=e.targetIds[o.SOURCE]),e.title=r("shared:notificationTypes."+e.event.type,e.targets),e.timeSince=i.getTimeSince(e.event.occurred),e.calendar=i.getCalendarDate(e.event.occurred);var a=w[e.event.type];e.click=undefined;if(n.isDefined(a)){e.link=t.href(a.state,e.targetIds);if((n.isDefined(a.method)||n.isDefined(a.getData))&&n.isDefined(a.view)){e.click=b(a);if(e.single.autoLoad){var f=0,c=e.$parent[u.INDEX];n.isDefined(c)&&c>0&&(f=c*l.AUTOLOAD_TIMEOUT_MULTIPLIER),h(function(){e.click()},f)}}}else e.link=t.href(s.INDEX,e.targetIds)})}};E(e.single),e.$watch("$parent."+e.$parent[u.SINGLE]+"."+f.DATA+"."+f.SINGLE,function(t,n){t!==n&&E(c(e.$parent[u.SINGLE])(e.$parent))})}])}),define("js/controller/follow",["./module","jquery","angular","js/util/i18n","js/util/utils","js/constants/path-variables","js/constants/scope-variables","js/constants/chained-keys","js/constants/partials"],function(e,t,n,r,i,s,o,u,a){var f=function(e){return function(t){return function(n,r,i){return e.loadingSubSingle=!1,t(n,r,i)}}},l=function(e){return function(t){return function(n,i){r(function(t){e.loadingSubSingle=!1,e.subSingleAlert=t("alerts:single.errors.user")}),e.subData={},t(n,i)}}},c=function(e,t,n){return t.user(e,n,f(e),l(e),l(e))};e.controller("FollowInfoController",["$scope","$parse","User",function(e,t,r){e.single=t(e.$parent[o.SINGLE])(e.$parent),e[o.SINGLE]="subData.single";var s=function(){e.subSingleAlert=undefined,n.isDefined(e.subData)&&n.isDefined(e.subData.single)||!n.isDefined(e.info)?e.subData={}:(e.loadingSubSingle=!0,e.subData=c(e,r,e.info.username.username))},a=function(t){n.isDefined(t)&&n.isDefined(t.getSingleMain())&&(e.single=t,e.info=t.getSingleMain(),e.timeSince=i.getTimeSince(e.info.added),e.calendar=i.getCalendarDate(e.info.added),e.clickUser=s,e.single.autoLoad&&e.clickUser())};a(e.single),e.$watch("$parent."+e.$parent[o.SINGLE]+"."+u.DATA+"."+u.SINGLE,function(n,r){n!==r&&a(t(e.$parent[o.SINGLE])(e.$parent))})}]),e.controller("FolloweeController",["$scope","$parse","CurrentUser","User","pyFollow",function(e,t,s,a,f){e.single=t(e.$parent[o.SINGLE])(e.$parent),e[o.SINGLE]="subData.single";var l=function(){e.subSingleAlert=undefined,n.isDefined(e.subData)&&n.isDefined(e.subData.single)||!n.isDefined(e.info)?e.subData={}:(e.loadingSubSingle=!0,e.subData=c(e,a,e.info.username.username))},h=function(t){n.isDefined(t)&&n.isDefined(t.getSingleMain())&&(e.single=t,e.info=t.getSingleMain(),e.timeSince=i.getTimeSince(e.info.added),e.calendar=i.getCalendarDate(e.info.added),e.unfollow=function(){var t=function(t,n,r){e.disabled=!0,e.subData={},s.refreshSubscription()},n=function(){r(function(t){e.subAlert=t("alerts:follow.unfollowError")})};e.subAlert=undefined,f.unfollow(t,n,n,e.info.username.username)},e.clickUser=l,e.single.autoLoad&&e.clickUser())};h(e.single),e.$watch("$parent."+e.$parent[o.SINGLE]+"."+u.DATA+"."+u.SINGLE,function(n,r){n!==r&&h(t(e.$parent[o.SINGLE])(e.$parent))})}]),e.controller("BlockedInfoController",["$scope","$parse","User","pyBlock",function(e,t,s,a){e.single=t(e.$parent[o.SINGLE])(e.$parent),e[o.SINGLE]="subData.single";var f=function(){e.subSingleAlert=undefined,n.isDefined(e.subData)&&n.isDefined(e.subData.single)||!n.isDefined(e.info)?e.subData={}:(e.loadingSubSingle=!0,e.subData=c(e,s,e.info.username.username))},l=function(t){n.isDefined(t)&&n.isDefined(t.getSingleMain())&&(e.single=t,e.info=t.getSingleMain(),e.timeSince=i.getTimeSince(e.info.added),e.calendar=i.getCalendarDate(e.info.added),e.unblock=function(){var t=function(t,n,r){e.disabled=!0,e.subData={}},n=function(){r(function(t){e.subAlert=t("alerts:block.unblockError")})};a.unblock(t,n,n,e.info.username.username)},e.clickUser=f,e.single.autoLoad&&e.clickUser())};l(e.single),e.$watch("$parent."+e.$parent[o.SINGLE]+"."+u.DATA+"."+u.SINGLE,function(n,r){n!==r&&l(t(e.$parent[o.SINGLE])(e.$parent))})}])}),define("js/constants/model-attributes",[],function(){var e="single",t="page",n="p",r="c",i="u",s="t",o="fi",u="V";return{COMMENT_VIEW:r+u,POSTING:n,COMMENT:r,USER:i,TAG:s,SINGLE:e,PAGE:t,constructModel:function(n,r){var i={};return typeof n!="undefined"&&n!==null&&(i[e]=n),typeof r!="undefined"&&r!==null&&(i[t]=r),i}}}),define("js/controller/message",["./module","jquery","angular","js/util/i18n","js/util/utils","js/constants/path-variables","js/constants/view-urls","js/constants/model-attributes","js/constants/scope-variables","js/constants/chained-keys"],function(e,t,n,r,i,s,o,u,a,f){e.controller("ConversationPreviewController",["$scope","$parse","CurrentUser",function(e,t,s){e.single=t(e.$parent[a.SINGLE])(e.$parent),e[a.SINGLE]="single",e[a.PAGEABLE]="data.pageable";var o=function(t){if(n.isDefined(t)&&n.isDefined(t.getSingleMain())){e.conversation=t.getSingleMain();var o=e.conversation.author.username,u=e.conversation.target.username;e.conversationUsername=u,e.conversationUser=e.conversation.target,s.get(function(t){e.currentUsername=t.username.username,typeof e.currentUsername=="undefined"?(e.conversationUsername=o,e.conversationUser=e.conversation.author):e.currentUsername===o?(e.conversationUsername=u,e.conversationUser=e.conversation.target):e.currentUsername===u&&(e.conversationUsername=o,e.conversationUser=e.conversation.author)}),r(function(t){e.created=i.getTimeSince(e.conversation.created),e.createdCalendar=i.getCalendarDate(e.conversation.created),e.lastMessage=i.getTimeSince(e.conversation.lastMessage),e.lastMessageCalendar=i.getCalendarDate(e.conversation.lastMessage)})}};o(e.single),e.$watch("$parent."+e.$parent[a.SINGLE]+"."+f.DATA+"."+f.SINGLE,function(n,r){n!==r&&o(t(e.$parent[a.SINGLE])(e.$parent))})}]),e.controller("MessageController",["$scope","$parse","CurrentUser",function(e,t,s){e.single=t(e.$parent[a.SINGLE])(e.$parent),e[a.SINGLE]="single",e[a.PAGEABLE]="data.pageable";var o=function(t){if(n.isDefined(t)&&n.isDefined(t.getSingleMain())){e.message=t.getSingleMain();var o=e.message.author.username,u=e.message.target.username;s.get(function(t){e.currentUsername=t.username.username,typeof e.currentUsername=="undefined"?e.self=!1:e.currentUsername===o?e.self=!0:e.currentUsername===u&&(e.self=!1)}),r(function(t){e.current=t("shared:you"),e.timeSince=i.getTimeSince(e.message.created),e.calendar=i.getCalendarDate(e.message.created)})}};o(e.single),e.$watch("$parent."+e.$parent[a.SINGLE]+"."+f.DATA+"."+f.SINGLE,function(n,r){n!==r&&o(t(e.$parent[a.SINGLE])(e.$parent))})}])}),define("js/controller/edit-posting",["./module","jquery","angular","js/util/i18n","js/util/validation-errors","js/constants/response-codes","js/constants/path-variables","js/constants/events","js/constants/states","js/constants/forms"],function(e,t,n,r,i,s,o,u,a,f){e.controller("EditPostingController",["$rootScope","$scope","$state","Browser","CurrentUser","Utils","Authentication","Alerts","MarkdownConverter","pyPosting",function(e,t,o,a,l,c,h,p,d,v){t.postingLoading=!1,t.title=undefined,t.content=undefined,t.preview=undefined,t.alert=undefined,t.errors={},t.currentUser=undefined,t.currentUsername=undefined,t.showPreview=!1,t.show=!1;var m=t.$parent;t.pscope=m,c.unsavedChanges(t,f.EDIT_POSTING);var g=function(){t.show=!1},y=function(e){t.authenticated=e,e&&l.get(function(e){t.currentUser=e,t.currentUsername=e.username.username},function(){r(function(e){p.warning(e("alerts:apiError")),g()})})};y(h.isAuthenticated()),h.manageEvent(t,function(e,t){y(t)});var b=function(e,n){r(function(r){t.postingLoading=!1,e===s.INVALID&&typeof n!="undefined"?i.handleErrorsInOrder(n,["title","content","preview","imageLink","imageWidth","imageHeight"],function(e,n){if(n){var s="validation:"+i.getValidCode(n);t.errors[e]=r(s,i.getArguments(n))}else t.errors[e]=undefined}):e===s.NOT_ALLOWED?t.alert=r("alerts:posting.editNotAllowed"):t.alert=r("alerts:posting.editError")})},w=function(r,i,s){t.postingLoading=!1,e.$broadcast(u.UNSAVED_CHANGES_COMPLETE),t.show=!1,n.isDefined(m.posting)&&(t.title===""&&(t.title=undefined),t.content===""&&(t.content=undefined),t.preview===""&&(t.preview=undefined),m.posting.title=t.title,m.posting.content=t.content,m.posting.preview=t.preview,m.posting.imageLink=t.imageLink,m.posting.imageWidth=t.imageWidth,m.posting.imageHeight=t.imageHeight)},E=function(){r(function(e){t.postingLoading=!1,t.alert=e("alerts:apiError")})};t.editPosting=function(){t.postingLoading=!0,t.errors={},t.alert=undefined;if(n.isDefined(m.postingId)){var e,r;n.isDefined(t.imageHeight)&&(e=parseInt(t.imageHeight)),n.isDefined(t.imageWidth)&&(r=parseInt(t.imageWidth)),v.edit(w,b,E,m.postingId,t.title,t.content,t.preview,t.imageLink,r,e)}},d.manageEvent(t,function(){var e=t.content;typeof e=="undefined"&&(e=""),t.contentPreview=e}),t.open=function(){n.isDefined(m.posting)&&(t.show=!0,t.title=m.posting.title,t.content=m.posting.content,t.$broadcast(u.SET_EDITOR,t.content),t.preview=m.posting.preview,t.imageLink=m.posting.imageLink,t.imageWidth=m.posting.imageWidth,t.imageHeight=m.posting.imageHeight)},t.cancel=function(){g()}}])}),define("js/controller/create-posting",["./module","jquery","angular","js/util/i18n","js/util/validation-errors","js/util/utils","js/constants/values","js/constants/response-codes","js/constants/path-variables","js/constants/pending-actions","js/constants/events","js/constants/states","js/constants/forms"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){e.controller("CreatePostingController",["$rootScope","$scope","$state","CurrentUser","Alerts","Browser","Utils","Authentication","EventManager","Options","MarkdownConverter","pyPosting",function(e,t,o,p,d,v,m,g,y,b,w,E){t.postingLoading=!1,t.title=undefined,t.content=undefined,t.preview=undefined,t.tags=undefined,t.backer=undefined,t.warning=undefined,t.cost=undefined,t.alert=undefined,t.errors={},t.contentPreview=t.content,t.optionalCollapsed=!0,t.imageLink=undefined,t.imageLinkHeight=undefined,t.imageLinkWidth=undefined,t.showPreview=!1;var S=function(){p.hasPendingAction(f.UNLINKED_PAYMENT_ID,function(e){e&&r(function(e){v.scrollTo("content"),d.warning(e("alerts:paymentId.recommended"))})},function(){})};S(),m.unsavedChanges(t,h.CREATE_POSTING);var x=function(e){t.authenticated=e};x(g.isAuthenticated()),g.manageEvent(t,function(e,t){x(t)});var T=function(e,n){r(function(r){v.scrollTo("form"),t.postingLoading=!1,e===u.INVALID&&typeof n!="undefined"?i.handleErrorsInOrder(n,["title","content","tags","backer","warning","cost","preview","imageLink","imageWidth","imageHeight"],function(e,n){if(n){var s="validation:"+i.getValidCode(n);t.errors[e]=r(s,i.getArguments(n))}else t.errors[e]=undefined}):e===u.BALANCE?t.errors.cost=r("validation.balance"):e===u.NOT_FOUND_BACKER?t.errors.backer=r("validation:notFound.backer"):t.alert=r("alerts:posting.createError")})},N=function(n,r,i){t.postingLoading=!1;var s={};s[a.POSTING]=r.result,e.$broadcast(l.BALANCE_CHANGE),e.$broadcast(l.UNSAVED_CHANGES_COMPLETE),o.go(c.POSTINGS_ID,s,{reload:!0})},C=function(){r(function(e){v.scrollTo("form"),t.postingLoading=!1,t.alert=e("alerts:apiError")})};t.createPosting=function(){t.postingLoading=!0,t.errors={},t.alert=undefined;var e;t.cost>0&&(e=t.backer);var r=s.parseTags(t.tags),i,o;n.isDefined(t.imageHeight)&&(i=parseInt(t.imageHeight)),n.isDefined(t.imageWidth)&&(o=parseInt(t.imageWidth)),E.create(N,T,C,t.title,t.content,r,e,t.warning,t.cost,t.preview,t.imageLink,o,i)},w.manageEvent(t,function(){var e=t.content;typeof e=="undefined"&&(e=""),t.contentPreview=e})}])}),define("js/controller/edit-comment",["./module","jquery","angular","js/util/i18n","js/util/validation-errors","js/constants/response-codes","js/constants/path-variables","js/constants/events","js/constants/states","js/constants/forms"],function(e,t,n,r,i,s,o,u,a,f){e.controller("EditCommentController",["$rootScope","$scope","$state","Browser","CurrentUser","Utils","Authentication","Alerts","MarkdownConverter","pyComment",function(e,t,o,a,l,c,h,p,d,v){t.commentLoading=!1,t.content=undefined,t.alert=undefined,t.errors={},t.currentUser=undefined,t.currentUsername=undefined,t.showPreview=!1,t.show=!1;var m=t.$parent;t.pscope=m,c.unsavedChanges(t,f.EDIT_COMMENT);var g=function(){t.show=!1},y=function(e){t.authenticated=e,e&&l.get(function(e){t.currentUser=e,t.currentUsername=e.username.username},function(){r(function(e){p.warning(e("alerts:apiError")),g()})})};y(h.isAuthenticated()),h.manageEvent(t,function(e,t){y(t)});var b=function(e,n){r(function(r){t.commentLoading=!1,e===s.INVALID&&typeof n!="undefined"?i.handleErrorsInOrder(n,["content"],function(e,n){if(n){var s="validation:"+i.getValidCode(n);t.errors[e]=r(s,i.getArguments(n))}else t.errors[e]=undefined}):e===s.NOT_ALLOWED?t.alert=r("alerts:comment.editNotAllowed"):t.alert=r("alerts:comment.editError")})},w=function(r,i,s){t.commentLoading=!1,e.$broadcast(u.UNSAVED_CHANGES_COMPLETE),t.show=!1,n.isDefined(m.comment)&&(t.content===""&&(t.content=undefined),t.preview===""&&(t.preview=undefined),m.comment.content=t.content,m.comment.preview=t.preview)},E=function(){r(function(e){t.commentLoading=!1,t.alert=e("alerts:apiError")})};t.editComment=function(){t.commentLoading=!0,t.errors={},t.alert=undefined,n.isDefined(m.commentId)&&v.edit(w,b,E,m.commentId,t.content)},d.manageEvent(t,function(){var e=t.content;typeof e=="undefined"&&(e=""),t.contentPreview=e}),t.open=function(){n.isDefined(m.comment)&&(t.show=!0,t.content=m.comment.content,t.$broadcast(u.SET_EDITOR,t.content))},t.cancel=function(){g()}}])}),define("js/controller/create-comment",["./module","jquery","angular","js/util/i18n","js/util/validation-errors","js/util/utils","js/constants/response-codes","js/constants/path-variables","js/constants/pending-actions","js/constants/events","js/constants/states","js/constants/forms"],function(e,t,n,r,i,s,o,u,a,f,l,c){e.controller("CreateCommentController",["$rootScope","$scope","$state","$stateParams","Alerts","Browser","Utils","Authentication","EventManager","CurrentUser","MarkdownConverter","pyComment",function(e,t,n,s,u,a,l,h,p,d,v,m){var g=t.$parent;t.pscope=g;var y=function(){t.content=undefined,t.backer=undefined,t.warning=undefined,t.cost=undefined,t.alert=undefined,t.errors={},t.optionalCollapsed=!0,t.showPreview=!1,t.commentLoading=!1};y(),l.unsavedChanges(t,c.CREATE_COMMENT);var b="user",w=function(e,n){r(function(r){a.scrollTo("form"),t.commentLoading=!1,e===o.INVALID&&typeof n!="undefined"?i.handleErrorsInOrder(n,["content","backer","warning","cost"],function(e,n){if(n){var s="validation:"+i.getValidCode(n);t.errors[e]=r(s,i.getArguments(n))}else t.errors[e]=undefined}):e===o.NOT_FOUND_BACKER?t.errors.backer=r("validation:notFound.backer"):e===o.NOT_ALLOWED?t.alert=r("alerts:comment.notAllowed."+b):t.alert=r("alerts:comment.createError")})};g.showCreateComment=!1,g.toggleReply=function(){g.showCreateComment=!g.showCreateComment,g.showCreateComment&&y()};var E=function(n,r,i){t.commentLoading=!1,e.$broadcast(f.BALANCE_CHANGE),e.$broadcast(f.UNSAVED_CHANGES_COMPLETE),g.showCreateComment=!1},S=function(){r(function(e){a.scrollTo("form"),t.commentLoading=!1,t.alert=e("alerts:apiError")})};t.createComment=function(){t.commentLoading=!0,t.errors={},t.alert=undefined;var e;t.cost>0&&(e=t.backer),g.reply(E,w,S,t.content,e,t.warning,t.cost)},v.manageEvent(t,function(){var e=t.content;typeof e=="undefined"&&(e=""),t.preview=e})}])}),define("js/controller/create-message",["./module","jquery","angular","js/util/i18n","js/util/validation-errors","js/util/utils","js/constants/response-codes","js/constants/path-variables","js/constants/view-urls","js/constants/roles","js/constants/events","js/constants/states","js/constants/view-ids"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){e.controller("CreateMessageController",["$rootScope","$scope","$stateParams","$modal","Alerts","ModalInterface","Browser","MarkdownConverter","Authentication","pyMessage",function(e,t,n,s,a,f,c,p,d,v){t.messageLoading=!1,t.message=undefined,t.alert=undefined,t.errors={},t.refresh=!0;var m=function(e){t.authenticated=e};m(d.isAuthenticated()),d.manageEvent(t,function(e,t){m(t)});var g=function(e,n){r(function(r){c.scrollTo("form"),t.messageLoading=!1,e===o.INVALID&&typeof n!="undefined"?i.handleErrorsInOrder(n,["message"],function(e,n){if(n){var s="validation:"+i.getValidCode(n);t.errors[e]=r(s,i.getArguments(n))}else t.errors[e]=undefined}):e===o.NOT_ALLOWED?t.alert=r("alerts:message.notAllowed"):t.alert=r("alerts:message.error")})},y=function(n,r,i){t.messageLoading=!1,t.message=undefined,t.preview=undefined,e.$broadcast(l.TOGGLE_AUTO_REFRESH,t.refresh),c.scrollTo(h.PAGEABLE)},b=function(){r(function(e){c.scrollTo("form"),t.messageLoading=!1,t.alert=e("alerts:apiError")})},w={loading:!1,open:!1};t.flagData=w;var E=function(e,t){e.flagData=w;var i=function(e,t,n){w.loading=!1,r(function(e){a.info(e("alerts:flagged.messageSuccess"))})},s=function(){r(function(e){w.loading=!1,a.warning(e("alerts:flagged.messageError"))})};e.submit=function(){w.loading=!0,v.flag(i,s,s,n[u.USER]),t.close(!0)},e.cancel=function(){t.dismiss("cancel")}};t.openFlag=function(){var e=s.open({templateUrl:"flagModal",controller:f.controller(E),backdrop:!1});e.result.then(function(){w.open=!1},function(){w.open=!1}),e.opened.then(function(){w.open=!0},function(){w.open=!1})},t.toggleAutoRefresh=function(){t.refresh=!t.refresh,e.$broadcast(l.TOGGLE_AUTO_REFRESH,t.refresh)},t.createMessage=function(){t.alert=undefined,t.errors={},t.messageLoading=!0,v.send(y,g,b,n[u.USER],t.message)},p.manageEvent(t,function(){var e=t.message;typeof e=="undefined"&&(e=""),t.preview=e})}])}),define("js/controller/info-view",["./module","jquery","angular","js/util/i18n","js/constants/events","js/constants/states","js/constants/params"],function(e,t,n,r,i,s,o){e.controller("TermsController",["$rootScope","$scope","$state","$location","$timeout","Loaded","Browser","Authentication","Alerts","CacheDelay","pyProfile",function(e,t,n,u,a,f,l,c,h,p,d){t.loaded=f,t.allowAccept=!1,t.allowAccept=!0;var v=function(e){t.authenticated=e};v(c.isAuthenticated()),c.manageEvent(t,function(e,t){v(t)});var m=function(e,t,r){n.go(s.DEFAULT,undefined,{reload:!0})},g=function(e,t){r(function(e){h.error(e("alerts:terms.error"))})},y=function(){r(function(e){h.error(e("alerts:apiError"))})};t.accept=function(){t.authenticated&&t.allowAccept&&d.acceptTermsOfService(m,g,y)},t.decline=function(){e.$broadcast(i.BACK)},t.$watch("loaded.content",function(e,n){var r=u.search()[o.SCROLL_TO];e===!0&&typeof r!="undefined"&&r!==""&&t.$evalAsync(function(){a(function(){l.scrollTo(r)},1)})}),f.resetInfo(!0),f.loadedInfo()}])}),define("js/controller/email-token-links",["./module","jquery","angular","js/util/i18n","js/util/validation-errors","js/constants/states","js/constants/params","js/constants/response-codes"],function(e,t,n,r,i,s,o,u){e.controller("EmailChangeController",["$scope","$state","$location","Browser","Loaded","Authentication","pyProfile",function(e,t,n,a,f,l,c){e.loaded=f,e.errors={},e.alert=undefined,e.emailLoading=!1;var h=n.search()[o.EMAIL_TOKEN];e.email=undefined,e.password=undefined;var p=function(t){e.authenticated=t};p(l.isAuthenticated()),l.manageEvent(e,function(e,t){p(t)});var d=function(t,n){r(function(r){a.scrollTo("form"),e.emailLoading=!1,t===u.INVALID&&typeof n!="undefined"?i.handleErrorsInOrder(n,["email","password"],function(t,n){if(n){var s="validation:"+i.getValidCode(n);e.errors[t]=r(s,i.getArguments(n))}else e.errors[t]=undefined}):t===u.EXISTS||t===u.EXISTS_EMAIL?e.errors.email=r("validation:exists.email"):t===u.RESTRICTED_EMAIL?e.errors.email=r("validation:restricted.email"):t===u.NOT_ALLOWED?e.errors.password=r("validation:notAllowed.password"):t===u.LOGIN_LOCKED?e.errors.password=r("alerts:password.locked"):t===u.INVALID?e.alert=r("alerts:emailToken.link.invalid"):e.alert=r("alerts:emailToken.link.error")})},v=function(n,r,i){e.emailLoading=!1,t.go(s.SETTINGS,undefined,{reload:!0})},m=function(){r(function(t){a.scrollTo("form"),e.emailLoading=!1,e.alert=t("alerts:apiError")})};e.changeEmail=function(){e.authenticated&&(e.emailLoading=!0,e.errors={},e.alert=undefined,c.emailChange(v,d,m,h,e.email,e.password),e.password=undefined)},f.resetInfo(!0),f.loadedInfo()}]),e.controller("PaymentChangeController",["$scope","$state","$location","Browser","Loaded","Authentication","pyProfile",function(e,t,n,a,f,l,c){e.loaded=f,e.errors={},e.alert=undefined,e.paymentLoading=!1;var h=n.search()[o.EMAIL_TOKEN];e.paymentId=undefined,e.password=undefined;var p=function(t){e.authenticated=t};p(l.isAuthenticated()),l.manageEvent(e,function(e,t){p(t)});var d=function(t,n){r(function(r){a.scrollTo("form"),e.paymentLoading=!1,t===u.INVALID&&typeof n!="undefined"?i.handleErrorsInOrder(n,["paymentId","password"],function(t,n){if(n){var s="validation:"+i.getValidCode(n);e.errors[t]=r(s,i.getArguments(n))}else e.errors[t]=undefined}):t===u.RESTRICTED_EMAIL?e.errors.paymentId=r("validation:restricted.email"):t===u.NOT_ALLOWED?e.errors.password=r("validation:notAllowed.password"):t===u.LOGIN_LOCKED?e.errors.password=r("alerts:password.locked"):t===u.INVALID?e.alert=r("alerts:emailToken.link.invalid"):e.alert=r("alerts:emailToken.link.error")})},v=function(n,r,i){e.paymentLoading=!1,t.go(s.SETTINGS,undefined,{reload:!0})},m=function(){r(function(t){a.scrollTo("form"),e.paymentLoading=!1,e.alert=t("alerts:apiError")})};e.changePayment=function(){e.authenticated&&(e.paymentLoading=!0,e.errors={},e.alert=undefined,c.paymentChange(v,d,m,h,e.paymentId,e.password),e.password=undefined)},f.resetInfo(!0),f.loadedInfo()}]),e.controller("ResetPasswordController",["$scope","$state","Browser","Loaded","Authentication","Alerts","pyProfile",function(e,t,n,o,a,f,l){e.loaded=o,e.errors={},e.alert=undefined,e.resetLoading=!1,e.email=undefined;var c=function(t){e.authenticated=t};c(a.isAuthenticated()),a.manageEvent(e,function(e,t){c(t)});var h=function(t,s){r(function(r){n.scrollTo("form"),e.resetLoading=!1,t===u.INVALID&&typeof s!="undefined"?i.handleErrorsInOrder(s,["email"],function(t,n){if(n){var s="validation:"+i.getValidCode(n);e.errors[t]=r(s,i.getArguments(n))}else e.errors[t]=undefined}):e.alert=r("alerts:emailToken.error")})},p=function(n,i,o){r(function(n){e.resetLoading=!1,f.success(n("alerts:emailToken.resetPassword")),t.go(s.DEFAULT,undefined,{reload:!0})})},d=function(){r(function(t){n.scrollTo("form"),e.resetLoading=!1,e.alert=t("alerts:apiError")})};e.resetPassword=function(){e.authenticated||(e.resetLoading=!0,e.errors={},e.alert=undefined,l.sendPasswordResetToken(p,h,d,e.email))},o.resetInfo(!0),o.loadedInfo()}]),e.controller("PasswordChangeUnauthedController",["$scope","$state","$location","Browser","Loaded","Authentication","pyProfile",function(e,t,n,a,f,l,c){e.loaded=f,e.errors={},e.alert=undefined,e.passwordLoading=!1;var h=n.search()[o.EMAIL_TOKEN];e.username=n.search()[o.USER],e.newPassword=undefined,e.confirmNewPassword=undefined;var p=function(t){e.authenticated=t};p(l.isAuthenticated()),l.manageEvent(e,function(e,t){p(t)});var d=function(t,n){r(function(r){a.scrollTo("form"),e.passwordLoading=!1,t===u.INVALID&&typeof n!="undefined"?i.handleErrorsInOrder(n,["newPassword","confirmNewPassword"],function(t,n){if(n){var s="validation:"+i.getValidCode(n);e.errors[t]=r(s,i.getArguments(n))}else e.errors[t]=undefined}):t===u.RESTRICTED_PASSWORD?e.errors.newPassword=r("validation:restricted.password"):t===u.INVALID?e.alert=r("alerts:emailToken.link.invalid"):e.alert=r("alerts:emailToken.link.error")})},v=function(n,r,i){e.passwordLoading=!1,t.go(s.DEFAULT,undefined,{reload:!0})},m=function(){r(function(t){a.scrollTo("form"),e.passwordLoading=!1,e.alert=t("alerts:apiError")})};e.changePassword=function(){e.authenticated||(e.passwordLoading=!0,e.errors={},e.alert=undefined,c.passwordChangeUnauthed(v,d,m,h,e.username,e.newPassword,e.confirmNewPassword),e.newPassword=undefined,e.confirmNewPassword=undefined)},f.resetInfo(!0),f.loadedInfo()}]),e.controller("ConfirmationController",["$scope","$state","$location","Loaded","Authentication","Alerts","pyProfile",function(e,t,n,i,a,f,l){e.loaded=i;var c=n.search()[o.EMAIL_TOKEN],h=function(e,n){r(function(n){e===u.INVALID?(f.warning(n("alerts:emailToken.link.invalid")),t.go(s.SETTINGS,undefined,{reload:!0})):(f.warning(n("alerts:emailToken.link.error")),t.go(s.SETTINGS,undefined,{reload:!0}))})},p=function(e,n,i){r(function(e){f.success(e("alerts:emailToken.link.confirmation")),t.go(s.SETTINGS,undefined,{reload:!0})})},d=function(){r(function(e){f.warning(e("alerts:apiError")),t.go(s.SETTINGS,undefined,{reload:!0})})},v=function(t){e.authenticated=t,t?l.confirmation(p,h,d,c):r(function(e){f.error(e("alerts:emailToken.login"))})};v(a.isAuthenticated()),a.manageEvent(e,function(e,t){v(t)}),i.resetInfo(!0),i.loadedInfo()}]),e.controller("DeletionController",["$scope","$state","$location","Reloader","Loaded","Authentication","Alerts","pyProfile",function(e,t,n,i,a,f,l,c){e.loaded=a;var h=n.search()[o.EMAIL_TOKEN],p=function(e,n){r(function(n){e===u.INVALID?(l.warning(n("alerts:emailToken.link.invalid")),t.go(s.SETTINGS,undefined,{reload:!0})):(l.warning(n("alerts:emailToken.link.error")),t.go(s.SETTINGS,undefined,{reload:!0}))})},d=function(e,n,i){r(function(e){l.success(e("alerts:emailToken.link.delete")),t.go(s.SETTINGS,undefined,{reload:!0})})},v=function(){r(function(e){l.warning(e("alerts:apiError")),t.go(s.SETTINGS,undefined,{reload:!0})})},m=function(t){e.authenticated=t,e.authenticated?c.deletion(d,p,v,h):r(function(e){l.error(e("alerts:emailToken.login"))})};m(f.isAuthenticated()),f.manageEvent(e,function(e,t){m(t)}),a.resetInfo(!0),a.loadedInfo()}])}),define("js/constants/navigation",["js/constants/states"],function(e){return{content:[{label:"shared:postings",state:e.POSTINGS,icon:"fa-newspaper-o"},{label:"shared:tags",state:e.TAGS,icon:"fa-tags"},{label:"shared:users",state:e.USERS,icon:"fa-users"},{label:"shared:comments",state:e.COMMENTS,icon:"fa-comments"}],tag:[{label:"shared:taggedPostings",state:e.TAGS_ID,icon:"fa-newspaper-o"},{label:"shared:replies",state:e.TAGS_ID_REPLIES,icon:"fa-at"}],user:[{label:"shared:activity",state:e.USERS_ID,icon:"fa-star"},{label:"shared:replies",state:e.USERS_ID_REPLIES,icon:"fa-at"},{label:"shared:followees",state:e.USERS_ID_FOLLOWEES,icon:"fa-binoculars"},{label:"shared:followers",state:e.USERS_ID_FOLLOWERS,icon:"fa-child"},{label:"shared:authoredPostings",state:e.USERS_ID_POSTINGS,icon:"fa-newspaper-o"},{label:"shared:authoredComments",state:e.USERS_ID_COMMENTS,icon:"fa-comments"}],current:[{label:"shared:activity",state:e.CURRENT,icon:"fa-star"},{label:"shared:replies",state:e.CURRENT_REPLIES,icon:"fa-at"},{label:"shared:followees",state:e.FOLLOWEES,icon:"fa-binoculars"},{label:"shared:followers",state:e.FOLLOWERS,icon:"fa-child"},{label:"shared:authoredPostings",state:e.CURRENT_POSTINGS,icon:"fa-newspaper-o"},{label:"shared:authoredComments",state:e.CURRENT_COMMENTS,icon:"fa-comments"},{label:"shared:blocked",state:e.BLOCKED,icon:"fa-gavel"}]}}),define("js/controller/state-view",["./module","jquery","angular","js/util/utils","js/util/i18n","js/constants/states","js/constants/path-variables","js/constants/scope-variables","js/constants/model-attributes","js/constants/response-codes","js/constants/navigation","js/constants/partials","js/constants/values","js/constants/events"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){e.controller("PostingsController",["$scope","Options","ApiData","pyPosting",function(e,t,n,r){var i=t.getPage(),s=function(e,t,n,i){var s,o;r.postingPreviews(t,n,i,e,s,o)};e.data=n.getData(undefined,{scope:e,view:c.POSTING,method:s,number:i,title:"shared:postings",time:!0,asReplies:!1,alternatives:l.content,alternativesLabel:"shared:contentSelect",scroll:!0}),e[u.PAGEABLE]="data.pageable"}]),e.controller("CommentsController",["$scope","Options","ApiData","pyComment",function(e,t,n,r){var i=t.getPage(),s=function(e,t,n,i){var s,o;r.commentPreviews(t,n,i,e,s,o)};e.data=n.getData(undefined,{scope:e,view:c.COMMENT,method:s,number:i,title:"shared:comments",time:!0,asReplies:!1,alternatives:l.content,alternativesLabel:"shared:contentSelect",scroll:!0}),e[u.PAGEABLE]="data.pageable"}]),e.controller("TagsController",["$scope","$state","ApiData","Options","pyTag",function(e,t,n,r,a){var h={disabled:!1,searchLabel:"shared:tagSearch.search",model:undefined,search:undefined,alert:undefined,symbol:"shared:symbols.tag"},p=function(e,n,r){h.disabled=!1;var i={};i[o.TAG]=n.name,t.go(s.TAGS_ID,i,{reload:!0})},d=function(e,t){i(function(t){h.disabled=!1,e===f.NOT_FOUND?h.alert=t("shared:tagSearch.notFoundTag",{tag:h.model}):e===f.NOT_ALLOWED?h.alert=t("shared:tagSearch.notAllowedTag",{tag:h.model}):h.alert=t("alerts:apiError")})},v=function(){i(function(e){h.disabled=!1,h.alert=e("alerts:apiError")})};h.search=function(){h.error=undefined;if(typeof h.model=="undefined"||h.model.length===0)return;h.disabled=!0,a.tag(p,d,v,h.model)};var m=r.getPage(),g=function(e,t,n,r){a.tagPreviews(t,n,r,e)};e.data=n.getData(undefined,{scope:e,view:c.TAG,method:g,number:m,title:"shared:tags",time:!0,asReplies:!1,alternatives:l.content,alternativesLabel:"shared:contentSelect",addSearch:h,scroll:!0}),e[u.PAGEABLE]="data.pageable"}]),e.controller("UsersController",["$scope","$state","ApiData","Options","User","pyUser",function(e,t,n,r,a,h){var p={disabled:!1,searchLabel:"shared:userSearch.search",model:undefined,search:undefined,alert:undefined,symbol:"shared:symbols.username"},d=function(e,n,r){p.disabled=!1;var i={};i[o.USER]=n.username.username,t.go(s.USERS_ID,i,{reload:!0})},v=function(e,t){i(function(t){p.disabled=!1,e===f.NOT_FOUND?p.alert=t("shared:userSearch.notFoundUser",{user:p.model}):e===f.NOT_ALLOWED?p.alert=t("shared:userSearch.notAllowedUser",{user:p.model}):p.alert=t("alerts:apiError")})},m=function(){i(function(e){p.disabled=!1,p.alert=e("alerts:apiError")})};p.search=function(){p.error=undefined;if(typeof p.model=="undefined"||p.model.length===0)return;p.disabled=!0,h.user(d,v,m,p.model)};var g=r.getPage(),y=function(e,t,n,r){h.userPreviews(t,n,r,e)};e.data=n.getData(undefined,{scope:e,view:c.USER,method:y,number:g,title:"shared:users",time:!0,asReplies:!1,alternatives:l.content,alternativesLabel:"shared:contentSelect",addSearch:p,chained:a.userChained,callChained:!0,scroll:!0}),e[u.PAGEABLE]="data.pageable"}]),e.controller("ConversationsController",["$scope","$state","ApiData","Options","pyMessage","pyUser",function(e,t,n,r,a,l){var h={disabled:!1,searchLabel:"shared:userSearch.search",model:undefined,search:undefined,alert:undefined,symbol:"shared:symbols.username"},p=function(e,n,r){h.disabled=!1;var i={};i[o.USER]=n.username.username,t.go(s.USERS_ID_MESSAGES,i,{reload:!0})},d=function(e,t){i(function(t){h.disabled=!1,e===f.NOT_FOUND?h.alert=t("shared:userSearch.notFoundUser",{user:h.model}):e===f.NOT_ALLOWED?h.alert=t("shared:userSearch.notAllowedUser",{user:h.model}):h.alert=t("alerts:apiError")})},v=function(){i(function(e){h.disabled=!1,h.alert=e("alerts:apiError")})};h.search=function(){h.error=undefined;if(typeof h.model=="undefined"||h.model.length===0)return;h.disabled=!0,l.user(p,d,v,h.model)};var m=r.getPage(),g=function(e,t,n,r){a.conversations(t,n,r,e)};e.data=n.getData(undefined,{scope:e,view:c.CONVERSATION,method:g,number:m,title:"shared:conversations",time:!1,asReplies:!1,addSearch:h,scroll:!0}),e[u.PAGEABLE]="data.pageable"}]),e.controller("MessagesController",["$stateParams","$scope","$state","Alerts","Authentication","ApiData","Options","AutoRefresh","CurrentUser","pyMessage",function(e,t,n,r,a,f,l,d,v,m){var g=e[o.USER],y=l.getPage();t.refresh=!0;var b=function(e,t,n,r){m.messages(t,n,r,g,e)},w=function(t){t&&v.get(function(t){var o=t.username.username;o===g&&i(function(t){r.warning(t("alerts:navigation.self.messages")),n.go(s.USERS_ID,e,{reload:!0})})},function(){i(function(t){r.warning(t("alerts:apiError")),n.go(s.USERS_ID,e,{reload:!0})})})};w(a.isAuthenticated()),a.manageEvent(t,function(e,t){w(t)});var E=function(e,n,r){return r.totalElements>t.data.pageable.getPage().length?!0:!1},S=function(){return!1};t.data=f.getData(undefined,{scope:t,view:c.MESSAGE,method:b,number:y,title:"shared:messages",time:!1,asReplies:!1,scroll:!0});var x=function(){t.data.pageable.loaded.current&&t.refresh&&t.data.pageable.conditionalRefresh(0,E,S,S,!0)};t.$on(p.TOGGLE_AUTO_REFRESH,function(e,n){t.refresh=n,n&&x()}),d.manageRefresh(x,h.CONVERSATION_REFRESH,undefined,undefined,undefined,t),t[u.PAGEABLE]="data.pageable"}]),e.controller("FeedController",["$scope","ApiData","Options","pyEvent",function(e,t,n,r){var i=n.getPage(),s=function(e,t,n,i){var s;r.feed(t,n,i,e,s)};e.data=t.getData(undefined,{scope:e,view:c.ACTIVITY,method:s,number:i,title:"shared:feed",time:!1,autoLoad:!0,scroll:!0}),e[u.PAGEABLE]="data.pageable"}]),e.controller("NotificationsController",["$scope","ApiData","Options","pyEvent",function(e,t,n,r){var i=n.getPage(),s=function(e,t,n,i){var s;r.notifications(t,n,i,e,s)};e.data=t.getData(undefined,{scope:e,view:c.NOTIFICATION,method:s,number:i,title:"shared:notifications",time:!1,autoLoad:!0,scroll:!0}),e[u.PAGEABLE]="data.pageable"}]),e.controller("SinglePostingController",["$scope","$state","$stateParams","$location","ApiData","Title","pyPosting",function(e,t,n,i,a,f,l){var h=n[o.POSTING],p=function(e){f.setTitle(e);if((t.is(s.POSTINGS_ID)||t.is(s.POSTINGS_ID_TITLE))&&typeof e!="undefined"){var n={};n[o.POSTING]=h,n[o.TITLE]=r.getEncodedTitle(e);var u=t.href(s.POSTINGS_ID_TITLE,n);i.path(u).replace()}},d=function(e){return function(t,n,r){n.removed||p(n.title),typeof e!="undefined"&&e(t,n,r)}},v=function(e,t,n){l.posting(d(e),t,n,h)};e.data=a.getData({scope:e,view:c.POSTING,method:v,autoSub:!0,args:{state:t.current.name}}),e[u.SINGLE]="data.single"}]),e.controller("SingleTagController",["$scope","$state","$stateParams","ApiData","Title","pyTag",function(e,t,n,r,i,s){var a=n[o.TAG],f=function(e){return function(t,n,r){i.setTitle("tagTag",!0,{tag:n.name}),typeof e!="undefined"&&e(t,n,r)}},l=function(e,t,n){s.tag(f(e),t,n,a)};e.data=r.getData({scope:e,view:c.TAG,method:l,autoSub:!0,args:{state:t.current.name}}),e[u.SINGLE]="data.single"}]),e.controller("SingleUserController",["$scope","$state","$stateParams","Title","User",function(e,t,n,r,i){var s=n[o.USER],a=function(e){return function(t,n,i){r.setTitle(n.username.username),typeof e!="undefined"&&e(t,n,i)}};e.data=i.user(e,s,a,undefined,undefined,!0,{state:t.current.name}),e[u.SINGLE]="data.single"}]),e.controller("SingleCurrentController",["$scope","$state","$stateParams","Title","User",function(e,t,n,r,i){var s=function(e){return function(t,n,i){r.setTitle(n.username.username),typeof e!="undefined"&&e(t,n,i)}};e.data=i.self(e,s,undefined,undefined,!0,{state:t.current.name}),e[u.SINGLE]="data.single"}]),e.controller("SingleCommentController",["$scope","$state","$stateParams","ApiData","Title","pyComment",function(e,t,n,r,i,s){var a=n[o.COMMENT],f=function(e){return function(t,n,r){i.setTitle("commentUser",!0,{user:n.author.username}),typeof e!="undefined"&&e(t,n,r)}},l=function(e,t,n){s.comment(f(e),t,n,a)};e.data=r.getData({scope:e,view:c.COMMENT,method:l,autoSub:!0,args:{state:t.current.name}}),e[u.SINGLE]="data.single"}])}),define("js/controller/index",["./main","./single","./help","./pageable","./options","./authentication","./sidebar","./user-actions","./posting-actions","./comment-actions","./current-actions","./tag-actions","./content-column","./alerts","./payment-processing","./cache-delay-waiting","./tour-available","./generics","./user-options","./payment","./appreciation-response","./posting","./comment","./tag","./user","./search","./current","./settings","./event","./follow","./message","./edit-posting","./create-posting","./edit-comment","./create-comment","./create-message","./info-view","./email-token-links","./state-view"],function(){}),define("js/service/module",["angular"],function(e){return e.module("app.service",[])}),define("js/service/loaded",["./module","jquery","angular","js/util/i18n","js/constants/values"],function(e,t,n,r,i){var s={};s.FAILED=i.LOADED_FAILED,s.page={previous:!1,current:!1,next:!1},s.resetPartial=function(){s.partial={info:!1,page:!1,single:!1}},s.resetPartial(),s.count={total:0,loaded:0,percentage:0},s.single=!1,s.info=!1,s.account=!1,s.content=!0;var o=function(e){var t=0,n=0;s.hasInfo&&(t+=2,s.partial.info&&n++,s.info&&n++),s.hasSingle&&(t+=2,s.partial.single&&n++,s.single&&n++),s.hasPage&&(t+=2,s.partial.page&&n++,s.page.current&&n++),s.count.total=t,s.count.loaded=n,s.count.percentage=n/t*100,e&&(s.count.total=0,s.count.percentage=0,s.count.loaded=0)};s.resetInfo=function(e){s.content=!1,s.info=!1,s.hasInfo=!1,s.partial.info=!1,typeof e!="undefined"&&(s.hasInfo=e),s.loadedInfo(),o()},s.softResetSingle=function(e){s.single=!1,s.hasSingle=!1,typeof e!="undefined"&&(s.hasSingle=e),o()},s.resetSingle=function(e){s.content=!1,s.partial.single=!1,s.softResetSingle(e)},s.softResetPage=function(e){s.page={previous:!1,current:!1,next:!1},s.hasPage=!1,typeof e!="undefined"&&(s.hasPage=e),o()},s.resetPage=function(e){s.content=!1,s.partial.page=!1,s.softResetPage(e)},s.resetContent=function(e,t,n){s.content=!1,s.resetInfo(n),s.resetSingle(e),s.resetPage(t),s.resetPartial(),o()};var u=function(){var e=!0;s.hasInfo&&(!s.info||!s.partial.info)&&(e=!1),s.hasSingle&&(!s.single||!s.partial.single)&&(e=!1),s.hasPage&&(!s.page.current||!s.partial.page)&&(e=!1),o(e),s.content=e};s.loadedInfo=function(){r(function(e){s.info=!0,u()})},s.loadedSingle=function(){r(function(e){s.single=!0,u()})},s.loadedPageCurrent=function(){r(function(e){s.page.current=!0,s.page.previous=!0,s.page.next=!0,u()})},s.loadedPagePrevious=function(){r(function(e){s.page.previous=!0})},s.loadedPageNext=function(){r(function(e){s.page.next=!0})},s.failedInfo=function(){r(function(e){s.info=s.FAILED,u()})},s.failedSingle=function(){r(function(e){s.single=s.FAILED,u()})},s.failedPageCurrent=function(){r(function(e){s.page.current=s.FAILED,s.page.previous=s.FAILED,s.page.next=s.FAILED,u()})},s.failedPagePrevious=function(){r(function(e){s.page.previous=s.FAILED})},s.failedPageNext=function(){r(function(e){s.page.next=s.FAILED})},s.partialInfo=function(){s.partial.info=!0,u()},s.partialPage=function(){s.partial.page=!0,u()},s.partialSingle=function(){s.partial.single=!0,u()},e.factory("Loaded",function(){return s})}),define("js/service/single-factory",["./module","jquery","angular","js/util/i18n","js/constants/response-codes","js/constants/states","js/constants/events","js/constants/chained-keys"],function(e,t,n,r,i,s,o,u){e.factory("Single",[function(){return{}}]),e.factory("SingleFactory",[function(){var e=function(e){return function(t,n){e.loaded[u.SINGLE]=!1;if(t===i.NOT_ALLOWED){e.scope.$emit(o.SINGLE_ERROR_NOT_ALLOWED);return}if(t===i.NOT_FOUND){e.scope.$emit(o.SINGLE_ERROR_NOT_ALLOWED);return}if(t===i.DENIED){e.scope.$emit(o.SINGLE_ERROR_DENIED);return}}},r=function(e){return function(){e.loaded[u.SINGLE]=!1}},s=function(e,t){e[u.DATA]=t,e.loaded[u.SINGLE]=!0,e.scope.$broadcast(o.SINGLE_CHANGE,e)},a=function(e,t,n){n.count>=n.total&&s(e,t)},f=function(e,t,n){return function(r){return function(s,o,u){n.count=n.count+1,typeof t!="undefined"&&typeof r!="undefined"&&(s===i.SUCCESS||s===i.CREATED||s===i.DELETED)&&(t[r]={code:s,dto:o,page:u},e.loaded[r]=!0),a(e,t,n)}}},l=function(e,t,n,r){return function(r){return function(i,s,o){n.count=n.count+1,t[r]={code:i,dto:s,page:o},e.loaded[r]=!1,a(e,t,n)}}},c=function(e,t,n){return function(r){return function(i,s,o){n.count=n.count+1,e.loaded[r]=!1,a(e,t,n)}}},h=function(e,n){var r={};r[u.SINGLE]=n;if(typeof e.chained=="undefined"||!e.callChained||t.isEmptyObject(e.chained))s(e,r);else{var i,o={count:0,total:0},a=0,h=f(e,r,o),p=l(e,r,o),d=c(e,r,o),v=e.chained;typeof v=="function"&&(v=e.chained(n));for(i in v)v.hasOwnProperty(i)&&typeof v[i]!="undefined"&&(o.total=o.total+1,e.loaded[i]=undefined,delete e.loaded[i],v[i](h(i),p(i),d(i)));o.total===0&&s(e,r)}},p=function(e,t){return function(t,n,r){(t===i.SUCCESS||t===i.CREATED||t===i.DELETED)&&typeof n!="undefined"&&h(e,n)}},d=function(t,n){typeof n!="undefined"&&(t.callChained=n),typeof t.method!="undefined"&&(t.loaded={},t.method(p(t,t.requestCount),e(t),r(t)))},v=function(t,i,s,o,a,f,l,c,v){var m={args:{},loaded:{},show:!0,showPageable:!1,requestCount:0};return m[u.DATA]={},typeof s=="undefined"&&typeof f=="undefined"||typeof i=="undefined"||typeof t=="undefined"?undefined:(m.args=v,m.view=i,m.autoLoad=l||!1,m.autoSub=c||!1,m.chained=o,m.callChained=a,m.method=s,m.scope=t,m.getSingleMain=function(){return m[u.DATA][u.SINGLE]},m.getChained=function(e){return m[u.DATA][e]},m.getArg=function(e){var t=m.args||{};return t[e]},m.refresh=function(e){return typeof m.method!="undefined"?d(m,e):undefined},m.refreshChained=function(){m.callChained=!0,typeof m[u.DATA][u.SINGLE]!="undefined"?h(m,m[u.DATA][u.SINGLE]):m.refresh(m,!0)},m.getView=function(){return m.view},n.isDefined(f)?h(m,f):s(p(m,m.requestCount),e(m),r(m)),m)};return{createSingle:v}}])}),define("js/service/pageable-factory",["./module","jquery","angular","js/constants/response-codes","js/constants/params","js/constants/events","js/constants/states","js/constants/values"],function(e,t,n,r,i,s,o,u){e.factory("Pageable",[function(){return{}}]),e.factory("PageableFactory",["SingleFactory",function(e){var t=function(t,n){var r=t.preview||{};return e.createSingle(t.scope,t.view,r.method,r.chained,r.callChained,n,t.autoLoad,t.autoSub,r.args)},i=function(e,n,r){e.pageNumber.first=r,e.pageNumber.last=r;if(typeof n!="undefined"){e.pageList=[n],e.page=[];for(var i=0;i<n.content.length;i++)e.page.push(t(e,n.content[i]));if(typeof e.page===undefined||e.page.length===0)e.page=[]}else e.pageList=[],e.page=[];e.loaded.current=!0,e.scope.$broadcast(s.PAGE_CHANGE,e,r)},o=function(e){return function(t,n){e.loaded.current=!1}},a=function(e){return function(){e.loaded.current=!1}},f=function(e){return function(){e.loaded.previous=!1}},l=function(e){return function(){e.loaded.next=!1}},c=function(e,t,n){return function(t,s,o){(t===r.SUCCESS||t===r.CREATED||t===r.DELETED)&&typeof o!="undefined"&&i(e,o,n)}},h=function(e){return function(n,i,o){if(n===r.SUCCESS||n===r.CREATED||n===r.DELETED)if(typeof o!="undefined"){e.pageNumber.last=e.pageNumber.last+1,e.pageList.push(o);if(typeof o.content!="undefined"&&o.content.length>0){var a;for(a=0;a<o.content.length;a++)e.page.push(t(e,o.content[a]))}if(e.pageList.length>u.MAX_PAGES){var f=e.pageList.shift();e.pageNumber.first=e.pageNumber.first+1;if(typeof f!="undefined"&&f.content.length>0){var l;for(l=0;l<f.content.length;l++)e.page.shift()}}e.loaded.next=!0,e.scope.$broadcast(s.PAGE_CHANGE,e,e.pageNumber.last)}}},p=function(e){return function(n,i,o){if(n===r.SUCCESS||n===r.CREATED||n===r.DELETED)if(typeof o!="undefined"){e.pageNumber.first=e.pageNumber.first-1,e.pageList.unshift(o);if(typeof o.content!="undefined"&&o.content.length>0){var a;for(a=o.content.length-1;a>=0;a--)e.page.unshift(t(e,o.content[a]))}if(e.pageList.length>u.MAX_PAGES){var f=e.pageList.pop();e.pageNumber.last=e.pageNumber.last-1;if(typeof f!="undefined"&&f.content.length>0){var l;for(l=0;l<f.content.length;l++)e.page.pop()}}e.loaded.previous=!0,e.scope.$broadcast(s.PAGE_CHANGE,e,e.pageNumber.first)}}},d=function(e,t){return typeof t!="undefined"&&typeof e.page!="undefined"?e.page[t]:undefined},v=function(e,t){if(typeof t=="undefined")return undefined;var n=t;for(var r=0;r<e.length;r++){if(typeof n=="undefined")return undefined;n=n[e[r]]}return n},m=function(e,t,r,i){if(typeof t=="undefined"||typeof r=="undefined"||!n.isArray(r))return undefined;var s=d(e,i),o=v(r,t);if(typeof s!="undefined"&&v(r,s)===o)return i;for(var u=0;u<e.page.length;u++)if(v(r,e.page[u])===o)return u},g=function(e,t,n,r,i,s){typeof t=="undefined"&&(t=e.pageNumber.first);var u=c(e,e.requestCount,t);typeof n!="undefined"&&(u=function(r,i,s){n(r,i,s)&&c(e,e.requestCount,t)(r,i,s)});var f=o(e);typeof r!="undefined"&&(f=function(t,n){r(t,n)&&o(e)(t,n)});var l=a(e);typeof i!="undefined"&&(l=function(){i()&&a(e)()}),s||(e.loaded={}),e.method(t,u,f,l)},y=function(e,t,n,r,i,s,u,v,y,b,w,E,S,x,T,N,C){var k={pageNumber:{first:0,last:0},loaded:{},page:[],pageList:[],timeSort:!1,timeRepliesSort:!1,requestCount:0};return typeof n=="undefined"||typeof t=="undefined"||typeof e=="undefined"?undefined:(k.view=t,k.title=i,k.scroll=w||!1,k.autoLoad=T||!1,k.autoSub=N||!1,k.preview={method:E,chained:S,callChained:x,args:C},k.timeSort=s||!1,k.timeRepliesSort=u||!1,k.number=r||0,k.alts=[],k.altsLabel=undefined,delete k.altsLabel,typeof v!="undefined"&&(k.alts=v),typeof y!="undefined"&&(k.altsLabel=y),k.search=undefined,typeof b!="undefined"&&(k.search=b),n(r,c(k,k.requestCount,r),o(k),a(k)),k.method=n,k.scope=e,k.hasPrevious=function(){var e=k.pageList[0];return typeof e!="undefined"&&!e.first?!0:!1},k.hasNext=function(){var e=k.pageList[k.pageList.length-1];return typeof e!="undefined"&&!e.last?!0:!1},k.getPrevious=function(){return k.method&&k.pageNumber.first>0&&k.hasPrevious()?(k.method(k.pageNumber.first-1,p(k),f(k),f(k)),!0):!1},k.getNext=function(){return k.method&&k.hasNext()?(k.method(k.pageNumber.last+1,h(k),l(k),l(k)),!0):!1},k.getFirst=function(){return k.pageNumber.first},k.getLast=function(){return k.pageNumber.last},k.getPage=function(){return k.page},k.findItem=function(e,t,n){return m(k,e,t,n)},k.getPageItem=function(e){return d(k,e)},k.removeItem=function(e){typeof e!="undefined"&&typeof k.page!="undefined"&&(k.page[e]={})},k.getTitle=function(){return k.title},k.setTitle=function(e){k.title=e},k.getAlternatives=function(){return typeof k.alts=="undefined"?[]:k.alts},k.getAlternativesLabel=function(){return k.altsLabel},k.getSearch=function(){return k.search},k.refresh=function(e){typeof e=="undefined"&&(e=k.pageNumber.first),k.loaded={},k.method(e,c(k,k.requestCount,e),o(k),a(k))},k.getTimeSorted=function(){return k.timeSort},k.getTimeRepliesSorted=function(){return k.timeRepliesSort},k.conditionalRefresh=function(e,t,n,r,i){return g(k,e,t,n,r,i)},k.getView=function(){return k.view},k)};return{createPageable:y}}])}),define("js/service/api-data",["./module","jquery","angular","js/util/i18n","js/constants/response-codes","js/constants/states","js/constants/events","js/constants/chained-keys"],function(e,t,n,r,i,s,o,u){e.factory("ApiData",["SingleFactory","PageableFactory",function(e,t){var n=function(n,r){var i={};if(typeof n!="undefined"){i.single=e.createSingle(n.scope,n.view,n.method,n.chained,n.callChained,n.preview,n.autoLoad,n.autoSub,n.args);if(typeof i.single=="undefined")throw"Single undefined!"}if(typeof r!="undefined"){i.pageable=t.createPageable(r.scope,r.view,r.method,r.number,r.title,r.time,r.asReplies,r.alternatives,r.alternativesLabel,r.addSearch,r.scroll,r.previewMethod,r.previewChained,r.previewCallChained,r.autoLoad,r.autoSub,r.args);if(typeof i.pageable=="undefined")throw"Pageable undefined!"}return i};return{getData:n}}])}),define("js/service/alerts",["./module","jquery","angular","js/constants/view-ids"],function(e,t,n,r){var i="danger",s="warning",o="info",u="success",a={notifications:[]},f=function(e,t){if(typeof e=="undefined"||typeof t=="undefined")return!1;for(var n=0;n<t.length;n++)if(t[n].message===e.message&&t[n].type===e.type)return!0;return!1};e.factory("Alerts",["Browser",function(e){var t=function(t,i,s){if(n.isDefined(t)&&n.isDefined(i)){var o={type:t,message:i,link:s};f(o,a.notifications)||(a.notifications.push(o),e.scrollTo(r.ALERTS))}};return{getAlerts:function(){return a},clear:function(){a.notifications=[]},remove:function(e){a.notifications.splice(e,1)},error:function(e,n){t(i,e,n)},warning:function(e,n){t(s,e,n)},info:function(e,t){},success:function(e,n){t(u,e,n)}}}])}),define("js/constants/defaults",["js/constants/param-values","js/constants/language-settings"],function(e,t){return{REFRESH:60,MAX_DEFERS:5,ACTIVE:60,TIME:e.TIME_OPTION_MONTH,TIME_REPLIES:e.TIME_OPTION_YEAR,SORT:e.SORT_OPTION_VALUE,LANGUAGE:t.DEFAULT_LANGUAGE,INTERFACE_LANGUAGE:t.DEFAULT_LANGUAGE,WARNING:!1,PAGE_SIZE:12}}),define("js/service/options",["./module","jquery","angular","js/util/i18n","js/constants/cookies","js/constants/params","js/constants/defaults","js/constants/events"],function(e,t,n,r,i,s,o,u){var a=function(e){return e?e.toUpperCase():e},f=function(e){return e?e.toLowerCase():e},l={};e.factory("Options",["$rootScope","Cookies","$location","Alerts","Reloader","pyProfile",function(e,t,n,r,u,c){var h=function(){m(o.WARNING)},p=function(e){typeof e!="undefined"&&(e===o.LANGUAGE?(t.remove(i.LANGUAGE),l[i.LANGUAGE]=undefined):(t.set(i.LANGUAGE,e),l[i.LANGUAGE]=e))},d=function(){var e=t.get(i.INTERFACE_LANGUAGE);return typeof e=="undefined"&&(e=l[i.INTERFACE_LANGUAGE],typeof e=="undefined"&&(e=o.INTERFACE_LANGUAGE)),f(e)},v=function(e){if(typeof e!="undefined"){var n=d();e===o.INTERFACE_LANGUAGE?(t.remove(i.INTERFACE_LANGUAGE),l[i.INTERFACE_LANGUAGE]=undefined):(t.set(i.INTERFACE_LANGUAGE,e),l[i.INTERFACE_LANGUAGE]=e),a(n)!==a(e)&&u.fullRefresh()}},m=function(e){typeof e!="undefined"&&(e===o.WARNING?(t.remove(i.WARNING),l[i.WARNING]=undefined):(t.set(i.WARNING,e),l[i.WARNING]=e))},g=function(e){typeof e!="undefined"&&(e===o.SORT?(t.remove(i.SORT),l[i.SORT]=undefined):(t.set(i.SORT,e),l[i.SORT]=e))},y=function(e){typeof e!="undefined"&&(e===o.TIME?(t.remove(i.TIME),l[i.TIME]=undefined):(t.set(i.TIME,e),l[i.TIME]=e))},b=function(e){typeof e!="undefined"&&(e===o.TIME_REPLIES?(t.remove(i.TIME_REPLIES),l[i.TIME_REPLIES]=undefined):(t.set(i.TIME_REPLIES,e),l[i.TIME_REPLIES]=e))},w=function(e){e===0&&(e=undefined),n.search(s.PAGE,e)},E=function(){return parseInt(n.search()[s.PAGE]||"0",10)},S=function(){return o.PAGE_SIZE},x=function(){var e=t.get(i.LANGUAGE);return typeof e=="undefined"&&(e=l[i.LANGUAGE],typeof e=="undefined"&&(e=o.LANGUAGE)),f(e)},T=function(){var e=t.get(i.WARNING);return typeof e=="undefined"&&(e=l[i.WARNING],typeof e=="undefined"&&(e=o.WARNING)),typeof e=="boolean"&&e||a(e)==="TRUE"},N=function(){var e=t.get(i.SORT);return typeof e=="undefined"&&(e=l[i.SORT],typeof e=="undefined"&&(e=o.SORT)),a(e)},C=function(){var e=t.get(i.TIME);return typeof e=="undefined"&&(e=l[i.TIME],typeof e=="undefined"&&(e=o.TIME)),a(e)},k=function(){var e=t.get(i.TIME_REPLIES);return typeof e=="undefined"&&(e=l[i.TIME_REPLIES],typeof e=="undefined"&&(e=o.TIME_REPLIES)),a(e)};return p(n.search()[s.LANGUAGE]),m(n.search()[s.WARNING]),g(n.search()[s.SORT]),y(n.search()[s.TIME]),b(n.search()[s.TIME_REPLIES]),{setPage:w,setLanguage:p,setInterfaceLanguage:v,setWarning:m,setSort:g,setTime:y,setTimeReplies:b,getPageSize:S,getPage:E,getLanguage:x,getInterfaceLanguage:d,getWarning:T,getSort:N,getTime:C,getTimeReplies:k,resetWarning:h}}])}),define("js/service/reloader",["./module","jquery","angular","js/util/utils"],function(e,t,n,r){e.factory("Reloader",["$location","$window","$state","Loaded",function(e,t,n,i){var s=function(){i.resetContent(!1,!1,!1)};return{reload:function(){},fullRefresh:function(){var n=t.location.pathname,i=e.search(),s=r.constructFilteredQueryString(i);t.location.href=t.location.pathname+s},reloadPrevious:function(n){var i={},o="";if(typeof n!="undefined"){if(typeof n.query!="undefined"){var u,a=e.search();if(typeof a!="undefined")for(u in a)a.hasOwnProperty(u)&&(i[u]=a[u]);for(u in n.query)n.query.hasOwnProperty(u)&&(i[u]=n.query[u]);o=r.constructQueryString(n.query)}typeof n.url!="undefined"?(t.location.href=n.url+o,s()):(t.location.search=o,s())}else{var f=t.location.pathname;i=e.search(),o=r.constructFilteredQueryString(i),t.location.href=t.location.pathname+o,s()}}}}])}),define("js/service/cookies",["./module","jquery","angular","jquery-cookie","js/constants/cookies"],function(e,t,n,r,i){var s=i.getCookieOptions(),o={domain:s.domain,path:s.path,secure:s.secure},u=function(e){t.removeCookie(e,o)},a=function(e,n){typeof n=="undefined"?u(e):t.cookie(e,n,o)},f=function(e){return t.cookie()[e]};e.factory("Cookies",function(){return{enabled:function(){a(i.TEST_COOKIES_ENABLED,"1");var e=f(i.TEST_COOKIES_ENABLED);return e==="1"?!0:!1},set:a,get:f,getAll:function(){return t.cookie()},remove:u}})}),define("js/service/browser",["./module","jquery","angular","js/constants/defaults","js/constants/view-ids"],function(e,t,n,r,i){var s=function(){return(new Date).getTime()},o=function(e,t,n){return typeof e!="undefined"&&typeof t!="undefined"&&typeof n!="undefined"&&t-e<=n?!0:!1};e.factory("Browser",["$rootScope","$window","$location","$timeout","$anchorScroll",function(e,n,u,a,f){f.yOffset=t("#"+i.NAVBAR);var l=!0,c=!1,h=s(),p=function(){h=s()},d=function(){l=!0,p()},v=function(){l=!1};n.onfocus=d,n.onblur=v,c=!1;var m=function(e){var t=(e||r.ACTIVE)*1e3;return o(h,s(),t)},g=1e3,y=function(){l&&p(),a(y,g)};a(y,g);var b=function(e){var t=u.hash();u.hash(e),f(),u.hash(t)};return{isFocus:function(){return l},isActive:function(e){return m(e)},confirm:function(e){return confirm(e)},scrollTo:b,scrollTop:function(){typeof n.scrollTo!="undefined"?n.scrollTo(0,0):typeof n.scroll!="undefined"?n.scroll(0,0):b("pageheader")}}}])}),define("js/service/auto-refresh",["./module","jquery","angular","js/constants/defaults"],function(e,t,n,r){e.factory("AutoRefresh",["$rootScope","$timeout","Browser",function(e,t,i){var s=function(i,s,o,u,a,f){if(typeof i!="undefined"){var l=(s||r.REFRESH)*1e3,c=o||r.MAX_DEFERS,h=0,p=!0,d,v,m=function(){h++,p&&i()&&h<c&&(d=t(m,l)),h>=c&&(typeof v!="undefined"&&(v(),v=undefined),typeof f!="undefined"&&f())},g=l;a&&(g=1),d=t(m,g),n.isDefined(u)&&(v=e.$on(u,function(e){p=!1,n.isDefined(d)&&t.cancel(d),v(),v=undefined}))}};return{manageRefresh:function(s,o,u,a,f,l){if(typeof s!="undefined"){var c=o||r.REFRESH,h=c*1e3,p=!0,d,v=function(){p&&((!a||i.isActive(c))&&s(),d=t(v,h))},m=h;f&&(m=1),d=t(v,m);if(n.isDefined(u))var g=e.$on(u,function(e){p=!1,n.isDefined(d)&&t.cancel(d),g()});n.isDefined(l)&&l.$on("$destroy",function(e){p=!1,n.isDefined(d)&&t.cancel(d)})}},defer:s,deferRequest:function(e,t,n,r,i,o,u,a,f){if(typeof e=="undefined")return;var l=function(){var i=!1,s=!0,o=function(e,n,r){i=!1,s=!1,typeof t!="undefined"&&t(e,n,r)},u=function(e,t){i=!1,typeof n!="undefined"&&n(e,t)},a=function(){i=!1,typeof r!="undefined"&&r()};return function(){return!i&&s&&(e(o,u,a),i=!0),s}};s(l(),i,o,u,a,f)}}}])}),define("js/service/custom-events",["./module","jquery","angular","js/constants/states","js/constants/events"],function(e,t,n,r,i){e.factory("CustomEvents",["$rootScope","$state","$location",function(e,t,n){var s,o,u;return e.$on("$stateChangeSuccess",function(t,n,r,s,a){typeof s!="undefined"&&(typeof s.skipBack=="undefined"||!s.skipBack)&&(o=s,u=a),e.$broadcast(i.CUSTOM_STATE_CHANGE_SUCCESS,n,r,s,a)}),e.$on("$locationChangeSuccess",function(t,r,o){var u=n.path();u!==s&&e.$broadcast(i.CUSTOM_LOCATION_CHANGE_SUCCESS),s=u}),e.$on(i.BACK,function(e){typeof o===undefined||typeof o.name=="undefined"||o.name.length===0||t.current.name===o.name?t.go(r.DEFAULT,undefined,{reload:!0}):t.go(o.name,u,{reload:!0})}),{}}])}),define("js/service/route-check",["./module","jquery","angular","js/util/i18n","js/constants/events","js/constants/states","js/constants/roles"],function(e,t,n,r,i,s,o){e.factory("RouteCheck",["$rootScope","$location","$state","Authentication","Alerts","CurrentUser",function(e,t,n,u,a,f){var l=[],c,h={};h[o.overrideRoles.UNACCEPTED]=n.href(s.TERMS),h[o.overrideRoles.DELETED]=n.href(s.DELETED);var p=function(e,t){r(function(n){t?a.warning(n("alerts:authenticationRequired")):a.warning(n("alerts:authenticationNotAllowed")),e()})},d=function(e,t){if(typeof t!="undefined"&&typeof t.authentication!="undefined"){if(t.authentication&&!u.isAuthenticated())return p(e,!0),!0;if(!t.authentication&&u.isAuthenticated())return p(e,!1),!0}return!1},v=function(e){return function(t,n){return function(i){n&&(i=!i),i&&r(function(r){typeof t!="undefined"&&(n?a.warning(r("alerts:role."+t),h[t]):a.warning(r("alerts:overrideRole."+t),h[t])),e()})}}},m=function(e,t){if(typeof t!="undefined"&&(typeof t.overrideRoles!="undefined"&&t.overrideRoles.length>0||typeof t.roles!="undefined"&&t.roles.length>0)){if(!u.isAuthenticated()){p(e,!0);return}var n=v(e),i=function(){r(function(t){a.warning(t("alerts:apiError")),e()})};f.refreshRoles();var s,o;if(typeof t.roles!="undefined"&&t.roles.length>0)for(s=0;s<t.roles.length;s++)o=t.roles[s],f.hasRole(o,n(o,!0),i);if(typeof t.overrideRoles!="undefined"&&t.overrideRoles.length>0)for(s=0;s<t.overrideRoles.length;s++)o=t.overrideRoles[s],f.hasOverrideRole(o,n(o),i)}},g=function(e,t){if(u.isAuthenticated()&&t.name!==s.DELETED){var n=function(t){t&&e(s.DELETED)};f.hasOverrideRole(o.overrideRoles.DELETED,n,function(){r(function(t){a.warning(t("alerts:apiError")),e()})})}},y=function(e){var t=!1;return function(r){t||(t=!0,typeof e!="undefined"&&e.preventDefault(),typeof r=="undefined"&&n.go(s.AUTHENTICATION,undefined,{reload:!0})),typeof r!="undefined"&&n.go(r,undefined,{reload:!0})}};return e.$on("$stateChangeStart",function(t,n,r,s,o){c=n;if(typeof l!="undefined"){for(var u=0;u<l.length;u++)if(l[u].callback()){t.preventDefault();return}l=[]}var a=y(t);g(a,n),d(a,n)||m(a,n),e.$broadcast(i.CUSTOM_STATE_CHANGE_START,n,r,s,o)}),e.$on("$stateChangeSuccess",function(e,t,n,r,i){c=undefined}),e.$on(i.LOGIN_CHANGE,function(e,t,r){var i=y(),s=n.current;typeof c!="undefined"&&(s=c),g(i,s),d(i,s)||m(i,s)}),{addToStateChangeStart:function(e,t){typeof l=="undefined"&&(l=[]);if(typeof e!="undefined"){var n=!1;if(typeof t!="undefined")for(var r=0;r<l.length;r++)l[r].id===t&&(n=!0);n||l.push({callback:e,id:t})}}}}])}),define("js/service/authentication",["./module","jquery","angular","js/util/utils","js/util/i18n","js/constants/cookies","js/constants/events","js/constants/states","js/constants/values"],function(e,t,n,r,i,s,o,u,a){e.factory("Authentication",["$rootScope","$state","AutoRefresh","Cookies","Alerts","EventManager",function(e,t,n,i,u,f){var l={},c;l.manageEvent=function(e,t){f.manage(o.LOGIN_CHANGE,e,t)},l.getToken=function(){var e=i.get(s.AUTHENTICATION_TOKEN);if(!i.enabled())return l.token;if(typeof l.token=="undefined"||l.token!==e)l.token=e;return l.token},l.isAuthenticated=function(){return r.isValidAuthenticationToken(l.getToken())},c=l.isAuthenticated();var h=function(){(l.isAuthenticated()&&!c||!l.isAuthenticated()&&c)&&p(l.isAuthenticated())};n.manageRefresh(h,a.AUTHENTICATION_CHECK);var p=function(t,n){var r=!1;!t&&c&&n&&(r=!0),c=t,e.$broadcast(o.PRE_LOGIN_CHANGE,t,r),e.$broadcast(o.LOGIN_CHANGE,t,r)};return l.setToken=function(e,t){if(typeof e=="undefined"){if(typeof l.getToken()=="undefined")return;l.token=undefined,i.remove(s.AUTHENTICATION_TOKEN),p(!1,t)}else{if(l.getToken()===e)return;l.token=e,i.set(s.AUTHENTICATION_TOKEN,e),p(!0,t)}},l}])}),define("js/service/py-api",["./module","jquery","angular","js/util/i18n","js/util/utils","js/constants/view-urls","js/constants/api","js/constants/response-codes","js/constants/params","js/constants/states"],function(e,t,n,r,i,s,o,u,a,f){var l=function(e,t,n){return},c=function(e,t){return},h=function(e){return function(t,n){r(function(t){e.error(t("alerts:apiError"));return})}},p=function(e,t,n,i,s,o,a,l,c,h,p,v,m,g,y){if(h!=="undefined"){var b=h.code,w=h.dto,E=h.page;if(b===u.SUCCESS||b===u.CREATED||b===u.DELETED)typeof p!="undefined"&&p!==null&&p(b,w,E);else if(g)typeof v!="undefined"&&v!==null&&v(b,w);else{var S=t.href(f.LOGGED_OUT);b===u.EXPIRED?r(function(r){n.setToken(undefined,!0),i.warning(r("alerts:expired"),S),y||d(e,t,n,i,s,o,a,l,c,h,p,v,m,g,!0)}):b===u.THEFT?r(function(r){n.setToken(undefined,!0),i.warning(r("alerts:theft"),S),y||d(e,t,n,i,s,o,a,l,c,h,p,v,m,g,!0)}):b===u.LOCKED?r(function(r){n.setToken(undefined,!0),i.warning(r("alerts:locked"),S),y||d(e,t,n,i,s,o,a,l,c,h,p,v,m,g,!0)}):b===u.DENIED?r(function(r){n.isAuthenticated()?(n.setToken(undefined,!0),i.warning(r("alerts:denied"),S),y||d(e,t,n,i,s,o,a,l,c,h,p,v,m,g,!0)):(n.setToken(undefined,!0),i.warning(r("alerts:deniedUnauthenticated"),S),y||d(e,t,n,i,s,o,a,l,c,h,p,v,m,g,!0))}):b===u.FEATURE_DISABLED?r(function(e){i.warning(e("alerts:featureDisabled")),t.go(f.DEFAULT,undefined,{reload:!0})}):typeof v!="undefined"&&v!==null&&v(b,w)}}},d=function(e,t,r,s,u,a,f,l,c,d,v,m,g,y,b){var w={Accept:"application/json"};w[o.ANTICACHE_HEADER]=(new Date).getTime(),r.isAuthenticated()&&(w[o.AUTHENTICATION_HEADER]=r.getToken());var E={url:o.getBaseUrl()+i.constructPath(f,l,c),method:a,headers:w};typeof d!="undefined"&&(E.data=n.toJson(d)),e(E).success(function(n,i,o,h){p(e,t,r,s,u,a,f,l,c,n,v,m,g,y,b)}).error(function(e,t,n,r){if(typeof e=="undefined"||e===null)e=undefined;typeof g!="undefined"?g(e,t):h(s)(e,t)})};e.factory("pyApi",["$http","$state","Authentication","Alerts","Reloader",function(e,t,n,r,i){return{GET:"GET",POST:"POST",DELETE:"DELETE",pyRequest:function(s,o,u,a,f,p,v,m,g){var y=p||l,b=v||c,w=m||h(r),E=g||!1;return d(e,t,n,r,i,s,o,u,a,f,y,b,w,E)}}}])}),define("js/service/py-authentication",["./module","jquery","angular","js/util/i18n","js/constants/api-urls","js/constants/params","js/constants/view-urls","js/constants/events","js/constants/settings-options"],function(e,t,n,r,i,s,o,u,a){e.factory("pyAuthentication",["$rootScope","Reloader","pyApi","pyProfile","Authentication","Alerts","Options",function(e,t,n,s,o,f,l){var c=function(e,n,r){l.setLanguage(n.language),l.setWarning(n.options[a.ALLOW_WARNING_CONTENT]),n.interfaceLanguage!==l.getInterfaceLanguage()&&(l.setInterfaceLanguage(n.interfaceLanguage),t.fullRefresh())},h=function(){r(function(e){f.error(e("alerts:user.settingsError"))})};e.$on(u.PRE_LOGIN_CHANGE,function(e,t){t&&s.getSettings(c,h,h)});var p=function(e,t,n,r){o.setToken(n.result),typeof e!="undefined"&&e(t,n,r)},d=function(e,t,n,r){o.setToken(),typeof e!="undefined"&&e(t,n,r)};return{forceLogout:function(){o.setToken(undefined,!0)},login:function(e,t,r,s,o,u){var a={username:s,password:o,rememberMe:u},f=function(t,n,r){p(e,t,n,r)};n.pyRequest(n.POST,i.LOGIN,undefined,undefined,a,f,t,r,!0)},register:function(e,t,r,s,o,u,a,f,l,c){var h={username:s,password:u,confirmNewPassword:a,email:o,ageMinimum:f,rememberMe:l,recaptchaResponse:c},d=function(t,n,r){p(e,t,n,r)};n.pyRequest(n.POST,i.REGISTER,undefined,undefined,h,d,t,r,!0)},logout:function(e,t,r){var s=function(t,n,r){d(e,t,n,r)},u=function(e,n){o.setToken(),t(e,n)};n.pyRequest(n.POST,i.LOGOUT,undefined,undefined,undefined,s,u,r,!0)}}}])}),define("js/service/py-profile",["./module","jquery","angular","js/constants/api-urls","js/constants/events","js/constants/params"],function(e,t,n,r,i,s){e.factory("pyProfile",["$rootScope","pyApi",function(e,t){return{currentUser:function(e,n,i){t.pyRequest(t.GET,r.CURRENT,undefined,undefined,undefined,e,n,i)},acceptTermsOfService:function(e,n,i){t.pyRequest(t.POST,r.CURRENT_ACCEPT,undefined,undefined,undefined,e,n,i)},getSettings:function(e,n,i){t.pyRequest(t.GET,r.SETTINGS,undefined,undefined,undefined,e,n,i)},setSettings:function(e,n,i,s,o,u,a,f,l){var c={language:s,interfaceLanguage:o,options:u,hiddenNotificationEvents:a,hiddenFeedEvents:f,filters:l};t.pyRequest(t.POST,r.SETTINGS,undefined,undefined,c,e,n,i)},getProfile:function(e,n,i){t.pyRequest(t.GET,r.PROFILE,undefined,undefined,undefined,e,n,i)},updateProfile:function(e,n,i,s,o){var u={description:s,warning:o};t.pyRequest(t.POST,r.PROFILE,undefined,undefined,u,e,n,i)},getAppreciationResponse:function(e,n,i,s){t.pyRequest(t.GET,r.RESPONSE,undefined,undefined,undefined,e,n,i)},updateAppreciationResponse:function(e,n,i,s,o){var u={appreciationResponse:s,appreciationResponseWarning:o};t.pyRequest(t.POST,r.RESPONSE,undefined,undefined,u,e,n,i)},sendConfirmationToken:function(e,n,i){t.pyRequest(t.POST,r.CONFIRMATION_SEND,undefined,undefined,undefined,e,n,i)},sendEmailChangeToken:function(e,n,i){t.pyRequest(t.POST,r.EMAIL,undefined,undefined,undefined,e,n,i)},sendPaymentIdChangeToken:function(e,n,i){t.pyRequest(t.POST,r.PAYMENT_SEND,undefined,undefined,undefined,e,n,i)},sendDeleteToken:function(e,n,i){t.pyRequest(t.POST,r.CURRENT_DELETE_SEND,undefined,undefined,undefined,e,n,i)},sendPasswordResetToken:function(e,n,i,s){var o={email:s};t.pyRequest(t.POST,r.PASSWORD_RESET,undefined,undefined,o,e,n,i)},resetSettings:function(e,n,i){t.pyRequest(t.DELETE,r.SETTINGS,undefined,undefined,undefined,e,n,i)},confirmation:function(e,n,i,o){var u={};u[s.EMAIL_TOKEN]=o,t.pyRequest(t.POST,r.CONFIRMATION,undefined,u,undefined,e,n,i)},emailChange:function(e,n,i,o,u,a){var f={email:u,password:a},l={};l[s.EMAIL_TOKEN]=o,t.pyRequest(t.POST,r.EMAIL_CHANGE,undefined,l,f,e,n,i)},emailPendingActionChange:function(e,n,i,s,o){var u={email:s,password:o};t.pyRequest(t.POST,r.EMAIL_PENDING_ACTION_CHANGE,undefined,undefined,u,e,n,i)},paymentChange:function(e,n,i,o,u,a){var f={paymentId:u,password:a},l={};l[s.EMAIL_TOKEN]=o,t.pyRequest(t.POST,r.PAYMENT_CHANGE,undefined,l,f,e,n,i)},passwordChange:function(e,n,i,s,o,u){var a={oldPassword:s,newPassword:o,confirmNewPassword:u};t.pyRequest(t.POST,r.PASSWORD,undefined,undefined,a,e,n,i)},passwordChangeUnauthed:function(e,n,i,o,u,a,f){var l={newPassword:a,confirmNewPassword:f},c={};c[s.EMAIL_TOKEN]=o,t.pyRequest(t.POST,r.PASSWORD_USERS_ID,[u],c,l,e,n,i)},rolesSet:function(e,n,i){t.pyRequest(t.GET,r.ROLES,undefined,undefined,undefined,e,n,i)},deletion:function(e,n,i,o){var u={};u[s.EMAIL_TOKEN]=o,t.pyRequest(t.DELETE,r.CURRENT_DELETE,undefined,u,undefined,e,n,i)},undelete:function(e,n,i){t.pyRequest(t.POST,r.CURRENT_DELETE,undefined,undefined,undefined,e,n,i)},subscription:function(e,n,i){t.pyRequest(t.GET,r.SUBSCRIPTION,undefined,undefined,undefined,e,n,i)}}}])}),define("js/constants/finance",[],function(){return{PURCHASE_COINS_CONVERSION_RATE:100,TOTAL_TAX_RATE:.0795,APPRECIATION_FEE_RATE:.1}}),define("js/service/py-finance",["./module","jquery","angular","js/util/utils","js/constants/api-urls","js/constants/params","js/constants/view-urls","js/constants/response-codes","js/constants/finance"],function(e,t,n,r,i,s,o,u,a){var f=function(e){return Math.ceil(e*100)/100},l=function(e){return Math.floor(e*100)/100},c=function(e){return Math.round(e*100)/100};e.factory("pyFinance",["$location","pyApi",function(e,t){return{balance:function(e,n,r){t.pyRequest(t.GET,i.FINANCES,undefined,undefined,undefined,e,n,r)},purchaseCurrency:function(n,r,s,o){var u={amount:o},a=e.absUrl();t.pyRequest(t.POST,i.PURCHASE,undefined,undefined,u,n,r,s)},appreciatePosting:function(n,r,s,o,u,a,f){var l;typeof u!="undefined"&&(l=""+u);var c={appreciation:l,tags:a,warning:f},h=e.absUrl();t.pyRequest(t.POST,i.POSTINGS_APPRECIATE,[o],undefined,c,n,r,s)},promotePosting:function(e,n,r,s,o,u,a){var f={promotion:o,tags:u,warning:a};t.pyRequest(t.POST,i.POSTINGS_PROMOTE,[s],undefined,f,e,n,r)},appreciateComment:function(n,r,s,o,u,a){var f;typeof u!="undefined"&&(f=""+u);var l={appreciation:f,warning:a},c=e.absUrl();t.pyRequest(t.POST,i.COMMENTS_APPRECIATE,[o],undefined,l,n,r,s)},promoteComment:function(e,n,r,s,o,u){var a={promotion:o,warning:u};t.pyRequest(t.POST,i.COMMENTS_PROMOTE,[s],undefined,a,e,n,r)},calculatePurchaseTotals:function(e,t,n,r){if(typeof e!="undefined"){if(typeof r=="undefined"||r<0)r=0;var i={amount:0,tax:0,total:0};i.amount=l(r/a.PURCHASE_COINS_CONVERSION_RATE),i.tax=c(i.amount*a.TOTAL_TAX_RATE),i.total=l(i.amount+i.tax),e(u.SUCCESS,i)}},calculateAppreciationTotals:function(e,t,n,r){if(typeof e!="undefined"){if(typeof r=="undefined"||r<0)r=0;var i={amount:0,author:0,fee:0,tax:0,total:0};i.amount=l(r),i.fee=c(i.amount*a.APPRECIATION_FEE_RATE),i.tax=c(i.fee*a.TOTAL_TAX_RATE),i.author=l(i.amount-i.fee),i.total=l(i.amount+i.tax),e(u.SUCCESS,i)}},calculateAppreciationTotalsFromAppreciation:function(e,t,n,r){if(typeof e!="undefined"){if(typeof r=="undefined"||r<0)r=0;var i={amount:0,author:0,fee:0,tax:0,total:0};i.author=l(r),i.amount=c(i.author/(1-a.APPRECIATION_FEE_RATE)),i.fee=c(i.amount*a.APPRECIATION_FEE_RATE),i.tax=c(i.fee*a.TOTAL_TAX_RATE),i.author=l(i.amount-i.fee),i.total=l(i.amount+i.tax),e(u.SUCCESS,i)}}}}])}),define("js/service/py-payment",["./module","jquery","angular","js/util/utils","js/constants/api-urls","js/constants/params"],function(e,t,n,r,i,s){e.factory("pyPayment",["pyApi",function(e){return{check:function(t,n,r,o){var u={};u[s.PAYKEY]=o,e.pyRequest(e.GET,i.PAYMENT,undefined,u,undefined,t,n,r,!0)},mark:function(t,n,r,o){var u={};u[s.PAYKEY]=o,e.pyRequest(e.POST,i.PAYMENT,undefined,u,undefined,t,n,r,!0)}}}])}),define("js/constants/cache-times",[],function(){return{USER_USERNAME:10,USER_INFO:15,POSTING:30,COMMENT:30,TAG:120,SUBSCRIPTION:30,PAGED:120,PAGED_REPLIES:30}}),define("js/service/cache-delay",["./module","jquery","angular","js/constants/cache-times","js/constants/events"],function(e,t,n,r,i){e.factory("CacheDelay",["AutoRefresh",function(e){var t={waiting:0},n=function(n,r,s,o){var u;s&&(u=i.CUSTOM_STATE_CHANGE_SUCCESS);var a=r,f;r<=0&&(a=1,f=!0),o&&t.waiting++;var l=function(){t.waiting--};e.defer(n,a,1,u,f,l)};return{username:function(e,t){n(e,r.USER_USERNAME,t)},user:function(e,t){n(e,r.USER_INFO,t)},posting:function(e,t){n(e,r.POSTING,t,!0)},comment:function(e,t){n(e,r.COMMENT,t,!0)},postingOrComment:function(e,t){var i=r.POSTING;r.COMMENT>r.POSTING&&(i=r.COMMENT),n(e,i,t,!0)},tag:function(e,t){n(e,r.TAG,t)},paged:function(e,t){n(e,r.PAGED,t)},pagedReplies:function(e,t){n(e,r.PAGED_REPLIES,t)},waiting:t}}])}),define("js/service/tour",["./module","jquery","angular","js/util/utils","js/util/i18n","js/constants/events","js/constants/states","js/constants/tour-states","js/constants/cookies"],function(e,t,n,r,i,s,o,u,a){e.factory("Tour",["$rootScope","$state","$window","Authentication","Cookies",function(e,t,n,r,i){var o={enabled:!1,show:!1,available:!1},f={},l={},c={},h,p,d;for(p in u)if(u.hasOwnProperty(p)){f[p]={state:0,authed:!1,complete:!1},h=u[p],c[u[p].key]=u[p];if(typeof h.states!="undefined")for(d in h.states)h.states.hasOwnProperty(d)&&(l[h.states[d]]=h)}var v=function(){var e,t,n,r,i;for(t in f)f.hasOwnProperty(t)&&(f[t].complete||(n=u[t].key,i=f[t].state,r="f",f[t].authed&&(r="t"),typeof e=="undefined"?e="":e+="-",e=e+n+":"+i+":"+r));return e},m=function(){o.enabled?i.set(a.TOUR,v()):i.remove(a.TOUR)},g=function(e){if(typeof e=="undefined")return;var t,r,i,s,o,u=e.split("-");for(t in f)f.hasOwnProperty(t)&&(f[t].complete=!0);for(t=0;t<u.length;t++){r=u[t].split(":"),i=c[r[0]];if(typeof i!="undefined"){s=!1,r[2]==="t"&&(s=!0),o=n.parseInt(r[1]),f[i.name].complete=!1,f[i.name].authed=s;if(typeof o=="undefined"||window.isNaN(o))o=0;f[i.name].state=o}}},y=function(){var e=i.get(a.TOUR);o.show=!1,typeof e!="undefined"&&(o.enabled=!0,g(e))};y();var b=function(t,n,r){o.section=t,o.subSection=n,o.authed=r,m(),e.$broadcast(s.TOUR_SECTION_CHANGE,t,n,r,o.show)},w=function(t){o.show=!1,t&&(o.enabled=!1),m(),e.$broadcast(s.TOUR_SECTION_CHANGE,undefined,undefined,undefined,!1)},E=!1,S=function(e){if(typeof e=="undefined")return;var t=l[e];o.available=!1,typeof t!="undefined"&&!f[t.name].complete&&(E||!f[t.name].authed)&&(o.available=!0)},x=function(e){E=e,S(t.current.name),w(!1)};x(r.isAuthenticated()),e.$on(s.LOGIN_CHANGE,function(e,t){x(t)});var T=function(){var e=!1,n;for(var r in f)if(f.hasOwnProperty(r)&&!f[r].complete){e=!0,n=u[r];if(typeof n.states!="undefined"&&typeof l[t.current.name]!="undefined"&&l[t.current.name].name===r)return N(r,!1,undefined,!0),o.show=e,!0}return o.show=e,o.available=!1,!1},N=function(e,t,n,r){if(typeof e=="undefined")return;var i=!0,s,a=f[e],l;if(t)for(l in f)f.hasOwnProperty(l)&&(f[l].state=0,f[l].complete=!1,f[l].authed=!1);if(a.complete)return;o.show=!0,typeof n!="undefined"&&(a.state=a.state+n),a.authed||(s=u[e].order,a.state>=s.length?(a.state=0,a.authed=!0,E||(o.available=!1)):a.state<0&&(a.state=0,a.authed=!1));if(a.authed){s=u[e].authedOrder;if(a.state>=s.length){a.state=0,a.complete=!0,i=!1;if(!r&&T())return}else a.state<0&&(a.state=u[e].order.length-1,a.state<0&&(a.state=0),a.authed=!1)}i?b(e,s[a.state],a.authed):b(undefined,undefined,!1)};return e.$on(s.CUSTOM_STATE_CHANGE_SUCCESS,function(e,t,n,r,i){S(t.name)}),{tour:o,start:function(e){o.enabled=!0,o.show=!0,typeof e!="undefined"&&(N(e,!0),o.available=!0)},show:function(){typeof l[t.current.name]!="undefined"&&(o.enabled=!0,o.show=!0,N(l[t.current.name].name))},next:function(e){N(e,!1,1)},finish:function(){w(!0)},hide:function(){w(!1)}}}])}),define("js/service/modal-interface",["./module","jquery","angular","js/constants/events"],function(e,t,n,r){e.factory("ModalInterface",["$modal",function(e){return{controller:function(e){var t=["$scope","$modalInstance",function(t,n){t.$on(r.CUSTOM_STATE_CHANGE_START,function(e){n.dismiss("close")}),typeof e!="undefined"&&e(t,n)}];return t}}}])}),define("js/service/g-recaptcha",["./module","jquery","angular","js/constants/events","js/constants/values"],function(e,t,n,r,i){e.factory("GRecaptcha",["$window","$rootScope",function(e,t){var n,s=function(){var n=e.grecaptcha;if(typeof n=="undefined")return;t.$broadcast(r.RECAPTCHA_LOADED,n)};return e[i.RECAPTCHA_CALLBACK]=s,typeof e.grecaptcha!="undefined"&&s(),{getRecaptcha:function(){return typeof e.grecaptcha=="undefined"?undefined:e.grecaptcha},setCurrentId:function(e){n=e},getResponse:function(){var t=e.grecaptcha;return typeof t!="undefined"?t.getResponse(n):undefined},reset:function(){var t=e.grecaptcha;typeof t!="undefined"&&t.reset(n)}}}])}),define("js/service/py-posting",["./module","jquery","angular","js/constants/api-urls","js/constants/params"],function(e,t,n,r,i){var s=function(e){return e===""&&(e=undefined),e};e.factory("pyPosting",["pyApi","Options",function(e,t){return{postingPreviews:function(n,s,o,u,a,f){var l={};l[i.PAGE]=u,l[i.SIZE]=t.getPageSize(),l[i.USER]=a,l[i.TAGS]=f,l[i.LANGUAGE]=t.getLanguage(),l[i.WARNING]=t.getWarning(),l[i.SORT]=t.getSort(),l[i.TIME]=t.getTime(),e.pyRequest(e.GET,r.POSTINGS,undefined,l,undefined,n,s,o)},currentPostingPreviews:function(n,s,o,u,a){var f={};f[i.PAGE]=u,f[i.SIZE]=t.getPageSize(),f[i.TAGS]=a,e.pyRequest(e.GET,r.POSTINGS_CURRENT,undefined,f,undefined,n,s,o)},posting:function(n,s,o,u){var a={};a[i.WARNING]=t.getWarning(),e.pyRequest(e.GET,r.POSTINGS_ID,[u],a,undefined,n,s,o)},create:function(n,o,u,a,f,l,c,h,p,d,v,m,g){var y={title:a,content:f,tags:s(l),backer:s(c),warning:h,cost:p,preview:d,imageLink:v,imageHeight:g,imageWidth:m},b={};b[i.LANGUAGE]=t.getLanguage(),e.pyRequest(e.POST,r.POSTINGS,undefined,b,y,n,o,u)},edit:function(t,n,i,s,o,u,a,f,l,c){var h={title:o,content:u,preview:a,imageLink:f,imageHeight:c,imageWidth:l};e.pyRequest(e.POST,r.POSTINGS_EDIT,[s],undefined,h,t,n,i)},enable:function(t,n,i,s){e.pyRequest(e.POST,r.POSTINGS_ENABLE,[s],undefined,undefined,t,n,i)},disable:function(t,n,i,s){e.pyRequest(e.POST,r.POSTINGS_DISABLE,[s],undefined,undefined,t,n,i)},flag:function(t,n,s,o,u){var a={};a[i.FLAG_REASON]=u,e.pyRequest(e.POST,r.POSTINGS_FLAG,[o],a,undefined,t,n,s)}}}])}),define("js/service/py-comment",["./module","jquery","angular","js/constants/api-urls","js/constants/params"],function(e,t,n,r,i){var s=function(e){return e===""&&(e=undefined),e};e.factory("pyComment",["pyApi","Options",function(e,t){return{commentPreviews:function(n,s,o,u,a,f){var l={};l[i.PAGE]=u,l[i.SIZE]=t.getPageSize(),l[i.COMMENT_TYPE]=f,l[i.USER]=a,l[i.LANGUAGE]=t.getLanguage(),l[i.WARNING]=t.getWarning(),l[i.SORT]=t.getSort(),l[i.TIME]=t.getTime(),e.pyRequest(e.GET,r.COMMENTS,undefined,l,undefined,n,s,o)},currentCommentPreviews:function(n,s,o,u){var a={};a[i.PAGE]=u,a[i.SIZE]=t.getPageSize(),e.pyRequest(e.GET,r.COMMENTS_CURRENT,undefined,a,undefined,n,s,o)},comment:function(n,s,o,u){var a={};a[i.WARNING]=t.getWarning(),e.pyRequest(e.GET,r.COMMENTS_ID,[u],a,undefined,n,s,o)},postingComments:function(n,s,o,u,a){var f={};f[i.PAGE]=u,f[i.SIZE]=t.getPageSize(),f[i.LANGUAGE]=t.getLanguage(),f[i.WARNING]=t.getWarning(),f[i.SORT]=t.getSort(),f[i.TIME]=t.getTimeReplies(),e.pyRequest(e.GET,r.POSTINGS_COMMENTS,[a],f,undefined,n,s,o)},tagComments:function(n,s,o,u,a){var f={};f[i.PAGE]=u,f[i.SIZE]=t.getPageSize(),f[i.LANGUAGE]=t.getLanguage(),f[i.WARNING]=t.getWarning(),f[i.SORT]=t.getSort(),f[i.TIME]=t.getTimeReplies(),e.pyRequest(e.GET,r.TAGS_COMMENTS,[a],f,undefined,n,s,o)},userComments:function(n,s,o,u,a){var f={};f[i.PAGE]=u,f[i.SIZE]=t.getPageSize(),f[i.LANGUAGE]=t.getLanguage(),f[i.WARNING]=t.getWarning(),f[i.SORT]=t.getSort(),f[i.TIME]=t.getTimeReplies(),e.pyRequest(e.GET,r.USERS_COMMENTS,[a],f,undefined,n,s,o)},commentComments:function(n,s,o,u,a){var f={};f[i.PAGE]=u,f[i.SIZE]=t.getPageSize(),f[i.LANGUAGE]=t.getLanguage(),f[i.WARNING]=t.getWarning(),f[i.SORT]=t.getSort(),f[i.TIME]=t.getTimeReplies(),e.pyRequest(e.GET,r.COMMENTS_COMMENTS,[a],f,undefined,n,s,o)},postingReply:function(n,o,u,a,f,l,c,h){var p={};p[i.LANGUAGE]=t.getLanguage();var d={content:f,backer:s(l),warning:c,cost:h};e.pyRequest(e.POST,r.POSTINGS_COMMENTS,[a],p,d,n,o,u)},tagReply:function(n,o,u,a,f,l,c,h){var p={};p[i.LANGUAGE]=t.getLanguage();var d={content:f,backer:s(l),warning:c,cost:h};e.pyRequest(e.POST,r.TAGS_COMMENTS,[a],p,d,n,o,u)},userReply:function(n,o,u,a,f,l,c,h){var p={};p[i.LANGUAGE]=t.getLanguage();var d={content:f,backer:s(l),warning:c,cost:h};e.pyRequest(e.POST,r.USERS_COMMENTS,[a],p,d,n,o,u)},commentReply:function(n,o,u,a,f,l,c,h){var p={};p[i.LANGUAGE]=t.getLanguage();var d={content:f,backer:s(l),warning:c,cost:h};e.pyRequest(e.POST,r.COMMENTS_COMMENTS,[a],p,d,n,o,u)},edit:function(t,n,i,s,o){var u={content:o};e.pyRequest(e.POST,r.COMMENTS_EDIT,[s],undefined,u,t,n,i)},enable:function(t,n,i,s){e.pyRequest(e.POST,r.COMMENTS_ENABLE,[s],undefined,undefined,t,n,i)},disable:function(t,n,i,s){e.pyRequest(e.POST,r.COMMENTS_DISABLE,[s],undefined,undefined,t,n,i)},flag:function(t,n,s,o,u){var a={};a[i.FLAG_REASON]=u,e.pyRequest(e.POST,r.COMMENTS_FLAG,[o],a,undefined,t,n,s)}}}])}),define("js/service/py-tag",["./module","jquery","angular","js/constants/api-urls","js/constants/params"],function(e,t,n,r,i){e.factory("pyTag",["pyApi","Options",function(e,t){return{tagPreviews:function(n,s,o,u){var a={};a[i.PAGE]=u,a[i.SIZE]=t.getPageSize(),a[i.LANGUAGE]=t.getLanguage(),a[i.TIME]=t.getTime(),e.pyRequest(e.GET,r.TAGS,undefined,a,undefined,n,s,o)},tag:function(n,s,o,u){var a={};a[i.LANGUAGE]=t.getLanguage(),e.pyRequest(e.GET,r.TAGS_ID,[u],a,undefined,n,s,o)}}}])}),define("js/service/py-user",["./module","jquery","angular","js/constants/api-urls","js/constants/params"],function(e,t,n,r,i){e.factory("pyUser",["pyApi","Options",function(e,t){return{userPreviews:function(n,s,o,u){var a={};a[i.WARNING]=t.getWarning(),a[i.PAGE]=u,a[i.SIZE]=t.getPageSize(),a[i.LANGUAGE]=t.getLanguage(),a[i.TIME]=t.getTime(),e.pyRequest(e.GET,r.USERS,undefined,a,undefined,n,s,o)},user:function(n,s,o,u,a){var f={};f[i.WARNING]=t.getWarning(),e.pyRequest(e.GET,r.USERS_ID,[u],f,undefined,n,s,o,a)},appreciationResponse:function(n,s,o,u,a){var f={};f[i.WARNING]=t.getWarning(),e.pyRequest(e.GET,r.USERS_APPRECIATION_RESPONSE,[u],f,undefined,n,s,o,a)},flag:function(t,n,s,o,u){var a={};a[i.FLAG_REASON]=u,e.pyRequest(e.POST,r.USERS_FLAG,[o],a,undefined,t,n,s)}}}])}),define("js/service/py-follow",["./module","jquery","angular","js/constants/api-urls","js/constants/params"],function(e,t,n,r,i){e.factory("pyFollow",["pyApi","Options",function(e,t){return{followers:function(n,s,o,u){var a={};a[i.PAGE]=u,a[i.SIZE]=t.getPageSize(),e.pyRequest(e.GET,r.FOLLOWERS,undefined,a,undefined,n,s,o)},userFollowers:function(n,s,o,u,a){var f={};f[i.PAGE]=a,f[i.SIZE]=t.getPageSize(),e.pyRequest(e.GET,r.USERS_FOLLOWERS,[u],f,undefined,n,s,o)},getFollower:function(t,n,i,s){e.pyRequest(e.GET,r.FOLLOWERS_ID,[s],undefined,undefined,t,n,i)},followees:function(n,s,o,u){var a={};a[i.PAGE]=u,a[i.SIZE]=t.getPageSize(),e.pyRequest(e.GET,r.FOLLOWEES,undefined,a,undefined,n,s,o)},userFollowees:function(n,s,o,u,a){var f={};f[i.PAGE]=a,f[i.SIZE]=t.getPageSize(),e.pyRequest(e.GET,r.USERS_FOLLOWEES,[u],f,undefined,n,s,o)},getFollowee:function(t,n,i,s,o){e.pyRequest(e.GET,r.FOLLOWEES_ID,[s],undefined,undefined,t,n,i,o)},follow:function(t,n,i,s){e.pyRequest(e.POST,r.FOLLOWEES_ID,[s],undefined,undefined,t,n,i)},unfollow:function(t,n,i,s){e.pyRequest(e.DELETE,r.FOLLOWEES_ID,[s],undefined,undefined,t,n,i)}}}])}),define("js/service/py-block",["./module","jquery","angular","js/constants/api-urls","js/constants/params"],function(e,t,n,r,i){e.factory("pyBlock",["pyApi","Options",function(e,t){return{blocked:function(n,s,o,u){var a={};a[i.PAGE]=u,a[i.SIZE]=t.getPageSize(),e.pyRequest(e.GET,r.BLOCKED,undefined,a,undefined,n,s,o)},getBlocked:function(t,n,i,s,o){e.pyRequest(e.GET,r.BLOCKED_ID,[s],undefined,undefined,t,n,i,o)},block:function(t,n,i,s){e.pyRequest(e.POST,r.BLOCKED_ID,[s],undefined,undefined,t,n,i)},unblock:function(t,n,i,s){e.pyRequest(e.DELETE,r.BLOCKED_ID,[s],undefined,undefined,t,n,i)}}}])}),define("js/service/py-event",["./module","jquery","angular","js/constants/api-urls","js/constants/params"],function(e,t,n,r,i){e.factory("pyEvent",["pyApi","Options",function(e,t){return{notifications:function(n,s,o,u,a){var f={};f[i.PAGE]=u,f[i.SIZE]=t.getPageSize(),f[i.EVENT]=a,e.pyRequest(e.GET,r.NOTIFICATIONS,undefined,f,undefined,n,s,o)},feed:function(n,s,o,u,a){var f={};f[i.PAGE]=u,f[i.SIZE]=t.getPageSize(),f[i.EVENT]=a,e.pyRequest(e.GET,r.FEED,undefined,f,undefined,n,s,o)},userFeed:function(n,s,o,u,a,f){var l={};l[i.PAGE]=a,l[i.SIZE]=t.getPageSize(),l[i.EVENT]=f,e.pyRequest(e.GET,r.USERS_FEED,[u],l,undefined,n,s,o)}}}])}),define("js/service/py-message",["./module","jquery","angular","js/constants/api-urls","js/constants/params"],function(e,t,n,r,i){e.factory("pyMessage",["pyApi","Options",function(e,t){return{conversations:function(n,s,o,u,a){var f={};f[i.PAGE]=u,f[i.SIZE]=t.getPageSize(),e.pyRequest(e.GET,r.MESSAGES,undefined,f,undefined,n,s,o)},getConversation:function(t,n,i,s,o){e.pyRequest(e.GET,r.CONVERSATION,[s],undefined,undefined,t,n,i,o)},messages:function(n,s,o,u,a){var f={};f[i.PAGE]=a,f[i.SIZE]=t.getPageSize(),e.pyRequest(e.GET,r.CONVERSATION_MESSAGES,[u],f,undefined,n,s,o)},send:function(t,n,i,s,o){var u={message:o};e.pyRequest(e.POST,r.CONVERSATION,[s],undefined,u,t,n,i)},flag:function(t,n,i,s){e.pyRequest(e.POST,r.CONVERSATION_FLAG,[s],undefined,undefined,t,n,i)},hide:function(t,n,i,s){e.pyRequest(e.POST,r.CONVERSATION_HIDE,[s],undefined,undefined,t,n,i)},show:function(t,n,i,s){e.pyRequest(e.POST,r.CONVERSATION_SHOW,[s],undefined,undefined,t,n,i)}}}])}),define("js/constants/content-types",["js/constants/path-variables"],function(e){return{POSTING:{id:"POSTING",pv:e.POSTING},USER:{id:"USER",pv:e.USER},USER_A:{id:"USER_A",pv:e.USER},TAG:{id:"TAG",pv:e.TAG},COMMENT:{id:"COMMENT",pv:e.COMMENT},CURRENT:{id:"CURRENT"}}}),define("js/service/user",["./module","jquery","angular","js/constants/api-urls","js/constants/params","js/constants/chained-keys","js/constants/content-types","js/constants/partials"],function(e,t,n,r,i,s,o,u){e.factory("User",["Authentication","ApiData","pyUser","pyFollow","pyBlock","pyProfile","pyMessage",function(e,t,n,r,i,s,o){var a=function(e){return undefined};return{setUserSingle:function(e,t){},setSelfSingle:function(e){},self:function(e,n,r,i,o,a){var f=function(e,t,o){var u=e;typeof n=="function"&&(u=n(e));var a=t;typeof r=="function"&&(a=r(t));var f=t;typeof i=="function"&&(f=i(o)),s.getProfile(u,a,f)},l=t.getData({scope:e,view:u.CURRENT,method:f,autoLoad:!1,autoSub:o,args:a});return l},userChained:function(e,t,n){return a(t.username.username)},user:function(r,i,s,o,f,l,c){var h=e.isAuthenticated(),p=function(e,t,r){var u=e;typeof s=="function"&&(u=s(e));var a=t;typeof o=="function"&&(a=o(t));var l=t;typeof f=="function"&&(l=f(r)),n.user(u,a,l,i)},d=a(i),v=t.getData({scope:r,view:u.USER,method:p,callChained:h,chained:d,autoLoad:!1,autoSub:l,args:c});return v}}}])}),define("js/service/current-user",["./module","jquery","angular","js/util/i18n","js/constants/cookies","js/constants/events"],function(e,t,n,r,i,s){var o=function(){return{result:undefined,waiting:!1,successList:[],errorList:[]}},u={current:o(),rolesSet:o(),subscription:o()};e.factory("CurrentUser",["$rootScope","Alerts","Authentication","pyProfile",function(e,t,n,i){var o=function(e,t){var n;for(n=0;n<u[e].successList.length;n++)u[e].successList[n](t);u[e].successList=[]},a=function(e,t){var n;for(n=0;n<u[e].errorList.length;n++)u[e].errorList[n]();u[e].errorList=[]},f=function(e){return function(t,n,r){u[e].result=n,u[e].waiting=!1,o(e,n)}},l=function(e,n){return function(i,s){u[e].result=undefined,u[e].waiting=!1,r(function(e){t.warning(e(n))}),a(e)}},c=function(e,t,r,i){n.isAuthenticated()?typeof t!="undefined"&&typeof i!="undefined"&&(u[e].waiting?(u[e].successList.push(t),typeof r!="undefined"&&u[e].errorList.push(r)):typeof u[e].result=="undefined"?(u[e].waiting=!0,u[e].successList.push(t),typeof r!="undefined"&&u[e].errorList.push(r),i()):t(u[e].result)):typeof r!="undefined"&&r()},h=function(e,t){c("current",e,t,function(){i.currentUser(f("current"),l("current","alerts:user.currentError"),l("current","alerts:user.currentError"))})},p=function(e,t){c("rolesSet",e,t,function(){i.rolesSet(f("rolesSet"),l("rolesSet","alerts:user.rolesSetError"),l("rolesSet","alerts:user.rolesSetError"))})},d=function(e,t){c("subscription",e,t,function(){i.subscription(f("subscription"),l("subscription","alerts:user.subscriptionError"),l("subscription","alerts:user.subscriptionError"))})},v=function(e,t){return u.current.result=undefined,u.current.waiting=!1,typeof e=="undefined"&&(e=function(){}),typeof t=="undefined"&&(t=function(){}),h(e,t)},m=function(e,t){u.rolesSet.result=undefined,u.rolesSet.waiting=!1,typeof e=="undefined"&&(e=function(){}),typeof t=="undefined"&&(t=function(){}),p(e,t)},g=function(e,t){return u.subscription.result=undefined,u.subscription.waiting=!1,typeof e=="undefined"&&(e=function(){}),typeof t=="undefined"&&(t=function(){}),d(e,t)},y=function(){u.current.result=undefined,u.current.waiting=!1,u.rolesSet.result=undefined,u.rolesSet.waiting=!1,u.subscription.result=undefined,u.subscription.waiting=!1};e.$on(s.PRE_LOGIN_CHANGE,function(e,t){y()});var b=function(e,n){typeof e!="undefined"&&r(function(r){t.warning(r("alerts:overrideRole."+e),n)})};return{get:h,getFresh:v,hasPendingAction:function(e,t,n){h(function(n){var r,i=!1,s=n.pendingActions;if(typeof s!="undefined")for(r=0;r<s.length;r++)s[r]===e&&(i=!0);t(i)},n)},hasRole:function(e,t,n){p(function(n){var r,i=!1,s=n.roles;if(typeof s!="undefined")for(r=0;r<s.length;r++)s[r]===e&&(i=!0);typeof t!="undefined"&&t(i)},n)},hasOverrideRole:function(e,t,n){p(function(n){var r,i=!1,s=n.overrideRoles;if(typeof s!="undefined")for(r=0;r<s.length;r++)s[r]===e&&(i=!0);typeof t!="undefined"&&t(i)},n)},checkAlertOverrideRole:function(e,t){p(function(n){var r,i=!1,s=n.overrideRoles;if(typeof s!="undefined")for(r=0;r<s.length;r++)s[r]===e&&(i=!0);i&&b(e,t)})},alertOverrideRole:b,refreshRoles:m,refreshSubscription:g,hasFollows:function(e,t,n){d(function(n){var r,i=!1,s=n.follows;if(typeof s!="undefined")for(r=0;r<s.length;r++)s[r].username.username===e&&(i=!0);typeof t!="undefined"&&t(i)},n)},hasBlocked:function(e,t,n){d(function(n){var r,i=!1,s=n.blocked;if(typeof s!="undefined")for(r=0;r<s.length;r++)s[r].username.username===e&&(i=!0);typeof t!="undefined"&&t(i)},n)}}}])}),define("js/service/payment",["./module","jquery","angular","js/util/utils","js/util/i18n","js/constants/params","js/constants/events","js/constants/regexes","js/constants/cookies","js/constants/values","js/constants/response-codes"],function(e,t,n,r,i,s,o,u,a,f,l){e.factory("Payment",["$rootScope","Authentication","Alerts","AutoRefresh","EventManager","Cookies","CacheDelay","pyPayment",function(e,t,s,c,h,p,d,v){var m={processing:0},g={},y=function(e){e?m.processing++:m.processing--,m.processing<0&&(m.processing=0)},b=function(){m=0},w=function(){p.remove(a.PAYKEYS)},E=function(e,t,n,r,i,s){return typeof e=="undefined"?undefined:(t?t="t":t="f",typeof r=="undefined"&&(r=""),typeof i=="undefined"&&(i=""),typeof s=="undefined"&&(s=""),g[e]=n,e+u.PAYKEY_COOKIE_DATA_DELIMITER+t+u.PAYKEY_COOKIE_DATA_DELIMITER+r+u.PAYKEY_COOKIE_DATA_DELIMITER+i+u.PAYKEY_COOKIE_DATA_DELIMITER+s)},S=function(e){var t={};if(typeof e!="undefined"){var n=e.split(u.PAYKEY_COOKIE_DATA_DELIMITER);t.paykey=n[0],t.isSingle=!1,n[1]==="t"&&(t.isSingle=!0),typeof n[2]!="undefined"&&n[2]!==""&&(t.username=n[2]),typeof n[3]!="undefined"&&n[3]!==""&&(t.amount=n[3]),typeof n[4]!="undefined"&&n[4]!==""&&(t.altId=n[4]),t.single=g[t.paykey],delete g[t.paykey]}return t},x,T=function(e){x=e,e||(w(),b())};T(t.isAuthenticated()),e.$on(o.LOGIN_CHANGE,function(e,t){T(t)});var N=function(){var e=p.get(a.PAYKEYS);return typeof e=="undefined"?[]:e.split(u.PAYKEY_COOKIE_DELIMITER)},C=function(e){var t="",n="";if(typeof e!="undefined"){if(e.length===0){w();return}for(var r=0;r<e.length;r++)t=t+n+e[r],n=u.PAYKEY_COOKIE_DELIMITER;p.set(a.PAYKEYS,t)}},k=function(e){if(typeof e=="undefined")return;var t=N();if(typeof t!="undefined")for(var n=0;n<t.length;n++){var r=S(t[n]);if(r.paykey===e){t.splice(n,1),C(t);return}}},L=function(e,t,n,r,i,s){if(typeof e!="undefined"){var o=N(),u=E(e,t,n,r,i,s);typeof u!="undefined"&&(o.push(u),o.length>f.PAYMENT_COOKIE_LIMIT&&o.shift(),C(o))}},A=function(e){var t,n;if(typeof e=="undefined"||e==="")t=undefined,n=undefined;var i=e.split("?");t=i[0];var s=r.getQueryObject("?"+i[1]);return n=s.paykey,[t,n]},O=function(e,t,n){if(typeof t=="undefined")return;var r=function(t,r,i){v.check(t,r,i,e,n)},i=function(){k(e),y(!1)};c.deferRequest(r,t,undefined,undefined,f.PAYMENT_CHECK_DEFER,f.PAYMENT_CHECK_RETRIES,undefined,!1,i)},M=function(t,r,u,a,h,p){if(typeof t=="undefined")return;var d=function(f,l,c){var d=function(){k(t),typeof r=="undefined"&&(r=!1),i(function(t){r?(s.success(t("alerts:appreciation.success")),e.$broadcast(o.APPRECIATION_SHOW_RESPONSE,a),n.isDefined(u)&&n.isDefined(u.scope)&&u.scope.$broadcast(o.APPRECIATION_SUCCESS,u,h),y(!1)):(e.$broadcast(o.BALANCE_CHANGE),y(!1))})};O(t,d,p)},m=function(e,n,r){v.mark(e,n,r,t,p)},g=function(){c.deferRequest(m,d,undefined,undefined,f.PAYMENT_MARK_DEFER,f.PAYMENT_MARK_RETRIES,undefined,!0)},b=function(e,n){if(e===l.NOT_ALLOWED||e===l.NOT_FOUND){k(t);return}g()};v.mark(d,b,g,t,p),y(!0)},_=N();for(var D=0;D<_.length;D++){var P=S(_[D]);M(P.paykey,P.isSingle,P.single,P.username,P.amount,P.altId)}return c.manageRefresh(function(){var e=N(),t=function(){};for(var n=0;n<e.length;n++){var r=S(e[n]);v.mark(t,t,t,r.paykey,r.altId)}},f.PAYMENT_AUTO_MARK_SECONDS),{manageAppreciationEvent:function(e,t){h.manage(o.APPRECIATION_SUCCESS,e,t)},payment:function(t,n,r,i,s,u){var a=A(t);if(typeof a!="undefined"){var f=a[0],l=a[1];e.$broadcast(o.PAYMENT,f,l,n,r,i,s,u)}},paymentStarted:function(e,t,n,r,i,s){L(e,t,n,r,i,s)},paymentFinished:function(e,t,n,r,i,s){M(e,t,n,r,i,s)},processing:m}}])}),define("js/service/event-manager",["./module","jquery","angular","js/constants/states","js/constants/events"],function(e,t,n,r,i){var s;e.factory("EventManager",["$rootScope",function(e){return e.$on(i.CUSTOM_STATE_CHANGE_SUCCESS,function(e,t,n,r,i){if(typeof s!="undefined"){var o;for(o=0;o<s.length;o++){var u=s[o];typeof u!="undefined"&&typeof u.eventOff!="undefined"&&u.eventOff()}s=undefined}}),{manage:function(t,n,r){var i=e.$on(t,r);typeof i!="undefined"&&(typeof s=="undefined"&&(s=[]),typeof n!="undefined"&&n.$on("$destroy",function(e){i()}),s.push({eventOff:i,scope:n}))},managePersistent:function(t,n,r){var i=e.$on(t,r);typeof i!="undefined"&&typeof n!="undefined"&&n.$on("$destroy",function(e){i()})}}}])}),define("js/service/state-handler",["./module","jquery","angular","js/constants/states","js/constants/events"],function(e,t,n,r,i){e.factory("StateHandler",["$rootScope","$state","Browser",function(e,t,n){return e.$on(i.CUSTOM_STATE_CHANGE_START,function(e,t,r,i,s){n.scrollTop()}),e.$on("$stateChangeError",function(e,n,i,s,o,u){t.go(r.DEFAULT,undefined,{reload:!0})}),{}}])}),define("js/service/title",["./module","jquery","angular","js/util/utils","js/util/i18n","js/constants/events","js/constants/states"],function(e,t,n,r,i,s,o){e.factory("Title",["$rootScope","$window","$state",function(e,t,n){var s={},o=!1;s.title=t.document.title,s.fullTitle=t.document.title;var u=function(e,t,n){n=n,i(function(i){var o=i("titles:app");typeof e!="undefined"?(t?s.title=i("titles:"+e,n):s.title=e,s.fullTitle=r.createFullTitle(o,s.title,i("titles:sep"))):(s.title=o,s.fullTitle=r.createFullTitle(o,s.title,i("titles:sep")))})};return e.$on("$stateChangeStart",function(e,t,n,r,i){var s={};if(o&&typeof t.title!="undefined"){var a=t.title;typeof t.title=="function"&&(a=t.title(n)),u(a,!0)}o=!0}),s.setTitle=function(e,t,n){u(e,t,n)},s}])}),define("js/service/utils",["./module","jquery","angular","js/util/i18n","js/constants/events"],function(e,t,n,r,i){e.factory("Utils",["$rootScope","$window","RouteCheck","Browser",function(e,t,s,o){var u,a,f=!1;return r(function(e){u=e("shared:unsavedContent.state"),a=e("shared:unsavedContent.window")}),e.$on(i.UNSAVED_CHANGES_COMPLETE,function(e){f=!0}),{unsavedChanges:function(e,r){typeof e!="undefined"&&typeof r!="undefined"&&(f=!1,n.isArray(r)||(r=[r]),t.onbeforeunload=function(n){if(!f){var i=!1;for(var s=0;s<r.length;s++)typeof e[r[s]]!="undefined"&&e[r[s]].$dirty&&(i=!0);if(i)return typeof n=="undefined"&&(n=t.event),n&&(n.returnValue=a),a}},s.addToStateChangeStart(function(){if(!f){var n=!1;for(var i=0;i<r.length;i++)typeof e[r[i]]!="undefined"&&e[r[i]].$dirty&&(n=!0);if(n){var s=o.confirm(u);return s?(t.onbeforeunload=undefined,!1):!0}}return!1},"Utils"))}}}])}),define("js/util/extra-templates",["js/util/utils","js/constants/view-urls","js/constants/path-variables"],function(e,t,n){return{user:function(r,i){var s={};s[n.USER]=r;var o=e.format(t.USERS_ID,s);return typeof i!="undefined"&&(o=i),"<a href='"+o+"' class='pyUsernameReference'>"+"<i class='fa fa-user'></i>"+"<span class='username'>"+r+"</span>"+"</a>"},tag:function(r,i){var s={};s[n.TAG]=r;var o=e.format(t.TAGS_ID,s);return typeof i!="undefined"&&(o=i),"<a href='"+o+"' class='pyTagReference label'>"+"<span class='tag'>"+r+"</span>"+"</a>"},attribution:function(e,t,n,r,i,s){var o="";typeof e!="undefined"&&e!==""&&(o='"'+e+'" '),typeof t!="undefined"&&e!==""&&(o="<a href='"+t+"'>",typeof e!="undefined"&&e!==""?o=o+'"'+e+'"':o=o+"("+t+")",o+="</a> ");var u="";typeof n!="undefined"&&n!==""&&(u="by "+n+""),typeof r!="undefined"&&r!==""&&(u="by <a href='"+r+"'>",typeof n!="undefined"&&n!==""?u+=n:u=u+"["+r+"]",u+="</a>");var a="";return typeof i!="undefined"&&i!==""&&(a=", licensed under "+i),typeof s!="undefined"&&s!==""&&(a=", licensed under <a href='"+s+"'>",typeof i!="undefined"&&i!==""?a+=i:a=""+s+"",a+="</a>"),"<span class='py-content-attribution'>Credit: "+o+u+a+"</span><br><br>"},editorButton:function(e,t,n,r,i,s){var o="";typeof s!="undefined"&&(o=" ng-show='"+s+"'");var u="<a tabindex='-1' ng-click='"+e+"' type='button' class='pyDropdownButtonInner editor-list-button btn btn-xs' role='button' aria-label='{{"+n+"}}'";return typeof i!="undefined"&&(u=u+" title='"+i+"'"),typeof r!="undefined"&&(u=u+" ng-class='{active: "+r+" }'"),typeof s!="undefined"&&(u=u+" ng-show='"+s+"'"),u+=">",typeof t!="undefined"&&(u=u+"<i class='fa fa-fw "+t+"' aria-hidden='true'></i>"),u=u+"<span ng-bind='"+n+"' class='menu-space'></span>"+"</a>",u},editorButtonDropdownOuter:function(e,t,n,r,i){var s="";return typeof r!="undefined"&&(s=" ng-show='"+r+"'"),"<div dropdown is-open='"+e+"' class='btn-group pyDropdownButton editor-dropdown-button' "+s+">"+"<button tabindex='-1' type='button' class='btn btn-xs dropdown-toggle' dropdown-toggle>"+"<i class='fa fa-fw fa-2x "+t+"'></i>"+"<span class='menu-space'></span>"+"<span><i class='caret'></i></span>"+"</button>"+"<ul class='dropdown-menu' role='menu'>"+i+"</ul>"+"</div>"},editorButtonDropdownInner:function(e,t,n,r,i,s){var o="<li><a tabindex='-1' ng-click='"+e+"' type='button' class='pyDropdownButtonInner editor-list-button' role='button' onclick='return false' aria-label='{{"+n+"}}'";return typeof i!="undefined"&&(o=o+" title='"+i+"'"),typeof r!="undefined"&&(o=o+" ng-class='{active: "+r+" }'"),typeof s!="undefined"&&(o=o+" ng-show='"+s+"'"),o=o+">"+"<div class='pyButtonInner'>",typeof t!="undefined"&&(o=o+"<i class='fa fa-fw "+t+"' aria-hidden='true'></i>"),o=o+"<span ng-bind='"+n+"' class='menu-space'></span>"+"</div>"+"</a>"+"</li>",o},fixed:{ALIGN_CENTER_START:"<p class='wysiwyg-text-align-center'>",ALIGN_LEFT_START:"<p class='wysiwyg-text-align-left'>",ALIGN_RIGHT_START:"<p class='wysiwyg-text-align-right'>",ALIGN_JUSTIFY_START:"<p class='wysiwyg-text-align-full'>",ALIGN_END:"</p>",FONT_SIZE_XSMALL_START:"<p class='wysiwyg-font-size-x-small'>",FONT_SIZE_SMALL_START:"<p class='wysiwyg-font-size-small'>",FONT_SIZE_MEDIUM_START:"<p class='wysiwyg-font-size-medium'>",FONT_SIZE_LARGE_START:"<p class='wysiwyg-font-size-large'>",FONT_SIZE_XLARGE_START:"<p class='wysiwyg-font-size-x-large'>",FONT_SIZE_END:"</p>",FONT_COLOR_RED_START:"<p class='wysiwyg-color-red'>",FONT_COLOR_GREEN_START:"<p class='wysiwyg-color-green'>",FONT_COLOR_BLUE_START:"<p class='wysiwyg-color-blue'>",FONT_COLOR_CYAN_START:"<p class='wysiwyg-color-cyan'>",FONT_COLOR_MAGENTA_START:"<p class='wysiwyg-color-magenta'>",FONT_COLOR_YELLOW_START:"<p class='wysiwyg-color-yellow'>",FONT_COLOR_END:"</p>"}}}),define("js/util/markdown-extensions",["showdown","js/util/extra-templates","js/constants/regexes"],function(e,t,n){var r=function(e){var t=e.charCodeAt(0);return"~E"+t+"E"},i=function(){return[{type:"lang",regex:"(\\\\)?@\\[("+n.USERNAME_STRING+"?)\\]",replace:function(e,n,i){if(n==="\\")return e;var s=i.replace(/_/g,r);return t.user(s)}},{type:"lang",regex:"(\\\\)?#\\[("+n.TAG_STRING+"?)\\]",replace:function(e,n,i){if(n==="\\")return e;var s=i.replace(/_/g,r);return t.tag(s)}},{type:"lang",regex:"(\\\\)?%\\[("+n.ALIGN_CENTER_START_STRING+")\\]",replace:function(e,n,r){return n==="\\"?e:t.fixed.ALIGN_CENTER_START}},{type:"lang",regex:"(\\\\)?%\\[("+n.ALIGN_LEFT_START_STRING+")\\]",replace:function(e,n,r){return n==="\\"?e:t.fixed.ALIGN_LEFT_START}},{type:"lang",regex:"(\\\\)?%\\[("+n.ALIGN_RIGHT_START_STRING+")\\]",replace:function(e,n,r){return n==="\\"?e:t.fixed.ALIGN_RIGHT_START}},{type:"lang",regex:"(\\\\)?%\\[("+n.ALIGN_JUSTIFY_START_STRING+")\\]",replace:function(e,n,r){return n==="\\"?e:t.fixed.ALIGN_JUSTIFY_START}},{type:"lang",regex:"(\\\\)?%\\[("+n.ALIGN_END_STRING+")\\]",replace:function(e,n,r){return n==="\\"?e:t.fixed.ALIGN_END}},{type:"lang",regex:"(\\\\)?%\\[("+n.FONT_SIZE_XSMALL_START_STRING+")\\]",replace:function(e,n,r){return n==="\\"?e:t.fixed.FONT_SIZE_XSMALL_START}},{type:"lang",regex:"(\\\\)?%\\[("+n.FONT_SIZE_SMALL_START_STRING+")\\]",replace:function(e,n,r){return n==="\\"?e:t.fixed.FONT_SIZE_SMALL_START}},{type:"lang",regex:"(\\\\)?%\\[("+n.FONT_SIZE_MEDIUM_START_STRING+")\\]",replace:function(e,n,r){return n==="\\"?e:t.fixed.FONT_SIZE_MEDIUM_START}},{type:"lang",regex:"(\\\\)?%\\[("+n.FONT_SIZE_LARGE_START_STRING+")\\]",replace:function(e,n,r){return n==="\\"?e:t.fixed.FONT_SIZE_LARGE_START}},{type:"lang",regex:"(\\\\)?%\\[("+n.FONT_SIZE_XLARGE_START_STRING+")\\]",replace:function(e,n,r){return n==="\\"?e:t.fixed.FONT_SIZE_XLARGE_START}},{type:"lang",regex:"(\\\\)?%\\[("+n.FONT_SIZE_END_STRING+")\\]",replace:function(e,n,r){return n==="\\"?e:t.fixed.FONT_SIZE_END}},{type:"lang",regex:"(\\\\)?%\\[("+n.FONT_COLOR_RED_START_STRING+")\\]",replace:function(e,n,r){return n==="\\"?e:t.fixed.FONT_COLOR_RED_START}},{type:"lang",regex:"(\\\\)?%\\[("+n.FONT_COLOR_GREEN_START_STRING+")\\]",replace:function(e,n,r){return n==="\\"?e:t.fixed.FONT_COLOR_GREEN_START}},{type:"lang",regex:"(\\\\)?%\\[("+n.FONT_COLOR_BLUE_START_STRING+")\\]",replace:function(e,n,r){return n==="\\"?e:t.fixed.FONT_COLOR_BLUE_START}},{type:"lang",regex:"(\\\\)?%\\[("+n.FONT_COLOR_CYAN_START_STRING+")\\]",replace:function(e,n,r){return n==="\\"?e:t.fixed.FONT_COLOR_CYAN_START}},{type:"lang",regex:"(\\\\)?%\\[("+n.FONT_COLOR_MAGENTA_START_STRING+")\\]",replace:function(e,n,r){return n==="\\"?e:t.fixed.FONT_COLOR_MAGENTA_START}},{type:"lang",regex:"(\\\\)?%\\[("+n.FONT_COLOR_YELLOW_START_STRING+")\\]",replace:function(e,n,r){return n==="\\"?e:t.fixed.FONT_COLOR_YELLOW_START}},{type:"lang",regex:"(\\\\)?%\\[("+n.FONT_COLOR_END_STRING+")\\]",replace:function(e,n,r){return n==="\\"?e:t.fixed.FONT_COLOR_END}},{type:"lang",regex:"\\\\@",replace:"@"},{type:"lang",regex:"\\\\#",replace:"#"},{type:"lang",regex:"\\\\%",replace:"%"}]},s=function(e){return i()};return typeof window!="undefined"&&window.showdown&&window.showdown.extensions&&(window.showdown.extensions.ext=s),typeof module!="undefined"&&(module.exports=s),s}),define("js/service/markdown-converter",["./module","jquery","angular","showdown","js/util/markdown-extensions","js/constants/events","js/constants/values"],function(e,t,n,r,i,s,o){e.factory("MarkdownConverter",["$rootScope","EventManager","AutoRefresh","Options",function(e,t,n,o){r.setOption("noHeaderId",!0),r.setOption("parseImgDimensions",!0);var u=new r.Converter({extensions:[i]}),a=function(e,t){return typeof t!="undefined"?e.makeHtml(t):""};return{convert:function(e){return a(u,e)},manageEvent:function(e,n){t.manage(s.PREVIEW_UPDATE,e,n)},managePreEvent:function(e,n){t.manage(s.PREVIEW_UPDATE_PRE,e,n)}}}])}),define("js/service/shared-methods",["./module","jquery","angular"],function(e,t,n){e.factory("SharedMethods",["$modal","ModalInterface",function(e,t){return{getPromotionStatsModal:function(n,r,i,s,o,u,a){var f=function(e,t){e.scope=n,e.title=r,e.tally=i,e.tallyLabel=s,e.replyTally=o,e.replyTallyLabel=u,e.labels=a,e.close=function(){t.dismiss("cancel")}};return function(n){var r=e.open({templateUrl:"promotionStatsModal",controller:t.controller(f),backdrop:!1})}}}}])}),define("js/constants/social-urls",[],function(){var e="[TITLE]",t="[URL]",n="[ALT_URL]",r="[DESCRIPTION]",i="[SOURCE]",s="[MEDIA]",o="[ABOUT]";return{TWITTER:"https://twitter.com/intent/tweet?status="+e+"+"+t,PINTEREST:"https://pinterest.com/pin/create/bookmarklet/?media="+s+"&url="+t+"&is_video=false&description="+e,FACEBOOK:"https://www.facebook.com/sharer/sharer.php?u="+t+"&title="+e,GOOGLE_PLUS:"https://plus.google.com/share?url="+t,REDDIT:"https://www.reddit.com/submit?url="+t+"&title="+e,DELICIOUS:"https://del.icio.us/post?url="+t+"&title="+e+"&notes="+r,STUMBLE_UPON:"https://www.stumbleupon.com/submit?url="+t+"&title="+e,LINKEDIN:"https://www.linkedin.com/shareArticle?mini=true&url="+t+"&title="+e+"&source="+i,SLASHDOT:"https://slashdot.org/bookmark.pl?url="+t+"&title="+e,TUMBLR:"https://www.tumblr.com/share?v=3&u="+t+"&t="+e,TECHNORATI:"https://technorati.com/faves?add="+t+"&title="+e,POSTEROUS:"https://posterous.com/share?linkto="+t,GOOGLE_BOOKMARKS:"https://www.google.com/bookmarks/mark?op=edit&bkmk="+t+"&title="+e+"&annotation="+r,NEWSVINE:"https://www.newsvine.com/_tools/seed&save?u="+t+"&h="+e,PING_FM:"https://ping.fm/ref/?link="+t+"&title="+e+"&body="+r,EVERNOTE:"https://www.evernote.com/clip.action?url="+t+"&title="+e,FRIEND_FEED:"https://www.friendfeed.com/share?url="+t+"&title="+e,constants:{TITLE:e,URL:t,ALT_URL:n,DESCRIPTION:r,SOURCE:i,MEDIA:s,ABOUT:o}}}),define("js/service/social",["./module","jquery","angular","js/util/i18n","js/constants/states","js/constants/events","js/constants/social-urls"],function(e,t,n,r,i,s,o){e.factory("Social",["$modal","$rootScope","$state","$window","$location","Loaded","Alerts","ModalInterface",function(e,t,i,s,u,a,f,l){var c={open:!1,loading:!1},h=function(e,t){e.socialData=c,c.loading=!1,c.errors={},c.alert=undefined,e.share=function(e){if(typeof e!="undefined"&&typeof c.info!="undefined"){for(var n in c.info)c.info.hasOwnProperty(n)&&(e=e.replace(n,c.info[n]));s.open(e,"","menubar=no,toolbar=no,resizeable=yes,scrollbars=yes,height=420,width=550"),t.dismiss("complete")}},e.cancel=function(){t.dismiss("cancel")}},p=function(t,i,s,a){r(function(r){c.info={};var f=u.absUrl();c.info[o.constants.URL]=encodeURIComponent(u.absUrl()),n.isDefined(s)&&(f=s,c.info[o.constants.URL]=encodeURIComponent(s)),n.isDefined(a)&&(f=a,c.info[o.constants.ALT_URL]=encodeURIComponent(a)),c.info[o.constants.TITLE]=encodeURIComponent(t),c.info[o.constants.DESCRIPTION]=encodeURIComponent(i),c.info[o.constants.SOURCE]=encodeURIComponent(r("shared:app")),c.permalink=f;var p=e.open({templateUrl:"socialModal",controller:l.controller(h),backdrop:!1});p.result.then(function(){c.open=!1},function(){c.open=!1}),p.opened.then(function(){c.open=!0},function(){c.open=!1})})};return{open:p,getSocialData:function(){return c}}}])}),define("js/service/analytics",["./module","jquery","angular","angulartics","angularticsClicky"],function(e,t,n){e.factory("Analytics",["$analytics",function(e){return{}}])}),define("js/service/index",["./loaded","./single-factory","./pageable-factory","./api-data","./alerts","./options","./reloader","./cookies","./browser","./auto-refresh","./custom-events","./route-check","./authentication","./py-api","./py-authentication","./py-profile","./py-finance","./py-payment","./cache-delay","./tour","./modal-interface","./g-recaptcha","./py-posting","./py-comment","./py-tag","./py-user","./py-follow","./py-block","./py-event","./py-message","./user","./current-user","./payment","./event-manager","./state-handler","./title","./utils","./markdown-converter","./shared-methods","./social","./analytics"],function(){}),define("js/directive/module",["angular"],function(e){return e.module("app.directive",[])}),define("js/constants/public-keys",[],function(){return{GOOGLE_RECAPTCHA:"6LcTfQkTAAAAAPEXcT4JVVBWKRADn-p8DmwlitPA"}}),define("js/directive/directive",["jquery","./module","js/constants/events","js/constants/public-keys"],function(e,t,n,r){t.directive("loadedInfo",["Loaded",function(e){return{controller:function(){e.partialInfo()}}}]),t.directive("loadedPage",["Loaded",function(e){return{controller:function(){e.partialPage()}}}]),t.directive("loadedSingle",["Loaded",function(e){return{controller:function(){e.partialSingle()}}}]),t.directive("modalFocus",["$timeout","$parse",function(e,t){return{link:function(n,r,i){var s=t(i.modalFocus);n.$watch(s,function(t){t===!0&&e(function(){r[0].focus()})})}}}]),t.directive("paymentModalLink",["$rootScope",function(e){return{controller:["$element",function(t){e.$broadcast(n.PAYMENT_MODAL_OPEN,t[0])}]}}]),t.directive("pyRecaptcha",["$rootScope","$timeout","GRecaptcha",function(e,t,i){return{restrict:"A",template:"<i class='fa fa-5x fa-spin fa-spinner recaptcha-loading'></i><div class='g-recaptcha recaptcha-move'></div>",link:function(t,s,o){var u=o.id,a;s.removeAttr("id"),s.children(".g-recaptcha").attr("id",u);var f=!1,l=i.getRecaptcha(),c=function(e){if(typeof e=="undefined")return;var t=function(){e.reset(a)},n=function(e){};a=e.render(u,{sitekey:r.GOOGLE_RECAPTCHA,theme:"light",type:"image",size:"normal",callback:n,"expired-callback":t}),i.setCurrentId(a)};typeof l!="undefined"?c(l):e.$on(n.RECAPTCHA_LOADED,function(e,t){c(t)})}}}])}),define("js/inlib/wysihtml",[],function(){var e={version:"0.5.0",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"﻿",INVISIBLE_SPACE_REG_EXP:/\uFEFF/g,EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,TAB_KEY:9,DELETE_KEY:46};e.polyfills=function(e,t){String.prototype.trim||function(){var e=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(e,"")}}(),function(){var n="addEventListener",r="removeEventListener";if(t[n])return;e.Element.prototype[n]=e[n]=t[n]=function(t,n,r){return(r=this).attachEvent("on"+t,function(t){var t=t||e.event;t.target=t.target||t.srcElement,t.preventDefault=t.preventDefault||function(){t.returnValue=!1},t.stopPropagation=t.stopPropagation||function(){t.cancelBubble=!0},t.which=t.button?t.button===2?3:t.button===4?2:t.button:t.keyCode,n.call(r,t)})},e.Element.prototype[r]=e[r]=t[r]=function(e,t){return this.detachEvent("on"+e,t)}}(),Object.defineProperty&&Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(e.Element.prototype,"textContent")&&!Object.getOwnPropertyDescriptor(e.Element.prototype,"textContent").get&&function(){var t=Object.getOwnPropertyDescriptor(e.Element.prototype,"innerText");Object.defineProperty(e.Element.prototype,"textContent",{get:function(){return t.get.call(this)},set:function(e){return t.set.call(this,e)}})}(),Array.isArray||(Array.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var n=this.length,r=-1,i=t>>>0;~(n-i);r=this[--n]===e?n:r);return r}),Function.prototype.bind||(Function.prototype.bind=function(e){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i}),e.Element&&function(e){e.matches=e.matches||e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector||function(e){var t=this,n=(t.parentNode||t.document).querySelectorAll(e),r=-1;while(n[++r]&&n[r]!=t);return!!n[r]}}(e.Element.prototype),"document"in e&&("classList"in t.createElement("_")?"DOMTokenList"in e&&function(){var n=t.createElement("_");n.classList.add("c1","c2");if(!n.classList.contains("c2")){var r=function(t){var n=e.DOMTokenList.prototype[t];e.DOMTokenList.prototype[t]=function(e){var t,r=arguments.length;for(t=0;t<r;t++)e=arguments[t],n.call(this,e)}};r("add"),r("remove")}n.classList.toggle("c3",!1);if(n.classList.contains("c3")){var i=e.DOMTokenList.prototype.toggle;e.DOMTokenList.prototype.toggle=function(e,t){return 1 in arguments&&!this.contains(e)==!t?t:i.call(this,e)}}n=null}():function(e){if(!("Element"in e))return;var t="classList",n="prototype",r=e.Element[n],i=Object,s=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},o=Array[n].indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(t in this&&this[t]===e)return t;return-1},u=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},a=function(e,t){if(t==="")throw new u("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new u("INVALID_CHARACTER_ERR","String contains an invalid character");return o.call(e,t)},f=function(e){var t=s.call(e.getAttribute("class")||""),n=t?t.split(/\s+/):[],r=0,i=n.length;for(;r<i;r++)this.push(n[r]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},l=f[n]=[],c=function(){return new f(this)};u[n]=Error[n],l.item=function(e){return this[e]||null},l.contains=function(e){return e+="",a(this,e)!==-1},l.add=function(){var e=arguments,t=0,n=e.length,r,i=!1;do r=e[t]+"",a(this,r)===-1&&(this.push(r),i=!0);while(++t<n);i&&this._updateClassName()},l.remove=function(){var e=arguments,t=0,n=e.length,r,i=!1,s;do{r=e[t]+"",s=a(this,r);while(s!==-1)this.splice(s,1),i=!0,s=a(this,r)}while(++t<n);i&&this._updateClassName()},l.toggle=function(e,t){e+="";var n=this.contains(e),r=n?t!==!0&&"remove":t!==!1&&"add";return r&&this[r](e),t===!0||t===!1?t:!n},l.toString=function(){return this.join(" ")};if(i.defineProperty){var h={get:c,enumerable:!0,configurable:!0};try{i.defineProperty(r,t,h)}catch(p){p.number===-2146823252&&(h.enumerable=!1,i.defineProperty(r,t,h))}}else i[n].__defineGetter__&&r.__defineGetter__(t,c)}(e));var n=function(){if("createRange"in document&&"getSelection"in window){var e=document.createElement("div"),t=document.createTextNode("a"),n=document.createTextNode("a"),r=document.createTextNode("a"),i=document.createRange(),s,o;return e.setAttribute("contenteditable","true"),e.appendChild(t),e.appendChild(n),e.appendChild(r),document.body.appendChild(e),i.setStart(n,1),i.setEnd(n,1),s=window.getSelection(),s.removeAllRanges(),s.addRange(i),e.normalize(),s=window.getSelection(),o=e.childNodes.length!==1||s.anchorNode!==e.firstChild||s.anchorOffset!==2,e.parentNode.removeChild(e),s.removeAllRanges(),o}},r=function(e){var t=[];for(e=e.firstChild;e;e=e.nextSibling)e.nodeType==3?t.push(e):t=t.concat(r(e));return t},i=function(){var e=Node.prototype.normalize,t=function(){var e=r(this),t=this.ownerDocument.defaultView.getSelection(),n=t.anchorNode,i=t.anchorOffset,s=n&&n.nodeType===1&&n.childNodes.length>0?n.childNodes[i]:undefined,o=t.focusNode,u=t.focusOffset,a=o&&o.nodeType===1&&u>0?o.childNodes[u-1]:undefined,f=this.ownerDocument.createRange(),l=e.shift(),c=l?e.shift():null;a&&a.nodeType===3&&(o=a,u=a.nodeValue.length,a=undefined),s&&s.nodeType===3&&(n=s,i=0,s=undefined);if(n===o&&u<i||n!==o&&n.compareDocumentPosition(o)&Node.DOCUMENT_POSITION_PRECEDING&&!(n.compareDocumentPosition(o)&Node.DOCUMENT_POSITION_CONTAINS))o=[n,n=o][0],u=[i,i=u][0];while(l&&c)c.previousSibling&&c.previousSibling===l?(n===c&&(n=l,i=l.nodeValue.length+i),o===c&&(o=l,u=l.nodeValue.length+u),l.nodeValue=l.nodeValue+c.nodeValue,c.parentNode.removeChild(c),c=e.shift()):(l=c,c=e.shift());a&&(u=Array.prototype.indexOf.call(a.parentNode.childNodes,a)+1),s&&(i=Array.prototype.indexOf.call(s.parentNode.childNodes,s)),n&&n.parentNode&&o&&o.parentNode&&(f.setStart(n,i),f.setEnd(o,u),t.removeAllRanges(),t.addRange(f))};Node.prototype.normalize=t},s=function(){window.removeEventListener("load",s),"Node"in window&&"normalize"in Node.prototype&&n()&&i()};t.readyState!=="complete"?window.addEventListener("load",s):s()},e.polyfills(window,document),function(e,t){t.rangy=e()}(function(){function u(n,r){var i=typeof n[r];return i==t||i==e&&!!n[r]||i=="unknown"}function a(t,n){return typeof t[n]==e&&!!t[n]}function f(e,t){return typeof e[t]!=n}function l(e){return function(t,n){var r=n.length;while(r--)if(!e(t,n[r]))return!1;return!0}}function d(e){return e&&c(e,o)&&p(e,s)}function v(e){return a(e,"body")?e.body:e.getElementsByTagName("body")[0]}function E(e){typeof console!=n&&u(console,"log")&&console.log(e)}function S(e,t){y&&t?alert(e):E(e)}function x(e){w.initialized=!0,w.supported=!1,S("Rangy is not supported in this environment. Reason: "+e,w.config.alertOnFail)}function T(e){S("Rangy warning: "+e,w.config.alertOnWarn)}function L(e){return e.message||e.description||String(e)}function A(){if(!y||w.initialized)return;var e,t=!1,n=!1;u(document,"createRange")&&(e=document.createRange(),c(e,i)&&p(e,r)&&(t=!0));var s=v(document);if(!s||s.nodeName.toLowerCase()!="body"){x("No body element found");return}s&&u(s,"createTextRange")&&(e=s.createTextRange(),d(e)&&(n=!0));if(!t&&!n){x("Neither Range nor TextRange are available");return}w.initialized=!0,w.features={implementsDomRange:t,implementsTextRange:n};var o,a;for(var f in g)(o=g[f])instanceof P&&o.init(o,w);for(var l=0,h=k.length;l<h;++l)try{k[l](w)}catch(m){a="Rangy init listener threw an exception. Continuing. Detail: "+L(m),E(a)}}function O(e,t,n){n&&(e+=" in module "+n.name),w.warn("DEPRECATED: "+e+" is deprecated. Please use "+t+" instead.")}function M(e,t,n,r){e[t]=function(){return O(t,n,r),e[n].apply(e,b.toArray(arguments))}}function D(e){e=e||window,A();for(var t=0,n=_.length;t<n;++t)_[t](e)}function P(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function H(e,t,n){var r=new P(e,t,function(t){if(!t.initialized){t.initialized=!0;try{n(w,t),t.supported=!0}catch(r){var i="Module '"+e+"' failed to load: "+L(r);E(i),r.stack&&E(r.stack)}}});return g[e]=r,r}function B(){}function j(){}var e="object",t="function",n="undefined",r=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],i=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],s=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],o=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],c=l(u),h=l(a),p=l(f),m=[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var n=0,r=e.length;n<r;++n)t(e[n],n)},g={},y=typeof window!=n&&typeof document!=n,b={isHostMethod:u,isHostObject:a,isHostProperty:f,areHostMethods:c,areHostObjects:h,areHostProperties:p,isTextRange:d,getBody:v,forEach:m},w={version:"1.3.0",initialized:!1,isBrowser:y,supported:!0,util:b,features:{},modules:g,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==n?!0:rangyAutoInitialize}};w.fail=x,w.warn=T;var N;(({})).hasOwnProperty?(b.extend=N=function(e,t,n){var r,i;for(var s in t)t.hasOwnProperty(s)&&(r=e[s],i=t[s],n&&r!==null&&typeof r=="object"&&i!==null&&typeof i=="object"&&N(r,i,!0),e[s]=i);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e},b.createOptions=function(e,t){var n={};return N(n,t),e&&N(n,e),n}):x("hasOwnProperty not supported"),y||x("Rangy can only run in a browser"),function(){var e;if(y){var t=document.createElement("div");t.appendChild(document.createElement("span"));var n=[].slice;try{n.call(t.childNodes,0)[0].nodeType==1&&(e=function(e){return n.call(e,0)})}catch(r){}}e||(e=function(e){var t=[];for(var n=0,r=e.length;n<r;++n)t[n]=e[n];return t}),b.toArray=e}();var C;y&&(u(document,"addEventListener")?C=function(e,t,n){e.addEventListener(t,n,!1)}:u(document,"attachEvent")?C=function(e,t,n){e.attachEvent("on"+t,n)}:x("Document does not have required addEventListener or attachEvent method"),b.addListener=C);var k=[];b.deprecationNotice=O,b.createAliasForDeprecatedMethod=M,w.init=A,w.addInitListener=function(e){w.initialized?e(w):k.push(e)};var _=[];w.addShimListener=function(e){_.push(e)},y&&(w.shim=w.createMissingNativeApi=D,M(w,"createMissingNativeApi","shim")),P.prototype={init:function(){var e=this.dependencies||[];for(var t=0,n=e.length,r,i;t<n;++t){i=e[t],r=g[i];if(!r||!(r instanceof P))throw new Error("required module '"+i+"' not found");r.init();if(!r.supported)throw new Error("required module '"+i+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error(e)},warn:function(e){w.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){w.warn("DEPRECATED: "+e+" in module "+this.name+" is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},w.createModule=function(e){var t,n;arguments.length==2?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]);var r=H(e,n,t);w.initialized&&w.supported&&r.init()},w.createCoreModule=function(e,t,n){H(e,t,n)},w.RangePrototype=B,w.rangePrototype=new B,w.selectionPrototype=new j,w.createCoreModule("DomUtil",[],function(e,t){function a(e){var t;return typeof e.namespaceURI==n||(t=e.namespaceURI)===null||t=="http://www.w3.org/1999/xhtml"}function f(e){var t=e.parentNode;return t.nodeType==1?t:null}function l(e){var t=0;while(e=e.previousSibling)++t;return t}function c(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function h(e,t){var n=[],r;for(r=e;r;r=r.parentNode)n.push(r);for(r=t;r;r=r.parentNode)if(u(n,r))return r;return null}function p(e,t,n){var r=n?t:t.parentNode;while(r){if(r===e)return!0;r=r.parentNode}return!1}function d(e,t){return p(e,t,!0)}function v(e,t,n){var r,i=n?e:e.parentNode;while(i){r=i.parentNode;if(r===t)return i;i=r}return null}function m(e){var t=e.nodeType;return t==3||t==4||t==8}function g(e){if(!e)return!1;var t=e.nodeType;return t==3||t==8}function y(e,t){var n=t.nextSibling,r=t.parentNode;return n?r.insertBefore(e,n):r.appendChild(e),e}function b(e,t,n){var r=e.cloneNode(!1);r.deleteData(0,t),e.deleteData(t,e.length-t),y(r,e);if(n)for(var i=0,s;s=n[i++];)s.node==e&&s.offset>t?(s.node=r,s.offset-=t):s.node==e.parentNode&&s.offset>l(e)&&++s.offset;return r}function w(e){if(e.nodeType==9)return e;if(typeof e.ownerDocument!=n)return e.ownerDocument;if(typeof e.document!=n)return e.document;if(e.parentNode)return w(e.parentNode);throw t.createError("getDocument: no document found for node")}function E(e){var r=w(e);if(typeof r.defaultView!=n)return r.defaultView;if(typeof r.parentWindow!=n)return r.parentWindow;throw t.createError("Cannot get a window object for node")}function S(e){if(typeof e.contentDocument!=n)return e.contentDocument;if(typeof e.contentWindow!=n)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function x(e){if(typeof e.contentWindow!=n)return e.contentWindow;if(typeof e.contentDocument!=n)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")}function T(e){return e&&r.isHostMethod(e,"setTimeout")&&r.isHostObject(e,"document")}function N(e,t,n){var i;e?r.isHostProperty(e,"nodeType")?i=e.nodeType==1&&e.tagName.toLowerCase()=="iframe"?S(e):w(e):T(e)&&(i=e.document):i=document;if(!i)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return i}function C(e){var t;while(t=e.parentNode)e=t;return e}function k(e,n,r,i){var s,o,u,a,f;if(e==r)return n===i?0:n<i?-1:1;if(s=v(r,e,!0))return n<=l(s)?-1:1;if(s=v(e,r,!0))return l(s)<i?-1:1;o=h(e,r);if(!o)throw new Error("comparePoints error: nodes have no common ancestor");u=e===o?o:v(e,o,!0),a=r===o?o:v(r,o,!0);if(u===a)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");f=o.firstChild;while(f){if(f===u)return-1;if(f===a)return 1;f=f.nextSibling}}function A(e){var t;try{return t=e.parentNode,!1}catch(n){return!0}}function O(e){if(!e)return"[No node]";if(L&&A(e))return"[Broken node]";if(m(e))return'"'+e.data+'"';if(e.nodeType==1){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+l(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function M(e){var t=w(e).createDocumentFragment(),n;while(n=e.firstChild)t.appendChild(n);return t}function D(e,t,n){var r=i(e),s=e.createElement("div");s.contentEditable=""+!!n,t&&(s.innerHTML=t);var o=r.firstChild;return o?r.insertBefore(s,o):r.appendChild(s),s}function P(e){return e.parentNode.removeChild(e)}function H(e){this.root=e,this._next=e}function B(e){return new H(e)}function j(e,t){this.node=e,this.offset=t}function F(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var n="undefined",r=e.util,i=r.getBody;r.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),r.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var s=document.createElement("div");r.areHostMethods(s,["insertBefore","appendChild","cloneNode"]||!r.areHostObjects(s,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),r.isHostProperty(s,"innerHTML")||t.fail("Element is missing innerHTML property");var o=document.createTextNode("test");r.areHostMethods(o,["splitText","deleteData","insertData","appendData","cloneNode"]||!r.areHostObjects(s,["previousSibling","nextSibling","childNodes","parentNode"])||!r.areHostProperties(o,["data"]))||t.fail("Incomplete Text Node implementation");var u=function(e,t){var n=e.length;while(n--)if(e[n]===t)return!0;return!1},L=!1;(function(){var t=document.createElement("b");t.innerHTML="1";var n=t.firstChild;t.innerHTML="<br />",L=A(n),e.features.crashyTextNodes=L})();var _;typeof window.getComputedStyle!=n?_=function(e,t){return E(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=n?_=function(e,t){return e.currentStyle?e.currentStyle[t]:""}:t.fail("No means of obtaining computed style properties found"),H.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next,t,n;if(this._current){t=e.firstChild;if(t)this._next=t;else{n=null;while(e!==this.root&&!(n=e.nextSibling))e=e.parentNode;this._next=n}}return this._current},detach:function(){this._current=this._next=this.root=null}},j.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+O(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},F.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},F.prototype.toString=function(){return this.message},e.dom={arrayContains:u,isHtmlNamespace:a,parentElement:f,getNodeIndex:l,getNodeLength:c,getCommonAncestor:h,isAncestorOf:p,isOrIsAncestorOf:d,getClosestAncestorIn:v,isCharacterDataNode:m,isTextOrCommentNode:g,insertAfter:y,splitDataNode:b,getDocument:w,getWindow:E,getIframeWindow:x,getIframeDocument:S,getBody:i,isWindow:T,getContentDocument:N,getRootContainer:C,comparePoints:k,isBrokenNode:A,inspectNode:O,getComputedStyleProperty:_,createTestElement:D,removeNode:P,fragmentFromNodeChildren:M,createIterator:B,DomPosition:j},e.DOMException=F}),w.createCoreModule("DomRange",["DomUtil"],function(e,t){function y(e,t){return e.nodeType!=3&&(a(e,t.startContainer)||a(e,t.endContainer))}function b(e){return e.document||f(e.startContainer)}function w(e){return v(e.startContainer)}function E(e){return new i(e.parentNode,u(e))}function S(e){return new i(e.parentNode,u(e)+1)}function x(e,t,r){var i=e.nodeType==11?e.firstChild:e;return o(t)?r==t.length?n.insertAfter(e,t):t.parentNode.insertBefore(e,r==0?t:c(t,r)):r>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[r]),i}function T(e,t,n){K(e),K(t);if(b(t)!=b(e))throw new s("WRONG_DOCUMENT_ERR");var r=l(e.startContainer,e.startOffset,t.endContainer,t.endOffset),i=l(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?r<=0&&i>=0:r<0&&i>0}function N(e){var t;for(var n,r=b(e.range).createDocumentFragment(),i;n=e.next();){t=e.isPartiallySelectedSubtree(),n=n.cloneNode(!t),t&&(i=e.getSubtreeIterator(),n.appendChild(N(i)),i.detach());if(n.nodeType==10)throw new s("HIERARCHY_REQUEST_ERR");r.appendChild(n)}return r}function C(e,t,r){var i,s;r=r||{stop:!1};for(var o,u;o=e.next();)if(e.isPartiallySelectedSubtree()){if(t(o)===!1){r.stop=!0;return}u=e.getSubtreeIterator(),C(u,t,r),u.detach();if(r.stop)return}else{i=n.createIterator(o);while(s=i.next())if(t(s)===!1){r.stop=!0;return}}}function k(e){var t;while(e.next())e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),k(t),t.detach()):e.remove()}function L(e){for(var t,n=b(e.range).createDocumentFragment(),r;t=e.next();){e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),r=e.getSubtreeIterator(),t.appendChild(L(r)),r.detach()):e.remove();if(t.nodeType==10)throw new s("HIERARCHY_REQUEST_ERR");n.appendChild(t)}return n}function A(e,t,n){var r=!!t&&!!t.length,i,s=!!n;r&&(i=new RegExp("^("+t.join("|")+")$"));var u=[];return C(new M(e,!1),function(t){if(r&&!i.test(t.nodeType))return;if(s&&!n(t))return;var a=e.startContainer;if(t==a&&o(a)&&e.startOffset==a.length)return;var f=e.endContainer;if(t==f&&o(f)&&e.endOffset==0)return;u.push(t)}),u}function O(e){var t=typeof e.getName=="undefined"?"Range":e.getName();return"["+t+"("+n.inspectNode(e.startContainer)+":"+e.startOffset+", "+n.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function M(e,t){this.range=e,this.clonePartiallySelectedTextNodes=t;if(!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&o(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===n&&!o(this.sc)?this.sc.childNodes[this.so]:h(this.sc,n,!0),this._last=this.ec===n&&!o(this.ec)?this.ec.childNodes[this.eo-1]:h(this.ec,n,!0))}}function j(e){return function(t,n){var r,i=n?t:t.parentNode;while(i){r=i.nodeType;if(d(e,r))return i;i=i.parentNode}return null}}function R(e,t){if(q(e,t))throw new s("INVALID_NODE_TYPE_ERR")}function U(e,t){if(!d(t,e.nodeType))throw new s("INVALID_NODE_TYPE_ERR")}function z(e,t){if(t<0||t>(o(e)?e.length:e.childNodes.length))throw new s("INDEX_SIZE_ERR")}function W(e,t){if(F(e,!0)!==F(t,!0))throw new s("WRONG_DOCUMENT_ERR")}function X(e){if(I(e,!0))throw new s("NO_MODIFICATION_ALLOWED_ERR")}function V(e,t){if(!e)throw new s(t)}function $(e,t){return t<=(o(e)?e.length:e.childNodes.length)}function J(e){return!!e.startContainer&&!!e.endContainer&&(!m||!n.isBrokenNode(e.startContainer)&&!n.isBrokenNode(e.endContainer))&&v(e.startContainer)==v(e.endContainer)&&$(e.startContainer,e.startOffset)&&$(e.endContainer,e.endOffset)}function K(e){if(!J(e))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+e.inspect()+")")}function et(e,t){K(e);var n=e.startContainer,r=e.startOffset,i=e.endContainer,s=e.endOffset,a=n===i;o(i)&&s>0&&s<i.length&&c(i,s,t),o(n)&&r>0&&r<n.length&&(n=c(n,r,t),a?(s-=r,i=n):i==n.parentNode&&s>=u(n)&&s++,r=0),e.setStartAndEnd(n,r,i,s)}function tt(e){K(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}function ct(e){e.START_TO_START=rt,e.START_TO_END=it,e.END_TO_END=st,e.END_TO_START=ot,e.NODE_BEFORE=ut,e.NODE_AFTER=at,e.NODE_BEFORE_AND_AFTER=ft,e.NODE_INSIDE=lt}function ht(e){ct(e),ct(e.prototype)}function pt(e,t){return function(){K(this);var n=this.startContainer,r=this.startOffset,i=this.commonAncestorContainer,s=new M(this,!0),o,u;n!==i&&(o=h(n,i,!0),u=S(o),n=u.node,r=u.offset),C(s,X),s.reset();var a=e(s);return s.detach(),t(this,n,r,n,r),a}}function dt(t,n){function i(e,t){return function(n){U(n,_),U(v(n),D);var r=(e?E:S)(n);(t?s:a)(this,r.node,r.offset)}}function s(e,t,r){var i=e.endContainer,s=e.endOffset;if(t!==e.startContainer||r!==e.startOffset){if(v(t)!=v(i)||l(t,r,i,s)==1)i=t,s=r;n(e,t,r,i,s)}}function a(e,t,r){var i=e.startContainer,s=e.startOffset;if(t!==e.endContainer||r!==e.endOffset){if(v(t)!=v(i)||l(t,r,i,s)==-1)i=t,s=r;n(e,i,s,t,r)}}var f=function(){};f.prototype=e.rangePrototype,t.prototype=new f,r.extend(t.prototype,{setStart:function(e,t){R(e,!0),z(e,t),s(this,e,t)},setEnd:function(e,t){R(e,!0),z(e,t),a(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],r=e[1],i=t,s=r;switch(e.length){case 3:s=e[2];break;case 4:i=e[2],s=e[3]}n(this,t,r,i,s)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:i(!0,!0),setStartAfter:i(!1,!0),setEndBefore:i(!0,!1),setEndAfter:i(!1,!1),collapse:function(e){K(this),e?n(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):n(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){R(e,!0),n(this,e,0,e,p(e))},selectNode:function(e){R(e,!1),U(e,_);var t=E(e),r=S(e);n(this,t.node,t.offset,r.node,r.offset)},extractContents:pt(L,n),deleteContents:pt(k,n),canSurroundContents:function(){K(this),X(this.startContainer),X(this.endContainer);var e=new M(this,!0),t=e._first&&y(e._first,this)||e._last&&y(e._last,this);return e.detach(),!t},splitBoundaries:function(){et(this)},splitBoundariesPreservingPositions:function(e){et(this,e)},normalizeBoundaries:function(){K(this);var e=this.startContainer,t=this.startOffset,r=this.endContainer,i=this.endOffset,s=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(r=e,i=e.length,e.appendData(t.data),g(t))},a=function(n){var s=n.previousSibling;if(s&&s.nodeType==n.nodeType){e=n;var o=n.length;t=s.length,n.insertData(0,s.data),g(s);if(e==r)i+=t,r=e;else if(r==n.parentNode){var a=u(n);i==a?(r=n,i=o):i>a&&i--}}},f=!0,l;if(o(r))i==r.length?s(r):i==0&&(l=r.previousSibling,l&&l.nodeType==r.nodeType&&(i=l.length,e==r&&(f=!1),l.appendData(r.data),g(r),r=l));else{if(i>0){var c=r.childNodes[i-1];c&&o(c)&&s(c)}f=!this.collapsed}if(f){if(o(e))t==0?a(e):t==e.length&&(l=e.nextSibling,l&&l.nodeType==e.nodeType&&(r==l&&(r=e,i+=e.length),e.appendData(l.data),g(l)));else if(t<e.childNodes.length){var h=e.childNodes[t];h&&o(h)&&a(h)}}else e=r,t=i;n(this,e,t,r,i)},collapseToPoint:function(e,t){R(e,!0),z(e,t),this.setStartAndEnd(e,t)}}),ht(t)}function vt(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:n.getCommonAncestor(e.startContainer,e.endContainer)}function mt(e,t,r,i,s){e.startContainer=t,e.startOffset=r,e.endContainer=i,e.endOffset=s,e.document=n.getDocument(t),vt(e)}function gt(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,vt(this)}var n=e.dom,r=e.util,i=n.DomPosition,s=e.DOMException,o=n.isCharacterDataNode,u=n.getNodeIndex,a=n.isOrIsAncestorOf,f=n.getDocument,l=n.comparePoints,c=n.splitDataNode,h=n.getClosestAncestorIn,p=n.getNodeLength,d=n.arrayContains,v=n.getRootContainer,m=e.features.crashyTextNodes,g=n.removeNode;M.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,o(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e=this._current,t,n;!o(e)||e!==this.sc&&e!==this.ec?e.parentNode&&g(e):(t=e===this.sc?this.so:0,n=e===this.ec?this.eo:e.length,t!=n&&e.deleteData(t,n-t))},isPartiallySelectedSubtree:function(){var e=this._current;return y(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse(!1);else{e=new gt(b(this.range));var t=this._current,n=t,r=0,i=t,s=p(t);a(t,this.sc)&&(n=this.sc,r=this.so),a(t,this.ec)&&(i=this.ec,s=this.eo),mt(e,n,r,i,s)}return new M(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var _=[1,3,4,5,7,8,10],D=[2,9,11],P=[5,6,10,12],H=[1,3,4,5,7,8,10,11],B=[1,3,4,5,7,8],F=j([9,11]),I=j(P),q=j([6,10,12]),Q=document.createElement("style"),G=!1;try{Q.innerHTML="<b>x</b>",G=Q.firstChild.nodeType==3}catch(Y){}e.features.htmlParsingConforms=G;var Z=G?function(e){var t=this.startContainer,r=f(t);if(!t)throw new s("INVALID_STATE_ERR");var i=null;return t.nodeType==1?i=t:o(t)&&(i=n.parentElement(t)),i===null||i.nodeName=="HTML"&&n.isHtmlNamespace(f(i).documentElement)&&n.isHtmlNamespace(i)?i=r.createElement("body"):i=i.cloneNode(!1),i.innerHTML=e,n.fragmentFromNodeChildren(i)}:function(e){var t=b(this),r=t.createElement("body");return r.innerHTML=e,n.fragmentFromNodeChildren(r)},nt=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],rt=0,it=1,st=2,ot=3,ut=0,at=1,ft=2,lt=3;r.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){K(this),W(this.startContainer,t.startContainer);var n,r,i,s,o=e==ot||e==rt?"start":"end",u=e==it||e==rt?"start":"end";return n=this[o+"Container"],r=this[o+"Offset"],i=t[u+"Container"],s=t[u+"Offset"],l(n,r,i,s)},insertNode:function(e){K(this),U(e,H),X(this.startContainer);if(a(e,this.startContainer))throw new s("HIERARCHY_REQUEST_ERR");var t=x(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){K(this);var e,t;if(this.collapsed)return b(this).createDocumentFragment();if(this.startContainer===this.endContainer&&o(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=b(this).createDocumentFragment(),t.appendChild(e),t;var n=new M(this,!0);return e=N(n),n.detach(),e},canSurroundContents:function(){K(this),X(this.startContainer),X(this.endContainer);var e=new M(this,!0),t=e._first&&y(e._first,this)||e._last&&y(e._last,this);return e.detach(),!t},surroundContents:function(e){U(e,B);if(!this.canSurroundContents())throw new s("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())while(e.lastChild)e.removeChild(e.lastChild);x(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){K(this);var e=new gt(b(this)),t=nt.length,n;while(t--)n=nt[t],e[n]=this[n];return e},toString:function(){K(this);var e=this.startContainer;if(e===this.endContainer&&o(e))return e.nodeType==3||e.nodeType==4?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new M(this,!0);return C(n,function(e){(e.nodeType==3||e.nodeType==4)&&t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){K(this);var t=e.parentNode,n=u(e);if(!t)throw new s("NOT_FOUND_ERR");var r=this.comparePoint(t,n),i=this.comparePoint(t,n+1);return r<0?i>0?ft:ut:i>0?at:lt},comparePoint:function(e,t){return K(this),V(e,"HIERARCHY_REQUEST_ERR"),W(e,this.startContainer),l(e,t,this.startContainer,this.startOffset)<0?-1:l(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:Z,toHtml:function(){return tt(this)},intersectsNode:function(e,t){K(this);if(v(e)!=w(this))return!1;var n=e.parentNode,r=u(e);if(!n)return!0;var i=l(n,r,this.endContainer,this.endOffset),s=l(n,r+1,this.startContainer,this.startOffset);return t?i<=0&&s>=0:i<0&&s>0},isPointInRange:function(e,t){return K(this),V(e,"HIERARCHY_REQUEST_ERR"),W(e,this.startContainer),l(e,t,this.startContainer,this.startOffset)>=0&&l(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return T(this,e,!1)},intersectsOrTouchesRange:function(e){return T(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=l(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=l(this.endContainer,this.endOffset,e.endContainer,e.endOffset),r=this.cloneRange();return t==-1&&r.setStart(e.startContainer,e.startOffset),n==1&&r.setEnd(e.endContainer,e.endOffset),r}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return l(e.startContainer,e.startOffset,this.startContainer,this.startOffset)==-1&&t.setStart(e.startContainer,e.startOffset),l(e.endContainer,e.endOffset,this.endContainer,this.endOffset)==1&&t.setEnd(e.endContainer,e.endOffset),t}throw new s("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==lt},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,p(e))<=0},containsRange:function(e){var t=this.intersection(e);return t!==null&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var r=n.pop();return t.setEnd(r,r.length),this.containsRange(t)}return this.containsNodeContents(e)},getNodes:function(e,t){return K(this),A(this,e,t)},getDocument:function(){return b(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var r=b(this),i=e.createRange(r);t=t||n.getBody(r),i.selectNodeContents(t);var s=this.intersection(i),o=0,u=0;return s&&(i.setEnd(s.startContainer,s.startOffset),o=i.toString().length,u=o+s.toString().length),{start:o,end:u,containerNode:t}},moveToBookmark:function(e){var t=e.containerNode,n=0;this.setStart(t,0),this.collapse(!0);var r=[t],i,s=!1,o=!1,u,a,f;while(!o&&(i=r.pop()))if(i.nodeType==3)u=n+i.length,!s&&e.start>=n&&e.start<=u&&(this.setStart(i,e.start-n),s=!0),s&&e.end>=n&&e.end<=u&&(this.setEnd(i,e.end-n),o=!0),n=u;else{f=i.childNodes,a=f.length;while(a--)r.push(f[a])}},getName:function(){return"DomRange"},equals:function(e){return gt.rangesEqual(this,e)},isValid:function(){return J(this)},inspect:function(){return O(this)},detach:function(){}}),dt(gt,mt),r.extend(gt,{rangeProperties:nt,RangeIterator:M,copyComparisonConstants:ht,createPrototypeRange:dt,inspect:O,toHtml:tt,getRangeDocument:b,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=gt}),w.createCoreModule("WrappedRange",["DomRange"],function(e,t){var n,r,i=e.dom,s=e.util,o=i.DomPosition,u=e.DomRange,a=i.getBody,f=i.getContentDocument,l=i.isCharacterDataNode;e.features.implementsDomRange&&function(){function l(e){var t=o.length,n;while(t--)n=o[t],e[n]=e.nativeRange[n];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function c(e,t,n,r,i){var s=e.startContainer!==t||e.startOffset!=n,o=e.endContainer!==r||e.endOffset!=i,u=!e.equals(e.nativeRange);if(s||o||u)e.setEnd(r,i),e.setStart(t,n)}var r,o=u.rangeProperties,h;n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,l(this)},u.createPrototypeRange(n,c),r=n.prototype,r.selectNode=function(e){this.nativeRange.selectNode(e),l(this)},r.cloneContents=function(){return this.nativeRange.cloneContents()},r.surroundContents=function(e){this.nativeRange.surroundContents(e),l(this)},r.collapse=function(e){this.nativeRange.collapse(e),l(this)},r.cloneRange=function(){return new n(this.nativeRange.cloneRange())},r.refresh=function(){l(this)},r.toString=function(){return this.nativeRange.toString()};var p=document.createTextNode("test");a(document).appendChild(p);var d=document.createRange();d.setStart(p,0),d.setEnd(p,0);try{d.setStart(p,1),r.setStart=function(e,t){this.nativeRange.setStart(e,t),l(this)},r.setEnd=function(e,t){this.nativeRange.setEnd(e,t),l(this)},h=function(e){return function(t){this.nativeRange[e](t),l(this)}}}catch(v){r.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}l(this)},r.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}l(this)},h=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(r){this.nativeRange[t](n),this.nativeRange[e](n)}l(this)}}}r.setStartBefore=h("setStartBefore","setEndBefore"),r.setStartAfter=h("setStartAfter","setEndAfter"),r.setEndBefore=h("setEndBefore","setStartBefore"),r.setEndAfter=h("setEndAfter","setStartAfter"),r.selectNodeContents=function(e){this.setStartAndEnd(e,0,i.getNodeLength(e))},d.selectNodeContents(p),d.setEnd(p,3);var m=document.createRange();m.selectNodeContents(p),m.setEnd(p,4),m.setStart(p,2),d.compareBoundaryPoints(d.START_TO_END,m)==-1&&d.compareBoundaryPoints(d.END_TO_START,m)==1?r.compareBoundaryPoints=function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:r.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var g=document.createElement("div");g.innerHTML="123";var y=g.firstChild,b=a(document);b.appendChild(g),d.setStart(y,1),d.setEnd(y,2),d.deleteContents(),y.data=="13"&&(r.deleteContents=function(){this.nativeRange.deleteContents(),l(this)},r.extractContents=function(){var e=this.nativeRange.extractContents();return l(this),e}),b.removeChild(g),b=null,s.isHostMethod(d,"createContextualFragment")&&(r.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),a(document).removeChild(p),r.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createNativeRange=function(e){return e=f(e,t,"createNativeRange"),e.createRange()}}();if(e.features.implementsTextRange){var c=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var r=n.parentElement();n=e.duplicate(),n.collapse(!1);var s=n.parentElement(),o=r==s?r:i.getCommonAncestor(r,s);return o==t?o:i.getCommonAncestor(t,o)},h=function(e){return e.compareEndPoints("StartToEnd",e)==0},p=function(e,t,n,r,s){var u=e.duplicate();u.collapse(n);var a=u.parentElement();i.isOrIsAncestorOf(t,a)||(a=t);if(!a.canHaveHTML){var f=new o(a.parentNode,i.getNodeIndex(a));return{boundaryPosition:f,nodeInfo:{nodeIndex:f.offset,containerElement:f.node}}}var c=i.getDocument(a).createElement("span");c.parentNode&&i.removeNode(c);var h,p=n?"StartToStart":"StartToEnd",d,v,m,g,y=s&&s.containerElement==a?s.nodeIndex:0,b=a.childNodes.length,w=b,E=w;for(;;){E==b?a.appendChild(c):a.insertBefore(c,a.childNodes[E]),u.moveToElementText(c),h=u.compareEndPoints(p,e);if(h==0||y==w)break;if(h==-1){if(w==y+1)break;y=E}else w=w==y+1?y:E;E=Math.floor((y+w)/2),a.removeChild(c)}g=c.nextSibling;if(h==-1&&g&&l(g)){u.setEndPoint(n?"EndToStart":"EndToEnd",e);var S;if(/[\r\n]/.test(g.data)){var x=u.duplicate(),T=x.text.replace(/\r\n/g,"\r").length;S=x.moveStart("character",T);while((h=x.compareEndPoints("StartToEnd",x))==-1)S++,x.moveStart("character",1)}else S=u.text.length;m=new o(g,S)}else d=(r||!n)&&c.previousSibling,v=(r||n)&&c.nextSibling,v&&l(v)?m=new o(v,0):d&&l(d)?m=new o(d,d.data.length):m=new o(a,i.getNodeIndex(c));return i.removeNode(c),{boundaryPosition:m,nodeInfo:{nodeIndex:E,containerElement:a}}},d=function(e,t){var n,r,s=e.offset,o=i.getDocument(e.node),u,f,c=a(o).createTextRange(),h=l(e.node);return h?(n=e.node,r=n.parentNode):(f=e.node.childNodes,n=s<f.length?f[s]:null,r=e.node),u=o.createElement("span"),u.innerHTML="&#feff;",n?r.insertBefore(u,n):r.appendChild(u),c.moveToElementText(u),c.collapse(!t),r.removeChild(u),h&&c[t?"moveStart":"moveEnd"]("character",s),c};r=function(e){this.textRange=e,this.refresh()},r.prototype=new u(document),r.prototype.refresh=function(){var e,t,n,r=c(this.textRange);h(this.textRange)?t=e=p(this.textRange,r,!0,!0).boundaryPosition:(n=p(this.textRange,r,!0,!1),e=n.boundaryPosition,t=p(this.textRange,r,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},r.prototype.getName=function(){return"WrappedTextRange"},u.copyComparisonConstants(r);var v=function(e){if(e.collapsed)return d(new o(e.startContainer,e.startOffset),!0);var t=d(new o(e.startContainer,e.startOffset),!0),n=d(new o(e.endContainer,e.endOffset),!1),r=a(u.getRangeDocument(e)).createTextRange();return r.setEndPoint("StartToStart",t),r.setEndPoint("EndToEnd",n),r};r.rangeToTextRange=v,r.prototype.toTextRange=function(){return v(this)},e.WrappedTextRange=r;if(!e.features.implementsDomRange||e.config.preferTextRange){var m=function(e){return e("return this;")()}(Function);typeof m.Range=="undefined"&&(m.Range=r),e.createNativeRange=function(e){return e=f(e,t,"createNativeRange"),a(e).createTextRange()},e.WrappedRange=r}}e.createRange=function(n){return n=f(n,t,"createRange"),new e.WrappedRange(e.createNativeRange(n))},e.createRangyRange=function(e){return e=f(e,t,"createRangyRange"),new u(e)},s.createAliasForDeprecatedMethod(e,"createIframeRange","createRange"),s.createAliasForDeprecatedMethod(e,"createIframeRangyRange","createRangyRange"),e.addShimListener(function(t){var n=t.document;typeof n.createRange=="undefined"&&(n.createRange=function(){return e.createRange(n)}),n=t=null})}),w.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){function y(e){return typeof e=="string"?/^backward(s)?$/i.test(e):!!e}function b(e,n){if(!e)return window;if(i.isWindow(e))return e;if(e instanceof J)return e.win;var r=i.getContentDocument(e,t,n);return i.getWindow(r)}function w(e){return b(e,"getWinSelection").getSelection()}function E(e){return b(e,"getDocSelection").document.selection}function S(e){var t=!1;return e.anchorNode&&(t=i.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)==1),t}function j(e,t,n){var r=n?"end":"start",i=n?"start":"end";e.anchorNode=t[r+"Container"],e.anchorOffset=t[r+"Offset"],e.focusNode=t[i+"Container"],e.focusOffset=t[i+"Offset"]}function F(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function I(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function q(t){var n;return t instanceof u?(n=e.createNativeRange(t.getDocument()),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof a?n=t.nativeRange:p.implementsDomRange&&t instanceof i.getWindow(t.startContainer).Range&&(n=t),n}function R(e){if(!e.length||e[0].nodeType!=1)return!1;for(var t=1,n=e.length;t<n;++t)if(!i.isAncestorOf(e[0],e[t]))return!1;return!0}function U(e){var n=e.getNodes();if(!R(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function z(e){return!!e&&typeof e.text!="undefined"}function W(e,t){var n=new a(t);e._ranges=[n],j(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function X(t){t._ranges.length=0;if(t.docSelection.type=="None")I(t);else{var n=t.docSelection.createRange();if(z(n))W(t,n);else{t.rangeCount=n.length;var r,i=v(n.item(0));for(var s=0;s<t.rangeCount;++s)r=e.createRange(i),r.selectNode(n.item(s)),t._ranges.push(r);t.isCollapsed=t.rangeCount==1&&t._ranges[0].collapsed,j(t,t._ranges[t.rangeCount-1],!1)}}}function V(e,n){var r=e.docSelection.createRange(),i=U(n),s=v(r.item(0)),o=m(s).createControlRange();for(var u=0,a=r.length;u<a;++u)o.add(r.item(u));try{o.add(i)}catch(f){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}o.select(),X(e)}function J(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function K(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}function G(e,t){var n=Q.length,r,i;while(n--){r=Q[n],i=r.selection;if(t=="deleteAll")K(i);else if(r.win==e)return t=="delete"?(Q.splice(n,1),!0):i}return t=="deleteAll"&&(Q.length=0),null}function et(e,n){var r=v(n[0].startContainer),i=m(r).createControlRange();for(var s=0,o,u=n.length;s<u;++s){o=U(n[s]);try{i.add(o)}catch(a){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}i.select(),X(e)}function st(e,t){if(e.win.document!=v(t))throw new f("WRONG_DOCUMENT_ERR")}function ot(t){return function(n,r){var i;this.rangeCount?(i=this.getRangeAt(0),i["set"+(t?"Start":"End")](n,r)):(i=e.createRange(this.win.document),i.setStartAndEnd(n,r)),this.setSingleRange(i,this.isBackward())}}function ut(e){var t=[],n=new l(e.anchorNode,e.anchorOffset),r=new l(e.focusNode,e.focusOffset),i=typeof e.getName=="function"?e.getName():"Selection";if(typeof e.rangeCount!="undefined")for(var s=0,o=e.rangeCount;s<o;++s)t[s]=u.inspect(e.getRangeAt(s));return"["+i+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}e.config.checkSelectionRanges=!0;var n="boolean",r="number",i=e.dom,s=e.util,o=s.isHostMethod,u=e.DomRange,a=e.WrappedRange,f=e.DOMException,l=i.DomPosition,c,h,p=e.features,d="Control",v=i.getDocument,m=i.getBody,g=u.rangesEqual,x=o(window,"getSelection"),T=s.isHostObject(document,"selection");p.implementsWinGetSelection=x,p.implementsDocSelection=T;var N=T&&(!x||e.config.preferTextRange);if(N)c=E,e.isSelectionValid=function(e){var t=b(e,"isSelectionValid").document,n=t.selection;return n.type!="None"||v(n.createRange().parentElement())==t};else{if(!x)return t.fail("Neither document.selection or window.getSelection() detected."),!1;c=w,e.isSelectionValid=function(){return!0}}e.getNativeSelection=c;var C=c();if(!C)return t.fail("Native selection was null (possibly issue 138?)"),!1;var k=e.createNativeRange(document),L=m(document),A=s.areHostProperties(C,["anchorNode","focusNode","anchorOffset","focusOffset"]);p.selectionHasAnchorAndFocus=A;var O=o(C,"extend");p.selectionHasExtend=O;var M=typeof C.rangeCount==r;p.selectionHasRangeCount=M;var _=!1,D=!0,P=O?function(t,n){var r=u.getRangeDocument(n),i=e.createRange(r);i.collapseToPoint(n.endContainer,n.endOffset),t.addRange(q(i)),t.extend(n.startContainer,n.startOffset)}:null;s.areHostMethods(C,["addRange","getRangeAt","removeAllRanges"])&&typeof C.rangeCount==r&&p.implementsDomRange&&function(){var t=window.getSelection();if(t){var n=t.rangeCount,r=n>1,s=[],o=S(t);for(var u=0;u<n;++u)s[u]=t.getRangeAt(u);var a=i.createTestElement(document,"",!1),f=a.appendChild(document.createTextNode("   ")),l=document.createRange();l.setStart(f,1),l.collapse(!0),t.removeAllRanges(),t.addRange(l),D=t.rangeCount==1,t.removeAllRanges();if(!r){var c=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(c&&parseInt(c[1])>=36)_=!1;else{var h=l.cloneRange();l.setStart(f,0),h.setEnd(f,3),h.setStart(f,2),t.addRange(l),t.addRange(h),_=t.rangeCount==2}}i.removeNode(a),t.removeAllRanges();for(u=0;u<n;++u)u==0&&o?P?P(t,s[u]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),t.addRange(s[u])):t.addRange(s[u])}}(),p.selectionSupportsMultipleRanges=_,p.collapsedNonEditableSelectionsSupported=D;var H=!1,B;L&&o(L,"createControlRange")&&(B=L.createControlRange(),s.areHostProperties(B,["item","add"])&&(H=!0)),p.implementsControlRange=H,A?h=function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:h=function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var $;o(C,"getRangeAt")?$=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:A&&($=function(t){var n=v(t.anchorNode),r=e.createRange(n);return r.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),r.collapsed!==this.isCollapsed&&r.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),r}),J.prototype=e.selectionPrototype;var Q=[],Y=function(e){if(e&&e instanceof J)return e.refresh(),e;e=b(e,"getNativeSelection");var t=G(e),n=c(e),r=T?E(e):null;return t?(t.nativeSelection=n,t.docSelection=r,t.refresh()):(t=new J(n,r,e),Q.push({win:e,selection:t})),t};e.getSelection=Y,s.createAliasForDeprecatedMethod(e,"getIframeSelection","getSelection");var Z=J.prototype;if(!N&&A&&s.areHostMethods(C,["removeAllRanges","addRange"])){Z.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),I(this)};var tt=function(e,t){P(e.nativeSelection,t),e.refresh()};M?Z.addRange=function(t,n){if(H&&T&&this.docSelection.type==d)V(this,t);else if(y(n)&&O)tt(this,t);else{var r;_?r=this.rangeCount:(this.removeAllRanges(),r=0);var i=q(t).cloneRange();try{this.nativeSelection.addRange(i)}catch(s){}this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==r+1){if(e.config.checkSelectionRanges){var o=$(this.nativeSelection,this.rangeCount-1);o&&!g(o,t)&&(t=new a(o))}this._ranges[this.rangeCount-1]=t,j(this,t,it(this.nativeSelection)),this.isCollapsed=h(this)}else this.refresh()}}:Z.addRange=function(e,t){y(t)&&O?tt(this,e):(this.nativeSelection.addRange(q(e)),this.refresh())},Z.setRanges=function(e){if(H&&T&&e.length>1)et(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)this.addRange(e[t])}}}else{if(!(o(C,"empty")&&o(k,"select")&&H&&N))return t.fail("No means of selecting a Range or TextRange was found"),!1;Z.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var e;if(this.anchorNode)e=v(this.anchorNode);else if(this.docSelection.type==d){var t=this.docSelection.createRange();t.length&&(e=v(t.item(0)))}if(e){var n=m(e).createTextRange();n.select(),this.docSelection.empty()}}}catch(r){}I(this)},Z.addRange=function(t){this.docSelection.type==d?V(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,j(this,t,!1))},Z.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?et(this,e):t&&this.addRange(e[0])}}Z.getRangeAt=function(e){if(e<0||e>=this.rangeCount)throw new f("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()};var nt;if(N)nt=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=m(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==d?X(t):z(n)?W(t,n):I(t)};else if(o(C,"getRangeAt")&&typeof C.rangeCount==r)nt=function(t){if(H&&T&&t.docSelection.type==d)X(t);else{t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount;if(t.rangeCount){for(var n=0,r=t.rangeCount;n<r;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));j(t,t._ranges[t.rangeCount-1],it(t.nativeSelection)),t.isCollapsed=h(t)}else I(t)}};else{if(!A||typeof C.isCollapsed!=n||typeof k.collapsed!=n||!p.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;nt=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=$(n,0),e._ranges=[t],e.rangeCount=1,F(e),e.isCollapsed=h(e)):I(e)}}Z.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,r=this.anchorOffset;nt(this);if(e){var i=t.length;if(i!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=r)return!0;while(i--)if(!g(t[i],this._ranges[i]))return!0;return!1}};var rt=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var r=0,i=n.length;r<i;++r)g(t,n[r])||e.addRange(n[r]);e.rangeCount||I(e)};H&&T?Z.removeRange=function(e){if(this.docSelection.type==d){var t=this.docSelection.createRange(),n=U(e),r=v(t.item(0)),i=m(r).createControlRange(),s,o=!1;for(var u=0,a=t.length;u<a;++u)s=t.item(u),s!==n||o?i.add(t.item(u)):o=!0;i.select(),X(this)}else rt(this,e)}:Z.removeRange=function(e){rt(this,e)};var it;!N&&A&&p.implementsDomRange?(it=S,Z.isBackward=function(){return it(this)}):it=Z.isBackward=function(){return!1},Z.isBackwards=Z.isBackward,Z.toString=function(){var e=[];for(var t=0,n=this.rangeCount;t<n;++t)e[t]=""+this._ranges[t];return e.join("")},Z.collapse=function(t,n){st(this,t);var r=e.createRange(t);r.collapseToPoint(t,n),this.setSingleRange(r),this.isCollapsed=!0},Z.collapseToStart=function(){if(!this.rangeCount)throw new f("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},Z.collapseToEnd=function(){if(!this.rangeCount)throw new f("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},Z.selectAllChildren=function(t){st(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.setSingleRange(n)},Z.deleteFromDocument=function(){if(H&&T&&this.docSelection.type==d){var e=this.docSelection.createRange(),t;while(e.length)t=e.item(0),e.remove(t),i.removeNode(t);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var r=0,s=n.length;r<s;++r)n[r].deleteContents();this.addRange(n[s-1])}}},Z.eachRange=function(e,t){for(var n=0,r=this._ranges.length;n<r;++n)if(e(this.getRangeAt(n)))return t},Z.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},Z.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},Z.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange(function(r){n.push(r[e].apply(r,t||[]))}),n},Z.setStart=ot(!0),Z.setEnd=ot(!1),e.rangePrototype.select=function(e){Y(this.getDocument()).setSingleRange(this,e)},Z.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange(function(n){e(n),t.push(n)}),this.removeAllRanges(),n&&t.length==1?this.addRange(t[0],"backward"):this.setRanges(t)},Z.containsNode=function(e,t){return this.eachRange(function(n){return n.containsNode(e,t)},!0)||!1},Z.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},Z.moveToBookmark=function(t){var n=[];for(var r=0,i,s;i=t.rangeBookmarks[r++];)s=e.createRange(this.win),s.moveToBookmark(i),n.push(s);t.backward?this.setSingleRange(n[0],"backward"):this.setRanges(n)},Z.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},Z.restoreRanges=function(e){this.removeAllRanges();for(var t=0,n;n=e.ranges[t];++t)this.addRange(n,e.backward&&t==0)},Z.toHtml=function(){var e=[];return this.eachRange(function(t){e.push(u.toHtml(t))}),e.join("")},p.implementsTextRange&&(Z.getNativeTextRange=function(){var n,r;if(n=this.docSelection){var i=n.createRange();if(z(i))return i;throw t.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return e.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw t.createError("getNativeTextRange: selection contains no range")}),Z.getName=function(){return"WrappedSelection"},Z.inspect=function(){return ut(this)},Z.detach=function(){G(this.win,"delete"),K(this)},J.detachAll=function(){G(null,"deleteAll")},J.inspect=ut,J.isDirectionBackward=y,e.Selection=J,e.selectionPrototype=Z,e.addShimListener(function(e){typeof e.getSelection=="undefined"&&(e.getSelection=function(){return Y(e)}),e=null})});var F=!1,I=function(e){F||(F=!0,!w.initialized&&w.config.autoInitialize&&A())};return y&&(document.readyState=="complete"?I():(u(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",I,!1),C(window,"load",I))),w},window),function(e,t){e(t.rangy)}(function(e){return e.createModule("TextRange",["WrappedSelection"],function(e,t){function E(e,t){function s(e,t,n){i.push({start:e,end:t,isWord:n})}var n=e.join(""),r,i=[],o=0,u,a;while(r=t.wordRegex.exec(n)){u=r.index,a=u+r[0].length,u>o&&s(o,u,!1);if(t.includeTrailingSpace)while(p.test(e[a]))++a;s(u,a,!0),o=a}return o<e.length&&s(o,e.length,!1),i}function S(e,t){var n=e.slice(t.start,t.end),r={isWord:t.isWord,chars:n,toString:function(){return n.join("")}};for(var i=0,s=n.length;i<s;++i)n[i].token=r;return r}function x(e,t,n){var r=n(e,t),i=[];for(var s=0,o;o=r[s++];)i.push(S(e,o));return i}function N(e){var t=e||"",n=typeof t=="string"?t.split(""):t;return n.sort(function(e,t){return e.charCodeAt(0)-t.charCodeAt(0)}),n.join("").replace(/(.)\1+/g,"$1")}function _(e){var t,n;return e?(t=e.language||v,n={},u(n,k[t]||k[v]),u(n,e),n):k[v]}function D(e,t){var n=a(e,t);return t.hasOwnProperty("wordOptions")&&(n.wordOptions=_(n.wordOptions)),t.hasOwnProperty("characterOptions")&&(n.characterOptions=a(n.characterOptions,T)),n}function j(e,t){var n=P(e,"display",t),r=e.tagName.toLowerCase();return n=="block"&&H&&B.hasOwnProperty(r)?B[r]:n}function F(e){var t=W(e);for(var n=0,r=t.length;n<r;++n)if(t[n].nodeType==1&&j(t[n])=="none")return!0;return!1}function I(e){var t;return e.nodeType==3&&(t=e.parentNode)&&P(t,"visibility")=="hidden"}function q(e){return e&&(e.nodeType==1&&!/^(inline(-block|-table)?|none)$/.test(j(e))||e.nodeType==9||e.nodeType==11)}function R(e){var t=e.lastChild;return t?R(t):e}function U(e){return s.isCharacterDataNode(e)||!/^(area|base|basefont|br|col|frame|hr|img|input|isindex|link|meta|param)$/i.test(e.nodeName)}function z(e){var t=[];while(e.parentNode)t.unshift(e.parentNode),e=e.parentNode;return t}function W(e){return z(e).concat([e])}function X(e){while(e&&!e.nextSibling)e=e.parentNode;return e?e.nextSibling:null}function V(e,t){return!t&&e.hasChildNodes()?e.firstChild:X(e)}function $(e){var t=e.previousSibling;if(t){e=t;while(e.hasChildNodes())e=e.lastChild;return e}var n=e.parentNode;return n&&n.nodeType==1?n:null}function J(e){if(!e||e.nodeType!=3)return!1;var t=e.data;if(t==="")return!0;var n=e.parentNode;if(!n||n.nodeType!=1)return!1;var r=P(e.parentNode,"whiteSpace");return/^[\t\n\r ]+$/.test(t)&&/^(normal|nowrap)$/.test(r)||/^[\t\r ]+$/.test(t)&&r=="pre-line"}function K(e){if(e.data==="")return!0;if(!J(e))return!1;var t=e.parentNode;return t?F(e)?!0:!1:!0}function Q(e){var t=e.nodeType;return t==7||t==8||F(e)||/^(script|style)$/i.test(e.nodeName)||I(e)||K(e)}function G(e,t){var n=e.nodeType;return n==7||n==8||n==1&&j(e,t)=="none"}function Y(){this.store={}}function tt(e,t,n){return function(r){var i=this.cache;if(i.hasOwnProperty(e))return Z++,i[e];et++;var s=t.call(this,n?this[n]:this,r);return i[e]=s,s}}function nt(e,t){this.node=e,this.session=t,this.cache=new Y,this.positions=new Y}function dt(e,t){this.offset=t,this.nodeWrapper=e,this.node=e.node,this.session=e.session,this.cache=new Y}function vt(){return"[Position("+s.inspectNode(this.node)+":"+this.offset+")]"}function bt(){return Et(),gt=new yt}function wt(){return gt||bt()}function Et(){gt&&gt.detach(),gt=null}function St(e,n,r,i){function u(){var e=null;return n?(e=s,o||(s=s.previousVisible(),o=!s||r&&s.equals(r))):o||(e=s=s.nextVisible(),o=!s||r&&s.equals(r)),o&&(s=null),e}r&&(n?Q(r.node)&&(r=e.previousVisible()):Q(r.node)&&(r=r.nextVisible()));var s=e,o=!1,a,f=!1;return{next:function(){if(f)return f=!1,a;var e,t;while(e=u()){t=e.getCharacter(i);if(t)return a=e,e}return null},rewind:function(){if(!a)throw t.createError("createCharacterIterator: cannot rewind. Only one position can be rewound.");f=!0},dispose:function(){e=r=null}}}function Tt(e,t,n){function o(e){var t,n,s=[],o=e?r:i,u=!1,a=!1;while(t=o.next()){n=t.character;if(h.test(n))a&&(a=!1,u=!0);else{if(u){o.rewind();break}a=!0}s.push(t)}return s}function p(e){var t=["["+e.length+"]"];for(var n=0;n<e.length;++n)t.push("(word: "+e[n]+", is word: "+e[n].isWord+")");return t}var r=St(e,!1,null,t),i=St(e,!0,null,t),s=n.tokenizer,u=o(!0),a=o(!1).reverse(),f=x(a.concat(u),n,s),l=u.length?f.slice(xt(f,u[0].token)):[],c=a.length?f.slice(0,xt(f,a.pop().token)+1):[];return{nextEndToken:function(){var e,t;while(l.length==1&&!(e=l[0]).isWord&&(t=o(!0)).length>0)l=x(e.chars.concat(t),n,s);return l.shift()},previousStartToken:function(){var e,t;while(c.length==1&&!(e=c[0]).isWord&&(t=o(!1)).length>0)c=x(t.reverse().concat(e.chars),n,s);return c.pop()},dispose:function(){r.dispose(),i.dispose(),l=c=null}}}function Nt(e,t,n,s,o){var u=0,a,f=e,l,c,h=Math.abs(n),p;if(n!==0){var d=n<0;switch(t){case r:l=St(e,d,null,s);while((a=l.next())&&u<h)++u,f=a;c=a,l.dispose();break;case i:var v=Tt(e,s,o),m=d?v.previousStartToken:v.nextEndToken;while((p=m())&&u<h)p.isWord&&(++u,f=d?p.chars[0]:p.chars[p.chars.length-1]);break;default:throw new Error("movePositionBy: unit '"+t+"' not implemented")}d?(f=f.previousVisible(),u=-u):f&&f.isLeadingSpace&&!f.isTrailingSpace&&(t==i&&(l=St(e,!1,null,s),c=l.next(),l.dispose()),c&&(f=c.previousVisible()))}return{position:f,unitsMoved:u}}function Ct(e,t,n,r){var i=e.getRangeBoundaryPosition(t,!0),s=e.getRangeBoundaryPosition(t,!1),o=r?s:i,u=r?i:s;return St(o,!!r,u,n)}function kt(e,t,n){var r=[],i=Ct(e,t,n),s;while(s=i.next())r.push(s);return i.dispose(),r}function Lt(t,n,r){var i=e.createRange(t.node);return i.setStartAndEnd(t.node,t.offset,n.node,n.offset),!i.expand("word",{wordOptions:r})}function At(e,t,n,r,i){function g(e,t){var n=a[e].previousVisible(),r=a[t-1],s=!i.wholeWordsOnly||Lt(n,r,i.wordOptions);return{startPos:n,endPos:r,valid:s}}var s=m(i.direction),o=St(e,s,e.session.getRangeBoundaryPosition(r,s),i.characterOptions),u="",a=[],f,l,c,h,p,d,v=null;while(f=o.next()){l=f.character,!n&&!i.caseSensitive&&(l=l.toLowerCase()),s?(a.unshift(f),u=l+u):(a.push(f),u+=l);if(n){p=t.exec(u);if(p){c=p.index,h=c+p[0].length;if(d){if(!s&&h<u.length||s&&c>0){v=g(c,h);break}}else d=!0}}else if((c=u.indexOf(t))!=-1){v=g(c,c+t.length);break}}return d&&(v=g(c,h)),o.dispose(),v}function Ot(e){return function(){var t=!!gt,n=wt(),r=[n].concat(o.toArray(arguments)),i=e.apply(this,r);return t||Et(),i}}function Mt(e,t){return Ot(function(i,s,o,u){typeof o==n&&(o=s,s=r),u=D(u,A);var a=e;t&&(a=o>=0,this.collapse(!a));var f=Nt(i.getRangeBoundaryPosition(this,a),s,o,u.characterOptions,u.wordOptions),l=f.position;return this[a?"setStart":"setEnd"](l.node,l.offset),f.unitsMoved})}function _t(e){return Ot(function(t,n){n=a(n,T);var r,i=Ct(t,this,n,!e),s=0;while((r=i.next())&&h.test(r.character))++s;i.dispose();var o=s>0;return o&&this[e?"moveStart":"moveEnd"]("character",e?s:-s,{characterOptions:n}),o})}function Dt(e){return Ot(function(t,n){var r=!1;return this.changeEachRange(function(t){r=t[e](n)||r}),r})}var n="undefined",r="character",i="word",s=e.dom,o=e.util,u=o.extend,a=o.createOptions,f=s.getBody,l=/^[ \t\f\r\n]+$/,c=/^[ \t\f\r]+$/,h=/^[\t-\r \u0085\u00A0\u1680\u180E\u2000-\u200B\u2028\u2029\u202F\u205F\u3000]+$/,p=/^[\t \u00A0\u1680\u180E\u2000-\u200B\u202F\u205F\u3000]+$/,d=/^[\n-\r\u0085\u2028\u2029]$/,v="en",m=e.Selection.isDirectionBackward,g=!1,y=!1,b=!1,w=!0;(function(){var t=s.createTestElement(document,"<p>1 </p><p></p>",!0),n=t.firstChild,r=e.getSelection();r.collapse(n.lastChild,2),r.setStart(n.firstChild,0),g=(""+r).length==1,t.innerHTML="1 <br />",r.collapse(t,2),r.setStart(t.firstChild,0),y=(""+r).length==1,t.innerHTML="1 <p>1</p>",r.collapse(t,2),r.setStart(t.firstChild,0),b=(""+r).length==1,s.removeNode(t),r.removeAllRanges()})();var T={includeBlockContentTrailingSpace:!0,includeSpaceBeforeBr:!0,includeSpaceBeforeBlock:!0,includePreLineTrailingSpace:!0,ignoreCharacters:""},C={includeBlockContentTrailingSpace:!w,includeSpaceBeforeBr:!y,includeSpaceBeforeBlock:!b,includePreLineTrailingSpace:!0},k={en:{wordRegex:/[a-z0-9]+('[a-z0-9]+)*/gi,includeTrailingSpace:!1,tokenizer:E}},L={caseSensitive:!1,withinRange:null,wholeWordsOnly:!1,wrap:!1,direction:"forward",wordOptions:null,characterOptions:null},A={wordOptions:null,characterOptions:null},O={wordOptions:null,characterOptions:null,trim:!1,trimStart:!0,trimEnd:!0},M={wordOptions:null,characterOptions:null,direction:"forward"},P=s.getComputedStyleProperty,H;(function(){var e=document.createElement("table"),t=f(document);t.appendChild(e),H=P(e,"display")=="block",t.removeChild(e)})();var B={table:"table",caption:"table-caption",colgroup:"table-column-group",col:"table-column",thead:"table-header-group",tbody:"table-row-group",tfoot:"table-footer-group",tr:"table-row",td:"table-cell",th:"table-cell"};Y.prototype={get:function(e){return this.store.hasOwnProperty(e)?this.store[e]:null},set:function(e,t){return this.store[e]=t}};var Z=0,et=0,rt={getPosition:function(e){var t=this.positions;return t.get(e)||t.set(e,new dt(this,e))},toString:function(){return"[NodeWrapper("+s.inspectNode(this.node)+")]"}};nt.prototype=rt;var it="EMPTY",st="NON_SPACE",ot="UNCOLLAPSIBLE_SPACE",ut="COLLAPSIBLE_SPACE",at="TRAILING_SPACE_BEFORE_BLOCK",ft="TRAILING_SPACE_IN_BLOCK",lt="TRAILING_SPACE_BEFORE_BR",ct="PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK",ht="TRAILING_LINE_BREAK_AFTER_BR",pt="INCLUDED_TRAILING_LINE_BREAK_AFTER_BR";u(rt,{isCharacterDataNode:tt("isCharacterDataNode",s.isCharacterDataNode,"node"),getNodeIndex:tt("nodeIndex",s.getNodeIndex,"node"),getLength:tt("nodeLength",s.getNodeLength,"node"),containsPositions:tt("containsPositions",U,"node"),isWhitespace:tt("isWhitespace",J,"node"),isCollapsedWhitespace:tt("isCollapsedWhitespace",K,"node"),getComputedDisplay:tt("computedDisplay",j,"node"),isCollapsed:tt("collapsed",Q,"node"),isIgnored:tt("ignored",G,"node"),next:tt("nextPos",V,"node"),previous:tt("previous",$,"node"),getTextNodeInfo:tt("textNodeInfo",function(e){var t=null,n=!1,r=P(e.parentNode,"whiteSpace"),i=r=="pre-line";if(i)t=c,n=!0;else if(r=="normal"||r=="nowrap")t=l,n=!0;return{node:e,text:e.data,spaceRegex:t,collapseSpaces:n,preLine:i}},"node"),hasInnerText:tt("hasInnerText",function(e,t){var n=this.session,r=n.getPosition(e.parentNode,this.getNodeIndex()+1),i=n.getPosition(e,0),s=t?r:i,o=t?i:r;while(s!==o){s.prepopulateChar();if(s.isDefinitelyNonEmpty())return!0;s=t?s.previousVisible():s.nextVisible()}return!1},"node"),isRenderedBlock:tt("isRenderedBlock",function(e){var t=e.getElementsByTagName("br");for(var n=0,r=t.length;n<r;++n)if(!Q(t[n]))return!0;return this.hasInnerText()},"node"),getTrailingSpace:tt("trailingSpace",function(e){if(e.tagName.toLowerCase()=="br")return"";switch(this.getComputedDisplay()){case"inline":var t=e.lastChild;while(t){if(!G(t))return t.nodeType==1?this.session.getNodeWrapper(t).getTrailingSpace():"";t=t.previousSibling}break;case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":break;case"table-cell":return"	";default:return this.isRenderedBlock(!0)?"\n":""}return""},"node"),getLeadingSpace:tt("leadingSpace",function(e){switch(this.getComputedDisplay()){case"inline":case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":case"table-cell":break;default:return this.isRenderedBlock(!1)?"\n":""}return""},"node")});var mt={character:"",characterType:it,isBr:!1,prepopulateChar:function(){var e=this;if(!e.prepopulatedChar){var t=e.node,n=e.offset,r="",i=it,s=!1;if(n>0)if(t.nodeType==3){var o=t.data,u=o.charAt(n-1),a=e.nodeWrapper.getTextNodeInfo(),f=a.spaceRegex;a.collapseSpaces?f.test(u)?n>1&&f.test(o.charAt(n-2))||(a.preLine&&o.charAt(n)==="\n"?(r=" ",i=ct):(r=" ",i=ut)):(r=u,i=st,s=!0):(r=u,i=ot,s=!0)}else{var l=t.childNodes[n-1];l&&l.nodeType==1&&!Q(l)&&(l.tagName.toLowerCase()=="br"?(r="\n",e.isBr=!0,i=ut,s=!1):e.checkForTrailingSpace=!0);if(!r){var c=t.childNodes[n];c&&c.nodeType==1&&!Q(c)&&(e.checkForLeadingSpace=!0)}}e.prepopulatedChar=!0,e.character=r,e.characterType=i,e.isCharInvariant=s}},isDefinitelyNonEmpty:function(){var e=this.characterType;return e==st||e==ot},resolveLeadingAndTrailingSpaces:function(){this.prepopulatedChar||this.prepopulateChar();if(this.checkForTrailingSpace){var e=this.session.getNodeWrapper(this.node.childNodes[this.offset-1]).getTrailingSpace();e&&(this.isTrailingSpace=!0,this.character=e,this.characterType=ut),this.checkForTrailingSpace=!1}if(this.checkForLeadingSpace){var t=this.session.getNodeWrapper(this.node.childNodes[this.offset]).getLeadingSpace();t&&(this.isLeadingSpace=!0,this.character=t,this.characterType=ut),this.checkForLeadingSpace=!1}},getPrecedingUncollapsedPosition:function(e){var t=this,n;while(t=t.previousVisible()){n=t.getCharacter(e);if(n!=="")return t}return null},getCharacter:function(e){function p(){return c||(l=h.getPrecedingUncollapsedPosition(e),c=!0),l}this.resolveLeadingAndTrailingSpaces();var t=this.character,n,r=N(e.ignoreCharacters),i=t!==""&&r.indexOf(t)>-1;if(this.isCharInvariant)return n=i?"":t,n;var s=["character",e.includeSpaceBeforeBr,e.includeBlockContentTrailingSpace,e.includePreLineTrailingSpace,r].join("_"),o=this.cache.get(s);if(o!==null)return o;var u="",a=this.characterType==ut,f,l,c=!1,h=this;if(a)if(this.type==pt)u="\n";else if(t!=" "||!(!p()||l.isTrailingSpace||l.character=="\n"||l.character==" "&&l.characterType==ut))if(t=="\n"&&this.isLeadingSpace)p()&&l.character!="\n"&&(u="\n");else{f=this.nextUncollapsed();if(f){f.isBr?this.type=lt:f.isTrailingSpace&&f.character=="\n"?this.type=ft:f.isLeadingSpace&&f.character=="\n"&&(this.type=at);if(f.character=="\n"){if(this.type!=lt||!!e.includeSpaceBeforeBr)if(this.type!=at||!!e.includeSpaceBeforeBlock)if(this.type!=ft||!f.isTrailingSpace||!!e.includeBlockContentTrailingSpace)if(this.type!=ct||f.type!=st||!!e.includePreLineTrailingSpace)t=="\n"?f.isTrailingSpace?this.isTrailingSpace||this.isBr&&(f.type=ht,p()&&l.isLeadingSpace&&!l.isTrailingSpace&&l.character=="\n"?f.character="":f.type=pt):u="\n":t==" "&&(u=" ")}else u=t}}return r.indexOf(u)>-1&&(u=""),this.cache.set(s,u),u},equals:function(e){return!!e&&this.node===e.node&&this.offset===e.offset},inspect:vt,toString:function(){return this.character}};dt.prototype=mt,u(mt,{next:tt("nextPos",function(e){var t=e.nodeWrapper,n=e.node,r=e.offset,i=t.session;if(!n)return null;var s,o,u;return r==t.getLength()?(s=n.parentNode,o=s?t.getNodeIndex()+1:0):t.isCharacterDataNode()?(s=n,o=r+1):(u=n.childNodes[r],i.getNodeWrapper(u).containsPositions()?(s=u,o=0):(s=n,o=r+1)),s?i.getPosition(s,o):null}),previous:tt("previous",function(e){var t=e.nodeWrapper,n=e.node,r=e.offset,i=t.session,o,u,a;return r==0?(o=n.parentNode,u=o?t.getNodeIndex():0):t.isCharacterDataNode()?(o=n,u=r-1):(a=n.childNodes[r-1],i.getNodeWrapper(a).containsPositions()?(o=a,u=s.getNodeLength(a)):(o=n,u=r-1)),o?i.getPosition(o,u):null}),nextVisible:tt("nextVisible",function(e){var t=e.next();if(!t)return null;var n=t.nodeWrapper,r=t.node,i=t;return n.isCollapsed()&&(i=n.session.getPosition(r.parentNode,n.getNodeIndex()+1)),i}),nextUncollapsed:tt("nextUncollapsed",function(e){var t=e;while(t=t.nextVisible()){t.resolveLeadingAndTrailingSpaces();if(t.character!=="")return t}return null}),previousVisible:tt("previousVisible",function(e){var t=e.previous();if(!t)return null;var n=t.nodeWrapper,r=t.node,i=t;return n.isCollapsed()&&(i=n.session.getPosition(r.parentNode,n.getNodeIndex())),i})});var gt=null,yt=function(){function e(e){var t=new Y;return{get:function(n){var r=t.get(n[e]);if(r)for(var i=0,s;s=r[i++];)if(s.node===n)return s;return null},set:function(n){var r=n.node[e],i=t.get(r)||t.set(r,[]);i.push(n)}}}function n(){this.initCaches()}var t=o.isHostProperty(document.documentElement,"uniqueID");return n.prototype={initCaches:function(){this.elementCache=t?function(){var e=new Y;return{get:function(t){return e.get(t.uniqueID)},set:function(t){e.set(t.node.uniqueID,t)}}}():e("tagName"),this.textNodeCache=e("data"),this.otherNodeCache=e("nodeName")},getNodeWrapper:function(e){var t;switch(e.nodeType){case 1:t=this.elementCache;break;case 3:t=this.textNodeCache;break;default:t=this.otherNodeCache}var n=t.get(e);return n||(n=new nt(e,this),t.set(n)),n},getPosition:function(e,t){return this.getNodeWrapper(e).getPosition(t)},getRangeBoundaryPosition:function(e,t){var n=t?"start":"end";return this.getPosition(e[n+"Container"],e[n+"Offset"])},detach:function(){this.elementCache=this.textNodeCache=this.otherNodeCache=null}},n}();u(s,{nextNode:V,previousNode:$});var xt=Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var n=0,r=e.length;n<r;++n)if(e[n]===t)return n;return-1};u(e.rangePrototype,{moveStart:Mt(!0,!1),moveEnd:Mt(!1,!1),move:Mt(!0,!0),trimStart:_t(!0),trimEnd:_t(!1),trim:Ot(function(e,t){var n=this.trimStart(t),r=this.trimEnd(t);return n||r}),expand:Ot(function(e,t,n){var s=!1;n=D(n,O);var o=n.characterOptions;t||(t=r);if(t==i){var u=n.wordOptions,a=e.getRangeBoundaryPosition(this,!0),f=e.getRangeBoundaryPosition(this,!1),l=Tt(a,o,u),c=l.nextEndToken(),h=c.chars[0].previousVisible(),p,d;if(this.collapsed)p=c;else{var v=Tt(f,o,u);p=v.previousStartToken()}return d=p.chars[p.chars.length-1],h.equals(a)||(this.setStart(h.node,h.offset),s=!0),d&&!d.equals(f)&&(this.setEnd(d.node,d.offset),s=!0),n.trim&&(n.trimStart&&(s=this.trimStart(o)||s),n.trimEnd&&(s=this.trimEnd(o)||s)),s}return this.moveEnd(r,1,n)}),text:Ot(function(e,t){return this.collapsed?"":kt(e,this,a(t,T)).join("")}),selectCharacters:Ot(function(e,t,n,r,i){var s={characterOptions:i};t||(t=f(this.getDocument())),this.selectNodeContents(t),this.collapse(!0),this.moveStart("character",n,s),this.collapse(!0),this.moveEnd("character",r-n,s)}),toCharacterRange:Ot(function(e,t,n){t||(t=f(this.getDocument()));var r=t.parentNode,i=s.getNodeIndex(t),o=s.comparePoints(this.startContainer,this.endContainer,r,i)==-1,u=this.cloneRange(),a,l;return o?(u.setStartAndEnd(this.startContainer,this.startOffset,r,i),a=-u.text(n).length):(u.setStartAndEnd(r,i,this.startContainer,this.startOffset),a=u.text(n).length),l=a+this.text(n).length,{start:a,end:l}}),findText:Ot(function(t,n,r){r=D(r,L),r.wholeWordsOnly&&(r.wordOptions.includeTrailingSpace=!1);var i=m(r.direction),s=r.withinRange;s||(s=e.createRange(),s.selectNodeContents(this.getDocument()));var o=n,u=!1;typeof o=="string"?r.caseSensitive||(o=o.toLowerCase()):u=!0;var a=t.getRangeBoundaryPosition(this,!i),f=s.comparePoint(a.node,a.offset);f===-1?a=t.getRangeBoundaryPosition(s,!0):f===1&&(a=t.getRangeBoundaryPosition(s,!1));var l=a,c=!1,h;for(;;){h=At(l,o,u,s,r);if(h){if(h.valid)return this.setStartAndEnd(h.startPos.node,h.startPos.offset,h.endPos.node,h.endPos.offset),!0;l=i?h.startPos:h.endPos}else{if(!r.wrap||!!c)return!1;s=s.cloneRange(),l=t.getRangeBoundaryPosition(s,!i),s.setBoundary(a.node,a.offset,i),c=!0}}}),pasteHtml:function(e){this.deleteContents();if(e){var t=this.createContextualFragment(e),n=t.lastChild;this.insertNode(t),this.collapseAfter(n)}}}),u(e.selectionPrototype,{expand:Ot(function(e,t,n){this.changeEachRange(function(e){e.expand(t,n)})}),move:Ot(function(e,t,n,r){var i=0;if(this.focusNode){this.collapse(this.focusNode,this.focusOffset);var s=this.getRangeAt(0);r||(r={}),r.characterOptions=a(r.characterOptions,C),i=s.move(t,n,r),this.setSingleRange(s)}return i}),trimStart:Dt("trimStart"),trimEnd:Dt("trimEnd"),trim:Dt("trim"),selectCharacters:Ot(function(t,n,r,i,s,o){var u=e.createRange(n);u.selectCharacters(n,r,i,o),this.setSingleRange(u,s)}),saveCharacterRanges:Ot(function(e,t,n){var r=this.getAllRanges(),i=r.length,s=[],o=i==1&&this.isBackward();for(var u=0,a=r.length;u<a;++u)s[u]={characterRange:r[u].toCharacterRange(t,n),backward:o,characterOptions:n};return s}),restoreCharacterRanges:Ot(function(t,n,r){this.removeAllRanges();for(var i=0,s=r.length,o,u,a;i<s;++i)u=r[i],a=u.characterRange,o=e.createRange(n),o.selectCharacters(n,a.start,a.end,u.characterOptions),this.addRange(o,u.backward)}),text:Ot(function(e,t){var n=[];for(var r=0,i=this.rangeCount;r<i;++r)n[r]=this.getRangeAt(r).text(t);return n.join("")})}),e.innerText=function(t,n){var r=e.createRange(t);r.selectNodeContents(t);var i=r.text(n);return i},e.createWordIterator=function(e,t,n){var r=wt();n=D(n,M);var i=r.getPosition(e,t),s=Tt(i,n.characterOptions,n.wordOptions),o=m(n.direction);return{next:function(){return o?s.previousStartToken():s.nextEndToken()},dispose:function(){s.dispose(),this.next=function(){}}}},e.noMutation=function(e){var t=wt();e(t),Et()},e.noMutation.createEntryPointFunction=Ot,e.textRange={isBlockNode:q,isCollapsedWhitespaceNode:K,createPosition:Ot(function(e,t,n){return e.getPosition(t,n)})}}),e},window),function(e,t){e(t.rangy)}(function(e){return e.createModule("SaveRestore",["WrappedRange"],function(e,t){function o(e,t){return(t||document).getElementById(e)}function u(e,t){var r="selectionBoundary_"+ +(new Date)+"_"+(""+Math.random()).slice(2),i,o=n.getDocument(e.startContainer),u=e.cloneRange();return u.collapse(t),i=o.createElement("span"),i.id=r,i.style.lineHeight="0",i.style.display="none",i.className="rangySelectionBoundary",i.appendChild(o.createTextNode(s)),u.insertNode(i),i}function a(e,n,i,s){var u=o(i,e);u?(n[s?"setStartBefore":"setEndBefore"](u),r(u)):t.warn("Marker element has been removed. Cannot restore selection.")}function f(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function l(t,n){var r,s,o=e.DomRange.getRangeDocument(t),a=t.toString(),f=i(n);return t.collapsed?(s=u(t,!1),{document:o,markerId:s.id,collapsed:!0}):(s=u(t,!1),r=u(t,!0),{document:o,startMarkerId:r.id,endMarkerId:s.id,collapsed:!1,backward:f,toString:function(){return"original text: '"+a+"', new text: '"+t.toString()+"'"}})}function c(n,i){var s=n.document;typeof i=="undefined"&&(i=!0);var u=e.createRange(s);if(n.collapsed){var f=o(n.markerId,s);if(f){f.style.display="inline";var l=f.previousSibling;l&&l.nodeType==3?(r(f),u.collapseToPoint(l,l.length)):(u.collapseBefore(f),r(f))}else t.warn("Marker element has been removed. Cannot restore selection.")}else a(s,u,n.startMarkerId,!0),a(s,u,n.endMarkerId,!1);return i&&u.normalizeBoundaries(),u}function h(t,n){var r=[],s,u,a=i(n);t=t.slice(0),t.sort(f);for(var c=0,h=t.length;c<h;++c)r[c]=l(t[c],a);for(c=h-1;c>=0;--c)s=t[c],u=e.DomRange.getRangeDocument(s),s.collapsed?s.collapseAfter(o(r[c].markerId,u)):(s.setEndBefore(o(r[c].endMarkerId,u)),s.setStartAfter(o(r[c].startMarkerId,u)));return r}function p(n){if(!e.isSelectionValid(n))return t.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var r=e.getSelection(n),i=r.getAllRanges(),s=i.length==1&&r.isBackward(),o=h(i,s);return s?r.setSingleRange(i[0],s):r.setRanges(i),{win:n,rangeInfos:o,restored:!1}}function d(e){var t=[],n=e.length;for(var r=n-1;r>=0;r--)t[r]=c(e[r],!0);return t}function v(t,n){if(!t.restored){var r=t.rangeInfos,i=e.getSelection(t.win),s=d(r),o=r.length;o==1&&n&&e.features.selectionHasExtend&&r[0].backward?(i.removeAllRanges(),i.addRange(s[0],!0)):i.setRanges(s),t.restored=!0}}function m(e,t){var n=o(t,e);n&&r(n)}function g(e){var t=e.rangeInfos;for(var n=0,r=t.length,i;n<r;++n)i=t[n],i.collapsed?m(e.doc,i.markerId):(m(e.doc,i.startMarkerId),m(e.doc,i.endMarkerId))}var n=e.dom,r=n.removeNode,i=e.Selection.isDirectionBackward,s="﻿";e.util.extend(e,{saveRange:l,restoreRange:c,saveRanges:h,restoreRanges:d,saveSelection:p,restoreSelection:v,removeMarkerElement:m,removeMarkers:g})}),e},window);var t=function(){};t.extend=function(e,n){var r=t.prototype.extend;t._prototyping=!0;var i=new this;r.call(i,e),i.base=function(){},delete t._prototyping;var s=i.constructor,o=i.constructor=function(){if(!t._prototyping)if(this._constructing||this.constructor==o)this._constructing=!0,s.apply(this,arguments),delete this._constructing;else if(arguments[0]!=null)return(arguments[0].extend||r).call(arguments[0],i)};return o.ancestor=this,o.extend=this.extend,o.forEach=this.forEach,o.implement=this.implement,o.prototype=i,o.toString=this.toString,o.valueOf=function(e){return e=="object"?o:s.valueOf()},r.call(o,n),typeof o.init=="function"&&o.init(),o},t.prototype={extend:function(e,n){if(arguments.length>1){var r=this[e];if(r&&typeof n=="function"&&(!r.valueOf||r.valueOf()!=n.valueOf())&&/\bbase\b/.test(n)){var i=n.valueOf();n=function(){var e=this.base||t.prototype.base;this.base=r;var n=i.apply(this,arguments);return this.base=e,n},n.valueOf=function(e){return e=="object"?n:i},n.toString=t.toString}this[e]=n}else if(e){var s=t.prototype.extend;!t._prototyping&&typeof this!="function"&&(s=this.extend||s);var o={toSource:null},u=["constructor","toString","valueOf"],a=t._prototyping?0:1;while(f=u[a++])e[f]!=o[f]&&s.call(this,f,e[f]);for(var f in e)o[f]||s.call(this,f,e[f])}return this}},t=t.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(e,t,n){for(var r in e)this.prototype[r]===undefined&&t.call(n,e[r],r,e)},implement:function(){for(var e=0;e<arguments.length;e++)typeof arguments[e]=="function"?arguments[e](this.prototype):this.prototype.extend(arguments[e]);return this},toString:function(){return String(this.valueOf())}}),e.browser=function(){function o(e){return+(/ipad|iphone|ipod/.test(e)&&e.match(/ os (\d+).+? like mac os x/)||[undefined,0])[1]}function u(e){return+(e.match(/android (\d+)/)||[undefined,0])[1]}function a(e,t){var n=-1,r;navigator.appName=="Microsoft Internet Explorer"?r=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"):navigator.appName=="Netscape"&&(navigator.userAgent.indexOf("Trident")>-1?r=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"):/Edge\/(\d+)./i.test(navigator.userAgent)&&(r=/Edge\/(\d+)./i)),r&&r.exec(navigator.userAgent)!=null&&(n=parseFloat(RegExp.$1));if(n===-1)return!1;if(!e)return!0;if(!t)return e===n;if(t==="<")return e<n;if(t===">")return e>n;if(t==="<=")return e<=n;if(t===">=")return e>=n}var e=navigator.userAgent,t=document.createElement("div"),n=e.indexOf("Gecko")!==-1&&e.indexOf("KHTML")===-1,r=e.indexOf("AppleWebKit/")!==-1,i=e.indexOf("Chrome/")!==-1,s=e.indexOf("Opera/")!==-1;return{USER_AGENT:e,supported:function(){var e=this.USER_AGENT.toLowerCase(),n="contentEditable"in t,r=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,i=document.querySelector&&document.querySelectorAll,s=this.isIos()&&o(e)<5||this.isAndroid()&&u(e)<4||e.indexOf("opera mobi")!==-1||e.indexOf("hpwos/")!==-1;return n&&r&&i&&!s},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return this.USER_AGENT.indexOf("Android")!==-1},supportsSandboxedIframes:function(){return a()},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return a(12,">")},hasCurrentStyleProperty:function(){return"currentStyle"in t},insertsLineBreaksOnReturn:function(){return n},supportsPlaceholderAttributeOn:function(e){return"placeholder"in e},supportsEvent:function(e){return"on"+e in t||function(){return t.setAttribute("on"+e,"return;"),typeof t["on"+e]=="function"}()},supportsEventsInIframeCorrectly:function(){return!s},supportsHTML5Tags:function(e){var t=e.createElement("div"),n="<article>foo</article>";return t.innerHTML=n,t.innerHTML.toLowerCase()===n},supportsCommand:function(){var e={formatBlock:a(10,"<="),insertUnorderedList:a(9,">=")||a(12,"<="),insertOrderedList:a(9,">=")||a(12,"<=")},t={insertHTML:n};return function(n,r){var i=e[r];if(!i){try{return n.queryCommandSupported(r)}catch(s){}try{return n.queryCommandEnabled(r)}catch(o){return!!t[r]}}return!1}}(),doesAutoLinkingInContentEditable:function(){return a()},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return n||s||r},supportsGetAttributeCorrectly:function(){var e=document.createElement("td");return e.getAttribute("rowspan")!="1"},canSelectImagesInContentEditable:function(){return n||a()||s},autoScrollsToCaret:function(){return!r},autoClosesUnclosedTags:function(){var e=t.cloneNode(!1),n,r;return e.innerHTML="<p><div></div>",r=e.innerHTML.toLowerCase(),n=r==="<p></p><div></div>"||r==="<p><div></div></p>",this.autoClosesUnclosedTags=function(){return n},n},supportsNativeGetElementsByClassName:function(){return String(document.getElementsByClassName).indexOf("[native code]")!==-1},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},needsSpaceAfterLineBreak:function(){return s},supportsSpeechApiOn:function(t){var n=e.match(/Chrome\/(\d+)/)||[undefined,0];return n[1]>=11&&("onwebkitspeechchange"in t||"speech"in t)},crashesWhenDefineProperty:function(e){return a(9)&&(e==="XMLHttpRequest"||e==="XDomainRequest")},doesAsyncFocus:function(){return a(12,">")},hasProblemsSettingCaretAfterImg:function(){return a()},hasUndoInContextMenu:function(){return n||i||s},hasInsertNodeIssue:function(){return s},hasIframeFocusIssue:function(){return a()},createsNestedInvalidMarkupAfterPaste:function(){return r},supportsMutationEvents:function(){return"MutationEvent"in window},supportsModernPaste:function(){return!a()},fixStyleKey:function(e){return e==="cssFloat"?"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat":e}}}(),e.lang.array=function(t){return{contains:function(n){if(Array.isArray(n)){for(var r=n.length;r--;)if(e.lang.array(t).indexOf(n[r])!==-1)return!0;return!1}return e.lang.array(t).indexOf(n)!==-1},indexOf:function(e){if(t.indexOf)return t.indexOf(e);for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return-1},without:function(n){n=e.lang.array(n);var r=[],i=0,s=t.length;for(;i<s;i++)n.contains(t[i])||r.push(t[i]);return r},get:function(){var e=0,n=t.length,r=[];for(;e<n;e++)r.push(t[e]);return r},map:function(e,n){if(Array.prototype.map)return t.map(e,n);var r=t.length>>>0,i=new Array(r),s=0;for(;s<r;s++)i[s]=e.call(n,t[s],s,t);return i},unique:function(){var n=[],r=t.length,i=0;while(i<r)e.lang.array(n).contains(t[i])||n.push(t[i]),i++;return n}}},e.lang.Dispatcher=t.extend({on:function(e,t){return this.events=this.events||{},this.events[e]=this.events[e]||[],this.events[e].push(t),this},off:function(e,t){this.events=this.events||{};var n=0,r,i;if(e){r=this.events[e]||[],i=[];for(;n<r.length;n++)r[n]!==t&&t&&i.push(r[n]);this.events[e]=i}else this.events={};return this},fire:function(e,t){this.events=this.events||{};var n=this.events[e]||[],r=0;for(;r<n.length;r++)n[r].call(this,t);return this},observe:function(){return this.on.apply(this,arguments)},stopObserving:function(){return this.off.apply(this,arguments)}}),e.lang.object=function(t){return{merge:function(n,r){for(var i in n)r&&e.lang.object(n[i]).isPlainObject()&&(typeof t[i]=="undefined"||e.lang.object(t[i]).isPlainObject())?typeof t[i]=="undefined"?t[i]=e.lang.object(n[i]).clone(!0):e.lang.object(t[i]).merge(e.lang.object(n[i]).clone(!0)):t[i]=e.lang.object(n[i]).isPlainObject()?e.lang.object(n[i]).clone(!0):n[i];return this},difference:function(e){var n={};for(var r in t)t.hasOwnProperty(r)&&(e.hasOwnProperty(r)||(n[r]=t[r]));for(var i in e)e.hasOwnProperty(i)&&(!t.hasOwnProperty(i)||t[i]!==e[i])&&(n[0]=t[0]);return n},get:function(){return t},clone:function(n){var r={},i;if(t===null||!e.lang.object(t).isPlainObject())return t;for(i in t)t.hasOwnProperty(i)&&(n?r[i]=e.lang.object(t[i]).clone(n):r[i]=t[i]);return r},isArray:function(){return Object.prototype.toString.call(t)==="[object Array]"},isFunction:function(){return Object.prototype.toString.call(t)==="[object Function]"},isPlainObject:function(){return t&&Object.prototype.toString.call(t)==="[object Object]"&&!("Node"in window?t instanceof Node:t instanceof Element||t instanceof Text)},isEmpty:function(){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}}},function(){var t=/^\s+/,n=/\s+$/,r=/[&<>\t"]/g,i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","	":"&nbsp; "};e.lang.string=function(e){return e=String(e),{trim:function(){return e.replace(t,"").replace(n,"")},interpolate:function(t){for(var n in t)e=this.replace("#{"+n+"}").by(t[n]);return e},replace:function(t){return{by:function(n){return e.split(t).join(n)}}},escapeHTML:function(t,n){var s=e.replace(r,function(e){return i[e]});return t&&(s=s.replace(/(?:\r\n|\r|\n)/g,"<br />")),n&&(s=s.replace(/  /gi,"&nbsp; ")),s}}}}(),function(e){function o(e,t){return l(e,t)?e:(e===e.ownerDocument.documentElement&&(e=e.ownerDocument.body),c(e,t))}function u(e){return e.replace(n,function(e,t){var n=(t.match(r)||[])[1]||"",o=s[n];t=t.replace(r,""),t.split(o).length>t.split(n).length&&(t+=n,n="");var u=t,a=t;return t.length>i&&(a=a.substr(0,i)+"..."),u.substr(0,4)==="www."&&(u="http://"+u),'<a href="'+u+'">'+a+"</a>"+n})}function a(e){var t=e._wysihtml5_tempElement;return t||(t=e._wysihtml5_tempElement=e.createElement("div")),t}function f(t){var n=t.parentNode,r=e.lang.string(t.data).escapeHTML(),i=a(n.ownerDocument);i.innerHTML="<span></span>"+u(r),i.removeChild(i.firstChild);while(i.firstChild)n.insertBefore(i.firstChild,t);n.removeChild(t)}function l(n,r){var i;while(n.parentNode){n=n.parentNode,i=n.nodeName;if(n.className&&e.lang.array(n.className.split(" ")).contains(r))return!0;if(t.contains(i))return!0;if(i==="body")return!1}return!1}function c(r,i){if(t.contains(r.nodeName))return;if(r.className&&e.lang.array(r.className.split(" ")).contains(i))return;if(r.nodeType===e.TEXT_NODE&&r.data.match(n)){f(r);return}var s=e.lang.array(r.childNodes).get(),o=s.length,u=0;for(;u<o;u++)c(s[u],i);return r}var t=e.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),n=/((https?:\/\/|www\.)[^\s<]{3,})/gi,r=/([^\w\/\-](,?))$/i,i=100,s={")":"(","]":"[","}":"{"};e.dom.autoLink=o,e.dom.autoLink.URL_REG_EXP=n}(e),function(e){var t=e.dom;t.addClass=function(e,n){var r=e.classList;if(r)return r.add(n);if(t.hasClass(e,n))return;e.className+=" "+n},t.removeClass=function(e,t){var n=e.classList;if(n)return n.remove(t);e.className=e.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," ")},t.hasClass=function(e,t){var n=e.classList;if(n)return n.contains(t);var r=e.className;return r.length>0&&(r==t||(new RegExp("(^|\\s)"+t+"(\\s|$)")).test(r))}}(e),e.dom.contains=function(){var t=document.documentElement;if(t.contains)return function(t,n){if(n.nodeType!==e.ELEMENT_NODE){if(n.parentNode===t)return!0;n=n.parentNode}return t!==n&&t.contains(n)};if(t.compareDocumentPosition)return function(e,t){return!!(e.compareDocumentPosition(t)&16)}}(),e.dom.convertToList=function(){function t(e,t){var n=e.createElement("li");return t.appendChild(n),n}function n(e,t){return e.createElement(t)}function r(r,i,s){if(r.nodeName==="UL"||r.nodeName==="OL"||r.nodeName==="MENU")return r;var o=r.ownerDocument,u=n(o,i),a=r.querySelectorAll("br"),f=a.length,l,c,h,p,d,v,m,g,y;for(y=0;y<f;y++){p=a[y];while((d=p.parentNode)&&d!==r&&d.lastChild===p){if(e.dom.getStyle("display").from(d)==="block"){d.removeChild(p);break}e.dom.insert(p).after(p.parentNode)}}l=e.lang.array(r.childNodes).get(),c=l.length;for(y=0;y<c;y++){g=g||t(o,u),h=l[y],v=e.dom.getStyle("display").from(h)==="block",m=h.nodeName==="BR";if(v&&(!s||!e.dom.hasClass(h,s))){g=g.firstChild?t(o,u):g,g.appendChild(h),g=null;continue}if(m){g=g.firstChild?null:g;continue}g.appendChild(h)}return l.length===0&&t(o,u),r.parentNode.replaceChild(u,r),u}return r}(),e.dom.copyAttributes=function(e){return{from:function(t){return{to:function(n){var r,i=0,s=e.length;for(;i<s;i++)r=e[i],typeof t[r]!="undefined"&&t[r]!==""&&(n[r]=t[r]);return{andTo:arguments.callee}}}}}},function(t){var n=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],r=function(e){return i(e)?parseInt(t.getStyle("width").from(e),10)<e.offsetWidth:!1},i=function(e){var r=0,i=n.length;for(;r<i;r++)if(t.getStyle(n[r]).from(e)==="border-box")return n[r]};t.copyStyles=function(i){return{from:function(s){r(s)&&(i=e.lang.array(i).without(n));var o="",u=i.length,a=0,f;for(;a<u;a++)f=i[a],o+=f+":"+t.getStyle(f).from(s)+";";return{to:function(e){return t.setStyles(o).on(e),{andTo:arguments.callee}}}}}}}(e.dom),function(e){e.dom.delegate=function(e,t,n,r){var i=function(n){var i=n.target,s=i.nodeType===3?i.parentNode:i,o=e.querySelectorAll(t);for(var u=0,a=o.length;u<a;u++)o[u].contains(s)&&r.call(o[u],n)};return e.addEventListener(n,i,!1),{stop:function(){e.removeEventListener(n,i,!1)}}}}(e),function(e){function t(e,t){var n=[e],r=e;while(t&&r&&r!==t||!t&&r)n.unshift(r),r=r.parentNode;return n}e.dom.domNode=function(n){var r=[e.ELEMENT_NODE,e.TEXT_NODE];return{is:{emptyTextNode:function(t){var r=t?/^\s*$/g:/^[\r\n]*$/g;return n.nodeType===e.TEXT_NODE&&r.test(n.data)},visible:function(){var t=!/^\s*$/g.test(e.dom.getTextContent(n));return t||n.nodeType===1&&n.querySelector("img, br, hr, object, embed, canvas, input, textarea")&&(t=!0),t}},prev:function(t){var i=n.previousSibling,s=t&&t.nodeTypes?t.nodeTypes:r;return i?!e.lang.array(s).contains(i.nodeType)||t&&t.ignoreBlankTexts&&e.dom.domNode(i).is.emptyTextNode(!0)?e.dom.domNode(i).prev(t):i:null},next:function(t){var i=n.nextSibling,s=t&&t.nodeTypes?t.nodeTypes:r;return i?!e.lang.array(s).contains(i.nodeType)||t&&t.ignoreBlankTexts&&e.dom.domNode(i).is.emptyTextNode(!0)?e.dom.domNode(i).next(t):i:null},commonAncestor:function(e,r){var i=t(n,r),s=t(e,r);if(i[0]!=s[0])return null;for(var o=0;o<i.length;o++)if(i[o]!=s[o])return i[o-1];return null},lastLeafNode:function(t){var r;if(n.nodeType!==1)return n;r=n.lastChild;if(!r)return n;if(t&&t.leafClasses)for(var i=t.leafClasses.length;i--;)if(e.dom.hasClass(n,t.leafClasses[i]))return n;return e.dom.domNode(r).lastLeafNode(t)},escapeParent:function(t,r){var i,s,o,u=n;if(!e.dom.contains(t,n))throw new Error("Child is not a descendant of node.");do{i=u.parentNode,s=i.cloneNode(!1);while(i.lastChild&&i.lastChild!==u)s.insertBefore(i.lastChild,s.firstChild);i!==t&&(o=i.cloneNode(!1),o.appendChild(u),u=o),i.parentNode.insertBefore(u,i.nextSibling);if(s.innerHTML!=="")if(/^\s+$/.test(s.innerHTML))while(s.lastChild)i.parentNode.insertBefore(s.lastChild,u.nextSibling);else i.parentNode.insertBefore(s,u.nextSibling);if(i.innerHTML==="")i.parentNode.removeChild(i);else if(/^\s+$/.test(i.innerHTML)){while(i.firstChild)i.parentNode.insertBefore(i.firstChild,i);i.parentNode.removeChild(i)}}while(i&&i!==t);r&&u&&(u.parentNode.insertBefore(r,u),r.appendChild(u))},test:function(t){var r;if(!t)return!1;if(n.nodeType!==1)return!1;if(t.query&&!n.matches(t.query))return!1;if(t.nodeName&&n.nodeName!==t.nodeName)return!1;if(t.className&&!n.classList.contains(t.className))return!1;if(t.classRegExp){var i=(n.className||"").match(t.classRegExp)||[];if(i.length===0)return!1}if(t.styleProperty&&t.styleProperty.length>0){var s=!1,o=Array.isArray(t.styleProperty)?t.styleProperty:[t.styleProperty];for(var u=0,a=o.length;u<a;u++){r=e.browser.fixStyleKey(o[u]);if(n.style[r]){if(!t.styleValue){s=!0;break}if(t.styleValue instanceof RegExp){if(n.style[r].trim().match(t.styleValue).length>0){s=!0;break}}else if(Array.isArray(t.styleValue)){if(t.styleValue.indexOf(n.style[r].trim())){s=!0;break}}else if(t.styleValue===n.style[r].trim().replace(/, /g,",")){s=!0;break}}if(!s)return!1}}if(t.attribute){var f=e.dom.getAttributes(n),l=[],c=!1;Array.isArray(t.attribute)?l=t.attribute:l[t.attribute]=t.attributeValue;for(var h in l)if(l.hasOwnProperty(h))if(typeof l[h]=="undefined"){if(typeof f[h]!="undefined"){c=!0;break}}else if(f[h]===l[h]){c=!0;break}if(!c)return!1}return!0}}}}(e),e.dom.getAsDom=function(){var t=function(e,t){var n=t.createElement("div");n.style.display="none",t.body.appendChild(n);try{n.innerHTML=e}catch(r){}return t.body.removeChild(n),n},n=function(e){if(e._wysihtml5_supportsHTML5Tags)return;for(var t=0,n=r.length;t<n;t++)e.createElement(r[t]);e._wysihtml5_supportsHTML5Tags=!0},r=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"];return function(r,i){i=i||document;var s;return typeof r=="object"&&r.nodeType?(s=i.createElement("div"),s.appendChild(r)):e.browser.supportsHTML5Tags(i)?(s=i.createElement("div"),s.innerHTML=r):(n(i),s=t(r,i)),s}}(),e.dom.getParentElement=function(){return function(t,n,r,i){r=r||50;while(r--&&t&&t.nodeName!=="BODY"&&(!i||t!==i)){if(e.dom.domNode(t).test(n))return t;t=t.parentNode}return null}}(),e.dom.getStyle=function(){function r(e){return e.replace(n,function(e){return e.charAt(1).toUpperCase()})}var t={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},n=/\-[a-z]/g;return function(n){return{from:function(i){if(i.nodeType!==e.ELEMENT_NODE)return;var s=i.ownerDocument,o=t[n]||r(n),u=i.style,a=i.currentStyle,f=u[o];if(f)return f;if(a)try{return a[o]}catch(l){}var c=s.defaultView||s.parentWindow,h=(n==="height"||n==="width")&&i.nodeName==="TEXTAREA",p,d;if(c.getComputedStyle)return h&&(p=u.overflow,u.overflow="hidden"),d=c.getComputedStyle(i,null).getPropertyValue(n),h&&(u.overflow=p||""),d}}}}(),e.dom.getTextNodes=function(t,n){var r=[];for(t=t.firstChild;t;t=t.nextSibling)t.nodeType==3?(!n||!/^\s*$/.test(t.innerText||t.textContent))&&r.push(t):r=r.concat(e.dom.getTextNodes(t,n));return r},e.dom.hasElementWithTagName=function(){function n(e){return e._wysihtml5_identifier||(e._wysihtml5_identifier=t++)}var e={},t=1;return function(t,r){var i=n(t)+":"+r,s=e[i];return s||(s=e[i]=t.getElementsByTagName(r)),s.length>0}}(),function(e){function r(e){return e._wysihtml5_identifier||(e._wysihtml5_identifier=n++)}var t={},n=1;e.dom.hasElementWithClassName=function(n,i){if(!e.browser.supportsNativeGetElementsByClassName())return!!n.querySelector("."+i);var s=r(n)+":"+i,o=t[s];return o||(o=t[s]=n.getElementsByClassName(i)),o.length>0}}(e),e.dom.insert=function(e){return{after:function(t){t.parentNode.insertBefore(e,t.nextSibling)},before:function(t){t.parentNode.insertBefore(e,t)},into:function(t){t.appendChild(e)}}},e.dom.insertCSS=function(e){return e=e.join("\n"),{into:function(t){var n=t.createElement("style");n.type="text/css",n.styleSheet?n.styleSheet.cssText=e:n.appendChild(t.createTextNode(e));var r=t.querySelector("head link");if(r){r.parentNode.insertBefore(n,r);return}var i=t.querySelector("head");i&&i.appendChild(n)}}},function(e){e.dom.lineBreaks=function(t){function n(e){return e.nodeName==="BR"}function r(t){return n(t)?!0:e.dom.getStyle("display").from(t)==="block"?!0:!1}return{add:function(n){var i=t.ownerDocument,s=e.dom.domNode(t).next({ignoreBlankTexts:!0}),o=e.dom.domNode(t).prev({ignoreBlankTexts:!0});s&&!r(s)&&e.dom.insert(i.createElement("br")).after(t),o&&!r(o)&&e.dom.insert(i.createElement("br")).before(t)},remove:function(r){var i=e.dom.domNode(t).next({ignoreBlankTexts:!0}),s=e.dom.domNode(t).prev({ignoreBlankTexts:!0});i&&n(i)&&i.parentNode.removeChild(i),s&&n(s)&&s.parentNode.removeChild(s)}}}}(e),e.dom.observe=function(e,t,n){t=typeof t=="string"?[t]:t;var r,i,s=0,o=t.length;for(;s<o;s++)i=t[s],e.addEventListener?e.addEventListener(i,n,!1):(r=function(t){"target"in t||(t.target=t.srcElement),t.preventDefault=t.preventDefault||function(){this.returnValue=!1},t.stopPropagation=t.stopPropagation||function(){this.cancelBubble=!0},n.call(e,t)},e.attachEvent("on"+i,r));return{stop:function(){var i,s=0,o=t.length;for(;s<o;s++)i=t[s],e.removeEventListener?e.removeEventListener(i,n,!1):e.detachEvent("on"+i,r)}}},e.dom.parse=function(t,n){function f(t,n){e.lang.object(u).merge(o).merge(n.rules).get();var r=n.context||t.ownerDocument||document,i=r.createDocumentFragment(),s=typeof t=="string",a=!1,f,h,p;n.clearInternals===!0&&(a=!0),s?f=e.dom.getAsDom(t,r):f=t,u.selectors&&c(f,u.selectors);while(f.firstChild)p=f.firstChild,h=l(p,n.cleanUp,a,n.uneditableClass),h&&i.appendChild(h),p!==h&&f.removeChild(p);if(n.unjoinNbsps){var d=e.dom.getTextNodes(i);for(var v=d.length;v--;)d[v].nodeValue=d[v].nodeValue.replace(/([\S\u00A0])\u00A0/gi,"$1 ")}return f.innerHTML="",f.appendChild(i),s?e.quirks.getCorrectInnerHTML(f):f}function l(t,n,s,o){var u=t.nodeType,f=t.childNodes,c=f.length,h=r[u],p=0,d,v,m,g;if(o&&u===1&&e.dom.hasClass(t,o))return t;v=h&&h(t,s);if(!v){if(v===!1){d=t.ownerDocument.createDocumentFragment();for(p=c;p--;)f[p]&&(m=l(f[p],n,s,o),m&&(f[p]===m&&p--,d.insertBefore(m,d.firstChild)));return g=e.dom.getStyle("display").from(t),g===""&&(g=e.lang.array(a).contains(t.tagName)?"block":""),e.lang.array(["block","flex","table"]).contains(g)&&d.appendChild(t.ownerDocument.createElement("br")),e.lang.array(["div","pre","p","table","td","th","ul","ol","li","dd","dl","footer","header","section","h1","h2","h3","h4","h5","h6"]).contains(t.nodeName.toLowerCase())&&t.parentNode.lastChild!==t&&(!t.nextSibling||t.nextSibling.nodeType!==3||!/^\s/.test(t.nextSibling.nodeValue))&&d.appendChild(t.ownerDocument.createTextNode(" ")),d.normalize&&d.normalize(),d}return null}for(p=0;p<c;p++)f[p]&&(m=l(f[p],n,s,o),m&&(f[p]===m&&p--,v.appendChild(m)));if(n&&v.nodeName.toLowerCase()===i&&(!v.childNodes.length||/^\s*$/gi.test(v.innerHTML)&&(s||t.className!=="_wysihtml5-temp-placeholder"&&t.className!=="rangySelectionBoundary")||!v.attributes.length)){d=v.ownerDocument.createDocumentFragment();while(v.firstChild)d.appendChild(v.firstChild);return d.normalize&&d.normalize(),d}return v.normalize&&v.normalize(),v}function c(t,n){var r,i,s;for(r in n)if(n.hasOwnProperty(r)){e.lang.object(n[r]).isFunction()?i=n[r]:typeof n[r]=="string"&&k[n[r]]&&(i=k[n[r]]),s=t.querySelectorAll(r);for(var o=s.length;o--;)i(s[o])}}function h(t,n){var r,s,o=u.tags,a=t.nodeName.toLowerCase(),f=t.scopeName,l;if(t._wysihtml5)return null;t._wysihtml5=1;if(t.className==="wysihtml5-temp")return null;f&&f!="HTML"&&(a=f+":"+a),"outerHTML"in t&&!e.browser.autoClosesUnclosedTags()&&t.nodeName==="P"&&t.outerHTML.slice(-4).toLowerCase()!=="</p>"&&(a="div");if(a in o){r=o[a];if(!r||r.remove)return null;if(r.unwrap)return!1;r=typeof r=="string"?{rename_tag:r}:r}else{if(!t.firstChild)return null;r={rename_tag:i}}if(r.one_of_type&&!p(t,u,r.one_of_type,n)){if(!r.remove_action)return null;if(r.remove_action==="unwrap")return!1;if(r.remove_action!=="rename")return null;l=r.remove_action_rename_to||i}return s=t.ownerDocument.createElement(l||r.rename_tag||a),w(t,s,r,n),m(t,s,r),t=null,s.normalize&&s.normalize(),s}function p(e,t,n,r){var i,s;if(e.nodeName!=="SPAN"||!!r||e.className!=="_wysihtml5-temp-placeholder"&&e.className!=="rangySelectionBoundary"){for(s in n)if(n.hasOwnProperty(s)&&t.type_definitions&&t.type_definitions[s]){i=t.type_definitions[s];if(v(e,i))return!0}return!1}return!0}function d(e,t){var n=e.length;while(n--)if(e[n]===t)return!0;return!1}function v(t,n){var r=t.getAttribute("class"),i=t.getAttribute("style"),o,u,a,f,l,c,h;if(n.methods)for(var p in n.methods)if(n.methods.hasOwnProperty(p)&&C[p]&&C[p](t))return!0;if(r&&n.classes){r=r.replace(/^\s+/g,"").replace(/\s+$/g,"").split(s),o=r.length;for(var d=0;d<o;d++)if(n.classes[r[d]])return!0}if(i&&n.styles){i=i.split(";");for(u in n.styles)if(n.styles.hasOwnProperty(u))for(var v=i.length;v--;){h=i[v].split(":");if(h[0].replace(/\s/g,"").toLowerCase()===u)if(n.styles[u]===!0||n.styles[u]===1||e.lang.array(n.styles[u]).contains(h[1].replace(/\s/g,"").toLowerCase()))return!0}}if(n.attrs)for(f in n.attrs)if(n.attrs.hasOwnProperty(f)){l=e.dom.getAttribute(t,f);if(typeof l=="string"&&l.search(n.attrs[f])>-1)return!0}return!1}function m(e,t,n){var r,i;if(n&&n.keep_styles)for(r in n.keep_styles)if(n.keep_styles.hasOwnProperty(r)){i=r==="float"?e.style.styleFloat||e.style.cssFloat:e.style[r];if(n.keep_styles[r]instanceof RegExp&&!n.keep_styles[r].test(i))continue;r==="float"?t.style[e.style.styleFloat?"styleFloat":"cssFloat"]=i:e.style[r]&&(t.style[r]=i)}}function g(e,t){var n=[];for(var r in t)t.hasOwnProperty(r)&&r.indexOf(e)===0&&n.push(r);return n}function y(t,n,r,i){var s=e.lang.object(r).isFunction()?r:x[r],o;if(s){o=s(n,i);if(typeof o=="string")return o}return!1}function b(t,n){var r=e.lang.object(u.attributes||{}).clone(),i=e.lang.object(r).merge(e.lang.object(n||{}).clone()).get(),s={},o=e.dom.getAttributes(t),a,f,l;for(a in i)if(/\*$/.test(a)){l=g(a.slice(0,-1),o);for(var c=0,h=l.length;c<h;c++)f=y(l[c],o[l[c]],i[a],t.nodeName),f!==!1&&(s[l[c]]=f)}else f=y(a,o[a],i[a],t.nodeName),f!==!1&&(s[a]=f);return s}function w(t,n,r,i){var o={},a=r.set_class,f=r.add_class,l=r.add_style,c=r.set_attributes,h=u.classes,p=0,d=[],v=[],m=[],g=[],y,w,E,S,x,C;c&&(o=e.lang.object(c).clone()),o=e.lang.object(o).merge(b(t,r.check_attributes)).get(),a&&d.push(a);if(f)for(x in f){C=N[f[x]];if(!C)continue;S=C(e.dom.getAttribute(t,x)),typeof S=="string"&&d.push(S)}if(l)for(x in l){C=T[l[x]];if(!C)continue;newStyle=C(e.dom.getAttribute(t,x)),typeof newStyle=="string"&&v.push(newStyle)}if(typeof h=="string"&&h==="any")if(t.getAttribute("class"))if(u.classes_blacklist){g=t.getAttribute("class"),g&&(d=d.concat(g.split(s))),y=d.length;for(;p<y;p++)E=d[p],u.classes_blacklist[E]||m.push(E);m.length&&(o["class"]=e.lang.array(m).unique().join(" "))}else o["class"]=t.getAttribute("class");else o["class"]=e.lang.array(d).unique().join(" ");else{i||(h["_wysihtml5-temp-placeholder"]=1,h._rangySelectionBoundary=1,h["wysiwyg-tmp-selected-cell"]=1),g=t.getAttribute("class"),g&&(d=d.concat(g.split(s))),y=d.length;for(;p<y;p++)E=d[p],h[E]&&m.push(E);m.length&&(o["class"]=e.lang.array(m).unique().join(" "))}o["class"]&&i&&(o["class"]=o["class"].replace("wysiwyg-tmp-selected-cell",""),/^\s*$/g.test(o["class"])&&delete o["class"]),v.length&&(o.style=e.lang.array(v).unique().join(" "));for(x in o)try{n.setAttribute(x,o[x])}catch(k){}o.src&&(typeof o.width!="undefined"&&n.setAttribute("width",o.width),typeof o.height!="undefined"&&n.setAttribute("height",o.height))}function E(t){var n=t.nextSibling;if(!n||n.nodeType!==e.TEXT_NODE){var r=t.data.replace(e.INVISIBLE_SPACE_REG_EXP,"");return t.ownerDocument.createTextNode(r)}n.data=t.data.replace(e.INVISIBLE_SPACE_REG_EXP,"")+n.data.replace(e.INVISIBLE_SPACE_REG_EXP,"")}function S(e){if(u.comments)return e.ownerDocument.createComment(e.nodeValue)}var r={1:h,3:E,8:S},i="span",s=/\s+/,o={tags:{},classes:{}},u={},a=["ADDRESS","BLOCKQUOTE","CENTER","DIR","DIV","DL","FIELDSET","FORM","H1","H2","H3","H4","H5","H6","ISINDEX","MENU","NOFRAMES","NOSCRIPT","OL","P","PRE","TABLE","UL"],x={url:function(){var e=/^https?:\/\//i;return function(t){return!t||!t.match(e)?null:t.replace(e,function(e){return e.toLowerCase()})}}(),src:function(){var e=/^(\/|https?:\/\/)/i;return function(t){return!t||!t.match(e)?null:t.replace(e,function(e){return e.toLowerCase()})}}(),href:function(){var e=/^(#|\/|https?:\/\/|mailto:|tel:)/i;return function(t){return!t||!t.match(e)?null:t.replace(e,function(e){return e.toLowerCase()})}}(),alt:function(){var e=/[^ a-z0-9_\-]/gi;return function(t,n){return t?t.replace(e,""):n==="IMG"?"":null}}(),numbers:function(){var e=/\D/g;return function(t){return t=(t||"").replace(e,""),t||null}}(),dimension:function(){var e=/\D*(\d+)(\.\d+)?\s?(%)?\D*/;return function(t){return t=(t||"").replace(e,"$1$2$3"),t||null}}(),any:function(){return function(e){return e?e:null}}()},T={align_text:function(){var e={left:"text-align: left;",right:"text-align: right;",center:"text-align: center;"};return function(t){return e[String(t).toLowerCase()]}}()},N={align_img:function(){var e={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(t){return e[String(t).toLowerCase()]}}(),align_text:function(){var e={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(t){return e[String(t).toLowerCase()]}}(),clear_br:function(){var e={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(t){return e[String(t).toLowerCase()]}}(),size_font:function(){var e={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(t){return e[String(t).charAt(0)]}}()},C={has_visible_contet:function(){var e,t=!1,n=["img","video","picture","br","script","noscript","style","table","iframe","object","embed","audio","svg","input","button","select","textarea","canvas"];return function(t){e=(t.innerText||t.textContent).replace(/\s/g,"");if(e&&e.length>0)return!0;for(var r=n.length;r--;)if(t.querySelector(n[r]))return!0;return t.offsetWidth&&t.offsetWidth>0&&t.offsetHeight&&t.offsetHeight>0?!0:!1}}()},k={unwrap:function(t){e.dom.unwrap(t)},remove:function(e){e.parentNode.removeChild(e)}};return f(t,n)},e.dom.removeEmptyTextNodes=function(t){var n,r=e.lang.array(t.childNodes).get(),i=r.length,s=0;for(;s<i;s++)n=r[s],n.nodeType===e.TEXT_NODE&&/^[\n\r]*$/.test(n.data)&&n.parentNode.removeChild(n)},e.dom.renameElement=function(t,n){var r=t.ownerDocument.createElement(n),i;while(i=t.firstChild)r.appendChild(i);return e.dom.copyAttributes(["align","className"]).from(t).to(r),t.parentNode&&t.parentNode.replaceChild(r,t),r},e.dom.replaceWithChildNodes=function(e){if(!e.parentNode)return;if(!e.firstChild){e.parentNode.removeChild(e);return}var t=e.ownerDocument.createDocumentFragment();while(e.firstChild)t.appendChild(e.firstChild);e.parentNode.replaceChild(t,e),e=t=null},function(t){function n(e){return t.getStyle("display").from(e)==="block"}function r(e){return e.nodeName==="BR"}function i(e){var t=e.ownerDocument.createElement("br");e.appendChild(t)}function s(t,s){if(!t.nodeName.match(/^(MENU|UL|OL)$/))return;var o=t.ownerDocument,u=o.createDocumentFragment(),a=e.dom.domNode(t).prev({ignoreBlankTexts:!0}),f=e.dom.domNode(t).next({ignoreBlankTexts:!0}),l,c,h,p,d,v,m=t.lastElementChild||t.lastChild,g;if(s){a&&!n(a)&&!r(a)&&i(u);while(v=t.firstElementChild||t.firstChild){c=v.lastChild,g=v===m;while(l=v.firstChild)h=l===c,p=(!g||f&&!n(f))&&h&&!n(l)&&!r(l),u.appendChild(l),p&&i(u);v.parentNode.removeChild(v)}}else while(v=t.firstElementChild||t.firstChild){if(v.querySelector&&v.querySelector("div, p, ul, ol, menu, blockquote, h1, h2, h3, h4, h5, h6"))while(l=v.firstChild)u.appendChild(l);else{d=o.createElement("p");while(l=v.firstChild)d.appendChild(l);u.appendChild(d)}v.parentNode.removeChild(v)}t.parentNode.replaceChild(u,t)}t.resolveList=s}(e.dom),function(e){var n=document,r=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],i=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],s=["referrer","write","open","close"];e.dom.Sandbox=t.extend({constructor:function(t,n){this.callback=t||e.EMPTY_FUNCTION,this.config=e.lang.object({}).merge(n).get(),this.config.className||(this.config.className="wysihtml5-sandbox"),this.editableArea=this._createIframe()},insertInto:function(e){typeof e=="string"&&(e=n.getElementById(e)),e.appendChild(this.editableArea)},getIframe:function(){return this.editableArea},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var e=this.getIframe();e.parentNode.removeChild(e)},_readyError:function(){throw new Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var t=this,r=n.createElement("iframe");return r.className=this.config.className,e.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(r),e.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(r.src="javascript:'<html></html>'"),r.onload=function(){r.onreadystatechange=r.onload=null,t._onLoadIframe(r)},r.onreadystatechange=function(){/loaded|complete/.test(r.readyState)&&(r.onreadystatechange=r.onload=null,t._onLoadIframe(r))},r},_onLoadIframe:function(t){if(!e.dom.contains(n.documentElement,t))return;var o=this,u=t.contentWindow,a=t.contentWindow.document,f=n.characterSet||n.charset||"utf-8",l=this._getHtml({charset:f,stylesheets:this.config.stylesheets});a.open("text/html","replace"),a.write(l),a.close(),this.getWindow=function(){return t.contentWindow},this.getDocument=function(){return t.contentWindow.document},u.onerror=function(e,t,n){throw new Error("wysihtml5.Sandbox: "+e,t,n)};if(!e.browser.supportsSandboxedIframes()){var c,h;for(c=0,h=r.length;c<h;c++)this._unset(u,r[c]);for(c=0,h=i.length;c<h;c++)this._unset(u,i[c],e.EMPTY_FUNCTION);for(c=0,h=s.length;c<h;c++)this._unset(a,s[c]);this._unset(a,"cookie","",!0)}e.polyfills&&e.polyfills(u,a),this.loaded=!0,setTimeout(function(){o.callback(o)},0)},_getHtml:function(t){var n=t.stylesheets,r="",i=0,s;n=typeof n=="string"?[n]:n;if(n){s=n.length;for(;i<s;i++)r+='<link rel="stylesheet" href="'+n[i]+'">'}return t.stylesheets=r,e.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(t)},_unset:function(t,n,r,i){try{t[n]=r}catch(s){}try{t.__defineGetter__(n,function(){return r})}catch(s){}if(i)try{t.__defineSetter__(n,function(){})}catch(s){}if(!e.browser.crashesWhenDefineProperty(n))try{var o={get:function(){return r}};i&&(o.set=function(){}),Object.defineProperty(t,n,o)}catch(s){}}})}(e),function(e){var n=document;e.dom.ContentEditableArea=t.extend({getContentEditable:function(){return this.element},getWindow:function(){return this.element.ownerDocument.defaultView||this.element.ownerDocument.parentWindow},getDocument:function(){return this.element.ownerDocument},constructor:function(t,n,r){this.callback=t||e.EMPTY_FUNCTION,this.config=e.lang.object({}).merge(n).get(),this.config.className||(this.config.className="wysihtml5-sandbox"),r?this.element=this._bindElement(r):this.element=this._createElement()},destroy:function(){},_createElement:function(){var e=n.createElement("div");return e.className=this.config.className,this._loadElement(e),e},_bindElement:function(e){return e.className=e.className?e.className+" wysihtml5-sandbox":"wysihtml5-sandbox",this._loadElement(e,!0),e},_loadElement:function(e,t){var n=this;if(!t){var r=this._getHtml();e.innerHTML=r}this.loaded=!0,setTimeout(function(){n.callback(n)},0)},_getHtml:function(e){return""}})}(e),function(){var t={className:"class"};e.dom.setAttributes=function(e){return{on:function(n){for(var r in e)n.setAttribute(t[r]||r,e[r])}}}}(),e.dom.setStyles=function(e){return{on:function(t){var n=t.style;if(typeof e=="string"){n.cssText+=";"+e;return}for(var r in e)r==="float"?(n.cssFloat=e[r],n.styleFloat=e[r]):n[r]=e[r]}}},function(e){e.simulatePlaceholder=function(t,n,r,i){var s=i||"wysihtml5-placeholder",o=function(){var t=n.element.offsetWidth>0&&n.element.offsetHeight>0;n.hasPlaceholderSet()&&(n.clear(),n.element.focus(),t&&setTimeout(function(){var e=n.selection.getSelection();(!e.focusNode||!e.anchorNode)&&n.selection.selectNode(n.element.firstChild||n.element)},0)),n.placeholderSet=!1,e.removeClass(n.element,s)},u=function(){n.isEmpty()&&!n.placeholderSet&&(n.placeholderSet=!0,n.setValue(r,!1),e.addClass(n.element,s))};t.on("set_placeholder",u).on("unset_placeholder",o).on("focus:composer",o).on("paste:composer",o).on("blur:composer",u),u()}}(e.dom),function(e){var t=document.documentElement;"textContent"in t?(e.setTextContent=function(e,t){e.textContent=t},e.getTextContent=function(e){return e.textContent}):"innerText"in t?(e.setTextContent=function(e,t){e.innerText=t},e.getTextContent=function(e){return e.innerText}):(e.setTextContent=function(e,t){e.nodeValue=t},e.getTextContent=function(e){return e.nodeValue})}(e.dom),e.dom.getAttribute=function(t,n){var r=!e.browser.supportsGetAttributeCorrectly();n=n.toLowerCase();var i=t.nodeName;if(i=="IMG"&&n=="src"&&e.dom.isLoadedImage(t)===!0)return t.src;if(r&&"outerHTML"in t){var s=t.outerHTML.toLowerCase(),o=s.indexOf(" "+n+"=")!=-1;return o?t.getAttribute(n):null}return t.getAttribute(n)},e.dom.getAttributes=function(t){var n=!e.browser.supportsGetAttributeCorrectly(),r=t.nodeName,i=[],s;for(s in t.attributes)(t.attributes.hasOwnProperty&&t.attributes.hasOwnProperty(s)||!t.attributes.hasOwnProperty&&Object.prototype.hasOwnProperty.call(t.attributes,s))&&t.attributes[s].specified&&(r=="IMG"&&t.attributes[s].name.toLowerCase()=="src"&&e.dom.isLoadedImage(t)===!0?i.src=t.src:e.lang.array(["rowspan","colspan"]).contains(t.attributes[s].name.toLowerCase())&&n?t.attributes[s].value!==1&&(i[t.attributes[s].name]=t.attributes[s].value):i[t.attributes[s].name]=t.attributes[s].value);return i},e.dom.isLoadedImage=function(e){try{return e.complete&&!e.mozMatchesSelector(":-moz-broken")}catch(t){if(e.complete&&e.readyState==="complete")return!0}},function(e){function i(e,t){var n=[],r;for(var i=0,s=e.length;i<s;i++){r=e[i].querySelectorAll(t);if(r)for(var o=r.length;o--;n.unshift(r[o]));}return n}function s(e){e.parentNode.removeChild(e)}function o(e,t){e.parentNode.insertBefore(t,e.nextSibling)}function u(e,t){var n=e.nextSibling;while(n.nodeType!=1){n=n.nextSibling;if(!t||t==n.tagName.toLowerCase())return n}return null}var t=e.dom,n=function(e){this.el=e,this.isColspan=!1,this.isRowspan=!1,this.firstCol=!0,this.lastCol=!0,this.firstRow=!0,this.lastRow=!0,this.isReal=!0,this.spanCollection=[],this.modified=!1},r=function(e,n){e?(this.cell=e,this.table=t.getParentElement(e,{query:"table"})):n&&(this.table=n,this.cell=this.table.querySelectorAll("th, td")[0])};r.prototype={addSpannedCellToMap:function(e,t,r,i,s,o){var u=[],a=r+(o?parseInt(o,10)-1:0),f=i+(s?parseInt(s,10)-1:0);for(var l=r;l<=a;l++){typeof t[l]=="undefined"&&(t[l]=[]);for(var c=i;c<=f;c++)t[l][c]=new n(e),t[l][c].isColspan=s&&parseInt(s,10)>1,t[l][c].isRowspan=o&&parseInt(o,10)>1,t[l][c].firstCol=c==i,t[l][c].lastCol=c==f,t[l][c].firstRow=l==r,t[l][c].lastRow=l==a,t[l][c].isReal=c==i&&l==r,t[l][c].spanCollection=u,u.push(t[l][c])}},setCellAsModified:function(e){e.modified=!0;if(e.spanCollection.length>0)for(var t=0,n=e.spanCollection.length;t<n;t++)e.spanCollection[t].modified=!0},setTableMap:function(){var e=[],r=this.getTableRows(),i,s,o,u,a,f,l,c;for(i=0;i<r.length;i++){s=r[i],o=this.getRowCells(s),f=0,typeof e[i]=="undefined"&&(e[i]=[]);for(u=0;u<o.length;u++){a=o[u];while(typeof e[i][f]!="undefined")f++;l=t.getAttribute(a,"colspan"),c=t.getAttribute(a,"rowspan"),l||c?(this.addSpannedCellToMap(a,e,i,f,l,c),f+=l?parseInt(l,10):1):(e[i][f]=new n(a),f++)}}return this.map=e,e},getRowCells:function(t){var n=this.table.querySelectorAll("table"),r=n?i(n,"th, td"):[],s=t.querySelectorAll("th, td"),o=r.length>0?e.lang.array(s).without(r):s;return o},getTableRows:function(){var t=this.table.querySelectorAll("table"),n=t?i(t,"tr"):[],r=this.table.querySelectorAll("tr"),s=n.length>0?e.lang.array(r).without(n):r;return s},getMapIndex:function(e){var t=this.map.length,n=this.map&&this.map[0]?this.map[0].length:0;for(var r=0;r<t;r++)for(var i=0;i<n;i++)if(this.map[r][i].el===e)return{row:r,col:i};return!1},getElementAtIndex:function(e){return this.setTableMap(),this.map[e.row]&&this.map[e.row][e.col]&&this.map[e.row][e.col].el?this.map[e.row][e.col].el:null},getMapElsTo:function(e){var t=[];this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(e);if(this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var n=this.idx_start;this.idx_start=this.idx_end,this.idx_end=n}if(this.idx_start.col>this.idx_end.col){var r=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=r}if(this.idx_start!=null&&this.idx_end!=null)for(var i=this.idx_start.row,s=this.idx_end.row;i<=s;i++)for(var o=this.idx_start.col,u=this.idx_end.col;o<=u;o++)t.push(this.map[i][o].el);return t},orderSelectionEnds:function(e){this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(e);if(this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var t=this.idx_start;this.idx_start=this.idx_end,this.idx_end=t}if(this.idx_start.col>this.idx_end.col){var n=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=n}return{start:this.map[this.idx_start.row][this.idx_start.col].el,end:this.map[this.idx_end.row][this.idx_end.col].el}},createCells:function(e,t,n){var r=this.table.ownerDocument,i=r.createDocumentFragment(),s;for(var o=0;o<t;o++){s=r.createElement(e);if(n)for(var u in n)n.hasOwnProperty(u)&&s.setAttribute(u,n[u]);s.appendChild(document.createTextNode(" ")),i.appendChild(s)}return i},correctColIndexForUnreals:function(e,t){var n=this.map[t],r=-1;for(var i=0,s=e;i<e;i++)n[i].isReal&&r++;return r},getLastNewCellOnRow:function(e,t){var n=this.getRowCells(e),r,i;for(var s=0,o=n.length;s<o;s++){r=n[s],i=this.getMapIndex(r);if(i===!1||typeof t!="undefined"&&i.row!=t)return r}return null},removeEmptyTable:function(){var e=this.table.querySelectorAll("td, th");return!e||e.length==0?(s(this.table),!0):!1},splitRowToCells:function(e){if(e.isColspan){var n=parseInt(t.getAttribute(e.el,"colspan")||1,10),r=e.el.tagName.toLowerCase();if(n>1){var i=this.createCells(r,n-1);o(e.el,i)}e.el.removeAttribute("colspan")}},getRealRowEl:function(e,n){var r=null,i=null;n=n||this.idx;for(var s=0,o=this.map[n.row].length;s<o;s++){i=this.map[n.row][s];if(i.isReal){r=t.getParentElement(i.el,{query:"tr"});if(r)return r}}return r===null&&e&&(r=t.getParentElement(this.map[n.row][n.col].el,{query:"tr"})||null),r},injectRowAt:function(e,n,r,i,s){var u=this.getRealRowEl(!1,{row:e,col:n}),a=this.createCells(i,r);if(u){var f=this.correctColIndexForUnreals(n,e);f>=0?o(this.getRowCells(u)[f],a):u.insertBefore(a,u.firstChild)}else{var l=this.table.ownerDocument.createElement("tr");l.appendChild(a),o(t.getParentElement(s.el,{query:"tr"}),l)}},canMerge:function(e){this.to=e,this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(this.to);if(this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var t=this.idx_start;this.idx_start=this.idx_end,this.idx_end=t}if(this.idx_start.col>this.idx_end.col){var n=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=n}for(var r=this.idx_start.row,i=this.idx_end.row;r<=i;r++)for(var s=this.idx_start.col,o=this.idx_end.col;s<=o;s++)if(this.map[r][s].isColspan||this.map[r][s].isRowspan)return!1;return!0},decreaseCellSpan:function(e,n){var r=parseInt(t.getAttribute(e.el,n),10)-1;r>=1?e.el.setAttribute(n,r):(e.el.removeAttribute(n),n=="colspan"&&(e.isColspan=!1),n=="rowspan"&&(e.isRowspan=!1),e.firstCol=!0,e.lastCol=!0,e.firstRow=!0,e.lastRow=!0,e.isReal=!0)},removeSurplusLines:function(){var e,n,r,i,o,u,a;this.setTableMap();if(this.map){r=0,i=this.map.length;for(;r<i;r++){e=this.map[r],a=!0,o=0,u=e.length;for(;o<u;o++){n=e[o];if(!(t.getAttribute(n.el,"rowspan")&&parseInt(t.getAttribute(n.el,"rowspan"),10)>1&&n.firstRow!==!0)){a=!1;break}}if(a){o=0;for(;o<u;o++)this.decreaseCellSpan(e[o],"rowspan")}}var f=this.getTableRows();r=0,i=f.length;for(;r<i;r++)e=f[r],e.childNodes.length==0&&/^\s*$/.test(e.textContent||e.innerText)&&s(e)}},fillMissingCells:function(){var e=0,t=0,r=null;this.setTableMap();if(this.map){e=this.map.length;for(var i=0;i<e;i++)this.map[i].length>t&&(t=this.map[i].length);for(var s=0;s<e;s++)for(var u=0;u<t;u++)this.map[s]&&!this.map[s][u]&&u>0&&(this.map[s][u]=new n(this.createCells("td",1)),r=this.map[s][u-1],r&&r.el&&r.el.parent&&o(this.map[s][u-1].el,this.map[s][u].el))}},rectify:function(){return this.removeEmptyTable()?!1:(this.removeSurplusLines(),this.fillMissingCells(),!0)},unmerge:function(){if(this.rectify()){this.setTableMap(),this.idx=this.getMapIndex(this.cell);if(this.idx){var e=this.map[this.idx.row][this.idx.col],n=t.getAttribute(e.el,"colspan")?parseInt(t.getAttribute(e.el,"colspan"),10):1,r=e.el.tagName.toLowerCase();if(e.isRowspan){var i=parseInt(t.getAttribute(e.el,"rowspan"),10);if(i>1)for(var s=1,o=i-1;s<=o;s++)this.injectRowAt(this.idx.row+s,this.idx.col,n,r,e);e.el.removeAttribute("rowspan")}this.splitRowToCells(e)}}},merge:function(e){if(this.rectify())if(this.canMerge(e)){var t=this.idx_end.row-this.idx_start.row+1,n=this.idx_end.col-this.idx_start.col+1;for(var r=this.idx_start.row,i=this.idx_end.row;r<=i;r++)for(var o=this.idx_start.col,u=this.idx_end.col;o<=u;o++)r==this.idx_start.row&&o==this.idx_start.col?(t>1&&this.map[r][o].el.setAttribute("rowspan",t),n>1&&this.map[r][o].el.setAttribute("colspan",n)):(/^\s*<br\/?>\s*$/.test(this.map[r][o].el.innerHTML.toLowerCase())||(this.map[this.idx_start.row][this.idx_start.col].el.innerHTML+=" "+this.map[r][o].el.innerHTML),s(this.map[r][o].el));this.rectify()}else window.console&&console.log("Do not know how to merge allready merged cells.")},collapseCellToNextRow:function(e){var n=this.getMapIndex(e.el),r=n.row+1,i={row:r,col:n.col};if(r<this.map.length){var s=this.getRealRowEl(!1,i);if(s!==null){var u=this.correctColIndexForUnreals(i.col,i.row);if(u>=0)o(this.getRowCells(s)[u],e.el);else{var a=this.getLastNewCellOnRow(s,r);a!==null?o(a,e.el):s.insertBefore(e.el,s.firstChild)}parseInt(t.getAttribute(e.el,"rowspan"),10)>2?e.el.setAttribute("rowspan",parseInt(t.getAttribute(e.el,"rowspan"),10)-1):e.el.removeAttribute("rowspan")}}},removeRowCell:function(e){e.isReal?e.isRowspan?this.collapseCellToNextRow(e):s(e.el):parseInt(t.getAttribute(e.el,"rowspan"),10)>2?e.el.setAttribute("rowspan",parseInt(t.getAttribute(e.el,"rowspan"),10)-1):e.el.removeAttribute("rowspan")},getRowElementsByCell:function(){var e=[];this.setTableMap(),this.idx=this.getMapIndex(this.cell);if(this.idx!==!1){var t=this.map[this.idx.row];for(var n=0,r=t.length;n<r;n++)t[n].isReal&&e.push(t[n].el)}return e},getColumnElementsByCell:function(){var e=[];this.setTableMap(),this.idx=this.getMapIndex(this.cell);if(this.idx!==!1)for(var t=0,n=this.map.length;t<n;t++)this.map[t][this.idx.col]&&this.map[t][this.idx.col].isReal&&e.push(this.map[t][this.idx.col].el);return e},removeRow:function(){var e=t.getParentElement(this.cell,{query:"tr"});if(e){this.setTableMap(),this.idx=this.getMapIndex(this.cell);if(this.idx!==!1){var n=this.map[this.idx.row];for(var r=0,i=n.length;r<i;r++)n[r].modified||(this.setCellAsModified(n[r]),this.removeRowCell(n[r]))}s(e)}},removeColCell:function(e){e.isColspan?parseInt(t.getAttribute(e.el,"colspan"),10)>2?e.el.setAttribute("colspan",parseInt(t.getAttribute(e.el,"colspan"),10)-1):e.el.removeAttribute("colspan"):e.isReal&&s(e.el)},removeColumn:function(){this.setTableMap(),this.idx=this.getMapIndex(this.cell);if(this.idx!==!1)for(var e=0,t=this.map.length;e<t;e++)this.map[e][this.idx.col].modified||(this.setCellAsModified(this.map[e][this.idx.col]),this.removeColCell(this.map[e][this.idx.col]))},remove:function(e){if(this.rectify()){switch(e){case"row":this.removeRow();break;case"column":this.removeColumn()}this.rectify()}},addRow:function(e){var n=this.table.ownerDocument;this.setTableMap(),this.idx=this.getMapIndex(this.cell),e=="below"&&t.getAttribute(this.cell,"rowspan")&&(this.idx.row=this.idx.row+parseInt(t.getAttribute(this.cell,"rowspan"),10)-1);if(this.idx!==!1){var r=this.map[this.idx.row],i=n.createElement("tr");for(var s=0,u=r.length;s<u;s++)r[s].modified||(this.setCellAsModified(r[s]),this.addRowCell(r[s],i,e));switch(e){case"below":o(this.getRealRowEl(!0),i);break;case"above":var a=t.getParentElement(this.map[this.idx.row][this.idx.col].el,{query:"tr"});a&&a.parentNode.insertBefore(i,a)}}},addRowCell:function(e,n,r){var i=e.isColspan?{colspan:t.getAttribute(e.el,"colspan")}:null;e.isReal?r!="above"&&e.isRowspan?e.el.setAttribute("rowspan",parseInt(t.getAttribute(e.el,"rowspan"),10)+1):n.appendChild(this.createCells("td",1,i)):r!="above"&&e.isRowspan&&e.lastRow?n.appendChild(this.createCells("td",1,i)):c.isRowspan&&e.el.attr("rowspan",parseInt(t.getAttribute(e.el,"rowspan"),10)+1)},add:function(e){this.rectify()&&((e=="below"||e=="above")&&this.addRow(e),(e=="before"||e=="after")&&this.addColumn(e))},addColCell:function(e,n,r){var i,s=e.el.tagName.toLowerCase();switch(r){case"before":i=!e.isColspan||e.firstCol;break;case"after":i=!e.isColspan||e.lastCol||e.isColspan&&c.el==this.cell}if(i){switch(r){case"before":e.el.parentNode.insertBefore(this.createCells(s,1),e.el);break;case"after":o(e.el,this.createCells(s,1))}e.isRowspan&&this.handleCellAddWithRowspan(e,n+1,r)}else e.el.setAttribute("colspan",parseInt(t.getAttribute(e.el,"colspan"),10)+1)},addColumn:function(e){var n,r;this.setTableMap(),this.idx=this.getMapIndex(this.cell),e=="after"&&t.getAttribute(this.cell,"colspan")&&(this.idx.col=this.idx.col+parseInt(t.getAttribute(this.cell,"colspan"),10)-1);if(this.idx!==!1)for(var i=0,s=this.map.length;i<s;i++)n=this.map[i],n[this.idx.col]&&(r=n[this.idx.col],r.modified||(this.setCellAsModified(r),this.addColCell(r,i,e)))},handleCellAddWithRowspan:function(e,n,r){var i=parseInt(t.getAttribute(this.cell,"rowspan"),10)-1,s=t.getParentElement(e.el,{query:"tr"}),a=e.el.tagName.toLowerCase(),f,l,c=this.table.ownerDocument,h;for(var p=0;p<i;p++){f=this.correctColIndexForUnreals(this.idx.col,n+p),s=u(s,"tr");if(s)if(f>0)switch(r){case"before":l=this.getRowCells(s),f>0&&this.map[n+p][this.idx.col].el!=l[f]&&f==l.length-1?o(l[f],this.createCells(a,1)):l[f].parentNode.insertBefore(this.createCells(a,1),l[f]);break;case"after":o(this.getRowCells(s)[f],this.createCells(a,1))}else s.insertBefore(this.createCells(a,1),s.firstChild);else h=c.createElement("tr"),h.appendChild(this.createCells(a,1)),this.table.appendChild(h)}}},t.table={getCellsBetween:function(e,t){var n=new r(e);return n.getMapElsTo(t)},addCells:function(e,t){var n=new r(e);n.add(t)},removeCells:function(e,t){var n=new r(e);n.remove(t)},mergeCellsBetween:function(e,t){var n=new r(e);n.merge(t)},unmergeCell:function(e){var t=new r(e);t.unmerge()},orderSelectionEnds:function(e,t){var n=new r(e);return n.orderSelectionEnds(t)},indexOf:function(e){var t=new r(e);return t.setTableMap(),t.getMapIndex(e)},findCell:function(e,t){var n=new r(null,e);return n.getElementAtIndex(t)},findRowByCell:function(e){var t=new r(e);return t.getRowElementsByCell()},findColumnByCell:function(e){var t=new r(e);return t.getColumnElementsByCell()},canMerge:function(e,t){var n=new r(e);return n.canMerge(t)}}}(e),e.dom.query=function(e,t){var n=[],r;e.nodeType&&(e=[e]);for(var i=0,s=e.length;i<s;i++){r=e[i].querySelectorAll(t);if(r)for(var o=r.length;o--;n.unshift(r[o]));}return n},e.dom.compareDocumentPosition=function(){var t=document.documentElement;return t.compareDocumentPosition?function(e,t){return e.compareDocumentPosition(t)}:function(t,n){var r,i;t.nodeType===9?r=t:r=t.ownerDocument,n.nodeType===9?i=n:i=n.ownerDocument;if(t===n)return 0;if(t===n.ownerDocument)return 20;if(t.ownerDocument===n)return 10;if(r!==i)return 1;if(t.nodeType===2&&t.childNodes&&e.lang.array(t.childNodes).indexOf(n)!==-1)return 20;if(n.nodeType===2&&n.childNodes&&e.lang.array(n.childNodes).indexOf(t)!==-1)return 10;var s=t,o=[],u=null;while(s){if(s==n)return 10;o.push(s),s=s.parentNode}s=n,u=null;while(s){if(s==t)return 20;var a=e.lang.array(o).indexOf(s);if(a!==-1){var f=o[a],l=e.lang.array(f.childNodes).indexOf(o[a-1]),c=e.lang.array(f.childNodes).indexOf(u);return l>c?2:4}u=s,s=s.parentNode}return 1}}(),e.dom.unwrap=function(t){var n=[];if(t.parentNode){while(t.lastChild)n.unshift(t.lastChild),e.dom.insert(t.lastChild).after(t);t.parentNode.removeChild(t)}return n},e.dom.getPastedHtml=function(t){var n;return e.browser.supportsModernPaste()&&t.clipboardData&&(e.lang.array(t.clipboardData.types).contains("text/html")?n=t.clipboardData.getData("text/html"):e.lang.array(t.clipboardData.types).contains("text/plain")&&(n=e.lang.string(t.clipboardData.getData("text/plain")).escapeHTML(!0,!0))),n},e.dom.getPastedHtmlWithDiv=function(e,t){var n=e.selection.getBookmark(),r=e.element.ownerDocument,i=r.createElement("DIV"),s=e.getScrollPos();r.body.appendChild(i),i.style.width="1px",i.style.height="1px",i.style.overflow="hidden",i.style.position="absolute",i.style.top=s.y+"px",i.style.left=s.x+"px",i.setAttribute("contenteditable","true"),i.focus(),setTimeout(function(){var r;e.selection.setBookmark(n),r=i.innerHTML,r&&/^<br\/?>$/i.test(r.trim())&&(r=!1),t(r),i.parentNode.removeChild(i)},0)},e.dom.removeInvisibleSpaces=function(t){var n=e.dom.getTextNodes(t);for(var r=n.length;r--;)n[r].nodeValue=n[r].nodeValue.replace(e.INVISIBLE_SPACE_REG_EXP,"")},e.quirks.cleanPastedHTML=function(){var t=function(t){var n=e.lang.string(t).trim(),r=n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");return new RegExp("^((?!^"+r+"$).)*$","i")},n=function(n,r){var i=e.lang.object(n).clone(!0),s,o;for(s in i.tags)if(i.tags.hasOwnProperty(s)&&i.tags[s].keep_styles)for(o in i.tags[s].keep_styles)i.tags[s].keep_styles.hasOwnProperty(o)&&r[o]&&(i.tags[s].keep_styles[o]=t(r[o]));return i},r=function(e,t){var n,r;if(!e)return null;for(var i=0,s=e.length;i<s;i++){e[i].condition||(r=e[i].set);if(e[i].condition&&e[i].condition.test(t))return e[i].set}return r};return function(t,i){var s={color:e.dom.getStyle("color").from(i.referenceNode),fontSize:e.dom.getStyle("font-size").from(i.referenceNode)},o=n(r(i.rules,t)||{},s),u;return u=e.dom.parse(t,{rules:o,cleanUp:!0,context:i.referenceNode.ownerDocument,uneditableClass:i.uneditableClass,clearInternals:!0,unjoinNbsps:!0}),u}}(),e.quirks.ensureProperClearing=function(){var t=function(){var e=this;setTimeout(function(){var t=e.innerHTML.toLowerCase();if(t=="<p>&nbsp;</p>"||t=="<p>&nbsp;</p><p>&nbsp;</p>")e.innerHTML=""},0)};return function(n){e.dom.observe(n.element,["cut","keydown"],t)}}(),function(e){var t="%7E";e.quirks.getCorrectInnerHTML=function(n){var r=n.innerHTML;if(r.indexOf(t)===-1)return r;var i=n.querySelectorAll("[href*='~'], [src*='~']"),s,o,u,a;for(a=0,u=i.length;a<u;a++)s=i[a].href||i[a].src,o=e.lang.string(s).replace("~").by(t),r=e.lang.string(r).replace(o).by(s);return r}}(e),function(e){var t="wysihtml5-quirks-redraw";e.quirks.redraw=function(n){e.dom.addClass(n,t),e.dom.removeClass(n,t);try{var r=n.ownerDocument;r.execCommand("italic",!1,null),r.execCommand("italic",!1,null)}catch(i){}}}(e),e.quirks.tableCellsSelection=function(t,n){function o(){return t.addEventListener("mousedown",u),i}function a(e){i.start=e,i.end=e,i.cells=[e],i.table=r.getParentElement(i.start,{query:"table"},!1,t),i.table&&(f(),r.addClass(e,s),t.addEventListener("mousemove",c),t.addEventListener("mouseup",h),n.fire("tableselectstart").fire("tableselectstart:composer"))}function f(){if(t){var e=t.querySelectorAll("."+s);if(e.length>0)for(var n=0;n<e.length;n++)r.removeClass(e[n],s)}}function l(e){for(var t=0;t<e.length;t++)r.addClass(e[t],s)}function c(e){var s=null,o=r.getParentElement(e.target,{query:"td, th"},!1,t),u;o&&i.table&&i.start&&(s=r.getParentElement(o,{query:"table"},!1,t),s&&s===i.table&&(f(),u=i.end,i.end=o,i.cells=r.table.getCellsBetween(i.start,o),i.cells.length>1&&n.composer.selection.deselect(),l(i.cells),i.end!==u&&n.fire("tableselectchange").fire("tableselectchange:composer")))}function h(e){t.removeEventListener("mousemove",c),t.removeEventListener("mouseup",h),n.fire("tableselect").fire("tableselect:composer"),setTimeout(function(){d()},0)}function d(){t.ownerDocument.addEventListener("click",p)}function v(e,s){i.start=e,i.end=s,i.table=r.getParentElement(i.start,{query:"table"},!1,t),selectedCells=r.table.getCellsBetween(i.start,i.end),l(selectedCells),d(),n.fire("tableselect").fire("tableselect:composer")}var r=e.dom,i={table:null,start:null,end:null,cells:null,select:v},s="wysiwyg-tmp-selected-cell",u=function(n){var r=e.dom.getParentElement(n.target,{query:"td, th"},!1,t);r&&a(r)},p=function(e){t.ownerDocument.removeEventListener("click",p),r.getParentElement(e.target,{query:"table"},false,t)!=i.table&&(f(),i.table=null,i.start=null,i.end=null,n.fire("tableunselect").fire("tableunselect:composer"))};return o()},function(e){function r(e){var n,r;for(n in t){if(!t.hasOwnProperty(n))continue;r=t[n];if(r.regex.test(e))return r}}function i(e){var t=r(e);return t?t.name:undefined}var t={rgba:{regex:/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d\.]+)\s*\)/i,name:"rgba"},rgb:{regex:/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i,name:"rgb"},hex6:{regex:/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i,name:"hex",radix:16},hex3:{regex:/^#([0-9a-f])([0-9a-f])([0-9a-f])/i,name:"hex",radix:16}},n=function(e){return new RegExp("(^|\\s|;)"+e+"\\s*:\\s*[^;$]+","gi")};e.quirks.styleParser={getColorParseMethod:r,getColorFormat:i,parseColor:function(i,s){var o,u,a,f,l,c=i;if(s){o=n(s);if(!(u=i.match(o)))return!1;u=u.pop().split(":")[1],c=e.lang.string(u).trim()}return(a=r(c))?(f=c.match(a.regex))?(l=a.radix||10,a===t.hex3?(f.shift(),f.push(1),e.lang.array(f).map(function(e,t){return t<3?parseInt(e,l)*l+parseInt(e,l):parseFloat(e)})):(f.shift(),f[3]||f.push(1),e.lang.array(f).map(function(e,t){return t<3?parseInt(e,l):parseFloat(e)}))):!1:!1},unparseColor:function(e,t){var n=16;return t==="hex"?(e[0].toString(n)+e[1].toString(n)+e[2].toString(n)).toUpperCase():t==="hash"?"#"+(e[0].toString(n)+e[1].toString(n)+e[2].toString(n)).toUpperCase():t==="rgb"?"rgb("+e[0]+","+e[1]+","+e[2]+")":t==="rgba"?"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")":t==="csv"?e[0]+","+e[1]+","+e[2]+","+e[3]:e[3]&&e[3]!==1?"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")":"rgb("+e[0]+","+e[1]+","+e[2]+")"},parseFontSize:function(t){var r=t.match(n("font-size"));return r?e.lang.string(r[r.length-1].split(":")[1]).trim():!1}}}(e),function(e){function r(e){var t=0;if(e.parentNode)do t+=e.offsetTop||0,e=e.offsetParent;while(e);return t}function i(e,t){var n=0;while(t!==e){n++,t=t.parentNode;if(!t)throw new Error("not a descendant of ancestor!")}return n}function s(t){var n=document.createElement("span"),r=function(e){var s;t.removeEventListener("mouseup",r),t.removeEventListener("keydown",r),t.removeEventListener("touchstart",r),t.removeEventListener("focus",r),t.removeEventListener("blur",r),t.removeEventListener("paste",i),t.removeEventListener("drop",i),t.removeEventListener("beforepaste",i),n&&n.parentNode&&n.parentNode.removeChild(n)},i=function(e){n&&n.parentNode&&setTimeout(r,0)};return n.appendChild(document.createTextNode(e.INVISIBLE_SPACE)),n.className="_wysihtml5-temp-caret-fix",n.style.display="block",n.style.minWidth="1px",n.style.height="0px",t.addEventListener("mouseup",r),t.addEventListener("keydown",r),t.addEventListener("touchstart",r),t.addEventListener("focus",r),t.addEventListener("blur",r),t.addEventListener("paste",i),t.addEventListener("drop",i),t.addEventListener("beforepaste",i),n}function o(e){if(e.canSurroundContents())return;var t=e.commonAncestorContainer,n=i(t,e.startContainer),r=i(t,e.endContainer);while(!e.canSurroundContents())n>r?(e.setStartBefore(e.startContainer),n=i(t,e.startContainer)):(e.setEndAfter(e.endContainer),r=i(t,e.endContainer))}var n=e.dom;e.Selection=t.extend({constructor:function(e,t,n){window.rangy.init(),this.editor=e,this.composer=e.composer,this.doc=this.composer.doc,this.win=this.composer.win,this.contain=t,this.unselectableClass=n||!1},getBookmark:function(){var e=this.getRange();return e&&e.cloneRange()},setBookmark:function(e){if(!e)return;this.setSelection(e)},setBefore:function(e){var t=rangy.createRange(this.doc);return t.setStartBefore(e),t.setEndBefore(e),this.setSelection(t)},createTemporaryCaretSpaceAfter:function(t){var n=this.doc.createElement("span"),r=this.doc.createTextNode(e.INVISIBLE_SPACE),i=function(t){var r;this.contain.removeEventListener("mouseup",i),this.contain.removeEventListener("keydown",o),this.contain.removeEventListener("touchstart",i),this.contain.removeEventListener("focus",i),this.contain.removeEventListener("blur",i),this.contain.removeEventListener("paste",s),this.contain.removeEventListener("drop",s),this.contain.removeEventListener("beforepaste",s),n&&n.parentNode&&(n.innerHTML=n.innerHTML.replace(e.INVISIBLE_SPACE_REG_EXP,""),/[^\s]+/.test(n.innerHTML)?(r=n.lastChild,e.dom.unwrap(n),this.setAfter(r)):n.parentNode.removeChild(n))}.bind(this),s=function(e){n&&n.parentNode&&setTimeout(i,0)},o=function(e){e.which!==8&&e.which!==91&&e.which!==17&&(e.which!==86||!e.ctrlKey&&!e.metaKey)&&i()};return n.className="_wysihtml5-temp-caret-fix",n.style.position="absolute",n.style.display="block",n.style.minWidth="1px",n.style.zIndex="99999",n.appendChild(r),t.parentNode.insertBefore(n,t.nextSibling),this.setBefore(r),this.contain.addEventListener("mouseup",i),this.contain.addEventListener("keydown",o),this.contain.addEventListener("touchstart",i),this.contain.addEventListener("focus",i),this.contain.addEventListener("blur",i),this.contain.addEventListener("paste",s),this.contain.addEventListener("drop",s),this.contain.addEventListener("beforepaste",s),n},setAfter:function(t,n,r){var i=this.win,s=rangy.createRange(this.doc),o=function(){var r=t.parentNode,s=r?r.childNodes[r.childNodes.length-1]:null;if(!u||s===t&&t.nodeType===1&&i.getComputedStyle(t).display==="block")if(n){var o=this.doc.createTextNode(e.INVISIBLE_SPACE);t.parentNode.insertBefore(o,t.nextSibling),this.selectNode(o),setTimeout(function(){o&&o.parentNode&&o.parentNode.removeChild(o)},0)}else this.createTemporaryCaretSpaceAfter(t)}.bind(this),u;s.setStartAfter(t),s.setEndAfter(t);if(!document.activeElement||document.activeElement!==this.composer.element){var a=this.composer.getScrollPos();this.composer.element.focus(),this.composer.setScrollPos(a),setTimeout(function(){u=this.setSelection(s),o(),r&&r(u)}.bind(this),0)}else u=this.setSelection(s),o(),r&&r(u)},selectNode:function(t,r){var i=rangy.createRange(this.doc),s=t.nodeType===e.ELEMENT_NODE,o="canHaveHTML"in t?t.canHaveHTML:t.nodeName!=="IMG",u=s?t.innerHTML:t.data,a=u===""||u===e.INVISIBLE_SPACE,f=n.getStyle("display").from(t),l=f==="block"||f==="list-item";if(a&&s&&o&&!r)try{t.innerHTML=e.INVISIBLE_SPACE}catch(c){}o?i.selectNodeContents(t):i.selectNode(t),o&&a&&s?i.collapse(l):o&&a&&(i.setStartAfter(t),i.setEndAfter(t)),this.setSelection(i)},getSelectedNode:function(e){var t,n;if(e&&this.doc.selection&&this.doc.selection.type==="Control"){n=this.doc.selection.createRange();if(n&&n.length)return n.item(0)}return t=this.getSelection(this.doc),t.focusNode===t.anchorNode?t.focusNode:(n=this.getRange(this.doc),n?n.commonAncestorContainer:this.doc.body)},fixSelBorders:function(){var e=this.getRange();o(e),this.setSelection(e)},getSelectedOwnNodes:function(e){var t,n=this.getOwnRanges(),r=[];for(var i=0,s=n.length;i<s;i++)r.push(n[i].commonAncestorContainer||this.doc.body);return r},findNodesInSelection:function(t){var n=this.getOwnRanges(),r=[],i;for(var s=0,o=n.length;s<o;s++)i=n[s].getNodes([1],function(n){return e.lang.array(t).contains(n.nodeName)}),r=r.concat(i);return r},filterElements:function(e){var t=this.getOwnRanges(),n=[],r;for(var i=0,s=t.length;i<s;i++)r=t[i].getNodes([1],function(n){return e(n,t[i])}),n=n.concat(r);return n},containsUneditable:function(){var e=this.getOwnUneditables(),t=this.getSelection();for(var n=0,r=e.length;n<r;n++)if(t.containsNode(e[n]))return!0;return!1},deleteContents:function(){var e=this.getRange();this.deleteRangeContents(e),this.setSelection(e)},deleteRangeContents:function(t){var n,r,i,s;if(this.unselectableClass){(n=e.dom.getParentElement(t.startContainer,{query:"."+this.unselectableClass},!1,this.contain))&&t.setStartBefore(n),(r=e.dom.getParentElement(t.endContainer,{query:"."+this.unselectableClass},!1,this.contain))&&t.setEndAfter(r),i=t.getNodes([1],function(t){return e.dom.hasClass(t,this.unselectableClass)}.bind(this));for(var o=i.length;o--;)try{s=new CustomEvent("wysihtml5:uneditable:delete"),i[o].dispatchEvent(s)}catch(u){}}t.deleteContents()},getPreviousNode:function(t,n){var r;if(!t){var i=this.getSelection();t=i.anchorNode}if(t===this.contain)return!1;var s=t.previousSibling,o;return s===this.contain?!1:(s&&s.nodeType!==3&&s.nodeType!==1?s=this.getPreviousNode(s,n):s&&s.nodeType===3&&/^\s*$/.test(s.textContent)?s=this.getPreviousNode(s,n):n&&s&&s.nodeType===1?(r=e.dom.getStyle("display").from(s),!e.lang.array(["BR","HR","IMG"]).contains(s.nodeName)&&!e.lang.array(["block","inline-block","flex","list-item","table"]).contains(r)&&/^[\s]*$/.test(s.innerHTML)&&(s=this.getPreviousNode(s,n))):!s&&t!==this.contain&&(o=t.parentNode,o!==this.contain&&(s=this.getPreviousNode(o,n))),s!==this.contain?s:!1)},getSelectionParentsByTag:function(t){var n=this.getSelectedOwnNodes(),r,i=[];for(var s=0,o=n.length;s<o;s++)r=n[s].nodeName&&n[s].nodeName==="LI"?n[s]:e.dom.getParentElement(n[s],{query:"li"},!1,this.contain),r&&i.push(r);return i.length?i:null},getRangeToNodeEnd:function(){if(this.isCollapsed()){var e=this.getRange(),t=e.startContainer,n=e.startOffset,r=rangy.createRange(this.doc);return r.selectNodeContents(t),r.setStart(t,n),r}},caretIsLastInSelection:function(){var e=rangy.createRange(this.doc),t=this.getSelection(),n=this.getRangeToNodeEnd().cloneContents(),r=n.textContent;return/^\s*$/.test(r)},caretIsFirstInSelection:function(){var t=rangy.createRange(this.doc),n=this.getSelection(),r=this.getRange(),i=r.startContainer;if(i)return i.nodeType===e.TEXT_NODE?this.isCollapsed()&&i.nodeType===e.TEXT_NODE&&/^\s*$/.test(i.data.substr(0,r.startOffset)):(t.selectNodeContents(this.getRange().commonAncestorContainer),t.collapse(!0),this.isCollapsed()&&(t.startContainer===n.anchorNode||t.endContainer===n.anchorNode)&&t.startOffset===n.anchorOffset)},caretIsInTheBeginnig:function(t){var n=this.getSelection(),r=n.anchorNode,i=n.anchorOffset;if(t&&r)return i===0&&(r.nodeName&&r.nodeName===t.toUpperCase()||e.dom.getParentElement(r.parentNode,{query:t},1));if(r)return i===0&&!this.getPreviousNode(r,!0)},getBeforeSelection:function(t){var n=this.getSelection(),r=n.isBackwards()?n.focusNode:n.anchorNode,i=n.isBackwards()?n.focusOffset:n.anchorOffset,s=this.createRange(),o,u;u=e.dom.getParentElement(r,{query:"._wysihtml5-temp-caret-fix"},1),u&&(r=u.parentNode,i=Array.prototype.indexOf.call(r.childNodes,u));if(r){if(i>0)return r.nodeType===3?(s.setStart(r,0),s.setEnd(r,i),{type:"text",range:s,offset:i,node:r}):(s.setStartBefore(r.childNodes[0]),o=r.childNodes[i-1],s.setEndAfter(o),{type:"element",range:s,offset:i,node:o});s.setStartAndEnd(r,0);if(t){var a=this.getPreviousNode(r,!0),f=null;a&&(a.nodeType===1&&e.dom.hasClass(a,this.unselectableClass)?f=a:f=e.dom.domNode(a).lastLeafNode());if(f)return{type:"leafnode",range:s,offset:i,node:f}}return{type:"none",range:s,offset:i,node:r}}return null},executeAndRestoreRangy:function(e,t){var n=rangy.saveSelection(this.win);if(!n)e();else try{e()}catch(r){setTimeout(function(){throw r},0)}rangy.restoreSelection(n)},executeAndRestore:function(t,r){var i=this.doc.body,s=r&&i.scrollTop,o=r&&i.scrollLeft,u="_wysihtml5-temp-placeholder",a='<span class="'+u+'">'+e.INVISIBLE_SPACE+"</span>",f=this.getRange(!0),l,c,h,p,d,v,m,g;if(!f){t(i,i);return}f.collapsed||(m=f.cloneRange(),v=m.createContextualFragment(a),m.collapse(!1),m.insertNode(v),m.detach()),d=f.createContextualFragment(a),f.insertNode(d),v&&(l=this.contain.querySelectorAll("."+u),f.setStartBefore(l[0]),f.setEndAfter(l[l.length-1])),this.setSelection(f);try{t(f.startContainer,f.endContainer)}catch(y){setTimeout(function(){throw y},0)}l=this.contain.querySelectorAll("."+u);if(l&&l.length){g=rangy.createRange(this.doc),h=l[0].nextSibling,l.length>1&&(p=l[l.length-1].previousSibling),p&&h?(g.setStartBefore(h),g.setEndAfter(p)):(c=this.doc.createTextNode(e.INVISIBLE_SPACE),n.insert(c).after(l[0]),g.setStartBefore(c),g.setEndAfter(c)),this.setSelection(g);for(var b=l.length;b--;)l[b].parentNode.removeChild(l[b])}else this.contain.focus();r&&(i.scrollTop=s,i.scrollLeft=o);try{l.parentNode.removeChild(l)}catch(w){}},set:function(e,t){var n=rangy.createRange(this.doc);n.setStart(e,t||0),this.setSelection(n)},insertHTML:function(e){var t=this.getRange(),n=this.doc.createElement("DIV"),r=this.doc.createDocumentFragment(),i,s;if(t){t.deleteContents(),n.innerHTML=e,i=n.lastChild;while(n.firstChild)r.appendChild(n.firstChild);t.insertNode(r),s=this.contain.lastChild;while(s&&s.nodeType===3&&s.previousSibling&&/^\s*$/.test(s.data))s=s.previousSibling;i&&(s&&i===s&&i.nodeType===1&&this.contain.appendChild(this.doc.createElement("br")),this.setAfter(i))}},insertNode:function(e){var t=this.getRange();t&&t.insertNode(e)},canAppendChild:function(e){var t,n,r=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],i=this.getRange();return t=e||i.startContainer,t&&(n=(t.tagName||t.nodeName).toLowerCase()),r.indexOf(n)===-1},splitElementAtCaret:function(t,n){var r=this.getSelection(),i,s,o,u,a;if(r.rangeCount>0){i=r.getRangeAt(0).cloneRange(),i.setEndAfter(t),s=i.extractContents(),a=s.childNodes;for(var f=a.length;f--;)e.dom.domNode(a[f]).is.visible()||s.removeChild(a[f]);t.parentNode.insertBefore(s,t.nextSibling),n?(o=n.firstChild||n,u=n.lastChild||n,t.parentNode.insertBefore(n,t.nextSibling),o&&u&&(i.setStartBefore(o),i.setEndAfter(u),this.setSelection(i))):(i.setStartAfter(t),i.setEndAfter(t)),e.dom.domNode(t).is.visible()||(e.dom.getTextContent(t)===""?t.parentNode.removeChild(t):t.parentNode.replaceChild(this.doc.createTextNode(" "),t))}},surround:function(e){var t=this.getOwnRanges(),n,r=[];if(t.length==0)return r;for(var i=t.length;i--;){n=this.doc.createElement(e.nodeName),r.push(n),e.className&&(n.className=e.className),e.cssStyle&&n.setAttribute("style",e.cssStyle);try{t[i].surroundContents(n),this.selectNode(n)}catch(s){n.appendChild(t[i].extractContents()),t[i].insertNode(n)}}return r},deblockAndSurround:function(t){var n=this.doc.createElement("div"),r=rangy.createRange(this.doc),i,s,o;n.className=t.className,this.composer.commands.exec("formatBlock",t),i=this.contain.querySelectorAll("."+t.className);if(i[0]){i[0].parentNode.insertBefore(n,i[0]),r.setStartBefore(i[0]),r.setEndAfter(i[i.length-1]),s=r.extractContents();while(s.firstChild){o=s.firstChild;if(o.nodeType==1&&e.dom.hasClass(o,t.className)){while(o.firstChild)n.appendChild(o.firstChild);o.nodeName!=="BR"&&n.appendChild(this.doc.createElement("br")),s.removeChild(o)}else n.appendChild(o)}}else n=null;return n},scrollIntoView:function(){var t=this.doc,n=5,i=t.documentElement.scrollHeight>t.documentElement.offsetHeight,s=t._wysihtml5ScrollIntoViewElement=t._wysihtml5ScrollIntoViewElement||function(){var n=t.createElement("span");return n.innerHTML=e.INVISIBLE_SPACE,n}(),o;i&&(this.insertNode(s),o=r(s),s.parentNode.removeChild(s),o>=t.body.scrollTop+t.documentElement.offsetHeight-n&&(t.body.scrollTop=o))},selectLine:function(){e.browser.supportsSelectionModify()?this._selectLine_W3C():this.doc.selection?this._selectLine_MSIE():this._selectLineUniversal()},_selectLine_W3C:function(){var e=this.win.getSelection(),t=[e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset];e.modify("move","left","lineboundary"),e.modify("extend","right","lineboundary"),e.anchorNode===t[0]&&e.anchorOffset===t[1]&&e.focusNode===t[2]&&e.focusOffset===t[3]&&this._selectLineUniversal()},toLineBoundary:function(t,n){n=typeof n=="undefined"?!1:n;if(e.browser.supportsSelectionModify()){var r=this.win.getSelection();r.modify("extend",t,"lineboundary"),n&&(t==="left"?r.collapseToStart():t==="right"&&r.collapseToEnd())}},getRangeRect:function(e){var t=this.doc.createTextNode("i"),n=this.doc.createTextNode("i"),r,i;return e.collapsed?(e.insertNode(n),e.selectNode(n),r=e.nativeRange.getBoundingClientRect(),e.deleteContents()):r=e.nativeRange.getBoundingClientRect(),r},_selectLineUniversal:function(){var e=this.getSelection(),t=e.getRangeAt(0),n,r,i,s,o=0,u,a,f;r=t.cloneRange(),i=t.cloneRange(),t.collapsed&&(t.expand("word",1),n=t.nativeRange.getBoundingClientRect());do{u=t.moveStart("character",-1),a=t.nativeRange.getBoundingClientRect();if(!a||Math.floor(a.top)!==Math.floor(n.top))t.moveStart("character",1),f=!0;o++}while(u!==0&&!f&&o<2e3);o=0,f=!1,n=t.nativeRange.getBoundingClientRect();do{u=t.moveEnd("character",1),a=t.nativeRange.getBoundingClientRect();if(!a||Math.floor(a.bottom)!==Math.floor(n.bottom))t.moveEnd("character",-1),f=!0;o++}while(u!==0&&!f&&o<2e3);t.select()},_selectLine_MSIE:function(){var e=this.doc.selection&&this.doc.selection.createRange?this.doc.selection.createRange():this.doc.createRange(),t=e.boundingTop,n=this.doc.body.scrollWidth,r,i,s,o,u;window.r=e;if(!e.moveToPoint)return;t===0&&(s=this.doc.createElement("span"),this.insertNode(s),t=s.offsetTop,s.parentNode.removeChild(s)),t+=1;for(o=-10;o<n;o+=2)try{e.moveToPoint(o,t);break}catch(a){}r=t,i=this.doc.selection.createRange();for(u=n;u>=0;u--)try{i.moveToPoint(u,r);break}catch(f){}e.setEndPoint("EndToEnd",i),e.select()},getText:function(){var e=this.getSelection();return e?e.toString():""},getNodes:function(e,t){var n=this.getRange();return n?n.getNodes(Array.isArray(e)?e:[e],t):[]},getOwnNodes:function(e,t,n){var r=this.getOwnRanges(),i=[];for(var s=0,o=r.length;s<o;s++)r[s]&&(n&&r[s].splitBoundaries(),i=i.concat(r[s].getNodes(Array.isArray(e)?e:[e],t)));return i},fixRangeOverflow:function(e){if(this.contain&&this.contain.firstChild&&e){var t=e.compareNode(this.contain);if(t!==2)t===1&&e.setStartBefore(this.contain.firstChild),t===0&&e.setEndAfter(this.contain.lastChild),t===3&&(e.setStartBefore(this.contain.firstChild),e.setEndAfter(this.contain.lastChild));else if(this._detectInlineRangeProblems(e)){var n=e.endContainer.previousElementSibling;n&&e.setEnd(n,this._endOffsetForNode(n))}}},_endOffsetForNode:function(e){var t=document.createRange();return t.selectNodeContents(e),t.endOffset},_detectInlineRangeProblems:function(e){var t=n.compareDocumentPosition(e.startContainer,e.endContainer);return e.endOffset==0&&t&4},getRange:function(e){var t=this.getSelection(),n=t&&t.rangeCount&&t.getRangeAt(0);return e!==!0&&this.fixRangeOverflow(n),n},getOwnUneditables:function(){var t=n.query(this.contain,"."+this.unselectableClass),r=n.query(t,"."+this.unselectableClass);return e.lang.array(t).without(r)},getOwnRanges:function(){var e=[],t=this.getRange(),n;t&&e.push(t);if(this.unselectableClass&&this.contain&&t){var r=this.getOwnUneditables(),i;if(r.length>0)for(var s=0,o=r.length;s<o;s++){n=[];for(var u=0,a=e.length;u<a;u++){if(e[u])switch(e[u].compareNode(r[s])){case 2:break;case 3:i=e[u].cloneRange(),i.setEndBefore(r[s]),n.push(i),i=e[u].cloneRange(),i.setStartAfter(r[s]),n.push(i);break;default:n.push(e[u])}e=n}}}return e},getSelection:function(){return rangy.getSelection(this.win)},setSelection:function(e){var t=rangy.getSelection(this.win);return t.setSingleRange(e),t&&t.anchorNode&&t.focusNode?t:null},selectAll:function(){var t=this.createRange(),n=this.composer,r=this,i=s(this.composer.element),o=s(this.composer.element),u,a=function(){t.setStart(n.element,0),t.setEnd(n.element,n.element.childNodes.length),u=r.setSelection(t)},f=function(){return!u||u.nativeSelection&&u.nativeSelection.type&&(u.nativeSelection.type==="Caret"||u.nativeSelection.type==="None")};e.dom.removeInvisibleSpaces(this.composer.element),a(),this.composer.element.firstChild&&f()&&(this.composer.element.appendChild(i),a(),f()&&(i.parentNode.removeChild(i),this.composer.element.insertBefore(o,this.composer.element.firstChild),a(),f()&&(this.composer.element.appendChild(i),a())))},createRange:function(){return rangy.createRange(this.doc)},isCollapsed:function(){return this.getSelection().isCollapsed},getHtml:function(){return this.getSelection().toHtml()},getPlainText:function(){return this.getSelection().toString()},isEndToEndInNode:function(t){var n=this.getRange(),r=n.commonAncestorContainer,i=n.startContainer,s=n.endContainer;r.nodeType===e.TEXT_NODE&&(r=r.parentNode);if(i.nodeType===e.TEXT_NODE&&!/^\s*$/.test(i.data.substr(n.startOffset)))return!1;if(s.nodeType===e.TEXT_NODE&&!/^\s*$/.test(s.data.substr(n.endOffset)))return!1;while(i&&i!==r){if(i.nodeType!==e.TEXT_NODE&&!e.dom.contains(r,i))return!1;if(e.dom.domNode(i).prev({ignoreBlankTexts:!0}))return!1;i=i.parentNode}while(s&&s!==r){if(s.nodeType!==e.TEXT_NODE&&!e.dom.contains(r,s))return!1;if(e.dom.domNode(s).next({ignoreBlankTexts:!0}))return!1;s=s.parentNode}return e.lang.array(t).contains(r.nodeName)?r:!1},isInThisEditable:function(){var t=this.getSelection(),n=t.focusNode,r=t.anchorNode;return n&&n.nodeType!==1&&(n=n.parentNode),r&&r.nodeType!==1&&(r=r.parentNode),r&&n&&(e.dom.contains(this.composer.element,n)||this.composer.element===n)&&(e.dom.contains(this.composer.element,r)||this.composer.element===r)},deselect:function(){var e=this.getSelection();e&&e.removeAllRanges()}})}(e),function(e,t){function i(e,t,n){if(!e.className)return!1;var r=e.className.match(n)||[];return r[r.length-1]===t}function s(e,t){if(!e.getAttribute||!e.getAttribute("style"))return!1;var n=e.getAttribute("style").match(t);return e.getAttribute("style").match(t)?!0:!1}function o(e,t,n){e.getAttribute("style")?(f(e,n),e.getAttribute("style")&&!/^\s*$/.test(e.getAttribute("style"))?e.setAttribute("style",t+";"+e.getAttribute("style")):e.setAttribute("style",t)):e.setAttribute("style",t)}function u(e,t,n){e.className?(a(e,n),e.className+=" "+t):e.className=t}function a(e,t){e.className&&(e.className=e.className.replace(t,""))}function f(e,t){var n,r=[];if(e.getAttribute("style")){n=e.getAttribute("style").split(";");for(var i=n.length;i--;)!n[i].match(t)&&!/^\s*$/.test(n[i])&&r.push(n[i]);r.length?e.setAttribute("style",r.join(";")):e.removeAttribute("style")}}function l(e,t){var n=[],r=t.split(";"),i=e.getAttribute("style");if(i){i=i.replace(/\s/gi,"").toLowerCase(),n.push(new RegExp("(^|\\s|;)"+t.replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(var s=r.length;s-->0;)/^\s*$/.test(r[s])||n.push(new RegExp("(^|\\s|;)"+r[s].replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(var o=0,u=n.length;o<u;o++)if(i.match(n[o]))return n[o]}return!1}function c(n,r,i,s){return i?l(n,i):s?e.dom.hasClass(n,s):t.dom.arrayContains(r,n.tagName.toLowerCase())}function h(e,t,n,r){for(var i=e.length;i--;)if(!c(e[i],t,n,r))return!1;return e.length?!0:!1}function p(e,t,n){var r=l(e,t);return r?(f(e,r),"remove"):(o(e,t,n),"change")}function d(e,t){return e.className.replace(r," ")==t.className.replace(r," ")}function v(e){var t=e.parentNode;while(e.firstChild)t.insertBefore(e.firstChild,e);t.removeChild(e)}function m(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var n=0,r=e.attributes.length,i,s,o;n<r;++n){i=e.attributes[n],o=i.name;if(o!="class"){s=t.attributes.getNamedItem(o);if(i.specified!=s.specified)return!1;if(i.specified&&i.nodeValue!==s.nodeValue)return!1}}return!0}function g(e,n){return t.dom.isCharacterDataNode(e)?n==0?!!e.previousSibling:n==e.length?!!e.nextSibling:!0:n>0&&n<e.childNodes.length}function y(e,n,r,i){var s;t.dom.isCharacterDataNode(n)&&(r==0?(r=t.dom.getNodeIndex(n),n=n.parentNode):r==n.length?(r=t.dom.getNodeIndex(n)+1,n=n.parentNode):s=t.dom.splitDataNode(n,r));if(!s)if(!i||n!==i){s=n.cloneNode(!1),s.id&&s.removeAttribute("id");var o;while(o=n.childNodes[r])s.appendChild(o);t.dom.insertAfter(s,n)}return n==e?s:y(e,s.parentNode,t.dom.getNodeIndex(s),i)}function b(t){this.isElementMerge=t.nodeType==e.ELEMENT_NODE,this.firstTextNode=this.isElementMerge?t.lastChild:t,this.textNodes=[this.firstTextNode]}function w(e,t,r,i,s,o,u){this.tagNames=e||[n],this.cssClass=t||(t===!1?!1:""),this.similarClassRegExp=r,this.cssStyle=s||"",this.similarStyleRegExp=o,this.normalize=i,this.applyToAnyTagName=!1,this.container=u}var n="span",r=/\s+/g;b.prototype={doMerge:function(){var e=[],t,n,r;for(var i=0,s=this.textNodes.length;i<s;++i)t=this.textNodes[i],n=t.parentNode,e[i]=t.data,i&&(n.removeChild(t),n.hasChildNodes()||n.parentNode.removeChild(n));return this.firstTextNode.data=r=e.join(""),r},getLength:function(){var e=this.textNodes.length,t=0;while(e--)t+=this.textNodes[e].length;return t},toString:function(){var e=[];for(var t=0,n=this.textNodes.length;t<n;++t)e[t]="'"+this.textNodes[t].data+"'";return"[Merge("+e.join(",")+")]"}},w.prototype={getAncestorWithClass:function(n){var r;while(n){r=this.cssClass?i(n,this.cssClass,this.similarClassRegExp):this.cssStyle!==""?!1:!0;if(n.nodeType==e.ELEMENT_NODE&&n.getAttribute("contenteditable")!="false"&&t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())&&r)return n;n=n.parentNode}return!1},getAncestorWithStyle:function(n){var r;while(n){r=this.cssStyle?s(n,this.similarStyleRegExp):!1;if(n.nodeType==e.ELEMENT_NODE&&n.getAttribute("contenteditable")!="false"&&t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())&&r)return n;n=n.parentNode}return!1},getMatchingAncestor:function(e){var t=this.getAncestorWithClass(e),n=!1;return t?this.cssStyle&&(n="class"):(t=this.getAncestorWithStyle(e),t&&(n="style")),{element:t,type:n}},postApply:function(e,t){var n=e[0],r=e[e.length-1],i=[],s,o=n,u=r,a=0,f=r.length,l,c;for(var h=0,p=e.length;h<p;++h)l=e[h],c=null,l&&l.parentNode&&(c=this.getAdjacentMergeableTextNode(l.parentNode,!1)),c?(s||(s=new b(c),i.push(s)),s.textNodes.push(l),l===n&&(o=s.firstTextNode,a=o.length),l===r&&(u=s.firstTextNode,f=s.getLength())):s=null;if(r&&r.parentNode){var d=this.getAdjacentMergeableTextNode(r.parentNode,!0);d&&(s||(s=new b(r),i.push(s)),s.textNodes.push(d))}if(i.length){for(h=0,p=i.length;h<p;++h)i[h].doMerge();t.setStart(o,a),t.setEnd(u,f)}},getAdjacentMergeableTextNode:function(t,n){var r=t.nodeType==e.TEXT_NODE,i=r?t.parentNode:t,s,o=n?"nextSibling":"previousSibling";if(r){s=t[o];if(s&&s.nodeType==e.TEXT_NODE)return s}else{s=i[o];if(s&&this.areElementsMergeable(t,s))return s[n?"firstChild":"lastChild"]}return null},areElementsMergeable:function(e,n){return t.dom.arrayContains(this.tagNames,(e.tagName||"").toLowerCase())&&t.dom.arrayContains(this.tagNames,(n.tagName||"").toLowerCase())&&d(e,n)&&m(e,n)},createContainer:function(e){var t=e.createElement(this.tagNames[0]);return this.cssClass&&(t.className=this.cssClass),this.cssStyle&&t.setAttribute("style",this.cssStyle),t},applyToTextNode:function(e){var n=e.parentNode;if(n.childNodes.length==1&&t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase()))this.cssClass&&u(n,this.cssClass,this.similarClassRegExp),this.cssStyle&&o(n,this.cssStyle,this.similarStyleRegExp);else{var r=this.createContainer(t.dom.getDocument(e));e.parentNode.insertBefore(r,e),r.appendChild(e)}},isRemovable:function(n){return t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())&&e.lang.string(n.className).trim()===""&&(!n.getAttribute("style")||e.lang.string(n.getAttribute("style")).trim()==="")},undoToTextNode:function(e,t,n,r){var i=n?!1:!0,s=n||r,o=!1;if(!t.containsNode(s)){var u=t.cloneRange();u.selectNode(s),u.isPointInRange(t.endContainer,t.endOffset)&&g(t.endContainer,t.endOffset)&&(y(s,t.endContainer,t.endOffset,this.container),t.setEndAfter(s)),u.isPointInRange(t.startContainer,t.startOffset)&&g(t.startContainer,t.startOffset)&&(s=y(s,t.startContainer,t.startOffset,this.container))}!i&&this.similarClassRegExp&&a(s,this.similarClassRegExp),i&&this.similarStyleRegExp&&(o=p(s,this.cssStyle,this.similarStyleRegExp)==="change"),this.isRemovable(s)&&!o&&v(s)},applyToRange:function(t){var n;for(var r=t.length;r--;){n=t[r].getNodes([e.TEXT_NODE]);if(!n.length)try{var i=this.createContainer(t[r].endContainer.ownerDocument);t[r].surroundContents(i),this.selectNode(t[r],i);return}catch(s){}t[r].splitBoundaries(),n=t[r].getNodes([e.TEXT_NODE]);if(n.length){var o;for(var u=0,a=n.length;u<a;++u)o=n[u],this.getMatchingAncestor(o).element||this.applyToTextNode(o);t[r].setStart(n[0],0),o=n[n.length-1],t[r].setEnd(o,o.length),this.normalize&&this.postApply(n,t[r])}}},undoToRange:function(t){var n,r,i,s,o;for(var u=t.length;u--;){n=t[u].getNodes([e.TEXT_NODE]);if(n.length)t[u].splitBoundaries(),n=t[u].getNodes([e.TEXT_NODE]);else{var a=t[u].endContainer.ownerDocument,f=a.createTextNode(e.INVISIBLE_SPACE);t[u].insertNode(f),t[u].selectNode(f),n=[f]}for(var l=0,c=n.length;l<c;++l)t[u].isValid()&&(r=n[l],o=this.getMatchingAncestor(r),o.type==="style"?this.undoToTextNode(r,t[u],!1,o.element):o.element&&this.undoToTextNode(r,t[u],o.element));c==1?this.selectNode(t[u],n[0]):(t[u].setStart(n[0],0),r=n[n.length-1],t[u].setEnd(r,r.length),this.normalize&&this.postApply(n,t[u]))}},selectNode:function(t,n){var r=n.nodeType===e.ELEMENT_NODE,i="canHaveHTML"in n?n.canHaveHTML:!0,s=r?n.innerHTML:n.data,o=s===""||s===e.INVISIBLE_SPACE;if(o&&r&&i)try{n.innerHTML=e.INVISIBLE_SPACE}catch(u){}t.selectNodeContents(n),o&&r?t.collapse(!1):o&&(t.setStartAfter(n),t.setEndAfter(n))},getTextSelectedByRange:function(e,t){var n=t.cloneRange();n.selectNodeContents(e);var r=n.intersection(t),i=r?r.toString():"";return n.detach(),i},isAppliedToRange:function(t){var n=[],r="full",i,s,o;for(var u=t.length;u--;){o=t[u].getNodes([e.TEXT_NODE]);if(!o.length)return i=this.getMatchingAncestor(t[u].startContainer).element,i?{elements:[i],coverage:r}:!1;for(var a=0,f=o.length,l;a<f;++a)l=this.getTextSelectedByRange(o[a],t[u]),i=this.getMatchingAncestor(o[a]).element,i&&l!=""?(n.push(i),e.dom.getTextNodes(i,!0).length===1?r="full":r==="full"&&(r="inline")):i||(r="partial")}return n.length?{elements:n,coverage:r}:!1},toggleRange:function(e){var t=this.isAppliedToRange(e),n;t?t.coverage==="full"?this.undoToRange(e):t.coverage==="inline"?(n=h(t.elements,this.tagNames,this.cssStyle,this.cssClass),this.undoToRange(e),n||this.applyToRange(e)):(h(t.elements,this.tagNames,this.cssStyle,this.cssClass)||this.undoToRange(e),this.applyToRange(e)):this.applyToRange(e)}},e.selection.HTMLApplier=w}(e,rangy),e.Commands=t.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.doc=this.composer.doc},support:function(t){return e.browser.supportsCommand(this.doc,t)},exec:function(t,n){var r=e.commands[t],i=e.lang.array(arguments).get(),s=r&&r.exec,o=null;this.composer.hasPlaceholderSet()&&!e.lang.array(["styleWithCSS","enableObjectResizing","enableInlineTableEditing"]).contains(t)&&(this.composer.element.innerHTML="",this.composer.selection.selectNode(this.composer.element)),this.editor.fire("beforecommand:composer");if(s)i.unshift(this.composer),o=s.apply(r,i);else try{o=this.doc.execCommand(t,!1,n)}catch(u){}return this.editor.fire("aftercommand:composer"),o},remove:function(t,n){var r=e.commands[t],i=e.lang.array(arguments).get(),s=r&&r.remove;if(s)return i.unshift(this.composer),s.apply(r,i)},state:function(t,n){var r=e.commands[t],i=e.lang.array(arguments).get(),s=r&&r.state;if(s)return i.unshift(this.composer),s.apply(r,i);try{return this.doc.queryCommandState(t)}catch(o){return!1}},stateValue:function(t){var n=e.commands[t],r=e.lang.array(arguments).get(),i=n&&n.stateValue;return i?(r.unshift(this.composer),i.apply(n,r)):!1}}),function(e){var t={nodeName:"B",toggle:!0};e.commands.bold={exec:function(n,r){e.commands.formatInline.exec(n,r,t)},state:function(n,r){return e.commands.formatInline.state(n,r,t)}}}(e),function(e){function n(n){var r=typeof n=="object"?n:{href:n};return e.lang.object({}).merge(t).merge({attribute:n}).get()}var t={nodeName:"A",toggle:!1};e.commands.createLink={exec:function(t,r,i){var s=n(i);if(t.selection.isCollapsed()&&!this.state(t,r)){var o=t.doc.createTextNode(s.attribute.href);t.selection.insertNode(o),t.selection.selectNode(o)}e.commands.formatInline.exec(t,r,s)},state:function(n,r){return e.commands.formatInline.state(n,r,t)}}}(e),function(e){var t={nodeName:"A"};e.commands.removeLink={exec:function(n,r){e.commands.formatInline.remove(n,r,t)},state:function(n,r){return e.commands.formatInline.state(n,r,t)}}}(e),function(e){var t=/wysiwyg-font-size-[0-9a-z\-]+/g;e.commands.fontSize={exec:function(n,r,i){e.commands.formatInline.exec(n,r,{className:"wysiwyg-font-size-"+i,classRegExp:t,toggle:!0})},state:function(t,n,r){return e.commands.formatInline.state(t,n,{className:"wysiwyg-font-size-"+r})}}}(e),function(e){e.commands.fontSizeStyle={exec:function(t,n,r){r=r.size||r,/^\s*$/.test(r)||e.commands.formatInline.exec(t,n,{styleProperty:"fontSize",styleValue:r,toggle:!1})},state:function(t,n,r){return e.commands.formatInline.state(t,n,{styleProperty:"fontSize",styleValue:r||undefined})},remove:function(t,n){return e.commands.formatInline.remove(t,n,{styleProperty:"fontSize"})},stateValue:function(t,n){var r,i=this.state(t,n);i&&e.lang.object(i).isArray()&&(i=i[0]);if(i){r=i.getAttribute("style");if(r)return e.quirks.styleParser.parseFontSize(r)}return!1}}}(e),function(e){var t=/wysiwyg-color-[0-9a-z]+/g;e.commands.foreColor={exec:function(n,r,i){e.commands.formatInline.exec(n,r,{className:"wysiwyg-color-"+i,classRegExp:t,toggle:!0})},state:function(t,n,r){return e.commands.formatInline.state(t,n,{className:"wysiwyg-color-"+r})}}}(e),function(e){e.commands.foreColorStyle={exec:function(t,n,r){var i,s;if(!r)return;i=e.quirks.styleParser.parseColor("color:"+(r.color||r),"color"),i&&(s=(i[3]===1?"rgb("+[i[0],i[1],i[2]].join(", "):"rgba("+i.join(", "))+")",e.commands.formatInline.exec(t,n,{styleProperty:"color",styleValue:s}))},state:function(t,n,r){var i=r?e.quirks.styleParser.parseColor("color:"+(r.color||r),"color"):null,s;return i&&(s=(i[3]===1?"rgb("+[i[0],i[1],i[2]].join(", "):"rgba("+i.join(", "))+")"),e.commands.formatInline.state(t,n,{styleProperty:"color",styleValue:s})},remove:function(t,n){return e.commands.formatInline.remove(t,n,{styleProperty:"color"})},stateValue:function(t,n,r){var i=this.state(t,n),s,o=!1;i&&e.lang.object(i).isArray()&&(i=i[0]);if(i){s=i.getAttribute("style");if(s)return o=e.quirks.styleParser.parseColor(s,"color"),e.quirks.styleParser.unparseColor(o,r)}return!1}}}(e),function(e){e.commands.bgColorStyle={exec:function(t,n,r){var i=e.quirks.styleParser.parseColor("background-color:"+(r.color||r),"background-color"),s;i&&(s=(i[3]===1?"rgb("+[i[0],i[1],i[2]].join(", "):"rgba("+i.join(", "))+")",e.commands.formatInline.exec(t,n,{styleProperty:"backgroundColor",styleValue:s}))},state:function(t,n,r){var i=r?e.quirks.styleParser.parseColor("background-color:"+(r.color||r),"background-color"):null,s;return i&&(s=(i[3]===1?"rgb("+[i[0],i[1],i[2]].join(", "):"rgba("+i.join(", "))+")"),e.commands.formatInline.state(t,n,{styleProperty:"backgroundColor",styleValue:s})},remove:function(t,n){return e.commands.formatInline.remove(t,n,{styleProperty:"backgroundColor"})},stateValue:function(t,n,r){var i=this.state(t,n),s,o=!1;i&&e.lang.object(i).isArray()&&(i=i[0]);if(i){s=i.getAttribute("style");if(s)return o=e.quirks.styleParser.parseColor(s,"background-color"),e.quirks.styleParser.unparseColor(o,r)}return!1}}}(e),function(e){function s(e){return{nodeName:e.nodeName||null,className:e.classRegExp?null:e.className||null,classRegExp:e.classRegExp||null,styleProperty:e.styleProperty||null}}function o(t){var n=t.element,i=n.querySelectorAll(r),s=n.querySelectorAll(t.config.classNames.uneditableContainer),o=e.lang.array(i).without(s);for(var u=o.length;u--;)o[u].innerHTML.replace(/[\uFEFF]/g,"")===""&&o[u].parentNode.removeChild(o[u])}function u(e){return e.config.useLineBreaks?"DIV":"P"}function a(e,t,i){var s=e,o=null;while(s&&t&&s!==t)s.nodeType===1&&s.matches(i?r:n)&&(o=s),s=s.parentNode;return o}function f(e,t){var n=e,r,s,o=null,u;while(n&&t&&n!==t)n.nodeType===1&&n.matches(i)&&(s=n,o===null?(o=n.cloneNode(!1),r=o):(u=n.cloneNode(!1),u.appendChild(o),o=u)),n=n.parentNode;return{parent:s,outerNode:o,innerNode:r}}function l(n,r,i){return n||(n=i.doc.createElement(r.nodeName||u(i)),n.appendChild(i.doc.createTextNode(e.INVISIBLE_SPACE))),r.nodeName&&n.nodeName!==r.nodeName&&(n=t.renameElement(n,r.nodeName)),r.classRegExp&&(n.className=n.className.replace(r.classRegExp,"")),r.className&&n.classList.add(r.className),r.styleProperty&&typeof r.styleValue!="undefined"&&(n.style[e.browser.fixStyleKey(r.styleProperty)]=r.styleValue),n}function c(n,r,i){var s,o;r.styleProperty&&(n.style[e.browser.fixStyleKey(r.styleProperty)]=""),r.className&&n.classList.remove(r.className),r.classRegExp&&(n.className=n.className.replace(r.classRegExp,"")),n.getAttribute("class")!==null&&n.getAttribute("class").trim()===""&&n.removeAttribute("class"),r.nodeName&&n.nodeName===r.nodeName&&(s=n.getAttribute("style"),!s||s.trim()===""?t.unwrap(n):n=t.renameElement(n,u(i))),n.getAttribute("style")!==null&&n.getAttribute("style").trim()===""&&n.removeAttribute("style")}function h(t){var n=t.querySelectorAll(r)||[];for(var i=n.length;i--;)(!n[i].nextSibling||n[i].nextSibling.nodeType!==1||n[i].nextSibling.nodeName!=="BR")&&(n[i].innerHTML||n[i].nodeValue||"").trim()!==""&&n[i].parentNode.insertBefore(n[i].ownerDocument.createElement("BR"),n[i].nextSibling),e.dom.unwrap(n[i])}function p(e,t){var n;if(e.startContainer&&e.startContainer.nodeType===1&&e.startContainer===e.endContainer){e.startContainer.firstChild===e.startContainer.lastChild&&e.endOffset===1&&e.startContainer!==t.element&&(e.setStartBefore(e.startContainer),e.setEndAfter(e.endContainer));return}if(e.startContainer&&e.startContainer.nodeType===1&&e.endContainer.nodeType===3){e.startContainer.firstChild===e.endContainer&&e.endOffset===1&&e.startContainer!==t.element&&e.setEndAfter(e.startContainer);return}if(e.endContainer&&e.endContainer.nodeType===1&&e.startContainer.nodeType===3){e.endContainer.firstChild===e.startContainer&&e.endOffset===1&&e.endContainer!==t.element&&e.setStartBefore(e.endContainer);return}if(e.startContainer&&e.startContainer.nodeType===3&&e.startContainer===e.endContainer&&e.startContainer.parentNode){e.startContainer.parentNode.firstChild===e.startContainer&&e.endOffset==e.endContainer.length&&e.startOffset===0&&(n=e.startContainer.parentNode,n!==t.element&&(e.setStartBefore(n),e.setEndAfter(n)));return}}function d(t,i,o,c){var d=i?e.lang.object(i).clone(!0):null;d&&(d.nodeName=d.nodeName||o||u(c)),p(t,c);var v=t.cloneRange(),m=v.startContainer,g=v.extractContents(),y=c.doc.createDocumentFragment(),b=d?s(d):null,w=b?e.dom.getParentElement(m,b,null,c.element):null,E=!d||o==="BLOCKQUOTE"&&d.nodeName&&d.nodeName==="BLOCKQUOTE",S=w||a(m,c.element,E),x,T,N;if(i&&i.nodeName&&i.nodeName==="BLOCKQUOTE"){var C=l(null,i,c);C.appendChild(g),y.appendChild(C),T=[C]}else{if(!g.firstChild)y.appendChild(l(null,i,c));else while(g.firstChild)if(g.firstChild.nodeType==1&&g.firstChild.matches(r))if(i)l(g.firstChild,i,c),g.firstChild.matches(n)&&h(g.firstChild),y.appendChild(g.firstChild);else{h(g.firstChild),N=e.dom.unwrap(g.firstChild);for(var k=0,L=N.length;k<L;k++)y.appendChild(N[k]);y.childNodes.length>0&&y.appendChild(c.doc.createElement("BR"))}else if(i){x=l(null,d,c);while(g.firstChild&&(g.firstChild.nodeType!==1||!g.firstChild.matches(r)))g.firstChild.nodeType==1&&x.matches(n)&&h(g.firstChild),x.appendChild(g.firstChild);y.appendChild(x)}else g.firstChild.nodeType==1&&h(g.firstChild),y.appendChild(g.firstChild);T=e.lang.array(y.childNodes).get()}if(S)c.selection.splitElementAtCaret(S,y);else{var A=f(m,c.element);if(A.outerNode&&A.innerNode&&A.parent){if(y.childNodes.length===1){while(y.firstChild.firstChild)A.innerNode.appendChild(y.firstChild.firstChild);y.firstChild.appendChild(A.outerNode)}c.selection.splitElementAtCaret(A.parent,y)}else v.insertNode(y)}return T}function v(t,n){var i=e.dom.getParentElement(t,{query:r},null,n.element);return i?i.nodeName:null}var t=e.dom,n="h1, h2, h3, h4, h5, h6, p, pre",r="h1, h2, h3, h4, h5, h6, p, pre, div, blockquote",i="b, big, i, small, tt, abbr, acronym, cite, code, dfn, em, kbd, strong, samp, var, a, bdo, br, q, span, sub, sup, button, label, textarea, input, select, u";e.commands.formatBlock={exec:function(t,r,i){var s=[],u,a,f,l,h,p;typeof i=="string"&&(i={nodeName:i.toUpperCase()});if(i&&i.toggle){p=this.state(t,r,i);if(p){h=rangy.saveSelection(t.win);for(var m=0,g=p.length;m<g;m++)c(p[m],i,t)}}if(!p){t.selection.isCollapsed()&&(l=e.dom.getParentElement(t.selection.getOwnRanges()[0].startContainer,{query:n+", "+(i&&i.nodeName?i.nodeName.toLowerCase():"div")},null,t.element),l?(h=rangy.saveSelection(t.win),f=t.selection.createRange(),f.selectNode(l),t.selection.setSelection(f)):t.isEmpty()||(h=rangy.saveSelection(t.win),t.selection.selectLine())),a=t.selection.getOwnRanges();for(var y=a.length;y--;)s=s.concat(d(a[y],i,v(a[y].startContainer,t),t))}o(t);for(var b=s.length;b--;)s[b].parentNode||s.splice(b,1);if(h)e.dom.removeInvisibleSpaces(t.element),rangy.restoreSelection(h);else{e.dom.removeInvisibleSpaces(t.element),f=t.selection.createRange(),f.setStart(s[0],0);var w=s[s.length-1],E=w.nodeType===1&&w.childNodes?w.childNodes.length|0:w.length||0;f.setEnd(w,E),f.select()}},state:function(n,i,s){typeof s=="string"&&(s={query:s});var o=n.selection.filterElements(function(t){return e.dom.domNode(t).test(s||{query:r})}.bind(this)),u=n.selection.getSelectedOwnNodes(),a;for(var f=0,l=u.length;f<l;f++)a=t.getParentElement(u[f],s||{query:r},null,n.element),a&&o.indexOf(a)===-1&&o.push(a);return o.length===0?!1:o}}}(e),function(e){e.commands.formatCode={exec:function(t,n,r){var i=this.state(t)[0],s,o,u;i?t.selection.executeAndRestore(function(){s=i.querySelector("code"),e.dom.replaceWithChildNodes(i),s&&e.dom.replaceWithChildNodes(s)}):(o=t.selection.getRange(),u=o.extractContents(),i=t.doc.createElement("pre"),s=t.doc.createElement("code"),r&&(s.className=r),i.appendChild(s),s.appendChild(u),o.insertNode(i),t.selection.selectNode(i))},state:function(t){var n=t.selection.getSelectedNode(),r;return n&&n.nodeName&&n.nodeName=="PRE"&&n.firstChild&&n.firstChild.nodeName&&n.firstChild.nodeName=="CODE"?[n]:(r=e.dom.getParentElement(n,{query:"pre code"}),r?[r.parentNode]:!1)}}}(e),function(e){function i(e){return/^\s*$/.test(e.className)}function s(e){return!e.getAttribute("style")||/^\s*$/.test(e.getAttribute("style"))}function o(t){var n=e.dom.getAttributes(t);return e.lang.object(n).isEmpty()}function u(t,n){var r,i,s,o;return t.nodeType!==1||n.nodeType!==1?!1:t.nodeName!==n.nodeName?!1:(r=t.className.trim().replace(/\s+/g," ").split(" "),i=n.className.trim().replace(/\s+/g," ").split(" "),e.lang.array(r).without(i).length>0?!1:(s=e.dom.getAttributes(t),o=e.dom.getAttributes(n),s.length!==o.length||!e.lang.object(e.lang.object(s).difference(o)).isEmpty()?!1:!0))}function a(n,r){var i=r&&r.nodeName||t,s=n.ownerDocument.createElement(i);r.classRegExp&&(s.className=s.className.replace(r.classRegExp,"")),r.className&&s.classList.add(r.className),r.styleProperty&&typeof r.styleValue!="undefined"&&(s.style[e.browser.fixStyleKey(r.styleProperty)]=r.styleValue);if(r.attribute)if(typeof r.attribute=="object")for(var o in r.attribute)r.attribute.hasOwnProperty(o)&&s.setAttribute(o,r.attribute[o]);else typeof r.attributeValue!="undefined"&&s.setAttribute(r.attribute,r.attributeValue);return s}function f(e,t){for(var n in e)if(e.hasOwnProperty(n))if(typeof t[n]===undefined||t[n]!==e[n])return!1;return!0}function l(t,n,r){var i=e.dom.getAttributes(t),s=f(n,i),o=e.lang.object(i).difference(n),u,a;if(s&&r!==!1)for(u in n)n.hasOwnProperty(u)&&t.removeAttribute(u);else for(u in n)n.hasOwnProperty(u)&&t.setAttribute(u,n[u])}function c(n,u){var a,f,c,h,p,d;u.className&&(u.toggle!==!1&&n.classList.contains(u.className)?n.classList.remove(u.className):n.classList.add(u.className),i(n)&&n.removeAttribute("class")),u.styleProperty&&(u.toggle!==!1&&n.style[e.browser.fixStyleKey(u.styleProperty)].trim().replace(/, /g,",")===u.styleValue?n.style[e.browser.fixStyleKey(u.styleProperty)]="":n.style[e.browser.fixStyleKey(u.styleProperty)]=u.styleValue),s(n)&&n.removeAttribute("style"),u.attribute&&(typeof u.attribute=="object"?h=u.attribute:(h={},h[u.attribute]=u.attributeValue||""),l(n,h,u.toggle)),p=u.nodeName?r[u.nodeName.toLowerCase()]||u.nodeName.toLowerCase():null,d=p?e.dom.domNode(n).test({query:p}):!1,(!u.nodeName||u.nodeName===t||d)&&(u.toggle!==!1&&d||!u.nodeName&&n.nodeName===t)&&i(n)&&s(n)&&o(n)&&e.dom.unwrap(n)}function h(t,n){var r=[];return t.isCollapsed()||(r=r.concat(t.getOwnNodes([3],function(t){return!e.dom.domNode(t).is.emptyTextNode()},n))),r}function p(e,t,n,r){var i=e,s=r?t:d(t);do{if(i.nodeType===1&&v(i,s))return i;i=i.parentNode}while(i&&i!==n);return null}function d(e){return{nodeName:e.nodeName||null,className:e.classRegExp?null:e.className||null,classRegExp:e.classRegExp||null,styleProperty:e.styleProperty||null}}function v(t,i){var s;if(i.nodeName){var o=r[i.nodeName.toLowerCase()]||i.nodeName.toLowerCase();return e.dom.domNode(t).test({query:o})}return s=e.lang.object(i).clone(),s.query=n,e.dom.domNode(t).test(s)}function m(t,n){var r=document.documentElement||document.body,i=r.scrollTop,s=r.scrollLeft,o=rangy.getSelection(t.win);rangy.getSelection(t.win).removeAllRanges();try{rangy.getSelection(t.win).addRange(n)}catch(u){}if(!t.doc.activeElement||!e.dom.contains(t.element,t.doc.activeElement))t.element.focus(),r.scrollTop=i,r.scrollLeft=s,rangy.getSelection(t.win).addRange(n)}function g(e,t){var n=rangy.createRange(t.doc),r=e[e.length-1];e[0]&&r&&(n.setStart(e[0],0),n.setEnd(r,r.length),m(t,n))}function y(e,t,n,r){var i=rangy.createRange(e.doc);t&&(i.setStart(t,n),i.setEnd(t,typeof r!="undefined"?r:n),m(e,i))}function b(e,t,n){var r=h(e.selection),i=[],s=!1,o,u,a;if(e.selection.isInThisEditable()){if(r.length===0&&e.selection.isCollapsed()){a=e.selection.getSelection().anchorNode;if(!a)return{nodes:[],partial:!1};a.nodeType===3&&(r=[a])}r.length||(u=e.selection.getOwnRanges()[0],u&&(r=[u.endContainer]));for(var f=0,l=r.length;f<l;f++)o=p(r[f],t,e.element,n),o?i.push(o):s=!0}return{nodes:i,partial:s}}function w(e){var t,n,r,i;if(e){t=e.anchorNode,n=e.anchorOffset;if(t&&t.nodeType===3&&n>0&&n<t.data.length)return r=t.data[n-1],i=t.data[n],/\w/.test(r)&&/\w/.test(i)}return!1}function E(t){var n,r,i,s,o,u,a,f,l=[];if(t){n=t.anchorNode,r=o=u=t.anchorOffset,i=n.ownerDocument,s=rangy.createRange(i);if(n&&n.nodeType===3){while(o>0&&/\w/.test(n.data[o-1]))o--;while(u<n.data.length&&/\w/.test(n.data[u]))u++;return s.setStartAndEnd(n,o,u),s.splitBoundaries(),l=s.getNodes([3],function(t){return!e.dom.domNode(t).is.emptyTextNode()}),{wordOffset:r-o,range:s,textNode:l[0]}}}return!1}function S(e,t){while(t.firstChild)e.appendChild(t.firstChild);t.parentNode.removeChild(t)}function x(e){for(var t=e.length;t--;)e[t]&&e[t].parentNode&&(e[t].nextSibling&&u(e[t],e[t].nextSibling)&&S(e[t],e[t].nextSibling),e[t].previousSibling&&u(e[t],e[t].previousSibling)&&S(e[t].previousSibling,e[t]))}function T(e,t,n){t.length>0&&g(t,e),x(b(e,n).nodes),t.length>0&&g(t,e)}function N(e,t,n,r){y(e,t,n),x(b(e,r).nodes),y(e,t,n)}function C(e,t){var n=a(e,t);e.parentNode.insertBefore(n,e),n.appendChild(e)}function k(t,n,r){var i=n.element,s=p(t,r,i),o;s&&(o=s.cloneNode(!1),e.dom.domNode(t).escapeParent(s,o),c(o,r))}function L(t,n,r){var i=n.element,s=p(t,r,i);s&&e.dom.domNode(t).escapeParent(s)}function A(e,t,n){var r=a(e.endContainer,n);e.surroundContents(r),t.selection.selectNode(r)}function O(t,n,r,i){var s=b(t,i,!0),o=t.selection.getSelection(),u,a,f,l;if(!n.length)if(i.toggle!==!1)if(w(o))u=E(o),a=u.textNode,k(u.textNode,t,i),N(t,u.textNode,u.wordOffset,i);else{a=t.doc.createTextNode(e.INVISIBLE_SPACE),f=r.nodes[0].cloneNode(!1),f.appendChild(a),t.selection.splitElementAtCaret(r.nodes[0],f),c(f,i),T(t,[a],i);var h=t.selection.getSelection();if(h.anchorNode&&h.focusNode)try{h.collapseToEnd()}catch(d){}}else for(l=r.nodes.length;l--;)c(r.nodes[l],i);else{if(!s.partial&&i.toggle!==!1)for(l=n.length;l--;)k(n[l],t,i);else for(l=n.length;l--;)p(n[l],i,t.element)&&k(n[l],t,i),p(n[l],i,t.element)||C(n[l],i);T(t,n,i)}}function M(t,n,r,i){var s,o,u,a,f=t.selection.getSelection();if(!n.length){s=f.anchorNode,o=f.anchorOffset;for(a=r.nodes.length;a--;)e.dom.unwrap(r.nodes[a]);N(t,s,o,i)}else{for(a=n.length;a--;)L(n[a],t,i);T(t,n,i)}}function _(e,t,n){var r,i,s=e.selection.getSelection();if(!t.length)if(w(s))r=E(s),C(r.textNode,n),N(e,r.textNode,r.wordOffset,n);else{var o=e.selection.getOwnRanges()[0];o&&A(o,e,n)}else{for(i=t.length;i--;)C(t[i],n);T(e,t,n)}}function D(e){return e=typeof e=="string"?{nodeName:e}:e,e.nodeName&&(e.nodeName=e.nodeName.toUpperCase()),e}var t="SPAN",n="b, big, i, small, tt, abbr, acronym, cite, code, dfn, em, kbd, strong, samp, var, a, bdo, br, q, span, sub, sup, button, label, textarea, input, select, u",r={b:"b, strong",strong:"b, strong",em:"em, i",i:"em, i"};e.commands.formatInline={exec:function(e,t,n){n=D(n),e.element.normalize();var r=h(e.selection,!0),i=b(e,n);i.nodes.length>0?O(e,r,i,n):_(e,r,n),e.element.normalize()},remove:function(e,t,n){n=D(n),e.element.normalize();var r=h(e.selection,!0),i=b(e,n);i.nodes.length>0&&M(e,r,i,n),e.element.normalize()},state:function(e,t,n){n=D(n);var r=b(e,n,!0).nodes;return r.length===0?!1:r}}}(e),function(e){var t={nodeName:"BLOCKQUOTE",toggle:!0};e.commands.insertBlockQuote={exec:function(n,r){return e.commands.formatBlock.exec(n,"formatBlock",t)},state:function(n,r){return e.commands.formatBlock.state(n,"formatBlock",t)}}}(e),function(e){e.commands.insertHTML={exec:function(e,t,n){e.selection.insertHTML(n)},state:function(){return!1}}}(e),function(e){var t="IMG";e.commands.insertImage={exec:function(n,r,i){i=typeof i=="object"?i:{src:i};var s=n.doc,o=this.state(n),u,a;if(o&&!i.src){n.selection.setBefore(o),a=o.parentNode,a.removeChild(o),e.dom.removeEmptyTextNodes(a),a.nodeName==="A"&&!a.firstChild&&(n.selection.setAfter(a),a.parentNode.removeChild(a)),e.quirks.redraw(n.element);return}if(o){for(var f in i)i.hasOwnProperty(f)&&o.setAttribute(f==="className"?"class":f,i[f]);return}o=s.createElement(t);for(var l in i)o.setAttribute(l==="className"?"class":l,i[l]);n.selection.insertNode(o),e.browser.hasProblemsSettingCaretAfterImg()?(u=s.createTextNode(e.INVISIBLE_SPACE),n.selection.insertNode(u),n.selection.setAfter(u)):n.selection.setAfter(o)},state:function(n){var r=n.doc,i,s,o;return e.dom.hasElementWithTagName(r,t)?(i=n.selection.getSelectedNode(),i?i.nodeName===t?i:i.nodeType!==e.ELEMENT_NODE?!1:(s=n.selection.getText(),s=e.lang.string(s).trim(),s?!1:(o=n.selection.getNodes(e.ELEMENT_NODE,function(e){return e.nodeName==="IMG"}),o.length!==1?!1:o[0])):!1):!1}}}(e),function(e){var t="<br>"+(e.browser.needsSpaceAfterLineBreak()?" ":"");e.commands.insertLineBreak={exec:function(e,n){e.selection.insertHTML(t)},state:function(){return!1}}}(e),function(e){e.commands.insertOrderedList={exec:function(t,n){e.commands.insertList.exec(t,n,"OL")},state:function(t,n){return e.commands.insertList.state(t,n,"OL")}}}(e),function(e){e.commands.insertUnorderedList={exec:function(t,n){e.commands.insertList.exec(t,n,"UL")},state:function(t,n){return e.commands.insertList.state(t,n,"UL")}}}(e),e.commands.insertList=function(e){var t=function(e,t){if(e&&e.nodeName){typeof t=="string"&&(t=[t]);for(var n=t.length;n--;)if(e.nodeName===t[n])return!0}return!1},n=function(n,r,i){var s={el:null,other:!1};if(n){var o=e.dom.getParentElement(n,{query:"li"},!1,i.element),u=r==="UL"?"OL":"UL";t(n,r)?s.el=n:t(n,u)?s={el:n,other:!0}:o&&(t(o.parentNode,r)?s.el=o.parentNode:t(o.parentNode,u)&&(s={el:o.parentNode,other:!0}))}return s.el&&!i.element.contains(s.el)&&(s.el=null),s},r=function(t,n,r){var i=n==="UL"?"OL":"UL",o,u;r.selection.executeAndRestoreRangy(function(){o=s(i,r);if(o.length)for(var a=o.length;a--;)e.dom.renameElement(o[a],n.toLowerCase());else{u=s(["OL","UL"],r);for(var f=u.length;f--;)e.dom.resolveList(u[f],r.config.useLineBreaks);e.dom.resolveList(t,r.config.useLineBreaks)}})},i=function(t,n,r){var i=n==="UL"?"OL":"UL";r.selection.executeAndRestoreRangy(function(){var o=[t].concat(s(i,r));for(var u=o.length;u--;)e.dom.renameElement(o[u],n.toLowerCase())})},s=function(e,n){var r=n.selection.getOwnRanges(),i=[];for(var s=r.length;s--;)i=i.concat(r[s].getNodes([1],function(n){return t(n,e)}));return i},o=function(t,n){var r;n.selection.isCollapsed()||(r=rangy.saveSelection(n.win));var i="_wysihtml5-temp-"+(new Date).getTime(),s=n.selection.deblockAndSurround({nodeName:"div",className:i}),o,u,a=/\uFEFF/g;s.innerHTML=s.innerHTML.replace(e.INVISIBLE_SPACE_REG_EXP,""),s&&(o=/^(\s|(<br>))+$/i.test(s.innerHTML),u=e.dom.convertToList(s,t.toLowerCase(),n.parent.config.classNames.uneditableContainer),r&&rangy.restoreSelection(r),o&&n.selection.selectNode(u.querySelector("li"),!0))};return{exec:function(e,t,s){var u=e.doc,a=s==="OL"?"insertOrderedList":"insertUnorderedList",f=e.selection.getSelectedNode(),l=n(f,s,e);l.el?l.other?i(l.el,s,e):r(l.el,s,e):e.commands.support(a)?u.execCommand(a,!1,null):o(s,e)},state:function(e,t,r){var i=e.selection.getSelectedNode(),s=n(i,r,e);return s.el&&!s.other?s.el:!1}}}(e),function(e){var t={nodeName:"I",toggle:!0};e.commands.italic={exec:function(n,r){e.commands.formatInline.exec(n,r,t)},state:function(n,r){return e.commands.formatInline.state(n,r,t)}}}(e),function(e){var t={className:"wysiwyg-text-align-center",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};e.commands.justifyCenter={exec:function(n,r){return e.commands.formatBlock.exec(n,"formatBlock",t)},state:function(n,r){return e.commands.formatBlock.state(n,"formatBlock",t)}}}(e),function(e){var t={className:"wysiwyg-text-align-left",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};e.commands.justifyLeft={exec:function(n,r){return e.commands.formatBlock.exec(n,"formatBlock",t)},state:function(n,r){return e.commands.formatBlock.state(n,"formatBlock",t)}}}(e),function(e){var t={className:"wysiwyg-text-align-right",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};e.commands.justifyRight={exec:function(n,r){return e.commands.formatBlock.exec(n,"formatBlock",t)},state:function(n,r){return e.commands.formatBlock.state(n,"formatBlock",t)}}}(e),function(e){var t={className:"wysiwyg-text-align-justify",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};e.commands.justifyFull={exec:function(n,r){return e.commands.formatBlock.exec(n,"formatBlock",t)},state:function(n,r){return e.commands.formatBlock.state(n,"formatBlock",t)}}}(e),function(e){var t={styleProperty:"textAlign",styleValue:"right",toggle:!0};e.commands.alignRightStyle={exec:function(n,r){return e.commands.formatBlock.exec(n,"formatBlock",t)},state:function(n,r){return e.commands.formatBlock.state(n,"formatBlock",t)}}}(e),function(e){var t={styleProperty:"textAlign",styleValue:"left",toggle:!0};e.commands.alignLeftStyle={exec:function(n,r){return e.commands.formatBlock.exec(n,"formatBlock",t)},state:function(n,r){return e.commands.formatBlock.state(n,"formatBlock",t)}}}(e),function(e){var t={styleProperty:"textAlign",styleValue:"center",toggle:!0};e.commands.alignCenterStyle={exec:function(n,r){return e.commands.formatBlock.exec(n,"formatBlock",t)},state:function(n,r){return e.commands.formatBlock.state(n,"formatBlock",t)}}}(e),function(e){var t={styleProperty:"textAlign",styleValue:"justify",toggle:!0};e.commands.alignJustifyStyle={exec:function(n,r){return e.commands.formatBlock.exec(n,"formatBlock",t)},state:function(n,r){return e.commands.formatBlock.state(n,"formatBlock",t)}}}(e),function(e){e.commands.redo={exec:function(e){return e.undoManager.redo()},state:function(e){return!1}}}(e),function(e){var t={nodeName:"U",toggle:!0};e.commands.underline={exec:function(n,r){e.commands.formatInline.exec(n,r,t)},state:function(n,r){return e.commands.formatInline.state(n,r,t)}}}(e),function(e){e.commands.undo={exec:function(e){return e.undoManager.undo()},state:function(e){return!1}}}(e),function(e){e.commands.createTable={exec:function(e,t,n){var r,i,s;if(n&&n.cols&&n.rows&&parseInt(n.cols,10)>0&&parseInt(n.rows,10)>0){n.tableStyle?s='<table style="'+n.tableStyle+'">':s="<table>",s+="<tbody>";for(i=0;i<n.rows;i++){s+="<tr>";for(r=0;r<n.cols;r++)s+="<td><br></td>";s+="</tr>"}s+="</tbody></table>",e.commands.exec("insertHTML",s)}},state:function(e,t){return!1}}}(e),function(e){e.commands.mergeTableCells={exec:function(t,n){t.tableSelection&&t.tableSelection.start&&t.tableSelection.end&&(this.state(t,n)?e.dom.table.unmergeCell(t.tableSelection.start):e.dom.table.mergeCellsBetween(t.tableSelection.start,t.tableSelection.end))},state:function(t,n){if(t.tableSelection){var r=t.tableSelection.start,i=t.tableSelection.end;if(r&&i&&r==i&&(e.dom.getAttribute(r,"colspan")&&parseInt(e.dom.getAttribute(r,"colspan"),10)>1||e.dom.getAttribute(r,"rowspan")&&parseInt(e.dom.getAttribute(r,"rowspan"),10)>1))return[r]}return!1}}}(e),function(e){e.commands.addTableCells={exec:function(t,n,r){if(t.tableSelection&&t.tableSelection.start&&t.tableSelection.end){var i=e.dom.table.orderSelectionEnds(t.tableSelection.start,t.tableSelection.end);r=="before"||r=="above"?e.dom.table.addCells(i.start,r):(r=="after"||r=="below")&&e.dom.table.addCells(i.end,r),setTimeout(function(){t.tableSelection.select(i.start,i.end)},0)}},state:function(e,t){return!1}}}(e),function(e){e.commands.deleteTableCells={exec:function(t,n,r){if(t.tableSelection&&t.tableSelection.start&&t.tableSelection.end){var i=e.dom.table.orderSelectionEnds(t.tableSelection.start,t.tableSelection.end),s=e.dom.table.indexOf(i.start),o,u=t.tableSelection.table;e.dom.table.removeCells(i.start,r),setTimeout(function(){o=e.dom.table.findCell(u,s),o||(r=="row"&&(o=e.dom.table.findCell(u,{row:s.row-1,col:s.col})),r=="column"&&(o=e.dom.table.findCell(u,{row:s.row,col:s.col-1}))),o&&t.tableSelection.select(o,o)},0)}},state:function(e,t){return!1}}}(e),function(e){e.commands.indentList={exec:function(e,t,n){var r=e.selection.getSelectionParentsByTag("LI");return r?this.tryToPushLiLevel(r,e.selection):!1},state:function(e,t){return!1},tryToPushLiLevel:function(t,n){var r,i,s,o,u,a=!1;return n.executeAndRestoreRangy(function(){for(var n=t.length;n--;)o=t[n],r=o.parentNode.nodeName==="OL"?"OL":"UL",i=o.ownerDocument.createElement(r),s=e.dom.domNode(o).prev({nodeTypes:[e.ELEMENT_NODE]}),u=s?s.querySelector("ul, ol"):null,s&&(u?u.appendChild(o):(i.appendChild(o),s.appendChild(i)),a=!0)}),a}}}(e),function(e){e.commands.outdentList={exec:function(e,t,n){var r=e.selection.getSelectionParentsByTag("LI");return r?this.tryToPullLiLevel(r,e):!1},state:function(e,t){return!1},tryToPullLiLevel:function(t,n){var r,i,s,o,u,a,f,l=!1,c=this;return n.selection.executeAndRestoreRangy(function(){for(var o=t.length;o--;){a=t[o];if(a.parentNode){r=a.parentNode;if(r.tagName==="OL"||r.tagName==="UL"){l=!0,i=e.dom.getParentElement(r.parentNode,{query:"ol, ul"},!1,n.element),s=e.dom.getParentElement(r.parentNode,{query:"li"},!1,n.element);if(i&&s)a.nextSibling&&(f=c.getAfterList(r,a),a.appendChild(f)),i.insertBefore(a,s.nextSibling);else{a.nextSibling&&(f=c.getAfterList(r,a),a.appendChild(f));for(var u=a.childNodes.length;u--;)r.parentNode.insertBefore(a.childNodes[u],r.nextSibling);r.parentNode.insertBefore(document.createElement("br"),r.nextSibling),a.parentNode.removeChild(a)}r.childNodes.length===0&&r.parentNode.removeChild(r)}}}}),l},getAfterList:function(e,t){var n=e.nodeName,r=document.createElement(n);while(t.nextSibling)r.appendChild(t.nextSibling);return r}}}(e),function(e){var t={nodeName:"SUB",toggle:!0};e.commands.subscript={exec:function(n,r){e.commands.formatInline.exec(n,r,t)},state:function(n,r){return e.commands.formatInline.state(n,r,t)}}}(e),function(e){var t={nodeName:"SUP",toggle:!0};e.commands.superscript={exec:function(n,r){e.commands.formatInline.exec(n,r,t)},state:function(n,r){return e.commands.formatInline.state(n,r,t)}}}(e),function(e){function c(e){var t;while(t=e.querySelector("._wysihtml5-temp"))t.parentNode.removeChild(t)}var t=90,n=89,r=8,i=46,s=25,o="data-wysihtml5-selection-node",u="data-wysihtml5-selection-offset",a='<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+e.INVISIBLE_SPACE+"</span>",f='<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+e.INVISIBLE_SPACE+"</span>",l=e.dom;e.UndoManager=e.lang.Dispatcher.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.element=this.composer.element,this.position=0,this.historyStr=[],this.historyDom=[],this.transact(),this._observe()},_observe:function(){var e=this,s=this.composer.sandbox.getDocument(),o;l.observe(this.element,"keydown",function(r){if(r.altKey||!r.ctrlKey&&!r.metaKey)return;var i=r.keyCode,s=i===t&&!r.shiftKey,o=i===t&&r.shiftKey||i===n;s?(e.undo(),r.preventDefault()):o&&(e.redo(),r.preventDefault())}),l.observe(this.element,"keydown",function(t){var n=t.keyCode;if(n===o)return;o=n,(n===r||n===i)&&e.transact()}),this.editor.on("newword:composer",function(){e.transact()}).on("beforecommand:composer",function(){e.transact()})},transact:function(){var t=this.historyStr[this.position-1],n=this.composer.getValue(!1,!1),r=this.element.offsetWidth>0&&this.element.offsetHeight>0,i,a,f,l,c;if(n===t)return;var h=this.historyStr.length=this.historyDom.length=this.position;h>s&&(this.historyStr.shift(),this.historyDom.shift(),this.position--),this.position++,r&&(i=this.composer.selection.getRange(),a=i&&i.startContainer?i.startContainer:this.element,f=i&&i.startOffset?i.startOffset:0,a.nodeType===e.ELEMENT_NODE?l=a:(l=a.parentNode,c=this.getChildNodeIndex(l,a)),l.setAttribute(u,f),typeof c!="undefined"&&l.setAttribute(o,c));var p=this.element.cloneNode(!!n);this.historyDom.push(p),this.historyStr.push(n),l&&(l.removeAttribute(u),l.removeAttribute(o))},undo:function(){this.transact();if(!this.undoPossible())return;this.set(this.historyDom[--this.position-1]),this.editor.fire("undo:composer")},redo:function(){if(!this.redoPossible())return;this.set(this.historyDom[++this.position-1]),this.editor.fire("redo:composer")},undoPossible:function(){return this.position>1},redoPossible:function(){return this.position<this.historyStr.length},set:function(e){this.element.innerHTML="";var t=0,n=e.childNodes,r=e.childNodes.length;for(;t<r;t++)this.element.appendChild(n[t].cloneNode(!0));var i,s,a;e.hasAttribute(u)?(i=e.getAttribute(u),a=e.getAttribute(o),s=this.element):(s=this.element.querySelector("["+u+"]")||this.element,i=s.getAttribute(u),a=s.getAttribute(o),s.removeAttribute(u),s.removeAttribute(o)),a!==null&&(s=this.getChildNodeByIndex(s,+a)),this.composer.selection.set(s,i)},getChildNodeIndex:function(e,t){var n=0,r=e.childNodes,i=r.length;for(;n<i;n++)if(r[n]===t)return n},getChildNodeByIndex:function(e,t){return e.childNodes[t]}})}(e),e.views.View=t.extend({constructor:function(e,t,n){this.parent=e,this.element=t,this.config=n,this.config.noTextarea||this._observeViewChange()},_observeViewChange:function(){var e=this;this.parent.on("beforeload",function(){e.parent.on("change_view",function(t){t===e.name?(e.parent.currentView=e,e.show(),setTimeout(function(){e.focus()},0)):e.hide()})})},focus:function(){if(this.element&&this.element.ownerDocument&&this.element.ownerDocument.querySelector(":focus")===this.element)return;try{this.element&&this.element.focus()}catch(e){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),function(e){var t=e.dom,n=e.browser;e.views.Composer=e.views.View.extend({name:"composer",constructor:function(e,t,n){this.base(e,t,n),this.config.noTextarea?this.editableArea=t:this.textarea=this.parent.textarea,this.config.contentEditableMode?this._initContentEditableArea():this._initSandbox()},clear:function(){this.element.innerHTML=n.displaysCaretInEmptyContentEditableCorrectly()?"":"<br>"},getValue:function(t,n){var r=this.isEmpty()?"":e.quirks.getCorrectInnerHTML(this.element);return t!==!1&&(r=this.parent.parse(r,n===!1?!1:!0)),r},setValue:function(e,t){t!==!1&&(e=this.parent.parse(e));try{this.element.innerHTML=e}catch(n){this.element.innerText=e}},cleanUp:function(e){var t;this.selection&&(t=rangy.saveSelection(this.win)),this.parent.parse(this.element,undefined,e),t&&rangy.restoreSelection(t)},show:function(){this.editableArea.style.display=this._displayStyle||"",!this.config.noTextarea&&!this.textarea.element.disabled&&(this.disable(),this.enable())},hide:function(){this._displayStyle=t.getStyle("display").from(this.editableArea),this._displayStyle==="none"&&(this._displayStyle=null),this.editableArea.style.display="none"},disable:function(){this.parent.fire("disable:composer"),this.element.removeAttribute("contentEditable")},enable:function(){this.parent.fire("enable:composer"),this.element.setAttribute("contentEditable","true")},focus:function(t){e.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear(),this.base();var n=this.element.lastChild;t&&n&&this.selection&&(n.nodeName==="BR"?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getScrollPos:function(){if(this.doc&&this.win){var e={};return typeof this.win.pageYOffset!="undefined"?e.y=this.win.pageYOffset:e.y=(this.doc.documentElement||this.doc.body.parentNode||this.doc.body).scrollTop,typeof this.win.pageXOffset!="undefined"?e.x=this.win.pageXOffset:e.x=(this.doc.documentElement||this.doc.body.parentNode||this.doc.body).scrollLeft,e}},setScrollPos:function(e){e&&typeof e.x!="undefined"&&typeof e.y!="undefined"&&this.win.scrollTo(e.x,e.y)},getTextContent:function(){return t.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==(this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"))&&this.placeholderSet},isEmpty:function(){var e=this.element.innerHTML.toLowerCase();return/^(\s|<br>|<\/br>|<p>|<\/p>)*$/i.test(e)||e===""||e==="<br>"||e==="<p></p>"||e==="<p><br></p>"||this.hasPlaceholderSet()},_initContentEditableArea:function(){var e=this;this.config.noTextarea?this.sandbox=new t.ContentEditableArea(function(){e._create()},{className:this.config.classNames.sandbox},this.editableArea):(this.sandbox=new t.ContentEditableArea(function(){e._create()},{className:this.config.classNames.sandbox}),this.editableArea=this.sandbox.getContentEditable(),t.insert(this.editableArea).after(this.textarea.element),this._createWysiwygFormField())},_initSandbox:function(){var e=this;this.sandbox=new t.Sandbox(function(){e._create()},{stylesheets:this.config.stylesheets,className:this.config.classNames.sandbox}),this.editableArea=this.sandbox.getIframe();var n=this.textarea.element;t.insert(this.editableArea).after(n),this._createWysiwygFormField()},_createWysiwygFormField:function(){if(this.textarea.element.form){var e=document.createElement("input");e.type="hidden",e.name="_wysihtml5_mode",e.value=1,t.insert(e).after(this.textarea.element)}},_create:function(){var r=this;this.doc=this.sandbox.getDocument(),this.win=this.sandbox.getWindow(),this.element=this.config.contentEditableMode?this.sandbox.getContentEditable():this.doc.body,this.config.noTextarea?this.cleanUp():(this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0,!1)),this.selection=new e.Selection(this.parent,this.element,this.config.classNames.uneditableContainer),this.commands=new e.Commands(this.parent),this.config.noTextarea||t.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element),t.addClass(this.element,this.config.classNames.composer),this.config.style&&!this.config.contentEditableMode&&this.style(),this.observe();var i=this.config.name;i&&(t.addClass(this.element,i),this.config.contentEditableMode||t.addClass(this.editableArea,i)),this.enable(),!this.config.noTextarea&&this.textarea.element.disabled&&this.disable();var s=typeof this.config.placeholder=="string"?this.config.placeholder:this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder");s&&t.simulatePlaceholder(this.parent,this,s,this.config.classNames.placeholder),this.commands.exec("styleWithCSS",!1),this._initAutoLinking(),this._initObjectResizing(),this._initUndoManager(),this._initLineBreaking(),!this.config.noTextarea&&(this.textarea.element.hasAttribute("autofocus")||document.querySelector(":focus")==this.textarea.element)&&!n.isIos()&&setTimeout(function(){r.focus(!0)},100),n.clearsContentEditableCorrectly()||e.quirks.ensureProperClearing(this),this.initSync&&this.config.sync&&this.initSync(),this.config.noTextarea||this.textarea.hide(),this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var r=this,i=n.canDisableAutoLinking(),s=n.doesAutoLinkingInContentEditable();if(i){var o=this.element.innerHTML;this.commands.exec("AutoUrlDetect",!1,!1),this.element.innerHTML=o}if(!this.config.autoLink)return;if(!s||s&&i)this.parent.on("newword:composer",function(){if(t.getTextContent(r.element).match(t.autoLink.URL_REG_EXP)){var n=r.selection.getSelectedNode(),i=r.element.querySelectorAll("."+r.config.classNames.uneditableContainer),s=!1;for(var o=i.length;o--;)e.dom.contains(i[o],n)&&(s=!0);s||t.autoLink(n,[r.config.classNames.uneditableContainer])}}),t.observe(this.element,"blur",function(){t.autoLink(r.element,[r.config.classNames.uneditableContainer])});var u=this.sandbox.getDocument().getElementsByTagName("a"),a=t.autoLink.URL_REG_EXP,f=function(n){var r=e.lang.string(t.getTextContent(n)).trim();return r.substr(0,4)==="www."&&(r="http://"+r),r};t.observe(this.element,"keydown",function(e){if(!u.length)return;var n=r.selection.getSelectedNode(e.target.ownerDocument),i=t.getParentElement(n,{query:"a"},4),s;if(!i)return;s=f(i),setTimeout(function(){var e=f(i);if(e===s)return;e.match(a)&&i.setAttribute("href",e)},0)})},_initObjectResizing:function(){this.commands.exec("enableObjectResizing",!0);if(n.supportsEvent("resizeend")){var r=["width","height"],i=r.length,s=this.element;t.observe(s,"resizeend",function(t){var n=t.target||t.srcElement,o=n.style,u=0,a;if(n.nodeName!=="IMG")return;for(;u<i;u++)a=r[u],o[a]&&(n.setAttribute(a,parseInt(o[a],10)),o[a]="");e.quirks.redraw(s)})}},_initUndoManager:function(){this.undoManager=new e.UndoManager(this.parent)},_initLineBreaking:function(){function o(e){var n=t.getParentElement(e,{query:"p, div"},2);n&&t.contains(r.element,n)&&r.selection.executeAndRestore(function(){r.config.useLineBreaks?t.replaceWithChildNodes(n):n.nodeName!=="P"&&t.renameElement(n,"p")})}var r=this,i="li, p, h1, h2, h3, h4, h5, h6",s="ul, ol, menu";this.config.useLineBreaks||t.observe(this.element,["focus","keydown"],function(){if(r.isEmpty()){var e=r.doc.createElement("P");r.element.innerHTML="",r.element.appendChild(e),n.displaysCaretInEmptyContentEditableCorrectly()?r.selection.selectNode(e,!0):(e.innerHTML="<br>",r.selection.setBefore(e.firstChild))}}),t.observe(this.element,"keydown",function(n){var u=n.keyCode;if(n.shiftKey)return;if(u!==e.ENTER_KEY&&u!==e.BACKSPACE_KEY)return;var a=t.getParentElement(r.selection.getSelectedNode(),{query:i},4);if(a){setTimeout(function(){var n=r.selection.getSelectedNode(),i;if(a.nodeName==="LI"){if(!n)return;i=t.getParentElement(n,{query:s},2),i||o(n)}u===e.ENTER_KEY&&a.nodeName.match(/^H[1-6]$/)&&o(n)},0);return}r.config.useLineBreaks&&u===e.ENTER_KEY&&!e.browser.insertsLineBreaksOnReturn()&&(n.preventDefault(),r.commands.exec("insertLineBreak"))})}})}(e),function(e){var t=e.dom,n=document,r=window,i=n.createElement("div"),s=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],o=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],u=["html                 { height: 100%; }","body                 { height: 100%; padding: 1px 0 0 0; margin: -1px 0 0 0; }","body > p:first-child { margin-top: 0; }","._wysihtml5-temp     { display: none; }",e.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","img:-moz-broken      { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],a=function(e){if(e.setActive)try{e.setActive()}catch(i){}else{var s=e.style,o=n.documentElement.scrollTop||n.body.scrollTop,u=n.documentElement.scrollLeft||n.body.scrollLeft,a={position:s.position,top:s.top,left:s.left,WebkitUserSelect:s.WebkitUserSelect};t.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(e),e.focus(),t.setStyles(a).on(e),r.scrollTo&&r.scrollTo(u,o)}};e.views.Composer.prototype.style=function(){var r=this,f=n.querySelector(":focus"),l=this.textarea.element,c=l.hasAttribute("placeholder"),h=c&&l.getAttribute("placeholder"),p=l.style.display,d=l.disabled,v;this.focusStylesHost=i.cloneNode(!1),this.blurStylesHost=i.cloneNode(!1),this.disabledStylesHost=i.cloneNode(!1),c&&l.removeAttribute("placeholder"),l===f&&l.blur(),l.disabled=!1,l.style.display=v="none";if(l.getAttribute("rows")&&t.getStyle("height").from(l)==="auto"||l.getAttribute("cols")&&t.getStyle("width").from(l)==="auto")l.style.display=v=p;t.copyStyles(o).from(l).to(this.editableArea).andTo(this.blurStylesHost),t.copyStyles(s).from(l).to(this.element).andTo(this.blurStylesHost),t.insertCSS(u).into(this.element.ownerDocument),l.disabled=!0,t.copyStyles(o).from(l).to(this.disabledStylesHost),t.copyStyles(s).from(l).to(this.disabledStylesHost),l.disabled=d,l.style.display=p,a(l),l.style.display=v,t.copyStyles(o).from(l).to(this.focusStylesHost),t.copyStyles(s).from(l).to(this.focusStylesHost),l.style.display=p,t.copyStyles(["display"]).from(l).to(this.editableArea);var m=e.lang.array(o).without(["display"]);return f?f.focus():l.blur(),c&&l.setAttribute("placeholder",h),this.parent.on("focus:composer",function(){t.copyStyles(m).from(r.focusStylesHost).to(r.editableArea),t.copyStyles(s).from(r.focusStylesHost).to(r.element)}),this.parent.on("blur:composer",function(){t.copyStyles(m).from(r.blurStylesHost).to(r.editableArea),t.copyStyles(s).from(r.blurStylesHost).to(r.element)}),this.parent.observe("disable:composer",function(){t.copyStyles(m).from(r.disabledStylesHost).to(r.editableArea),t.copyStyles(s).from(r.disabledStylesHost).to(r.element)}),this.parent.observe("enable:composer",function(){t.copyStyles(m).from(r.blurStylesHost).to(r.editableArea),t.copyStyles(s).from(r.blurStylesHost).to(r.element)}),this}}(e),function(e){var t=e.dom,n=e.browser,r={66:"bold",73:"italic",85:"underline"},i=function(e,t,n){for(var r=0,i=t.length;r<i;r++)e.addEventListener(t[r],n,!1)},s=function(e,t,n){for(var r=0,i=t.length;r<i;r++)e.removeEventListener(t[r],n,!1)},o=function(t,n){if(t.selection.caretIsLastInSelection()){var r=t.selection.getSelection(),i=r.anchorNode;if(i&&i.nodeType===1&&(e.dom.getParentElement(i,{query:"td, th"},!1,t.element)||n)){var s=i.childNodes[r.anchorOffset];if(s&&s.nodeType===1&s.nodeName==="BR")return s.parentNode.removeChild(s),!0}}return!1},u=function(e){var t=e.selection.getBeforeSelection(!0);if(t&&(t.type==="element"||t.type==="leafnode")&&t.node.nodeType===1&&t.node.classList.contains(e.config.classNames.uneditableContainer)){if(o(e,!0))return!0;try{var n=new CustomEvent("wysihtml5:uneditable:delete");t.node.dispatchEvent(n)}catch(r){}return t.node.parentNode.removeChild(t.node),!0}return!1},a=function(t){var n=t.selection,r=n.getPreviousNode();if(n.caretIsFirstInSelection()&&r&&r.nodeType===1&&/block/.test(t.win.getComputedStyle(r).display)){if(/^\s*$/.test(r.textContent||r.innerText))return r.parentNode.removeChild(r),!0;if(r.lastChild){var i=r.lastChild,s=n.getSelectedNode(),o=e.dom.domNode(r).commonAncestor(s,t.element);curNode=o?e.dom.getParentElement(s,{query:"h1, h2, h3, h4, h5, h6, p, pre, div, blockquote"},!1,o):null;if(curNode){while(curNode.firstChild)r.appendChild(curNode.firstChild);return n.setAfter(i),!0}if(s.nodeType===3)return r.appendChild(s),n.setAfter(i),!0}}return!1},f=function(e,t){var n=t.selection,r=t.element;if(n.isCollapsed()){if(a(t)){e.preventDefault();return}if(o(t)){e.preventDefault();return}if(u(t)){e.preventDefault();return}}else n.containsUneditable()&&(e.preventDefault(),n.deleteContents())},l=function(e,t,n){if(!e.selection.isCollapsed())e.selection.deleteContents();else if(e.selection.caretIsInTheBeginnig("li"))if(n){if(e.commands.exec("outdentList"))return}else if(e.commands.exec("indentList"))return;e.commands.exec("insertHTML","&emsp;")},c=function(e){this.domNodeRemovedInterval&&clearInterval(domNodeRemovedInterval),this.parent.fire("destroy:composer")},h=function(e){this.parent.fire("beforeinteraction",e).fire("beforeinteraction:composer",e),setTimeout(function(){this.parent.fire("interaction",e).fire("interaction:composer",e)}.bind(this),0)},p=function(e){this.parent.fire("focus",e).fire("focus:composer",e),setTimeout(function(){this.focusState=this.getValue(!1,!1)}.bind(this),0)},d=function(e){if(this.focusState!==this.getValue(!1,!1)){var t=e;typeof Object.create=="function"&&(t=Object.create(e,{type:{value:"change"}})),this.parent.fire("change",t).fire("change:composer",t)}this.parent.fire("blur",e).fire("blur:composer",e)},v=function(e){this.parent.fire(e.type,e).fire(e.type+":composer",e),e.type==="paste"&&setTimeout(function(){this.parent.fire("newword:composer")}.bind(this),0)},m=function(t){this.config.copyedFromMarking&&(e.browser.supportsModernPaste()&&(t.clipboardData.setData("text/html",this.config.copyedFromMarking+this.selection.getHtml()),t.clipboardData.setData("text/plain",this.selection.getPlainText()),t.preventDefault()),this.parent.fire(t.type,t).fire(t.type+":composer",t))},g=function(t){var n=t.keyCode;(n===e.SPACE_KEY||n===e.ENTER_KEY)&&this.parent.fire("newword:composer")},y=function(t){if(!n.canSelectImagesInContentEditable()){var r=t.target,i=this.element.querySelectorAll("img"),s=this.element.querySelectorAll("."+this.config.classNames.uneditableContainer+" img"),o=e.lang.array(i).without(s);r.nodeName==="IMG"&&e.lang.array(o).contains(r)&&this.selection.selectNode(r)}},b=function(e){var t={IMG:"Image: ",A:"Link: "},n=e.target,r=n.nodeName,i;if(r!=="A"&&r!=="IMG")return;n.hasAttribute("title")||(i=t[r]+(n.getAttribute("href")||n.getAttribute("src")),n.setAttribute("title",i))},w=function(t){if(this.config.classNames.uneditableContainer){var n=e.dom.getParentElement(t.target,{query:"."+this.config.classNames.uneditableContainer},!1,this.element);n&&this.selection.setAfter(n)}},E=function(e){n.canSelectImagesInContentEditable()||setTimeout(function(){this.selection.getSelection().removeAllRanges()}.bind(this),0)},S=function(t){var n=t.keyCode,i=r[n],s,o;if((t.ctrlKey||t.metaKey)&&!t.altKey&&n===65){this.selection.selectAll(),t.preventDefault();return}(t.ctrlKey||t.metaKey)&&!t.altKey&&i&&(this.commands.exec(i),t.preventDefault()),n===e.BACKSPACE_KEY&&f(t,this);if(n===e.BACKSPACE_KEY||n===e.DELETE_KEY)s=this.selection.getSelectedNode(!0),s&&s.nodeName==="IMG"&&(t.preventDefault(),o=s.parentNode,o.removeChild(s),o.nodeName==="A"&&!o.firstChild&&o.parentNode.removeChild(o),setTimeout(function(){e.quirks.redraw(this.element)}.bind(this),0));this.config.handleTabKey&&n===e.TAB_KEY&&(t.preventDefault(),l(this,this.element,t.shiftKey))},x=function(e){setTimeout(function(){this.doc.querySelector(":focus")!==this.element&&this.focus()}.bind(this),0)},T=function(e){setTimeout(function(){this.selection.getSelection().removeAllRanges()}.bind(this),0)},N=function(){var t=function(){window.removeEventListener("load",t),this.doc.execCommand("enableObjectResizing",!1,"false"),this.doc.execCommand("enableInlineTableEditing",!1,"false")}.bind(this),n=function(){t.call(this),s(this.sandbox.getIframe(),["focus","mouseup","mouseover"],n)}.bind(this);this.doc.execCommand&&e.browser.supportsCommand(this.doc,"enableObjectResizing")&&e.browser.supportsCommand(this.doc,"enableInlineTableEditing")&&(this.sandbox.getIframe?i(this.sandbox.getIframe(),["focus","mouseup","mouseover"],n):window.addEventListener("load",t)),this.tableSelection=e.quirks.tableCellsSelection(this.element,this.parent)};e.views.Composer.prototype.observe=function(){var e=this,r=this.sandbox.getIframe?this.sandbox.getIframe():this.sandbox.getContentEditable(),s=this.element,o=n.supportsEventsInIframeCorrectly()||this.sandbox.getContentEditable?this.element:this.sandbox.getWindow();this.focusState=this.getValue(!1,!1),r.addEventListener(["DOMNodeRemoved"],c.bind(this),!1),n.supportsMutationEvents()||(this.domNodeRemovedInterval=setInterval(function(){t.contains(document.documentElement,r)||c.call(this)},250)),this.config.handleTables&&N.call(this),i(o,["drop","paste","mouseup","focus","keyup"],h.bind(this)),o.addEventListener("focus",p.bind(this),!1),o.addEventListener("blur",d.bind(this),!1),i(this.element,["drop","paste","beforepaste"],v.bind(this),!1),this.element.addEventListener("copy",m.bind(this),!1),this.element.addEventListener("mousedown",y.bind(this),!1),this.element.addEventListener("mouseover",b.bind(this),!1),this.element.addEventListener("click",w.bind(this),!1),this.element.addEventListener("drop",E.bind(this),!1),this.element.addEventListener("keyup",g.bind(this),!1),this.element.addEventListener("keydown",S.bind(this),!1),this.element.addEventListener("dragenter",function(){this.parent.fire("unset_placeholder")}.bind(this),!1)}}(e),function(e){var n=400;e.views.Synchronizer=t.extend({constructor:function(e,t,n){this.editor=e,this.textarea=t,this.composer=n,this._observe()},fromComposerToTextarea:function(t){this.textarea.setValue(e.lang.string(this.composer.getValue(!1,!1)).trim(),t)},fromTextareaToComposer:function(e){var t=this.textarea.getValue(!1,!1);t?this.composer.setValue(t,e):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(e){this.editor.currentView.name==="textarea"?this.fromTextareaToComposer(e):this.fromComposerToTextarea(e)},_observe:function(){var t,r=this,i=this.textarea.element.form,s=function(){t=setInterval(function(){r.fromComposerToTextarea()},n)},o=function(){clearInterval(t),t=null};s(),i&&(e.dom.observe(i,"submit",function(){r.sync(!0)}),e.dom.observe(i,"reset",function(){setTimeout(function(){r.fromTextareaToComposer()},0)})),this.editor.on("change_view",function(e){e==="composer"&&!t?(r.fromTextareaToComposer(!0),s()):e==="textarea"&&(r.fromComposerToTextarea(!0),o())}),this.editor.on("destroy:composer",o)}})}(e),function(e){e.views.SourceView=t.extend({constructor:function(e,t){this.editor=e,this.composer=t,this._observe()},switchToTextarea:function(e){var t=this.composer.win.getComputedStyle(this.composer.element),n=parseFloat(t.width),r=Math.max(parseFloat(t.height),100);this.textarea||(this.textarea=this.composer.doc.createElement("textarea"),this.textarea.className="wysihtml5-source-view"),this.textarea.style.width=n+"px",this.textarea.style.height=r+"px",this.textarea.value=this.editor.getValue(e,!0),this.composer.element.parentNode.insertBefore(this.textarea,this.composer.element),this.editor.currentView="source",this.composer.element.style.display="none"},switchToComposer:function(e){var t=this.textarea.value;t?this.composer.setValue(t,e):(this.composer.clear(),this.editor.fire("set_placeholder")),this.textarea.parentNode.removeChild(this.textarea),this.editor.currentView=this.composer,this.composer.element.style.display=""},_observe:function(){this.editor.on("change_view",function(e){e==="composer"?this.switchToComposer(!0):e==="textarea"&&this.switchToTextarea(!0)}.bind(this))}})}(e),e.views.Textarea=e.views.View.extend({name:"textarea",constructor:function(e,t,n){this.base(e,t,n),this._observe()},clear:function(){this.element.value=""},getValue:function(e){var t=this.isEmpty()?"":this.element.value;return e!==!1&&(t=this.parent.parse(t)),t},setValue:function(e,t){t!==!1&&(e=this.parent.parse(e)),this.element.value=e},cleanUp:function(e){var t=this.parent.parse(this.element.value,undefined,e);this.element.value=t},hasPlaceholderSet:function(){var t=e.browser.supportsPlaceholderAttributeOn(this.element),n=this.element.getAttribute("placeholder")||null,r=this.element.value,i=!r;return t&&i||r===n},isEmpty:function(){return!e.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var t=this.element,n=this.parent,r={focusin:"focus",focusout:"blur"},i=e.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];n.on("beforeload",function(){e.dom.observe(t,i,function(e){var t=r[e.type]||e.type;n.fire(t).fire(t+":textarea")}),e.dom.observe(t,["paste","drop"],function(){setTimeout(function(){n.fire("paste").fire("paste:textarea")},0)})})}}),function(e){var t,n={name:t,style:!0,toolbar:t,showToolbarAfterInit:!0,showToolbarDialogsOnSelection:!0,autoLink:!0,handleTables:!0,handleTabKey:!0,parserRules:{tags:{br:{},span:{},div:{},p:{},b:{},i:{},u:{}},classes:{}},pasteParserRulesets:null,parser:e.dom.parse,useLineBreaks:!0,stylesheets:[],placeholderText:t,supportTouchDevices:!0,cleanUp:!0,contentEditableMode:!1,classNames:{composer:"wysihtml5-editor",body:"wysihtml5-supported",sandbox:"wysihtml5-sandbox",placeholder:"wysihtml5-placeholder",uneditableContainer:"wysihtml5-uneditable-container"},copyedFromMarking:'<meta name="copied-from" content="wysihtml5">'};e.Editor=e.lang.Dispatcher.extend({constructor:function(t,r){this.editableElement=typeof t=="string"?document.getElementById(t):t,this.config=e.lang.object({}).merge(n).merge(r).get(),this._isCompatible=e.browser.supported(),r&&r.classNames&&e.lang.object(this.config.classNames).merge(r.classNames),this.editableElement.nodeName.toLowerCase()!="textarea"&&(this.config.contentEditableMode=!0,this.config.noTextarea=!0),this.config.noTextarea||(this.textarea=new e.views.Textarea(this,this.editableElement,this.config),this.currentView=this.textarea);if(!this._isCompatible||!this.config.supportTouchDevices&&e.browser.isTouchDevice()){var i=this;setTimeout(function(){i.fire("beforeload").fire("load")},0);return}e.dom.addClass(document.body,this.config.classNames.body),this.composer=new e.views.Composer(this,this.editableElement,this.config),this.currentView=this.composer,typeof this.config.parser=="function"&&this._initParser(),this.on("beforeload",this.handleBeforeLoad)},handleBeforeLoad:function(){this.config.noTextarea?this.sourceView=new e.views.SourceView(this,this.composer):this.synchronizer=new e.views.Synchronizer(this,this.textarea,this.composer),this.config.toolbar&&(this.toolbar=new e.toolbar.Toolbar(this,this.config.toolbar,this.config.showToolbarAfterInit))},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(e,t){return this.currentView.getValue(e,t)},setValue:function(e,t){return this.fire("unset_placeholder"),e?(this.currentView.setValue(e,t),this):this.clear()},cleanUp:function(e){this.currentView.cleanUp(e)},focus:function(e){return this.currentView.focus(e),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},destroy:function(){this.composer&&this.composer.sandbox&&this.composer.sandbox.destroy(),this.toolbar&&this.toolbar.destroy(),this.off()},parse:function(t,n,r){var i=this.config.contentEditableMode?document:this.composer?this.composer.sandbox.getDocument():null,s=this.config.parser(t,{rules:r||this.config.parserRules,cleanUp:this.config.cleanUp,context:i,uneditableClass:this.config.classNames.uneditableContainer,clearInternals:n});return typeof t=="object"&&e.quirks.redraw(t),s},_initParser:function(){var t;e.browser.supportsModernPaste()?this.on("paste:composer",function(n){n.preventDefault(),t=e.dom.getPastedHtml(n),t&&this._cleanAndPaste(t)}.bind(this)):this.on("beforepaste:composer",function(t){t.preventDefault();var n=this.composer.getScrollPos();e.dom.getPastedHtmlWithDiv(this.composer,function(e){e&&this._cleanAndPaste(e),this.composer.setScrollPos(n)}.bind(this))}.bind(this))},_cleanAndPaste:function(t){var n=e.quirks.cleanPastedHTML(t,{referenceNode:this.composer.element,rules:this.config.pasteParserRulesets||[{set:this.config.parserRules}],uneditableClass:this.config.classNames.uneditableContainer});this.composer.selection.deleteContents(),this.composer.selection.insertHTML(n)}})}(e),window.wysihtml5=e}),define("js/constants/img-urls",[],function(){var e="/resources/img/";return{FAVICON:e+"favicon.ico",FAVICON_SHORTCUT:"/favicon.ico",FAVICON32:e+"favicon-32.png",FAVICON57:e+"favicon-57.png",FAVICON72:e+"favicon-72.png",FAVICON96:e+"favicon-96.png",FAVICON120:e+"favicon-120.png",FAVICON128:e+"favicon-128.png",FAVICON144:e+"favicon-144.png",FAVICON152:e+"favicon-152.png",FAVICON195:e+"favicon-195.png",FAVICON228:e+"favicon-228.png",BRAND:e+"brand.png",BRAND_SMALL:e+"shortbrand.png",POST_ICON:e+"quillpen.svg",POST_ICON_PNG:e+"quillpen.png",OPEN_GRAPH:e+"ogimg.jpg",PAYMENT_BUTTON:"https://www.paypalobjects.com/en_US/i/btn/x-click-but6.gif",PAYMENT_LABEL:"https://www.paypalobjects.com/en_US/i/logo/PayPal_mark_60x38.gif",getBaseUrl:function(){return e}}}),define("js/constants/resources",["js/constants/api","js/constants/api-urls","js/constants/img-urls","js/constants/values"],function(e,t,n,r){var i="https://cdnjs.cloudflare.com/ajax/libs/",s="/resources/",o=s+"libs/js/",u=s+"libs/css/",a="2.1.11",f="3.2.0",l="0.12.0",c="4.2.0",h="3.0.1",p="2.7.2",d="1.4.2",v="1.3.3",m="0.2.10",g="1.11.0",y="1.4.1",b="1.6.3",w="2.6.0",E="4.2.0",S="1.2.0",x="1.0.3";return{js:s+"js",jsLibs:s+"libs",versionRequire:a,versionBootstrap:f,versionAngularUiBootstrap:l,versionFontAwesome:c,versionNormalizr:h,versionModernizr:p,versionRespond:d,versionAngular:v,versionAngularUiRouter:m,versionJquery:g,versionJqueryCookie:y,versionI18next:b,versionMoment:w,versionZxcvbn:E,versionShowdown:S,versionAngulartics:x,cssBase:s+"css/app.css",imgIcon:n.MONEY_THUMB,jsRequire:i+"require.js/"+a+"/require.js",jsModernizr:i+"modernizr/"+p+"/modernizr.min.js",jsRespond:i+"respond.js/"+d+"/respond.min.js",jsXdomain:e.getPublicBaseUrl()+t.CORS_PROXY_JS,htmlXdomain:e.getPublicBaseUrl()+t.CORS_PROXY_HTML,jsRecaptcha:"https://www.google.com/recaptcha/api.js?onload="+r.RECAPTCHA_ONLOAD+"&render=explicit",jsBrowserFixes:s+"inline/browser-fixes.js",jsBrowserFixesMin:s+"inline/browser-fixes.min.js",jsBootstrap:i+"twitter-bootstrap/"+f+"/js/bootstrap.min",cssBootstrap:i+"twitter-bootstrap/"+f+"/css/bootstrap.min.css",cssFontAwesome:i+"font-awesome/"+c+"/css/font-awesome.min.css",cssNormalizr:i+"normalize/"+h+"/normalize.min.css",jsJquery:i+"jquery/"+g+"/jquery.min",jsJqueryCookie:i+"jquery-cookie/"+y+"/jquery.cookie.min",jsAngular:i+"angular.js/"+v+"/angular.min",jsAngularSanitize:i+"angular.js/"+v+"/angular-sanitize.min",jsAngularRoute:i+"angular.js/"+v+"/angular-route.min",jsAngularUiRouter:i+"angular-ui-router/"+m+"/angular-ui-router.min",jsAngularUiBootstrap:i+"angular-ui-bootstrap/"+l+"/ui-bootstrap-tpls.min",jsI18next:i+"i18next/"+b+"/i18next.amd-"+b+".min",jsMoment:i+"moment.js/"+w+"/moment.min",jsZxcvbn:i+"zxcvbn/"+E+"/zxcvbn",jsShowdown:i+"showdown/"+S+"/showdown.min",jsAngulartics:i+"angulartics/"+x+"/angulartics.min",jsAngularticsClicky:i+"angulartics/"+x+"/angulartics-clicky.min",jsPayPal:"https://www.paypalobjects.com/js/external/apdg",jsPyMin:s+"py.min.js",jsPy:"js/main",jsBlankAdmin:s+"js/blank-admin",jsBlankDef:s+"js/blank-def",fallback:{cssBase:s+"css/app.css",jsRequire:o+"require.min.js",jsModernizr:o+"modernizr.min.js",jsBootstrap:o+"bootstrap.min",jsJquery:o+"jquery.min",jsJqueryCookie:o+"jquery.cookie.min",jsAngular:o+"angular.min",jsAngularSanitize:o+"angular-sanitize.min",jsAngularRoute:o+"angular-route.min",jsAngularUiRouter:o+"angular-ui-router.min",jsAngularUiBootstrap:o+"ui-bootstrap-tpls.min",jsI18next:o+"i18next.amd.min",jsMoment:o+"moment.min",jsZxcvbn:o+"zxcvbn",jsShowdown:o+"showdown.min",jsAngulartics:o+"angulartics.min",jsAngularticsClicky:o+"angulartics-clicky.min",jsPayPal:o+"apdg"}}}),define("js/constants/wysihtml-parser-rules",[],function(){var e={blockLevelEl:{check_attributes:{id:"any"}},makeDiv:{rename_tag:"div",one_of_type:{alignment_object:1},remove_action:"unwrap",check_attributes:{id:"any"}}},t={classes:"any",classes_blacklist:{"Apple-interchange-newline":1,MsoNormal:1,MsoPlainText:1},type_definitions:{alignment_object:{classes:{"wysiwyg-text-align-center":1,"wysiwyg-text-align-justify":1,"wysiwyg-text-align-left":1,"wysiwyg-text-align-right":1,"wysiwyg-float-left":1,"wysiwyg-float-right":1},styles:{"float":["left","right"],"text-align":["left","right","center"]}},valid_image_src:{attrs:{src:/^[^data\:]/i}},text_color_object:{styles:{color:!0,"background-color":!0}},text_fontsize_object:{styles:{"font-size":!0}},text_formatting_object:{classes:{"wysiwyg-color-aqua":1,"wysiwyg-color-black":1,"wysiwyg-color-blue":1,"wysiwyg-color-fuchsia":1,"wysiwyg-color-gray":1,"wysiwyg-color-green":1,"wysiwyg-color-lime":1,"wysiwyg-color-maroon":1,"wysiwyg-color-navy":1,"wysiwyg-color-olive":1,"wysiwyg-color-purple":1,"wysiwyg-color-red":1,"wysiwyg-color-silver":1,"wysiwyg-color-teal":1,"wysiwyg-color-white":1,"wysiwyg-color-yellow":1,"wysiwyg-font-size-large":1,"wysiwyg-font-size-larger":1,"wysiwyg-font-size-medium":1,"wysiwyg-font-size-small":1,"wysiwyg-font-size-smaller":1,"wysiwyg-font-size-x-large":1,"wysiwyg-font-size-x-small":1,"wysiwyg-font-size-xx-large":1,"wysiwyg-font-size-xx-small":1}}},comments:1,tags:{tr:{check_attributes:{id:"any"}},strike:{unwrap:1},form:{unwrap:1},rt:{rename_tag:"span"},code:{},acronym:{rename_tag:"span"},br:{add_class:{clear:"clear_br"}},details:{unwrap:1},h4:e.blockLevelEl,em:{},title:{unwrap:1},multicol:{unwrap:1},figure:{unwrap:1},xmp:{unwrap:1},small:{rename_tag:"span",set_class:"wysiwyg-font-size-smaller"},area:{remove:1},time:{unwrap:1},dir:{rename_tag:"ul"},bdi:{unwrap:1},command:{unwrap:1},ul:{check_attributes:{id:"any"}},progress:{rename_tag:"span"},dfn:{unwrap:1},iframe:{remove:1},figcaption:{unwrap:1},a:{check_attributes:{href:"href",rel:"any",target:"any",id:"any"}},img:{one_of_type:{valid_image_src:1},check_attributes:{width:"dimension",alt:"alt",src:"src",height:"dimension",id:"any"},add_class:{align:"align_img"}},rb:{unwrap:1},footer:e.makeDiv,noframes:{remove:1},abbr:{unwrap:1},u:{},bgsound:{remove:1},sup:{},address:{unwrap:1},basefont:{remove:1},nav:{unwrap:1},h1:e.blockLevelEl,head:{unwrap:1},tbody:e.blockLevelEl,dd:{unwrap:1},s:{unwrap:1},li:{},td:{check_attributes:{rowspan:"numbers",colspan:"numbers",valign:"any",align:"any",id:"any","class":"any"}},object:{remove:1},div:{one_of_type:{alignment_object:1},remove_action:"unwrap",check_attributes:{id:"any",contenteditable:"any"}},option:{remove:1},select:{remove:1},i:{},track:{remove:1},wbr:{remove:1},fieldset:{unwrap:1},big:{rename_tag:"span",set_class:"wysiwyg-font-size-larger"},button:{unwrap:1},noscript:{remove:1},svg:{remove:1},input:{remove:1},table:{check_attributes:{id:"any"}},keygen:{remove:1},h5:e.blockLevelEl,meta:{remove:1},map:{remove:1},isindex:{remove:1},mark:{unwrap:1},caption:e.blockLevelEl,tfoot:e.blockLevelEl,base:{remove:1},video:{remove:1},strong:{},canvas:{remove:1},output:{unwrap:1},marquee:{unwrap:1},b:{},q:{check_attributes:{cite:"url",id:"any"}},applet:{remove:1},span:{check_attributes:{id:"any"}},rp:{unwrap:1},spacer:{remove:1},source:{remove:1},aside:e.makeDiv,frame:{remove:1},section:e.makeDiv,body:{unwrap:1},ol:{},nobr:{unwrap:1},html:{unwrap:1},summary:{unwrap:1},"var":{unwrap:1},del:{unwrap:1},blockquote:{check_attributes:{cite:"url",id:"any"}},style:{remove:1},device:{remove:1},meter:{unwrap:1},h3:e.blockLevelEl,textarea:{unwrap:1},embed:{remove:1},hgroup:{unwrap:1},font:{unwrap:1},tt:{unwrap:1},noembed:{remove:1},thead:{check_attributes:{id:"any"}},blink:{unwrap:1},plaintext:{unwrap:1},xml:{remove:1},h6:e.blockLevelEl,param:{remove:1},th:{check_attributes:{rowspan:"numbers",colspan:"numbers",valign:"any",align:"any",id:"any"}},legend:{unwrap:1},hr:{},label:{unwrap:1},dl:{unwrap:1},kbd:{unwrap:1},listing:{unwrap:1},dt:{unwrap:1},nextid:{remove:1},pre:{},center:e.makeDiv,audio:{remove:1},datalist:{unwrap:1},samp:{unwrap:1},col:{remove:1},article:e.makeDiv,cite:{},link:{remove:1},script:{remove:1},bdo:{unwrap:1},menu:{rename_tag:"ul"},colgroup:{remove:1},ruby:{unwrap:1},h2:e.blockLevelEl,ins:{unwrap:1},p:e.blockLevelEl,sub:{},comment:{remove:1},frameset:{remove:1},optgroup:{unwrap:1},header:e.makeDiv}},n=function(e){if(typeof e=="undefined")return;var n=e.lang.object(t).clone(!0);n.comments=!1,n.selectors={"a u":"unwrap"},n.tags.style={remove:1},n.tags.script={remove:1},n.tags.head={remove:1};var r=e.lang.object(n).clone(!0);r.tags.div.one_of_type.alignment_object=1,r.tags.div.remove_action="unwrap",r.tags.div.check_attributes.style=!1,r.tags.div.keep_styles={textAlign:/^((left)|(right)|(center)|(justify))$/i,"float":1},r.tags.span.keep_styles=!1;var i=e.lang.object(r).clone(!0);i.classes={},window.wysihtml5ParserPasteRulesets=[{condition:/<font face="Times New Roman"|class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument|class="OutlineElement|id="?docs\-internal\-guid\-/i,set:i},{condition:/<meta name="copied-from" content="wysihtml5">/i,set:n},{set:r}]};return{extendRules:n,parserRules:t,parserRulesDefaults:e}}),define("js/directive/py-editor",["./module","jquery","angular","js/inlib/wysihtml","js/util/i18n","js/util/extra-templates","js/constants/resources","js/constants/states","js/constants/path-variables","js/constants/values","js/constants/regexes","js/constants/wysihtml-parser-rules","js/constants/events","js/constants/scope-variables","js/constants/chained-keys"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){e.directive("pyEditor",["$compile","$timeout","$window","$modal","$state","$parse","$rootScope","Single","ModalInterface","MarkdownConverter",function(e,r,v,m,g,y,b,w,E,S){var x=0,T=5;return{restrict:"A",replace:!0,template:"<div class='pyEditor'></div>",scope:{},link:function(m,w,E){var x=E.id,N=E.pyEditor,C=E.dirtyForm,k=E.placeholder,L="";typeof k!="undefined"&&(L=" placeholder='"+k+"'"),m.labels={},m.tooltips={},m.titles={},m.active={},m.showAdvanced=!1,m.htmlMode=!1;var A=!1;m.showTable=!1,m.showUser=!1,m.showTag=!1,m.showLink=!1,m.showImage=!1,m.showAttribution=!1,m.dropdownText=!1,m.dropdownAlign=!1,m.dropdownHeader=!1,m.dropdownFontSize=!1,m.dropdownFormat=!1,m.dropdownColor=!1,m.dropdownLinks=!1,m.dropdownSettings=!1,i(function(e){var t=function(t){m.labels[t]=e("shared:editorButtons."+t)};t("bold"),t("italic"),t("underline"),t("superscript"),t("subscript"),t("alignCenter"),t("alignLeft"),t("alignRight"),t("alignJustify"),t("h1"),t("h2"),t("normal"),t("quote"),t("code"),t("fontXSmall"),t("fontSmall"),t("fontMedium"),t("fontLarge"),t("fontXLarge"),t("ul"),t("ol"),t("indent"),t("lineBreak"),t("pageBreak"),t("colorBlack"),t("colorRed"),t("colorGreen"),t("colorBlue"),t("colorCyan"),t("colorMagenta"),t("colorYellow"),t("user"),t("tag"),t("link"),t("unlink"),t("image"),t("imageWidth"),t("imageHeight"),t("attribution"),t("attributionAuthor"),t("attributionAuthorLink"),t("attributionTitle"),t("attributionTitleLink"),t("attributionLicense"),t("attributionLicenseLink"),t("undo"),t("redo"),t("toggleView"),t("save"),t("cancel"),m.tooltips.text=e("shared:editorButtons.tooltips.text"),m.tooltips.align=e("shared:editorButtons.tooltips.align"),m.tooltips.header=e("shared:editorButtons.tooltips.header"),m.tooltips.fontSize=e("shared:editorButtons.tooltips.fontSize"),m.tooltips.format=e("shared:editorButtons.tooltips.format"),m.tooltips.color=e("shared:editorButtons.tooltips.color"),m.tooltips.links=e("shared:editorButtons.tooltips.links"),m.tooltips.settings=e("shared:editorButtons.tooltips.settings"),m.titles.bold=e("shared:editorButtons.titles.bold"),m.titles.italic=e("shared:editorButtons.titles.italic"),m.titles.underline=e("shared:editorButtons.titles.underline"),m.titles.indent=e("shared:editorButtons.titles.indent"),m.titles.undo=e("shared:editorButtons.titles.undo"),m.titles.redo=e("shared:editorButtons.titles.redo"),m.markdownWarning=e("alerts:editor.markdownWarning")});var O="<span class='buttonspacer'></span>",M=e("<div class='row'><span class='col-xs-12 well ng-hide' ng-hide='showAdvanced'><span ng-bind='markdownWarning'></span></span><div class='pyEditorButtonRow toolbar col-xs-12'>"+s.editorButtonDropdownOuter("dropdownText","fa-font","tooltips.text","!htmlMode",s.editorButtonDropdownInner("clearDropdowns();bold($event)","fa-bold","labels.bold","active.bold","{{titles.bold}}")+s.editorButtonDropdownInner("clearDropdowns();italic($event)","fa-italic","labels.italic","active.italic","{{titles.italic}}")+s.editorButtonDropdownInner("clearDropdowns();underline($event)","fa-underline","labels.underline","active.underline","{{titles.underline}}")+s.editorButtonDropdownInner("clearDropdowns();superscript($event)","fa-superscript","labels.superscript","active.superscript")+s.editorButtonDropdownInner("clearDropdowns();subscript($event)","fa-subscript","labels.subscript","active.subscript"))+s.editorButtonDropdownOuter("dropdownAlign","fa-align-center","tooltips.align","!htmlMode",s.editorButtonDropdownInner("clearDropdowns();alignLeft($event)","fa-align-left","labels.alignLeft","active.justifyLeft")+s.editorButtonDropdownInner("clearDropdowns();alignRight($event)","fa-align-right","labels.alignRight","active.justifyRight")+s.editorButtonDropdownInner("clearDropdowns();alignCenter($event)","fa-align-center","labels.alignCenter","active.justifyCenter")+s.editorButtonDropdownInner("clearDropdowns();alignJustify($event)","fa-align-justify","labels.alignJustify","active.justifyFull"))+s.editorButtonDropdownOuter("dropdownHeader","fa-header","tooltips.header","!htmlMode",s.editorButtonDropdownInner("clearDropdowns();header1($event)","fa-header","labels.h1")+s.editorButtonDropdownInner("clearDropdowns();header2($event)","fa-header","labels.h2")+s.editorButtonDropdownInner("clearDropdowns();normal($event)","fa-paragraph","labels.normal",undefined,undefined,"showAdvanced")+s.editorButtonDropdownInner("clearDropdowns();blockquote($event)","fa-quote-left","labels.quote")+s.editorButtonDropdownInner("clearDropdowns();code($event)","fa-code","labels.code"))+s.editorButtonDropdownOuter("dropdownFontSize","fa-text-height","tooltips.fontSize","!htmlMode",s.editorButtonDropdownInner("clearDropdowns();fontXSmall($event)","fa-angle-double-down","labels.fontXSmall","active.fontSizex-small")+s.editorButtonDropdownInner("clearDropdowns();fontSmall($event)","fa-angle-down","labels.fontSmall","active.fontSizesmall")+s.editorButtonDropdownInner("clearDropdowns();fontMedium($event)","fa-angle-right","labels.fontMedium","active.fontSizemedium")+s.editorButtonDropdownInner("clearDropdowns();fontLarge($event)","fa-angle-up","labels.fontLarge","active.fontSizelarge")+s.editorButtonDropdownInner("clearDropdowns();fontXLarge($event)","fa-angle-double-up","labels.fontXLarge","active.fontSizex-large"))+s.editorButtonDropdownOuter("dropdownFormat","fa-paragraph","tooltips.format","!htmlMode",s.editorButtonDropdownInner("clearDropdowns();unorderedList($event)","fa-list-ul","labels.ul")+s.editorButtonDropdownInner("clearDropdowns();orderedList($event)","fa-list-ol","labels.ol")+s.editorButtonDropdownInner("clearDropdowns();indent($event)","fa-indent","labels.indent",undefined,"{{titles.indent}}")+s.editorButtonDropdownInner("clearDropdowns();lineBreak($event)","fa-ellipsis-v","labels.lineBreak")+s.editorButtonDropdownInner("clearDropdowns();pageBreak($event)","fa-ellipsis-h","labels.pageBreak"))+s.editorButtonDropdownOuter("dropdownColor","fa-paint-brush","tooltips.color","!htmlMode",s.editorButtonDropdownInner("clearDropdowns();colorRed($event)","fa-tint wysiwyg-color-red","labels.colorRed","active.foreColorred")+s.editorButtonDropdownInner("clearDropdowns();colorGreen($event)","fa-tint wysiwyg-color-green","labels.colorGreen","active.foreColorgreen")+s.editorButtonDropdownInner("clearDropdowns();colorBlue($event)","fa-tint wysiwyg-color-blue","labels.colorBlue","active.foreColorblue")+s.editorButtonDropdownInner("clearDropdowns();colorCyan($event)","fa-tint wysiwyg-color-cyan","labels.colorCyan","active.foreColorcyan")+s.editorButtonDropdownInner("clearDropdowns();colorMagenta($event)","fa-tint wysiwyg-color-magenta","labels.colorMagenta","active.foreColormagenta")+s.editorButtonDropdownInner("clearDropdowns();colorYellow($event)","fa-tint wysiwyg-color-yellow","labels.colorYellow","active.foreColoryellow"))+s.editorButtonDropdownOuter("dropdownLinks","fa-external-link","tooltips.links","!htmlMode",s.editorButtonDropdownInner("dropdownLinks = false;addUser($event)","fa-user","labels.user")+s.editorButtonDropdownInner("dropdownLinks = false;addTag($event)","fa-tag","labels.tag")+s.editorButtonDropdownInner("clearDropdowns();link($event)","fa-link","labels.link")+s.editorButtonDropdownInner("clearDropdowns();removeLink($event)","fa-unlink","labels.unlink",undefined,undefined,"showAdvanced")+s.editorButtonDropdownInner("clearDropdowns();image($event)","fa-image","labels.image")+s.editorButtonDropdownInner("clearDropdowns();attribution($event)","fa-info","labels.attribution"))+s.editorButtonDropdownOuter("dropdownSettings","fa-gear","tooltips.settings","showAdvanced && !htmlMode",s.editorButtonDropdownInner("clearDropdowns();undo($event)","fa-undo","labels.undo",undefined,"{{titles.undo}}")+s.editorButtonDropdownInner("clearDropdowns();redo($event)","fa-repeat","labels.redo",undefined,"{{titles.redo}}")+s.editorButtonDropdownInner("clearDropdowns();toggleView($event)","fa-terminal","labels.toggleView"))+s.editorButton("clearDropdowns();toggleView($event)","fa-terminal","labels.toggleView",undefined,undefined,"showAdvanced && htmlMode")+"</div>"+"<div class='col-xs-12 pyEditorShowUser' ng-show='showUser'>"+"<label ng-bind='labels.user + \":&nbsp;\"'></label>"+"<input type='text' ng-model='userName' class='pyEditorUserName'>"+"<button type='button' class='btn btn-xs' ng-click='cancelInsert($event)' ng-bind='labels.cancel'></button>"+"<button type='button' class='btn btn-xs' ng-click='saveUser($event)' ng-bind='labels.save'></button>"+"</div>"+"<div class='col-xs-12 pyEditorShowTag' ng-show='showTag'>"+"<label ng-bind='labels.tag + \":&nbsp;\"'></label>"+"<input type='text' ng-model='tagName' class='pyEditorTagName'>"+"<button type='button' class='btn btn-xs' ng-click='cancelInsert($event)' ng-bind='labels.cancel'></button>"+"<button type='button' class='btn btn-xs' ng-click='saveTag($event)' ng-bind='labels.save'></button>"+"</div>"+"<div class='col-xs-12 pyEditorShowLink' ng-show='showLink'>"+"<label ng-bind='labels.link + \":&nbsp;\"'></label>"+"<input type='text' ng-model='linkHref' class='pyEditorLinkHref' placeholder='https://'>"+"<button type='button' class='btn btn-xs' ng-click='cancelInsert($event)' ng-bind='labels.cancel'></button>"+"<button type='button' class='btn btn-xs' ng-click='saveLink($event)' ng-bind='labels.save'></button>"+"</div>"+"<div class='col-xs-12 pyEditorShowImage' ng-show='showImage'>"+"<label ng-bind='labels.image + \":&nbsp;\"'></label>"+"<input type='text' ng-model='imageHref' class='pyEditorImageHref' placeholder='https://'>"+"<label ng-bind='labels.imageWidth + \":&nbsp;\"'></label>"+"<input type='text' ng-model='imageWidth'>"+"<label ng-bind='labels.imageHeight + \":&nbsp;\"'></label>"+"<input type='text' ng-model='imageHeight'>"+"<button type='button' class='btn btn-xs' ng-click='cancelInsert($event)' ng-bind='labels.cancel'></button>"+"<button type='button' class='btn btn-xs' ng-click='saveImage($event)' ng-bind='labels.save'></button>"+"</div>"+"<div class='col-xs-12 pyEditorShowAttribution' ng-show='showAttribution'>"+"<label ng-bind='labels.attributionAuthor + \":&nbsp;\"'></label>"+"<input type='text' ng-model='attributionAuthor' class='pyEditorAttributionAuthor'>"+"<label ng-bind='labels.attributionAuthorLink + \":&nbsp;\"'></label>"+"<input type='text' ng-model='attributionAuthorLink' class='pyEditorAttributionAuthorLink' placeholder='https://'>"+"<label ng-bind='labels.attributionTitle + \":&nbsp;\"'></label>"+"<input type='text' ng-model='attributionTitle' class='pyEditorAttributionTitle'>"+"<label ng-bind='labels.attributionTitleLink + \":&nbsp;\"'></label>"+"<input type='text' ng-model='attributionTitleLink' class='pyEditorAttributionTitleLink' placeholder='https://'>"+"<br>"+"<label ng-bind='labels.attributionLicense + \":&nbsp;\"'></label>"+"<input type='text' ng-model='attributionLicense' class='pyEditorAttributionLicense'>"+"<label ng-bind='labels.attributionLicenseLink + \":&nbsp;\"'></label>"+"<input type='text' ng-model='attributionLicenseLink' class='pyEditorAttributionLicenseLink' placeholder='https://'>"+"<button type='button' class='btn btn-xs' ng-click='cancelInsert($event)' ng-bind='labels.cancel'></button>"+"<button type='button' class='btn btn-xs' ng-click='saveAttribution($event)' ng-bind='labels.save'></button>"+"</div>"+"<textarea contenteditable='true' ng-model='textareaData' class='col-xs-12' ng-hide='showAdvanced' rows='"+f.TEXTAREA_ROWS+"' cols='"+f.TEXTAREA_COLS+"'"+L+"></textarea>"+"<div contenteditable='true' ng-model='textData' class='col-xs-12 pyEditorTextareaDiv' ng-show='showAdvanced'></div>"+"</div>")(m),_=t(M).find("textarea"),D=t(M).find(".pyEditorTextareaDiv"),P=D[0];typeof P!="undefined"&&typeof P.value=="undefined"&&(P.value=""),typeof x!="undefined"&&D.attrs("id",x),w.html(M);var H=y("$parent."+C);m.modelChangeDirtyForm=function(){typeof C!="undefined"&&(H(m).$dirty=!0,H(m).$pristine=!1)},c.extendRules(wysihtml5);var B={parserRules:c.parserRules,name:"pyEditorIframe",stylesheets:o.cssBase},j=new wysihtml5.Editor(P,B);wysihtml5.browser.supported()&&(m.showAdvanced=!0);var F=y("$parent."+N),I=j.composer,q=t(M).find(".pyEditorButtonRow");m.$on("$destroy",function(){try{j.destroy()}catch(e){}t(q).find(".editor-button").off(),t(q).find(".editor-dropdown-button").off(),t(q).find(".editor-list-button").off()}),m.clearDropdowns=function(){m.dropdownText=!1,m.dropdownAlign=!1,m.dropdownHeader=!1,m.dropdownFontSize=!1,m.dropdownFormat=!1,m.dropdownColor=!1,m.dropdownLinks=!1,m.dropdownSettings=!1};var R=function(){m.showUser=!1,m.showTag=!1,m.showLink=!1,m.showImage=!1,m.showAttribution=!1},U=function(e,t){m.active[e]=!1;if(typeof t=="undefined")I.commands.state(e)&&(m.active[e]=!0);else{m.active[e+t]=!1;if(I.commands.state(e,t)||I.commands.stateValue(e,t))m.active[e+t]=!0}},z=function(){var e;U("bold"),U("italic"),U("underline"),U("superscript"),U("subscript"),U("justifyLeft"),U("justifyRight"),U("justifyCenter"),U("justifyFull"),U("foreColor","red"),U("foreColor","green"),U("foreColor","blue"),U("foreColor","cyan"),U("foreColor","magenta"),U("foreColor","yellow"),U("fontSize","x-small"),U("fontSize","small"),U("fontSize","medium"),U("fontSize","large"),U("fontSize","x-large")},W=function(){if(!A)return;var e;try{e=j.getValue()}catch(t){return}typeof e=="undefined"&&(e=""),F.assign(m,j.getValue()),m.textData=e},X=function(e){typeof e=="undefined"&&(e=""),F.assign(m,S.convert(e)),m.textareaData=e,P.value=e},V=function(e){if(typeof n.dispatchEvent!="undefined"&&typeof v.document.createEvent!="undefined"){var t=v.document.createEvent("TextEvent");if(typeof t!="undefined"&&typeof t.initTextEvent!="undefined")try{return t.initTextEvent("textInput",!0,!0,null,e),n.dispatchEvent(t),!0}catch(n){return!1}}return!1},J=function(){P.focus();var e=0,t=0,n,r,i,s,o;typeof P.selectionStart=="number"&&typeof P.selectionEnd=="number"?(e=P.selectionStart,t=P.selectionEnd):(r=v.document.selection.createRange(),r&&r.parentElement()===P&&(s=P.value.length,n=P.value.replace(/\r\n/g,"\n"),i=P.createTextRange(),i.moveToBookmark(r.getBookmark()),o=P.createTextRange(),o.collapse(!1),i.compareEndPoints("StartToEnd",o)>-1?e=t=s:(e=-i.moveStart("character",-s),e+=n.slice(0,e).split("\n").length-1,i.compareEndPoints("EndToEnd",o)>-1?t=s:(t=-i.moveEnd("character",-s),t+=n.slice(0,t).split("\n").length-1))));if(e>t){var u=e;e=t,t=u}return{start:e,end:t}},K=function(e,t){typeof t=="undefined"&&(t=e);if(P.setSelectionRange)P.focus(),P.setSelectionRange(e,t);else if(P.createTextRange){var n=P.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select()}},Q=function(e){return typeof e=="undefined"?!1:e===" "||e==="	"||e==="\r"||e==="\n"},G=function(){return"\n"},Y=function(){return 1},Z=function(){var e=J(),t=e.start,n=e.end,r=P.value;typeof r=="undefined"&&(r="");var i=r.substring(t,n),s;for(s=0;s<i.length;s++){if(!Q(i[s]))break;t+=1}if(t<n){i=i.substring(t,i.length);var o;for(s=0;s<i.length;s++){o=i.length-1-s;if(!Q(i[o]))break;n-=1}}return{start:t,end:n}},et=function(e,n,r,i,s,o){typeof e=="undefined"&&(e=0),typeof n=="undefined"&&(n=0);var u,a;typeof s=="undefined"&&(s=0);var f=P.value;typeof f=="undefined"&&(f="");var l=f.substring(0,e),c=f.substring(n,f.length);typeof i=="undefined"&&(i=""),typeof r=="undefined"&&(r="");var h="",p="",d=!1;e!==n&&(d=!0,h=f.substring(e,n));var v=h.split(/\r\n|\r|\n/g),m=T,g=!1;typeof o!="undefined"&&(g=!0);var y="",b="",w,E;for(w=0;w<s;w++)b+=G();var S="";if(v.length===1)g&&(y=""+o),p=p+y+r,u=l.length+p.length,p+=v[0],a=l.length+p.length,p+=i;else if(v.length>1){E=0;for(w=0;w<v.length;w++)S=t.trim(v[w]),typeof S!="undefined"&&S.length!==0&&(g&&(y=""+(E+o),E++),p=p+y+r,typeof u=="undefined"&&(u=l.length+p.length)),p+=v[w],typeof S!="undefined"&&S.length!==0&&(typeof a===undefined&&(a=l.length+p.length),p+=i),w<v.length-1&&(p+=b)}typeof u=="undefined"&&(u=e),typeof a=="undefined"&&(a=n);var x=l;return e=x.length,x+=p,n=x.length,x+=c,{start:e,first:u,end:n,last:a,select:d,text:x,resultText:p}},tt=function(e,t,n,r){var i=J(),s=i.start,o=i.end;return et(s,o,e,t,n,r)},nt=function(e){r(function(){V(e.resultText)||ct(e.text),e.select?K(e.end):K(e.first)})},rt=function(e,t,n){var r=e.start,i=e.end;typeof t=="undefined"&&(t=0),typeof n=="undefined"&&(n=0);var s=e.text.substring(0,r),o=e.text.substring(i,e.text.length),u,a,f,l=t;if(t>0){f=0;for(u=0;u<s.length;u++){a=s.length-1-u;if(!Q(s[a]))break;f++,s[a]==="\n"&&l--;if(l<=0)break}}var c=n;if(n>0){f=0;for(u=0;u<o.length;u++){if(!Q(o[u]))break;f++,o[u]==="\n"&&c--;if(c<=0)break}}l<0&&(l=0),c<0&&(c=0);if(l>0||c>0){var h="";for(u=0;u<l;u++)h+=G();var p="";for(u=0;u<c;u++)p+=G();e.start=s.length,e.end=s.length+e.resultText.length+(l+c)*Y(),e.first=e.first+l*Y(),e.last=e.last+l*Y(),e.resultText=h+e.resultText+p,e.text=s+e.resultText+o}return e},it,st=function(){m.showAdvanced&&(it=I.selection.getBookmark())},ot=function(){},ut=function(e,t,n,i){if(i&&it)r(function(){I.selection.setBookmark(it);try{I.commands.exec(t,n),j.focus()}catch(e){}},0);else try{I.commands.exec(t,n),j.focus()}catch(s){}},at=function(e,t,n,r,i,s,o,u,a,f){var l;e?l=tt(r,i,s,f):l=et(t,n,r,i,s,f),typeof o!="undefined"&&typeof u!="undefined"&&(l=rt(l,o,u)),a?a(l):nt(l)},ft=ot,lt=at,ct=X,ht=X,pt,dt="keypress keyup keydown paste change focus blur";if(m.showAdvanced){ft=ut,lt=ot,ct=W,ht=function(e){if(!A){pt=e;return}if(typeof e=="undefined"||e==="")e=" ";try{j.setValue(e,!1)}catch(t){}F.assign(m,e),m.textData=e},j.on("load",function(){A=!0,typeof vt!="undefined"&&vt()}),j.on("change",function(){ct(),m.modelChangeDirtyForm(),z()}),j.on("focus",function(){ct(),m.clearDropdowns()}),j.on("blur",function(){ct(),z()}),j.on("tableselect",function(){m.showTable=!0}),j.on("tableunselect",function(){m.showTable=!1}),m.$on(h.SET_EDITOR,function(e,t){e.defaultPrevented||(n.isDefined(t)||(t=""),e.preventDefault(),ht(t))});try{t(q).find(".editor-button").mousedown(function(e){var t=I.selection.getBookmark();e.preventDefault(),r(function(){I.selection.setBookmark(t)},0);try{j.focus()}catch(n){}}),t(q).find(".editor-dropdown-button").click(function(e){e.preventDefault(),e.stopPropagation()}),t(q).find(".editor-list-button").mousedown(function(e){e.preventDefault(),e.stopPropagation()})}catch(P){}}else _.on("blur",function(){ct(m.textareaData)});var vt=function(){r(function(){var e=F(m);typeof pt!="undefined"&&(e=pt),typeof ht!="undefined"&&ht(e)},0)};b.$on(h.UNSAVED_CHANGES_COMPLETE,function(e){vt()}),vt(),m.$watch("$parent."+m.$parent[p.SINGLE]+"."+d.DATA+"."+d.SINGLE,function(e,t){e!==t&&vt()}),m.cancelInsert=function(e){R()},m.saveUser=function(e){var t={};t[a.USER]=m.userName,ft(e,"insertHTML",s.user(m.userName,g.href(u.USERS_ID,t,{absolute:!0})),!0),lt(!0,undefined,undefined,"@["+m.userName,"]",1),R()},m.saveTag=function(e){var t={};t[a.TAG]=m.tagName,ft(e,"insertHTML",s.tag(m.tagName,g.href(u.TAGS_ID,t,{absolute:!0})),!0),lt(!0,undefined,undefined,"#["+m.tagName,"]",1),R()},m.saveLink=function(e){ft(e,"createLink",{href:m.linkHref},!0);if(!m.showAdvanced){var t=m.linkHref,n=J(),r=et(n.start,n.end,"[","]",1);typeof t!="undefined"&&t.lastIndexOf("http://",0)!==0&&t.lastIndexOf("https://",0)!==0&&(t="http://"+t);var i="("+t+")",s=r.text.substring(0,r.end),o=r.text.substring(r.end,r.text.length);r.resultText=r.resultText+i,r.end=r.end+i.length,r.text=s+i+o,r=rt(r,1,1),nt(r)}R()},m.saveImage=function(e){ft(e,"insertImage",{src:m.imageHref,width:m.imageWidth,height:m.imageHeight},!0);if(!m.showAdvanced){var t="*",n="*",r="",i=m.imageHref;if(typeof m.imageWidth!="undefined"&&m.imageWidth.length>0||typeof m.imageHeight!="undefined"&&m.imageHeight.length>0)typeof m.imageWidth!="undefined"&&m.imageWidth.length>0&&(n=m.imageWidth),typeof m.imageHeight!="undefined"&&m.imageHeight.length>0&&(t=m.imageHeight),r=" ="+n+"x"+t;if(typeof m.imageHref=="undefined")return;typeof i!="undefined"&&i.lastIndexOf("http://",0)!==0&&i.lastIndexOf("https://",0)!==0&&(i="https://"+i);var s=J(),o=et(s.start,s.end,"![","]",1),u="("+i+r+")",a=o.text.substring(0,o.end),f=o.text.substring(o.end,o.text.length);o.resultText=o.resultText+u,o.end=o.end+u.length,o.text=a+u+f,o=rt(o,1,1),nt(o)}R()},m.saveAttribution=function(e){var t=m.attributionTitle;t===""&&(t=undefined);var n=m.attributionTitleLink;n===""&&(n=undefined);var r=m.attributionAuthor;r===""&&(r=undefined);var i=m.attributionAuthorLink;i===""&&(i=undefined);var o=m.attributionLicense;o===""&&(o=undefined);var u=m.attributionLicenseLink;u===""&&(u=undefined);var a=s.attribution(t,n,r,i,o,u);ft(e,"insertHtml",a,!0),lt(!0,undefined,undefined,a,"",1),R()};var mt=function(e,n,r){t(M).find(e).bind("keyup",function(e){e.keyCode===13?n():e.keyCode===27&&r()})};try{mt(".pyEditorShowUser input",m.saveUser,m.cancelInsert),mt(".pyEditorShowTag input",m.saveTag,m.cancelInsert),mt(".pyEditorShowLink input",m.saveLink,m.cancelInsert),mt(".pyEditorShowImage input",m.saveImage,m.cancelInsert),mt(".pyEditorShowAttribution input",m.saveAttribution,m.cancelInsert)}catch(P){}m.bold=function(e){ft(e,"bold"),lt(!0,undefined,undefined,"<strong>","</strong>",1)},m.italic=function(e){ft(e,"italic"),lt(!0,undefined,undefined,"<em>","</em>",1)},m.underline=function(e){ft(e,"underline"),lt(!0,undefined,undefined,"<u>","</u>",1)},m.superscript=function(e){ft(e,"superscript"),lt(!0,undefined,undefined,"<sup>","</sup>",1)},m.subscript=function(e){ft(e,"subscript"),lt(!0,undefined,undefined,"<sub>","</sub>",1)},m.alignLeft=function(e){ft(e,"justifyLeft"),lt(!0,undefined,undefined,"%["+l.ALIGN_LEFT_START_STRING+"]","%["+l.ALIGN_END_STRING+"]",1)},m.alignRight=function(e){ft(e,"justifyRight"),lt(!0,undefined,undefined,"%["+l.ALIGN_RIGHT_START_STRING+"]","%["+l.ALIGN_END_STRING+"]",1)},m.alignCenter=function(e){ft(e,"justifyCenter"),lt(!0,undefined,undefined,"%["+l.ALIGN_CENTER_START_STRING+"]","%["+l.ALIGN_END_STRING+"]",1)},m.alignJustify=function(e){ft(e,"justifyFull"),lt(!0,undefined,undefined,"%["+l.ALIGN_JUSTIFY_START_STRING+"]","%["+l.ALIGN_END_STRING+"]",1)},m.header1=function(e){ft(e,"formatBlock","h1"),lt(!0,undefined,undefined,"## "," ##",1,1,1)},m.header2=function(e){ft(e,"formatBlock","h2"),lt(!0,undefined,undefined,"","\n=====",2,1,1)},m.normal=function(e){ft(e,"formatBlock","")},m.blockquote=function(e){ft(e,"formatBlock","blockquote"),lt(!0,undefined,undefined,"> ","",1,1,1)},m.code=function(e){ft(e,"formatBlock","code"),lt(!0,undefined,undefined,"`","`",1)},m.pre=function(e){ft(e,"formatBlock","pre"),lt(!0,undefined,undefined,"<pre>","</pre>",1)},m.fontXSmall=function(e){ft(e,"fontSize","x-small"),lt(!0,undefined,undefined,"%["+l.FONT_SIZE_XSMALL_START_STRING+"]","%["+l.FONT_SIZE_END_STRING+"]",1)},m.fontSmall=function(e){ft(e,"fontSize","small"),lt(!0,undefined,undefined,"%["+l.FONT_SIZE_SMALL_START_STRING+"]","%["+l.FONT_SIZE_END_STRING+"]",1)},m.fontMedium=function(e){ft(e,"fontSize","medium"),lt(!0,undefined,undefined,"%["+l.FONT_SIZE_MEDIUM_START_STRING+"]","%["+l.FONT_SIZE_END_STRING+"]",1)},m.fontLarge=function(e){ft(e,"fontSize","large"),lt(!0,undefined,undefined,"%["+l.FONT_SIZE_LARGE_START_STRING+"]","%["+l.FONT_SIZE_END_STRING+"]",1)},m.fontXLarge=function(e){ft(e,"fontSize","x-large"),lt(!0,undefined,undefined,"%["+l.FONT_SIZE_XLARGE_START_STRING+"]","%["+l.FONT_SIZE_END_STRING+"]",1)},m.unorderedList=function(e){ft(e,"insertUnorderedList"),lt(!0,undefined,undefined,"- ","",1,2,1)},m.orderedList=function(e){ft(e,"insertOrderedList"),lt(!0,undefined,undefined,". ","",1,2,1,undefined,1)},m.indent=function(e){ft(e,"insertHtml","&ensp;&ensp;"),lt(!0,undefined,undefined,"&ensp;&ensp;","",1,undefined,undefined,function(e){e.first=e.end,e.last=e.end,nt(e)})},m.lineBreak=function(e){ft(e,"insertLineBreak"),lt(!0,undefined,undefined,"<br>","",1,undefined,undefined,function(e){e.first=e.end,e.last=e.end,nt(e)})},m.pageBreak=function(e){ft(e,"insertHtml","<hr>"),lt(!0,undefined,undefined,"<hr>","",1,2,1,function(e){e.first=e.end,e.last=e.end,nt(e)})},m.colorRed=function(e){ft(e,"foreColor","red"),lt(!0,undefined,undefined,"%["+l.FONT_COLOR_RED_START_STRING+"]","%["+l.FONT_COLOR_END_STRING+"]",1)},m.colorGreen=function(e){ft(e,"foreColor","green"),lt(!0,undefined,undefined,"%["+l.FONT_COLOR_GREEN_START_STRING+"]","%["+l.FONT_COLOR_END_STRING+"]",1)},m.colorBlue=function(e){ft(e,"foreColor","blue"),lt(!0,undefined,undefined,"%["+l.FONT_COLOR_BLUE_START_STRING+"]","%["+l.FONT_COLOR_END_STRING+"]",1)},m.colorCyan=function(e){ft(e,"foreColor","cyan"),lt(!0,undefined,undefined,"%["+l.FONT_COLOR_CYAN_START_STRING+"]","%["+l.FONT_COLOR_END_STRING+"]",1)},m.colorMagenta=function(e){ft(e,"foreColor","magenta"),lt(!0,undefined,undefined,"%["+l.FONT_COLOR_MAGENTA_START_STRING+"]","%["+l.FONT_COLOR_END_STRING+"]",1)},m.colorYellow=function(e){ft(e,"foreColor","yellow"),lt(!0,undefined,undefined,"%["+l.FONT_COLOR_YELLOW_START_STRING+"]","%["+l.FONT_COLOR_END_STRING+"]",1)};var gt=t(M).find("input.pyEditorUserName"),yt=t(M).find("input.pyEditorTagName"),bt=t(M).find("input.pyEditorLinkHref"),wt=t(M).find("input.pyEditorImageHref"),Et=t(M).find("input.pyEditorAttributionAuthor");m.addUser=function(e){R(),st(),m.userName="",m.showUser=!0,r(function(){typeof gt!="undefined"&&gt.focus()},0)},m.addTag=function(e){R(),st(),m.tagName="",m.showTag=!0,r(function(){typeof yt!="undefined"&&yt.focus()},0)},m.link=function(e){R(),st(),m.linkHref="",m.showLink=!0,r(function(){typeof bt!="undefined"&&bt.focus()},0)},m.removeLink=function(e){ft(e,"removeLink")},m.image=function(e){R(),st(),m.imageHref="",m.imageWidth="",m.imageHeight="",m.showImage=!0,r(function(){typeof wt!="undefined"&&wt.focus()},0)},m.attribution=function(e){R(),st(),m.attributionAuthor="",m.attributionAuthorLink="",m.attributionTitle="",m.attributionTitleLink="",m.attributionLicense="",m.attributionLicenseLink="",m.showAttribution=!0,r(function(){typeof Et!="undefined"&&Et.focus()},0)},m.undo=function(e){ft(e,"undo")},m.redo=function(e){ft(e,"redo")},m.toggleView=function(e){try{j.currentView===j.textarea||j.currentView==="source"?(j.fire("change_view","composer"),m.htmlMode=!1):(j.fire("change_view","textarea"),m.htmlMode=!0)}catch(t){}},S.managePreEvent(m,function(){if(m.showAdvanced)try{if(j.currentView===j.textarea||j.currentView==="source")j.fire("change_view","composer"),m.htmlMode=!1,ct()}catch(e){}})}}}])}),define("js/constants/help-topics",[],function(){return{ACCOUNT:{name:"account",sections:{REGISTER:"register",LOGIN:"login",USERNAME:"username",EMAIL:"email",PASSWORD:"password",LOCKED:"locked",IDLE:"idle",THEFT:"theft",DELETED:"deleted",WARNING:"warning",COMMENTS_DISABLED:"commentsDisabled",PROMOTE_DISABLED:"promoteDisabled",CACHE_DELAY:"cacheDelay"}},CURRENT:{name:"profile",sections:{DESCRIPTION:"description",APPRECIATION_RESPONSE:"appreciationResponse",WARNING:"warning"}},PAYMENT:{name:"payment",sections:{COINS:"coins",PROMOTION:"promotion",APPRECIATION:"appreciation",PAYMENT:"payment",PROCESSING:"processing"}},EDITOR:{name:"editor",sections:{PREVIEW:"preview",USER:"user",TAG:"tag",LINK:"link",IMAGE:"image",SECURE_IMAGE:"secureImage"}},POSTINGS:{name:"posts",sections:{CREATE:"create",EDIT:"edit",TITLE:"title",TAGS:"tags",WARNING:"warning",PROMOTE:"promote",APPRECIATE:"appreciate",IMAGE:"image",PREVIEW:"preview",FLAG:"flag"}},COMMENTS:{name:"comments",sections:{CREATE:"reply",WARNING:"warning",PROMOTE:"promote",APPRECIATE:"appreciate",FLAG:"flag"}},TAGS:{name:"tags",sections:{CREATE:"tag",POSTINGS:"postings",PROMOTE:"promote"}},USERS:{name:"users",sections:{APPRECIATION_RESPONSE:"appreciationResponse",MESSAGE:"message",MESSAGE_FLAG:"messageFlag",ACTIVITY:"activity",FOLLOW:"follow",FLAG:"flag"}}}}),define("js/directive/py-bind-convert-html",["./module","jquery","angular","js/util/i18n","js/util/utils","js/constants/values","js/constants/help-topics","js/constants/webapp","js/constants/view-urls","js/constants/params"],function(e,t,n,r,i,s,o,u,a,f){var l="pyBindConvertHtml",c=function(){return"<span><div class='row'><span class='col-xs-12 well'><strong class='pyBCHError'></strong></span></div><span class='pyBCHMarkup'></span></span>"},h=function(e,t){try{var n=t.split("/")[0];if(!(i.isExternalUrl(u.DOMAIN,this.hostname)||n!=="http:"&&n!=="https:"))return t;var r={};return r[f.EXTERNAL_URL]=t,i.constructPath(a.EXTERNAL_URL,undefined,r)}catch(s){return i.constructPath(a.NOT_FOUND)}},p=function(e){return typeof e=="undefined"?undefined:(e.find("a[href]").attr("href",h),e)},d=function(e){return["$rootScope","$sce","$sanitize","$parse","$compile",function(t,n,i,s,o){return{restrict:"A",link:function(t,u,a){function l(){return(f(t)||"").toString()}u.data("$binding",a[e]);var f=s(a[e]),h=o(c())(t);r(function(e){h.find(".pyBCHError").text(e("shared:html.error"))});var d=function(){return"<span py-secure-image></span>"};t.$watch(l,function(){var r;try{var s=f(t);typeof s=="undefined"&&(s="");var a=n.getTrustedHtml(i(s));u.html(a),p(u)}catch(l){r=f(t);if(typeof r=="undefined"||typeof r!="string")r="";var c=r.split("\n"),d=o("<p></p>")(t),v;for(var m=0;m<c.length;m++)v=o("<p></p>")(t),v.text(c[m]),d.append(v);h.find(".pyBCHMarkup").html(d),u.html(h)}})}}}]};e.directive(l,d(l))}),define("js/directive/py-scrollspy",["./module","jquery","angular"],function(e,t,n){e.directive("scrollSpy",["$timeout",function(e){return{restrict:"A",link:function(e,n,r){var i=parseInt(r.scrollOffset,10);i||(i=10),typeof n!="undefined"&&typeof n.scrollspy!="undefined"&&t("body").scrollspy({target:"#"+r.scrollSpy,offset:i})}}}]),e.directive("preventDefault",function(){return function(e,n,r){t(n).click(function(e){e.preventDefault()})}}),e.directive("scrollTo",["$window","Browser",function(e,t){return{restrict:"AC",compile:function(){function n(n){n||e.scrollTo(0,0),t.scrollTo(n)}return function(e,t,r){t.bind("click",function(e){n(r.scrollTo)})}}}}])}),define("js/directive/py-tour",["./module","jquery","angular","js/util/utils","js/constants/events","js/constants/tour-states","js/constants/values"],function(e,t,n,r,i,s,o){var u="pyTourSection",a="pyTourSubSection",f="pyTourAuthed";e.directive(u,["$rootScope","$compile","$timeout","Browser","Tour",function(e,t,n,s,l){return{restrict:"A",link:function(s,c,h){var p=h[u],d=h[a],v=h[f];typeof v!="undefined"&&v.toUpperCase()==="TRUE"?v=!0:v=!1;var m={trigger:"manual",template:"<div class='popover' role='tooltip'><div class='arrow'></div><h4 class='popover-title fs-2'></h4><div class='popover-content'></div><div class='popover-links'></div></div>"},g;if(typeof c!="undefined"&&typeof c.find!="undefined"){var y=c.find(".pyTourSectionSubElement");typeof y!="undefined"&&typeof y.filter!="undefined"&&(g=y.filter(":last"),g.popover(m))}var b=t("<a href='"+o.VOID_ACTION+"' ng-click='hide()' class='pull-left btn'>"+"<i class='fa fa-fw fa-2x fa-stop' />"+"</a>"+"<a href='"+o.VOID_ACTION+"' ng-click='next()' class='pull-right btn'>"+"<i class='fa fa-fw fa-2x fa-play' />"+"</a>")(s),w=!1,E=!1,S=function(e){if(typeof e=="undefined")return},x=function(e){E=e,e?s.$evalAsync(function(){n(function(){typeof g!="undefined"&&g.popover("show")},1)}):typeof g!="undefined"&&g.popover("hide")},T;typeof p!="undefined"&&typeof d!="undefined"&&typeof v!="undefined"&&(T=e.$on(i.TOUR_SECTION_CHANGE,function(e,t,n,r,i){i?t===p&&n===d&&r===v?x(!0):E&&x(!1):x(!1)})),s.next=function(){l.next(p)},s.hide=function(){l.hide()},typeof g!="undefined"&&g.on("shown.bs.popover",function(){w||(c.find(".popover-links").filter(":last").html(b),w=!0),c.find(".arrow").css("top",""),S(r.getTourId(p,d,v))}),s.$on("$destroy",function(){typeof T!="undefined"&&(T(),T=undefined),typeof g!="undefined"&&g.unbind("shown.bs.popover")})}}}])}),define("js/directive/index",["./directive","./py-editor","./py-bind-convert-html","./py-scrollspy","./py-tour"],function(){}),define("js/filter/module",["angular"],function(e){return e.module("app.filter",[])}),define("js/filter/filter",["./module"],function(e){}),define("js/filter/index",["./filter"],function(){}),define("js/app",["angular","js/constants/whitelist-urls","js/controller/index","js/service/index","js/directive/index","js/filter/index","angular-ui-router","angular-ui-bootstrap","angular-sanitize","angulartics","angularticsClicky"],function(e,t){return e.module("app",["app.controller","app.service","app.directive","app.filter","app.admin","ui.router","ui.bootstrap","ngSanitize","angulartics","angulartics.clicky"]).run(["$rootScope","$state","$stateParams",function(e,t,n){e.$state=t,e.$stateParams=n}]).config(["$sceDelegateProvider","$compileProvider","$provide","$analyticsProvider",function(e,n,r,i){e.resourceUrlWhitelist(t.URLS),r.decorator("$exceptionHandler",["$delegate","$window",function(e,t){var n=t.pyGetClientConfig();return typeof n!="undefined"&&n.production?function(e,t){}:function(t,n){e(t,n)}}])}])}),define("js/util/route-utils",["jquery","js/constants/partials"],function(e,t){var n=window.pyJsPartials();typeof n=="undefined"&&(n={});var r=function(){var e={};for(var t in n)n.hasOwnProperty(t)&&(e[t]={template:n[t],reloadOnSearch:!1});return e},i=["Loaded",function(e){e.resetInfo(!0),e.loadedInfo()}],s=["Loaded",function(e){e.resetInfo(!1),e.loadedInfo()}],o=["Loaded","Single",function(e,t){e.resetSingle(!1),t.clear()}],u=[function(){}],a="<div loaded-info></div>",f="<div loaded-single></div>",l="<div loaded-page></div>",c=function(e){return"^"+e},h={controller:u,reloadOnSearch:!1},p=function(e){return typeof e=="undefined"?h:{template:n[t.ROOT],controller:e,reloadOnSearch:!1}},d={template:a,controller:s,reloadOnSearch:!1},v=function(e,t){t=t||s;var n={};return n.controller=t,n.reloadOnSearch=!1,typeof e!="undefined"?n.templateUrl=e:n.template=a,n},m={template:f,controller:o,reloadOnSearch:!1},g=function(e,t){t=t||o;var n={};return n.controller=t,n.reloadOnSearch=!1,typeof e!="undefined"?n.templateUrl=e:n.template=f,n},y={template:l,reloadOnSearch:!1},b=function(e){return{templateUrl:e}},w={template:"",controller:["Loaded","Pageable",function(e,t){e.resetPage(!1),t.clear()}],reloadOnSearch:!1},E=function(e){return{controller:e,reloadOnSearch:!1}},S=function(e,t){var n=p(e),i=t||d,s=r();return s["info@"]=i,s["root@"]=n,s};return{controllers:{info:i,noInfo:s,noSingle:o},templates:{info:a,single:f,page:l},blanks:{info:d,single:m,page:y,pageLoader:w},funcs:{url:c,views:S,info:v,single:g,page:b,pageLoader:E}}}),define("js/constants/partial-urls",["js/constants/view-urls"],function(e){var t="/partials",n=t+"/info",r=t+"/single",i=t+"/page",s=t+"/subNav",o="/create",u="/preview",a="/response",f="/search",l="/email",c="/message",h="/change";return{LOGGED_OUT:n+e.LOGGED_OUT,NOT_FOUND:n+e.NOT_FOUND,REDIRECTING:n+e.NO_CONTENT,EXTERNAL_URL:n+e.EXTERNAL_URL,DELETED:n+e.DELETED,RESET_PASSWORD:n+e.RESET_PASSWORD,CREATE_POSTING:n+e.POSTINGS+o,CREATE_MESSAGE:n+e.MESSAGES+o,EMAIL_CHANGE:n+e.EMAIL_CHANGE,PASSWORD_CHANGE_UNAUTHED:n+e.PASSWORD_CHANGE,PAYMENT_CHANGE:n+e.PAYMENT_CHANGE,SETTINGS:n+e.SETTINGS,TERMS:n+e.TERMS,WELCOME:n+e.WELCOME,ACCOUNT:n+e.ACCOUNT,CAREERS:n+e.CAREERS,SUPPORT:n+e.SUPPORT,HELP:n+e.HELP}}),define("js/routes",["./app","jquery","jquery-cookie","js/util/route-utils","js/util/utils","js/constants/cookies","js/constants/view-urls","js/constants/partial-urls","js/constants/states","js/constants/content-types","js/constants/roles","js/constants/path-variables"],function(e,t,n,r,i,s,o,u,a,f,l,c){return e.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,t,n){var i=r.funcs.url,h=r.funcs.views,p=r.funcs.info,d=r.funcs.single,v=r.funcs.page,m=r.funcs.pageLoader,g=r.controllers.info,y=function(e){return u.HELP+"/"+e[c.HELP]},b=function(e){var t="helpTopics";return typeof e=="undefined"?t+".default":t+"."+e[c.HELP]},w=s.getCookieOptions(),E={domain:w.domain,path:w.path,secure:w.secure},S=function(){return o.POSTINGS};t.when(o.INDEX,S).when(o.INDEX_BLANK,S).otherwise(o.NOT_FOUND),t.rule(function(e,t){var n=t.url().split("?"),r=n[0],i=n[1],s=r[r.length-1]==="/";if(s){var o=r.substr(0,r.length-1);return typeof i=="undefined"?o:o+"?"+i}});var x=l.overrideRoles;e.state(a.ROOT,{"abstract":!0}).state(a.NOT_FOUND,{title:"notFound",url:i(o.NOT_FOUND),views:h(undefined,p(u.NOT_FOUND,g))}).state(a.LOGGED_OUT,{title:"loggedOut",url:i(o.LOGGED_OUT),views:h(undefined,p(u.LOGGED_OUT,g))}).state(a.RESET_PASSWORD,{title:"resetPassword",url:i(o.RESET_PASSWORD),views:h(undefined,p(u.RESET_PASSWORD,"ResetPasswordController")),authentication:!1}).state(a.DELETED,{url:i(o.DELETED),views:h(undefined,p(u.DELETED,"DeletedController"))}).state(a.EMAIL_CHANGE,{title:"emailLink.email",url:i(o.EMAIL_CHANGE),views:h(undefined,p(u.EMAIL_CHANGE,"EmailChangeController"))}).state(a.PAYMENT_CHANGE,{title:"emailLink.payment",url:i(o.PAYMENT_CHANGE),views:h(undefined,p(u.PAYMENT_CHANGE,"PaymentChangeController"))}).state(a.PASSWORD_CHANGE,{title:"emailLink.password",url:i(o.PASSWORD_CHANGE),views:h(undefined,p(u.PASSWORD_CHANGE_UNAUTHED,"PasswordChangeUnauthedController")),authentication:!1}).state(a.CONFIRMATION,{url:i(o.CONFIRMATION),views:h(undefined,p(u.REDIRECTING,"ConfirmationController"))}).state(a.DELETION,{url:i(o.DELETION),views:h(undefined,p(u.REDIRECTING,"DeletionController"))}).state(a.SETTINGS,{title:"settings",url:i(o.SETTINGS),views:h(undefined,p(u.SETTINGS,"SettingsController"))}).state(a.SETTINGS_ERROR,{title:"settings",url:i(o.SETTINGS_ERROR),views:h(undefined,p(u.REDIRECTING,"SettingsErrorController"))}).state(a.TERMS,{title:"terms",url:i(o.TERMS),views:h(undefined,p(u.TERMS,"TermsController")),skipBack:!0}).state(a.EXTERNAL_URL,{title:"externalUrl",url:i(o.EXTERNAL_URL),views:h(undefined,p(u.EXTERNAL_URL,"ExternalUrlController")),skipBack:!0}).state(a.PAYMENT_SUCCESS,{url:i(o.PAYMENT_SUCCESS),views:h(undefined,p(u.REDIRECTING,"PaymentSuccessController"))}).state(a.PAYMENT_CANCEL,{url:i(o.PAYMENT_CANCEL),views:h(undefined,p(u.REDIRECTING,"PaymentCancelController"))}).state(a.POSTINGS_CREATE,{title:"create.posting",url:i(o.POSTINGS_CREATE),views:h(undefined,p(u.CREATE_POSTING,"CreatePostingController")),authentication:!0,overrideRoles:[x.UNACCEPTED]}),e.state(a.WELCOME,{title:"welcome",url:i(o.WELCOME),views:h(undefined,p(u.WELCOME,g))}).state(a.ACCOUNT,{title:"account",url:i(o.ACCOUNT),views:h(undefined,p(u.ACCOUNT,g))}).state(a.CAREERS,{title:"careers",url:i(o.CAREERS),views:h(undefined,p(u.CAREERS,g))}).state(a.SUPPORT,{title:"support",url:i(o.SUPPORT),views:h(undefined,p(u.SUPPORT,g))}).state(a.HELP,{title:"help",url:i(o.HELP),views:h(undefined,p(u.HELP,g))}).state(a.HELP_ID,{title:"help",url:i(o.HELP_ID),views:h(undefined,p(y,"HelpController"))}),e.state(a.POSTINGS,{title:"postings",url:i(o.POSTINGS),views:h("PostingsController")}).state(a.POSTINGS_ID,{title:"postings",url:i(o.POSTINGS_ID),views:h("SinglePostingController"),single:f.POSTING}).state(a.POSTINGS_ID_TITLE,{title:"postings",url:i(o.POSTINGS_ID_TITLE),views:h("SinglePostingController"),single:f.POSTING}),e.state(a.COMMENTS,{title:"comments",url:i(o.COMMENTS),views:h("CommentsController")}).state(a.COMMENTS_ID,{title:"comments",url:i(o.COMMENTS_ID),views:h("SingleCommentController"),single:f.COMMENT}),e.state(a.TAGS,{title:"tags",url:i(o.TAGS),views:h("TagsController")}).state(a.TAGS_ID,{title:"tags",url:i(o.TAGS_ID),views:h("SingleTagController"),single:f.TAG}).state(a.TAGS_ID_REPLIES,{title:"replies",url:i(o.TAGS_ID_REPLIES),views:h("SingleTagController"),single:f.TAG}),e.state(a.USERS,{title:"users",url:i(o.USERS),views:h("UsersController")}).state(a.USERS_ID,{title:"users",url:i(o.USERS_ID),views:h("SingleUserController"),single:f.USER}).state(a.USERS_ID_REPLIES,{title:"replies",url:i(o.USERS_ID_REPLIES),views:h("SingleUserController"),single:f.USER}).state(a.USERS_ID_POSTINGS,{title:"postings",url:i(o.USERS_ID_POSTINGS),views:h("SingleUserController"),single:f.USER}).state(a.USERS_ID_COMMENTS,{title:"comments",url:i(o.USERS_ID_COMMENTS),views:h("SingleUserController"),single:f.USER}).state(a.USERS_ID_FOLLOWERS,{title:"followers",url:i(o.USERS_ID_FOLLOWERS),views:h("SingleUserController"),single:f.USER}).state(a.USERS_ID_FOLLOWEES,{title:"followees",url:i(o.USERS_ID_FOLLOWEES),views:h("SingleUserController"),single:f.USER}).state(a.USERS_ID_MESSAGES,{title:"messages",url:i(o.USERS_ID_MESSAGES),views:h("MessagesController",p(u.CREATE_MESSAGE,"CreateMessageController")),single:f.USER,authentication:!0,overrideRoles:[x.UNACCEPTED]}),e.state(a.CURRENT,{title:"current",url:i(o.CURRENT),views:h("SingleCurrentController"),single:f.CURRENT,authentication:!0}).state(a.CURRENT_REPLIES,{title:"replies",url:i(o.CURRENT_REPLIES),views:h("SingleCurrentController"),single:f.CURRENT,authentication:!0}).state(a.CURRENT_POSTINGS,{title:"postings",url:i(o.CURRENT_POSTINGS),views:h("SingleCurrentController"),single:f.CURRENT,authentication:!0}).state(a.CURRENT_COMMENTS,{title:"comments",url:i(o.CURRENT_COMMENTS),views:h("SingleCurrentController"),single:f.CURRENT,authentication:!0}).state(a.CURRENT_SELF_POSTINGS,{title:"postings",url:i(o.CURRENT_SELF_POSTINGS),views:h("SingleCurrentController"),single:f.CURRENT,authentication:!0}).state(a.CURRENT_SELF_COMMENTS,{title:"comments",url:i(o.CURRENT_SELF_COMMENTS),views:h("SingleCurrentController"),single:f.CURRENT,authentication:!0}).state(a.FEED,{title:"feed",url:i(o.FEED),views:h("FeedController"),single:f.CURRENT,authentication:!0}).state(a.NOTIFICATIONS,{title:"notifications",url:i(o.NOTIFICATIONS),views:h("NotificationsController"),single:f.CURRENT,authentication:!0}).state(a.MESSAGES,{title:"messages",url:i(o.MESSAGES),views:h("ConversationsController"),single:f.CURRENT,authentication:!0,overrideRoles:[x.UNACCEPTED]}).state(a.FOLLOWERS,{title:"followers",url:i(o.FOLLOWERS),views:h("SingleCurrentController"),single:f.CURRENT,authentication:!0}).state(a.FOLLOWEES,{title:"followees",url:i(o.FOLLOWEES),views:h("SingleCurrentController"),single:f.CURRENT,authentication:!0}).state(a.BLOCKED,{title:"blocked",url:i(o.BLOCKED),views:h("SingleCurrentController"),single:f.CURRENT,authentication:!0}),n.html5Mode(!0)}])}),define("adminRoutes",["angular"],function(e){return e.module("app.admin",["app.controller"])}),define("js/main",["jquery","bootstrap","angular","moment","js/util/i18n","js/app","js/routes","adminRoutes","payment"],function(e,t,n,r,i,s){e(document).ready(function(){n.bootstrap(document,["app"])})});